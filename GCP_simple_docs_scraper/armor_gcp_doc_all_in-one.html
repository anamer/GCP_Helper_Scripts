<p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs]</H1></p><div class="devsite-article-body clearfix devsite-no-page-title">
<article id="cloud-site">
<nav class="cloud-jump-menu cloud-jump-menu__prebuilt" data-cloud-menu-label="Google Cloud Armor documentation">
<div class="cloud-menu-content">
<a class="cloud-jump-menu__toggle" href="#">Google Cloud Armor documentation<i aria-hidden="true" class="material-icons" translate="no"><span></span></i></a>
<div class="cloud-jump-menu__links">
<h1 class="cloud-subhead" data-text="Google Cloud Armor documentation" id="google-cloud-armor-documentation">Google Cloud Armor documentation</h1>
<!-- first_jump_section_label -->
<div class="cloud-jump-menu__links">
<a class="cloud-jump-menu__item" href="#docs" track-metadata-eventdetail="Overview" track-metadata-module="left nav" track-metadata-position="left nav" track-name="leftJumpNav" track-type="navigation">
<div class="cloud-body-text__small cloud-jump-menu__item__main">
      Overview
    </div>
</a>
<!-- hero_headline -->
<!-- Training and tutorials -->
<!-- use-cases -->
<!-- Code samples -->
<!--  Videos -->
<a class="cloud-jump-menu__item" href="#videos" track-metadata-eventdetail="Videos" track-metadata-module="left nav" track-metadata-position="left nav" track-name="leftJumpNav" track-type="navigation">
<div class="cloud-body-text__small cloud-jump-menu__item__main">
        Videos
      </div>
</a>
</div>
</div>
</div>
</nav>
<div class="cloud-jump-content cloud-jump-section" data-cloud-main-text="Overview" id="docs">
<div class="cloud-section cloud-section--no-padding-bottom cloud-section__header--small">
<div class="page-intro">
<p>
  Google Cloud Armor helps protect your infrastructure and applications from
  Layer 3/Layer 4 network or protocol-based volumetric distributed denial-of-service (DDoS) attacks,
  volumetric Layer 7 attacks, and other targeted application attacks. It leverages Google's
  global network and distributed infrastructure to detect and absorb attacks and filter traffic
  through user-configurable security policies at the edge of Google's network, far upstream of your
  workloads.
  <a href="/armor/docs/security-policy-overview" track-name="introLearnMore" track-type="landingPage">Learn more</a>
</p>
</div>
</div>
<div class="cloud-section--small cloud-section--no-padding-top hero-section">
<div class="cloud-grid--alternate cloud-copy__inner cloud-copy--three-column">
<div class="cloud-grid--alternate cloud-grid--row-gap cloud-grid__col is-12 is-12__large">
<div class="cloud-grid__col is-6 is-4__large">
<div class="cloud-list-card cloud-elevation-z0">
<div class="cloud-list-card__content">
<div class="cloud-list-card__header-border">
<h4 class="cloud-list-card__subhead cloud-body-text" data-text="Guides" id="guides">Guides</h4>
</div>
<ul class="cloud-list-card__list">
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/docs/security-policy-overview" track-metadata-category="Guides" track-metadata-child_headline="Google Cloud Armor security policy overview" track-metadata-eventdetail="/armor/docs/security-policy-overview" track-metadata-position="0" track-name="
  Google Cloud Armor security policy overview
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Google Cloud Armor security policy overview
      </p>
</div>
</a>
</li>
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/docs/configure-security-policies" track-metadata-category="Guides" track-metadata-child_headline="Configuring security policies" track-metadata-eventdetail="/armor/docs/configure-security-policies" track-metadata-position="1" track-name="
  Configuring security policies
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Configuring security policies
      </p>
</div>
</a>
</li>
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/docs/rule-tuning" track-metadata-category="Guides" track-metadata-child_headline="Tuning WAF rules" track-metadata-eventdetail="/armor/docs/rule-tuning" track-metadata-position="2" track-name="
  Tuning WAF rules
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Tuning WAF rules
      </p>
</div>
</a>
</li>
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/docs/managed-protection-using" track-metadata-category="Guides" track-metadata-child_headline="Using Managed Protection" track-metadata-eventdetail="/armor/docs/managed-protection-using" track-metadata-position="3" track-name="
  Using Managed Protection
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Using Managed Protection
      </p>
</div>
</a>
</li>
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/docs/adaptive-protection-overview" track-metadata-category="Guides" track-metadata-child_headline="Adaptive Protection overview" track-metadata-eventdetail="/armor/docs/adaptive-protection-overview" track-metadata-position="4" track-name="
  Adaptive Protection overview
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Adaptive Protection overview
      </p>
</div>
</a>
</li>
</ul>
</div>
</div>
</div>
<div class="cloud-grid__col is-6 is-4__large">
<div class="cloud-list-card cloud-elevation-z0">
<div class="cloud-list-card__content">
<div class="cloud-list-card__header-border">
<h4 class="cloud-list-card__subhead cloud-body-text" data-text="Reference and monitoring" id="reference-and-monitoring">Reference and monitoring</h4>
</div>
<ul class="cloud-list-card__list">
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/docs/rules-language-reference" track-metadata-category="Reference and monitoring" track-metadata-child_headline="Custom rules language reference" track-metadata-eventdetail="/armor/docs/rules-language-reference" track-metadata-position="0" track-name="
  Custom rules language reference
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Custom rules language reference
      </p>
</div>
</a>
</li>
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/docs/apis" track-metadata-category="Reference and monitoring" track-metadata-child_headline="APIs and references" track-metadata-eventdetail="/armor/docs/apis" track-metadata-position="1" track-name="
  APIs and references
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        APIs and references
      </p>
</div>
</a>
</li>
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/docs/monitoring" track-metadata-category="Reference and monitoring" track-metadata-child_headline="Monitoring security policies" track-metadata-eventdetail="/armor/docs/monitoring" track-metadata-position="2" track-name="
  Monitoring security policies
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Monitoring security policies
      </p>
</div>
</a>
</li>
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/docs/audit-logging" track-metadata-category="Reference and monitoring" track-metadata-child_headline="Audit logging information" track-metadata-eventdetail="/armor/docs/audit-logging" track-metadata-position="3" track-name="
  Audit logging information
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Audit logging information
      </p>
</div>
</a>
</li>
</ul>
</div>
</div>
</div>
<div class="cloud-grid__col is-6 is-4__large">
<div class="cloud-list-card cloud-elevation-z0">
<div class="cloud-list-card__content">
<div class="cloud-list-card__header-border">
<h4 class="cloud-list-card__subhead cloud-body-text" data-text="Resources" id="resources">Resources</h4>
</div>
<ul class="cloud-list-card__list">
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/pricing" track-metadata-category="Resources" track-metadata-child_headline="Pricing" track-metadata-eventdetail="/armor/pricing" track-metadata-position="0" track-name="
  Pricing
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Pricing
      </p>
</div>
</a>
</li>
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/quotas" track-metadata-category="Resources" track-metadata-child_headline="Quotas and limits" track-metadata-eventdetail="/armor/quotas" track-metadata-position="1" track-name="
  Quotas and limits
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Quotas and limits
      </p>
</div>
</a>
</li>
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/docs/troubleshooting" track-metadata-category="Resources" track-metadata-child_headline="Troubleshooting issues" track-metadata-eventdetail="/armor/docs/troubleshooting" track-metadata-position="2" track-name="
  Troubleshooting issues
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Troubleshooting issues
      </p>
</div>
</a>
</li>
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/docs/release-notes" track-metadata-category="Resources" track-metadata-child_headline="Release notes" track-metadata-eventdetail="/armor/docs/release-notes" track-metadata-position="3" track-name="
  Release notes
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Release notes
      </p>
</div>
</a>
</li>
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/docs/getting-support" track-metadata-category="Resources" track-metadata-child_headline="Getting support" track-metadata-eventdetail="/armor/docs/getting-support" track-metadata-position="4" track-name="
  Getting support
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Getting support
      </p>
</div>
</a>
</li>
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/docs/billing-questions" track-metadata-category="Resources" track-metadata-child_headline="Billing questions" track-metadata-eventdetail="/armor/docs/billing-questions" track-metadata-position="5" track-name="
  Billing questions
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Billing questions
      </p>
</div>
</a>
</li>
<li class="cloud-list-card__list-item">
<a class="cloud-list-card__link" href="/armor/sla" track-metadata-category="Resources" track-metadata-child_headline="Service Level Agreement" track-metadata-eventdetail="/armor/sla" track-metadata-position="6" track-name="
  Service Level Agreement
  
" track-type="list card item">
<div>
<p class="cloud-subhead2">
        Service Level Agreement
      </p>
</div>
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cloud-section--small cloud-section--border community cloud-section--no-padding-top">
<h2 class="cloud-jump-section" data-cloud-main-text="Videos" data-text="               Videos             " id="videos">
              Videos
            </h2>
<devsite-dynamic-content initial-results="3" query="tenant:cloud+origin:youtube+text:Google Cloud Armor" sortorder="relevance">
</devsite-dynamic-content>
</div>
</div>
</article>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/cloud-armor-overview]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor helps you protect your Google Cloud deployments from
multiple types of threats, including distributed denial-of-service (DDoS)
attacks and application attacks like cross-site scripting (XSS) and SQL
injection (SQLi). Google Cloud Armor features
some automatic protections and some that you need to configure manually.
This document provides a high-level overview of these features.</p>
<aside class="note"><strong>Note:</strong><span> Google Cloud Armor provides protection only to applications running
behind an external load balancer, and several features are only available for
external HTTP(S) load balancer.</span></aside>
<h2 data-text="Security policies" id="security_policies">Security policies</h2>
<p>Use Google Cloud Armor security policies to protect applications running behind
a load balancer from distributed denial-of-service (DDoS) and other web-based
attacks, whether the applications are deployed on Google Cloud, in a hybrid
deployment, or in a multi-cloud architecture. Security policies can be configured
manually, with configurable match conditions and actions in a security policy.
Google Cloud Armor also features preconfigured security policies, which cover
a variety of use cases. For more information, see
<a href="/armor/docs/security-policy-overview">Google Cloud Armor security policy overview</a>.</p>
<h3 data-text="Rules language" id="rules_language">Rules language</h3>
<p>Google Cloud Armor enables you to define prioritized rules with configurable
match conditions and actions in a security policy. A rule takes effect, meaning
that the configured action is applied, if the rule is the highest priority rule
whose attributes match the attributes of the incoming request.
For more information, see
<a href="/armor/docs/rules-language-reference">Google Cloud Armor custom rules language reference</a>.</p>
<h3 data-text="Preconfigured WAF rules" id="preconfigured_waf_rules">Preconfigured WAF rules</h3>
<p>Google Cloud Armor preconfigured rules help protect your web applications
and services from common attacks from the internet and help mitigate the
<a class="external" href="https://owasp.org/www-project-top-ten/">OWASP Top 10 risks</a>.
The rules allow Google Cloud Armor to evaluate distinct
traffic signatures by referring to conveniently-named rules, rather than
requiring you to define each signature manually. The rule source is
<a class="external" href="https://modsecurity.org/crs/" target="github">ModSecurity Core Rule Set 3.0.2</a> 
(CRS).</p>
<p>These preconfigured rules can be tuned to disable noisy or otherwise unnecessary
signatures. For more information, see
<a href="/armor/docs/rule-tuning">Tuning Google Cloud Armor WAF rules</a>.</p>
<h3 data-text="Named IP lists" id="named_ip_lists">Named IP lists</h3>
<p><em>Google Cloud Armor named IP address lists</em> let you reference lists of IP
addresses and IP ranges that are maintained by third-party providers. You can
configure named IP address lists within a security policy. You do not have to
manually specify each IP address or IP range individually. For more information,
see <a href="/armor/docs/armor-named-ip">Named IP lists</a>.</p>
<h2 data-text="Google Cloud Armor Managed Protection" id="google-cloud-armor-managed-protection">Google Cloud Armor Managed Protection</h2>
<p>Managed Protection is the managed application protection service that helps
protect your web applications and services from distributed denial-of-service
(DDoS) attacks and other threats from the internet. Managed Protection
features always-on protections for your load balancer, and gives you access to
WAF rules.</p>
<p>DDoS protection is automatically provided for HTTP(S) Load Balancing,
SSL Proxy Load Balancing, and TCP Proxy Load Balancing, regardless of tier. The HTTP,
HTTPS, HTTP/2, and QUIC protocols are all supported.</p>
<p>For more information, see
<a href="/armor/docs/managed-protection-overview">Managed Protection overview</a>.</p>
<h2 data-text="Google Cloud Armor Adaptive Protection" id="google-cloud-armor-adaptive-protection">Google Cloud Armor Adaptive Protection</h2>
<p>Adaptive Protection helps you protect your applications and services from L7
distributed denial-of-service (DDoS) attacks by analyzing patterns of traffic to
your backend services, detecting and alerting on suspected attacks, and
generating suggested WAF rules to mitigate such attacks. These rules can be
tuned to meet your needs. Adaptive Protection can be enabled on a per-
security policy basis, but it requires an active Managed Protection
subscription in the project.</p>
<p>For more information, see
<a href="/armor/docs/adaptive-protection-overview">Google Cloud Armor Adaptive Protection overview</a>.</p>
<h2 data-text="How Google Cloud Armor works" id="how_works">How Google Cloud Armor works</h2>
<p>Google Cloud Armor provides always-on DDoS protection against network or
protocol-based volumetric DDoS attacks for applications or services behind external HTTP(S) load balancers,
SSL proxy load balancers, or TCP proxy load balancers. Google Cloud Armor's DDoS
protection is always-on inline, scaling to the capacity of Google's global network.
It is able to instantly detect and mitigate network attacks in order to allow
only well-formed requests through the load balancing proxies. Backend services
behind an external HTTP(S) load balancer also have access to security policies to enforce
custom Layer 7 filtering policies, including pre-configured WAF rules to mitigate
the OWASP Top 10 web application vulnerability risks.</p>
<p>Google Cloud Armor security policies enable you to allow or deny access to
your external HTTP(S) load balancer at the Google Cloud edge, as close as possible to
the source of incoming traffic. This prevents unwelcome traffic from consuming
resources or entering your Virtual Private Cloud (VPC) networks.</p>
<p>The following diagram illustrates the location of the external HTTP(S) load balancers,
the Google network, and Google data centers.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-1.svg">
<img alt="Google Cloud Armor policy at network edge." border="0" src="/armor/images/ip-bl-wl-1.svg" width="700"/></a>
<figcaption>Google Cloud Armor policy at network edge (click to
   enlarge)</figcaption>
</figure>
<p>You can use some or all of these features to protect your application. You can
use security policies to match against known conditions, create WAF rules to
protect against common attacks like those found in the <a class="external" href="https://modsecurity.org/crs/" target="github">ModSecurity Core Rule
Set 3.0.2</a>,
and use Google Cloud Armor Managed Protection's built-in protections against DDoS attacks.</p>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/common-use-cases">Examine common use cases for Google Cloud Armor</a></li>
<li><a href="/armor/docs/managed-protection-overview">Learn about Google Cloud Armor Managed Protection</a></li>
<li><a href="/armor/docs/adaptive-protection-overview">Learn about Google Cloud Armor Adaptive Protection</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/apis]</H1></p><div class="devsite-article-body clearfix">
<p>This page describes individual commands that can be used with Google Cloud Armor.
For contextual <em>how-to</em> information about using these commands, see the
Google Cloud Armor <a href="/armor/docs/how-to">how-to guides</a>.</p>
<ul>
<li><p><strong>Security policies</strong>: Use to create security policies and rules.</p>
<p><a href="/sdk/gcloud/reference/compute/security-policies">gcloud</a> |
<a href="/compute/docs/reference/rest/v1/securityPolicies">API</a></p></li>
<li><p><strong>Backend services</strong>: Use to attach a security policy to a backend service.</p>
<p><a href="/sdk/gcloud/reference/compute/backend-services">gcloud</a> |
<a href="/compute/docs/reference/rest/v1/backendServices">API</a></p></li>
</ul>
<p>To learn how to write expressions in advanced match conditions for security
policy rules, see the
<a href="/armor/docs/rules-language-reference">Google Cloud Armor custom rules language reference</a>.</p>
<devsite-hats-survey class="nocontent" hats-id="mwETRvWii0eU5NUYprb0Y9z5GVbc" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/support]</H1></p><div class="devsite-article-body clearfix">
<article class="grid-fluid l-fixed-width" id="cloud-site">
<section class="l-relative">
<div class="grid-fluid">
<div class="c12">
<div class="card" id="support">
<header>
</header>
<ul class="card-showcase">
<li>
<a class="no-logo" href="/armor/docs/getting-support">
<h3 class="hide-from-toc no-link" data-text="Getting support" id="getting-support">Getting support</h3>
<p>
    Get assistance with Google Cloud Armor issues.
    </p>
</a>
</li>
<li>
<a class="no-logo" href="/armor/docs/troubleshooting">
<h3 class="hide-from-toc no-link" data-text="Troubleshooting" id="troubleshooting">Troubleshooting</h3>
<p>
    Troubleshoot common issues with Google Cloud Armor.
    </p>
</a>
</li>
<li>
<a class="no-logo" href="/armor/docs/billing-questions">
<h3 class="hide-from-toc no-link" data-text="Billing questions" id="billing-questions">Billing questions</h3>
<p>
    Get answers to common billing questions.
    </p>
</a>
</li>
</ul>
</div>
</div>
</div>
</section>
</article>
<devsite-hats-survey class="nocontent" hats-id="mwETRvWii0eU5NUYprb0Y9z5GVbc" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/resources]</H1></p><div class="devsite-article-body clearfix">
<article class="grid-fluid l-fixed-width" id="cloud-site">
<section class="l-relative">
<div class="grid-fluid">
<div class="c12">
<div class="card" id="resources">
<header>
</header>
<ul class="card-showcase">
<li>
<a class="no-logo" href="/armor/pricing">
<h3 class="hide-from-toc no-link" data-text="Pricing" id="pricing">Pricing</h3>
<p>
    Pricing details for Google Cloud Armor.
    </p>
</a>
</li>
<li>
<a class="no-logo" href="/armor/quotas">
<h3 class="hide-from-toc no-link" data-text="Quotas and limits" id="quotas-and-limits">Quotas and limits</h3>
<p>
    Quota details for Google Cloud Armor.
    </p>
</a>
</li>
<li>
<a class="no-logo" href="/armor/docs/release-notes">
<h3 class="hide-from-toc no-link" data-text="Release notes" id="release-notes">Release notes</h3>
<p>
    Details about updates to Google Cloud Armor.
    </p>
</a>
</li>
<li>
<a class="no-logo" href="/armor/sla">
<h3 class="hide-from-toc no-link" data-text="Service Level Agreement" id="service-level-agreement">Service Level Agreement</h3>
<p>
    The Service Level Agreement (SLA) for Google Cloud Armor.
    </p>
</a>
</li>
</ul>
</div>
</div>
</div>
</section>
</article>
<devsite-hats-survey class="nocontent" hats-id="mwETRvWii0eU5NUYprb0Y9z5GVbc" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/cloud-armor-overview]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor helps you protect your Google Cloud deployments from
multiple types of threats, including distributed denial-of-service (DDoS)
attacks and application attacks like cross-site scripting (XSS) and SQL
injection (SQLi). Google Cloud Armor features
some automatic protections and some that you need to configure manually.
This document provides a high-level overview of these features.</p>
<aside class="note"><strong>Note:</strong><span> Google Cloud Armor provides protection only to applications running
behind an external load balancer, and several features are only available for
external HTTP(S) load balancer.</span></aside>
<h2 data-text="Security policies" id="security_policies">Security policies</h2>
<p>Use Google Cloud Armor security policies to protect applications running behind
a load balancer from distributed denial-of-service (DDoS) and other web-based
attacks, whether the applications are deployed on Google Cloud, in a hybrid
deployment, or in a multi-cloud architecture. Security policies can be configured
manually, with configurable match conditions and actions in a security policy.
Google Cloud Armor also features preconfigured security policies, which cover
a variety of use cases. For more information, see
<a href="/armor/docs/security-policy-overview">Google Cloud Armor security policy overview</a>.</p>
<h3 data-text="Rules language" id="rules_language">Rules language</h3>
<p>Google Cloud Armor enables you to define prioritized rules with configurable
match conditions and actions in a security policy. A rule takes effect, meaning
that the configured action is applied, if the rule is the highest priority rule
whose attributes match the attributes of the incoming request.
For more information, see
<a href="/armor/docs/rules-language-reference">Google Cloud Armor custom rules language reference</a>.</p>
<h3 data-text="Preconfigured WAF rules" id="preconfigured_waf_rules">Preconfigured WAF rules</h3>
<p>Google Cloud Armor preconfigured rules help protect your web applications
and services from common attacks from the internet and help mitigate the
<a class="external" href="https://owasp.org/www-project-top-ten/">OWASP Top 10 risks</a>.
The rules allow Google Cloud Armor to evaluate distinct
traffic signatures by referring to conveniently-named rules, rather than
requiring you to define each signature manually. The rule source is
<a class="external" href="https://modsecurity.org/crs/" target="github">ModSecurity Core Rule Set 3.0.2</a> 
(CRS).</p>
<p>These preconfigured rules can be tuned to disable noisy or otherwise unnecessary
signatures. For more information, see
<a href="/armor/docs/rule-tuning">Tuning Google Cloud Armor WAF rules</a>.</p>
<h3 data-text="Named IP lists" id="named_ip_lists">Named IP lists</h3>
<p><em>Google Cloud Armor named IP address lists</em> let you reference lists of IP
addresses and IP ranges that are maintained by third-party providers. You can
configure named IP address lists within a security policy. You do not have to
manually specify each IP address or IP range individually. For more information,
see <a href="/armor/docs/armor-named-ip">Named IP lists</a>.</p>
<h2 data-text="Google Cloud Armor Managed Protection" id="google-cloud-armor-managed-protection">Google Cloud Armor Managed Protection</h2>
<p>Managed Protection is the managed application protection service that helps
protect your web applications and services from distributed denial-of-service
(DDoS) attacks and other threats from the internet. Managed Protection
features always-on protections for your load balancer, and gives you access to
WAF rules.</p>
<p>DDoS protection is automatically provided for HTTP(S) Load Balancing,
SSL Proxy Load Balancing, and TCP Proxy Load Balancing, regardless of tier. The HTTP,
HTTPS, HTTP/2, and QUIC protocols are all supported.</p>
<p>For more information, see
<a href="/armor/docs/managed-protection-overview">Managed Protection overview</a>.</p>
<h2 data-text="Google Cloud Armor Adaptive Protection" id="google-cloud-armor-adaptive-protection">Google Cloud Armor Adaptive Protection</h2>
<p>Adaptive Protection helps you protect your applications and services from L7
distributed denial-of-service (DDoS) attacks by analyzing patterns of traffic to
your backend services, detecting and alerting on suspected attacks, and
generating suggested WAF rules to mitigate such attacks. These rules can be
tuned to meet your needs. Adaptive Protection can be enabled on a per-
security policy basis, but it requires an active Managed Protection
subscription in the project.</p>
<p>For more information, see
<a href="/armor/docs/adaptive-protection-overview">Google Cloud Armor Adaptive Protection overview</a>.</p>
<h2 data-text="How Google Cloud Armor works" id="how_works">How Google Cloud Armor works</h2>
<p>Google Cloud Armor provides always-on DDoS protection against network or
protocol-based volumetric DDoS attacks for applications or services behind external HTTP(S) load balancers,
SSL proxy load balancers, or TCP proxy load balancers. Google Cloud Armor's DDoS
protection is always-on inline, scaling to the capacity of Google's global network.
It is able to instantly detect and mitigate network attacks in order to allow
only well-formed requests through the load balancing proxies. Backend services
behind an external HTTP(S) load balancer also have access to security policies to enforce
custom Layer 7 filtering policies, including pre-configured WAF rules to mitigate
the OWASP Top 10 web application vulnerability risks.</p>
<p>Google Cloud Armor security policies enable you to allow or deny access to
your external HTTP(S) load balancer at the Google Cloud edge, as close as possible to
the source of incoming traffic. This prevents unwelcome traffic from consuming
resources or entering your Virtual Private Cloud (VPC) networks.</p>
<p>The following diagram illustrates the location of the external HTTP(S) load balancers,
the Google network, and Google data centers.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-1.svg">
<img alt="Google Cloud Armor policy at network edge." border="0" src="/armor/images/ip-bl-wl-1.svg" width="700"/></a>
<figcaption>Google Cloud Armor policy at network edge (click to
   enlarge)</figcaption>
</figure>
<p>You can use some or all of these features to protect your application. You can
use security policies to match against known conditions, create WAF rules to
protect against common attacks like those found in the <a class="external" href="https://modsecurity.org/crs/" target="github">ModSecurity Core Rule
Set 3.0.2</a>,
and use Google Cloud Armor Managed Protection's built-in protections against DDoS attacks.</p>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/common-use-cases">Examine common use cases for Google Cloud Armor</a></li>
<li><a href="/armor/docs/managed-protection-overview">Learn about Google Cloud Armor Managed Protection</a></li>
<li><a href="/armor/docs/adaptive-protection-overview">Learn about Google Cloud Armor Adaptive Protection</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/integrating-cloud-armor]</H1></p><div class="devsite-article-body clearfix">
<p>The following sections discuss how Google Cloud Armor interacts with
other Google Cloud features and products.</p>
<h2 data-text="Google Cloud Armor and VPC firewall rules" id="https-vpc-firewall-rules">Google Cloud Armor and VPC firewall rules</h2>
<p>Google Cloud Armor security policies and <a href="/vpc/docs/firewalls">VPC firewall
rules</a> have different functions:</p>
<ul>
<li>Google Cloud Armor security policies provide edge security and act on
client traffic to Google Front Ends (GFEs).</li>
<li>VPC firewall rules allow or deny traffic to and from your
backends. You must create ingress allow firewall rules, whose targets are the
load-balanced backend VMs, and whose sources are
<a href="/load-balancing/docs/https#firewall_rules">IP ranges used by external HTTP(S) load balancers</a>.
These rules allow GFEs and the health check systems to communicate with
your backend VMs.</li>
</ul>
<p>For example, consider a scenario in which you want to allow traffic only from
CIDR range 100.1.1.0/24 and CIDR range 100.1.2.0/24 to access your
external HTTP(S) load balancer. Your goal is to ensure that traffic cannot directly reach
the backend load balanced instances. In other words, only external traffic
proxied through the external HTTP(S) load balancer with an associated security policy
should reach the instances.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-5.svg">
<img alt="Using Google Cloud Armor security policy with ingress firewalls
       to restrict access." border="0" src="/armor/images/ip-bl-wl-5.svg" width="700"/></a>
<figcaption>Using Google Cloud Armor security policy with ingress
   firewalls to restrict access (click to enlarge)</figcaption>
</figure>
<p>In the previous illustration, you accomplish your security objectives by
configuring your Google Cloud deployment as follows:</p>
<ol>
<li>Create two instance groups, one in the <code dir="ltr" translate="no">us-west1</code> region and another in the
<code dir="ltr" translate="no">europe-west1</code> region.</li>
<li>Deploy backend application instances to the VMs in the instance groups.</li>
<li>Create an external HTTP(S) load balancer in Premium Tier.  Configure a simple URL map
and a single backend service whose backends are the two instance groups
that you created in the previous step. Ensure that the load balancer's
forwarding rule uses the <code dir="ltr" translate="no">120.1.1.1</code> external IP address.</li>
<li>Configure a Google Cloud Armor security policy that allows traffic
from 100.1.1.0/24 and 100.1.2.0/24 and denies all other traffic.</li>
<li>Associate this policy with the load balancer's backend service.
For instructions, see
<a href="/armor/docs/configure-security-policies">Configuring security policies</a>.
External HTTP(S) load balancers with more complex
URL maps can reference multiple backend services. You can associate the
security policy with one or more of the backend services as needed.</li>
<li>Configure ingress allow firewall rules to permit traffic from the
external HTTP(S) load balancer. For more information, see
<a href="/load-balancing/docs/https#firewall_rules">Firewall rules</a>.</li>
</ol>
<h2 data-text="Google Cloud Armor with HTTP(S) Load Balancing and IAP" id="https-iap">Google Cloud Armor with HTTP(S) Load Balancing and IAP</h2>
<p>Identity-Aware Proxy (IAP) verifies a user's identity and then
determines whether that user should be permitted to access an application. To
enable IAP for the external HTTP(S) load balancer, you enable it on the
load balancer's backend services. Similarly, edge Google Cloud Armor
security policies are attached to the backend services of an external HTTP(S) load balancer.</p>
<p>If Google Cloud Armor security policies and IAP are both
enabled for a backend service of an external HTTP(S) load balancer, the IAP
evaluation happens first. If IAP blocks a request,
Google Cloud Armor does not evaluate the request.  If IAP
successfully authenticates a request, Google Cloud Armor then evaluates the
request. The request is blocked if a Google Cloud Armor security policy
produces a deny decision.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-6.svg">
<img alt="Using IP address denylists and allowlists with IAP." border="0" src="/armor/images/ip-bl-wl-6.svg" width="700"/></a>
<figcaption>Using IP address denylists and allowlists with IAP
    (click to enlarge)</figcaption>
</figure>
<p>For more information about IAP and related configurations, see
the <a href="/iap">Identity-Aware Proxy</a> documentation.</p>
<h2 data-text="Google Cloud Armor with hybrid deployments" id="hybrid">Google Cloud Armor with hybrid deployments</h2>
<p>In a hybrid deployment, an external HTTP(S) load balancer needs access to an application or
content source that runs outside Google Cloud, for example, in another
cloud provider's infrastructure. You can use Google Cloud Armor to protect such
deployments.</p>
<p>In the following diagram, the load balancer has two backend services. One has an
instance group as its backend. The other backend service has an internet NEG as
its backend, and the internet NEG is associated with an application that is
running in a third-party provider's data center.</p>
<figure style="text-align: center">
<a href="/armor/images/ca-hybrid.svg">
<img alt="Google Cloud Armor for hybrid deployments." border="0" src="/armor/images/ca-hybrid.svg"/></a>
<figcaption>Google Cloud Armor for hybrid deployments (click to
   enlarge)</figcaption>
</figure>
<p>When you attach a Google Cloud Armor security policy to the backend
service that has an internet NEG as the backend, Google Cloud Armor
inspects every L7 request that arrives at the external HTTP(S) load balancer that is
destined for that backend service.</p>
<p>Google Cloud Armor protection for hybrid deployments is subject to the same
<a href="/load-balancing/docs/negs/internet-neg-concepts#limitations">limitations that apply to internet NEGs</a>.</p>
<h2 data-text="Google Cloud Armor with Google Kubernetes Engine (GKE) Ingress" id="with_ingress">Google Cloud Armor with Google Kubernetes Engine (GKE) Ingress</h2>
<p>After you configure a Google Cloud Armor security policy, you can use
<a class="external" href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Kubernetes Ingress</a> 
to enable it with GKE.</p>
<p>You can reference your security policy with a <code dir="ltr" translate="no">BackendConfig</code> resource by adding
the name of your security policy to the <code dir="ltr" translate="no">BackendConfig</code>. The following
<code dir="ltr" translate="no">BackendConfig</code> manifest specifies a security policy named
<code dir="ltr" translate="no">example-security-policy</code>:</p>
<pre class="prettyprint lang-yaml" dir="ltr" translate="no"><code dir="ltr" translate="no">apiVersion: cloud.google.com/v1
kind: BackendConfig
metadata:
  namespace: cloud-armor-how-to
  name: my-backendconfig
spec:
  <strong>securityPolicy:
    name: "example-security-policy"</strong>
</code></pre>
<p>For more information about Ingress features, see
<a href="/kubernetes-engine/docs/how-to/ingress-features">Configuring Ingress features</a>.</p>
<h2 data-text="Google Cloud Armor with Cloud CDN" id="cloud-cdn">Google Cloud Armor with Cloud CDN</h2>
<p>To protect CDN origin servers, you can use Google Cloud Armor with
Cloud CDN. Google Cloud Armor protects your CDN origin server from
application attacks, mitigates OWASP Top 10 risks, and enforces Layer 7 filtering
policies. There are two types of security policy that affect how
Google Cloud Armor works with Cloud CDN: edge security policies and
backend security policies.</p>
<h3 data-text="Edge security policies" id="edge-policies">Edge security policies</h3>
<p>You can use edge security policies for Cloud CDN-enabled backend services and
Cloud Storage backend buckets behind the external HTTP(S) load balancer. Use edge
security policies to filter requests before content is served from
cache.</p>
<h3 data-text="Backend security policies" id="backend-policies">Backend security policies</h3>
<p>When Google Cloud Armor backend security policies are applied to backend services
with Cloud CDN enabled, they apply only to requests routed to the backend
service. These requests include dynamic content requests and cache
misses—that is, requests that miss or bypass the Cloud CDN cache.</p>
<p>Requests are always first evaluated against edge security policies. For requests
allowed by the edge security policies, the request is served to the user and is
not evaluated against the backend security policy. Otherwise, the request is
evaluated again, this time against the backend security policy.</p>
<p>The following diagram shows exclusively how backend security policies work with
Cloud CDN origins, after the requests have been allowed by the edge security
policies.</p>
<figure style="text-align: center">
<a href="/armor/images/ca-cdn-origins.svg">
<img alt="Using Google Cloud Armor backend security policies with Cloud CDN." border="0" src="/armor/images/ca-cdn-origins.svg" width="700"/></a>
<figcaption>Google Cloud Armor backend security policies with Cloud CDN
    (click to enlarge)</figcaption>
</figure>
<p>For more information about Cloud CDN, see the
<a href="/cdn/docs">Cloud CDN documentation</a>.</p>
<h2 data-text="Google Cloud Armor with serverless apps" id="serverless">Google Cloud Armor with serverless apps</h2>
<p>You can use Google Cloud Armor security policies with a serverless NEG backend
that points to a <a href="/run/docs">Cloud Run</a>,
<a href="/appengine/docs">App Engine</a>, or <a href="/functions/docs">Cloud Functions</a>
service.</p>
<p>However, when you use Google Cloud Armor with serverless NEGs and
Cloud Functions, you must take special steps to ensure that all access to
the serverless endpoint is filtered through a Google Cloud Armor security
policy.</p>
<p>Users who have the default URL for a Cloud Functions service
can bypass the load balancer and go directly to the service URL. This bypasses
Google Cloud Armor security policies. You cannot disable the URLs that
Google Cloud automatically assigns to Cloud Functions
services.</p>
<p>To ensure that your access controls are applied to all incoming traffic, you can
use
<a href="/sdk/gcloud/reference/functions/deploy#--ingress-settings"><code dir="ltr" translate="no">internal-and-gclb</code></a>
when you configure Cloud Functions, which allows only internal traffic
and traffic sent to a public IP address exposed by the external HTTP(S) load balancer. Traffic
sent to <code dir="ltr" translate="no">cloudfunctions.net</code> or any other custom domain set up through
Cloud Functions is blocked. This prevents users from circumventing any
access controls (such as Google Cloud Armor security policies) set up
through the external HTTP(S) load balancer.</p>
<p>For more information about serverless NEGs, see
<a href="/load-balancing/docs/negs/serverless-neg-concepts">Serverless network endpoint groups overview</a>
and <a href="/load-balancing/docs/negs/setting-up-serverless-negs">Setting up serverless NEGs</a>.</p>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/configure-security-policies">Configure security policies, rules, and expressions</a></li>
<li><a href="/armor/docs/managed-protection-overview">Learn about the features in Managed Protection tiers</a></li>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/best-practices]</H1></p><div class="devsite-article-body clearfix">
<p>This page provides best practices for optimizing and tuning Google Cloud Armor
deployments.</p>
<p>Google Cloud Armor is deployed with external HTTP(S) load balancers, TCP proxy load balancers, or
SSL proxy load balancers. When you deploy Google Cloud Armor, you attach a security
policy to the load balancer backend service that you want to protect. A
security policy consists of a collection of pre-configured and custom rules that
you determine.</p>
<h2 data-text="Security policy and rule creation" id="policy-creation">Security policy and rule creation</h2>
<p>The following sections contain best practices and recommendations for new
security policies and rules.</p>
<h3 data-text="Provide rule descriptions" id="rule-descriptions">Provide rule descriptions</h3>
<p>Use rule descriptions to provide additional context about
why each rule was created and the intended function of the rule. The
<strong>description</strong> field is limited to 64 characters, so references to
configuration management databases or other repositories are the most efficient
way to capture context.</p>
<h3 data-text="Consider priority spacing" id="priority-spacing">Consider priority spacing</h3>
<p>When you initially configure rules, leave an interval of at least 10 between
each rule priority value. For example, the first two rules in a security policy
could have priorities 20 and 30. This lets you insert more rules when you need
them. In addition, we recommend that you group similar rules into blocks,
leaving larger intervals between groups.</p>
<h3 data-text="Use preview mode" id="preview-mode">Use preview mode</h3>
<p>Security policy rules, including Open Web Application Security Project (OWASP)
signatures, can have unpredictable effects on your application. Use
<a href="/armor/docs/security-policy-overview#preview_mode">preview mode</a>,
to evaluate whether the introduction of a rule will have a negative impact
on production traffic.</p>
<h3 data-text="Enable Google Cloud Armor Adaptive Protection" id="adaptive-protection">Enable Google Cloud Armor Adaptive Protection</h3>
<p><a href="/armor/docs/adaptive-protection-overview#configure-alert-tuning">Enable Adaptive Protection</a>
for additional protection of your applications. Adaptive Protection monitors
traffic and (as necessary) recommends new rules for your security policies. In
addition, we recommend that you put an
<a href="/armor/docs/adaptive-protection-overview#monitor-alert-log">alerting policy</a> in
place to ensure that the right people are alerted about potential
attacks. Adaptive Protection is best suited for volumetric protection. Attacks
that are not volumetric might not trigger Adaptive Protection.</p>
<h3 data-text="Enable JSON parsing" id="json-parsing">Enable JSON parsing</h3>
<p>If your application sends JSON content in the body of <code dir="ltr" translate="no">POST</code> requests,
ensure that you enable JSON parsing. If you do not enable JSON parsing,
Google Cloud Armor does not parse the JSON content of POST bodies for
preconfigured WAF rules, and the results can be noisy and generate false
positives. For additional information, see
<a href="/armor/docs/security-policy-overview#json-parsing">JSON parsing</a>.</p>
<h3 data-text="Test your logic" id="test-logic">Test your logic</h3>
<p>A rule is triggered when its match condition evaluates to true; for example, the
match condition <code dir="ltr" translate="no">origin.region_code == 'AU'</code> evaluates to true if the region
code of the request is <code dir="ltr" translate="no">AU</code>. If a higher priority rule evaluates to true, then
the action in a lower priority rule is ignored. In the following example,
imagine that you want to create a security policy to block users from the <code dir="ltr" translate="no">AU</code>
region, except for traffic within the IP address range <code dir="ltr" translate="no">10.10.10.0/24</code>. Consider
the following security policy with two rules:</p>
<pre class="prettyprint" dir="ltr" translate="no"><code dir="ltr" translate="no">Rule1
expr: inIPRange(origin.ip, '10.10.10.0/24')
action: allow
priority: 1
Rule2
expr: origin.region_code == 'AU'
action: deny(403)
priority: 2
</code></pre>
<p>In this example, <code dir="ltr" translate="no">Rule1</code> allows traffic that originates from the IP address
range <code dir="ltr" translate="no">10.10.10.0/24</code>. Because <code dir="ltr" translate="no">Rule1</code> is the higher-priority rule, such traffic
is allowed before it is evaluated against <code dir="ltr" translate="no">Rule2</code>, meaning that
Google Cloud Armor does not evaluate it against <code dir="ltr" translate="no">Rule2</code> (or any other
remaining rules).</p>
<p>When you create Google Cloud Armor policies, test the logic of your rules to
ensure that you achieve the intended behavior. To do so, we recommend that you
generate synthetic traffic to understand which rules are blocking traffic, and
verify that your results are consistent with your rule design decisions. If
you're unsure of how a request might flow through the system, use preview mode
to see which rule matches the request.</p>
<h3 data-text="Identify the source IP addresses of your scanners" id="identify-scanner-address">Identify the source IP addresses of your scanners</h3>
<p>Your security scanners can be located inside or outside of Google. If you want
an outside and unfiltered assessment of your application, you can explicitly
allow traffic based on IP address (or other token) prior to evaluating it
against any other rules.</p>
<h3 data-text="Group and sort rules in your security policy" id="group-rules">Group and sort rules in your security policy</h3>
<p>Your applications might serve different subsets of your customers. In the
following example, you want to deny traffic from certain geographical areas or
IP ranges, and therefore you configure the first rule in your policy to deny
such traffic. Additionally, you want to explicitly allow someg traffic into the
application without the security policy processing it. For this example, we
recommend the following structure of rule priority, from greatest-priority to
least-priority:</p>
<ol>
<li>Explicit deny rules (ASN, region, IP ranges)</li>
<li>Trusted explicit allow rules (scanners, trusted systems - use with extreme caution)</li>
<li>Security rules rules (OWASP, custom rules)</li>
<li>Explicit allow rules (ASN, presence of header value, IP range)</li>
<li>Default deny rules</li>
</ol>
<h3 data-text="Use bot management where appropriate" id="bot-management">Use bot management where appropriate</h3>
<p>Google Cloud Armor integrates with Google's reCAPTCHA Enterprise. If you
are using reCAPTCHA Enterprise, move the token assessment process to
Google Cloud Armor. This reduces origin load and puts security controls closer
to the end user than your backends. For more information, see the
<a href="/armor/docs/bot-management">bot management overview</a>.</p>
<h3 data-text="Set rate limiting thresholds" id="rate-limiting">Set rate limiting thresholds</h3>
<p>Rate limiting is a a flexible and valuable capability to prevent abuse and
mitigate high volume threats like credential stuffing or L7 DDoS attacks. When
you deploy rate limiting for the first time, it is important to choose a
threshold that makes sense for your application. We recommend that you start
with enforcement in preview mode. As you analyze and understand the traffic
profile, you can adjust the rate limiting parameters. In addition, it is
important to consider the priority that you assign to the rate limiting rule.
Traffic might be explicitly allowed or denied by a higher priority rule before
it is evaluated against the rate limiting rule.</p>
<h2 data-text="Rule tuning" id="rule-tuning">Rule tuning</h2>
<p>Web applications might allow requests that appear to be attacks, and they might
allow, or even require, that users send requests that match the signatures in
preconfigured WAF rules. It is critical that you validate your
Google Cloud Armor rules against your application and address any findings
that might not be relevant for your application prior to promoting the rule by
disabling preview mode on a production application. The following sections
contain best practices and recommendations for tuning the preconfigured WAF
rules.</p>
<h3 data-text="Choose your preconfigured WAF rule sensitivity level" id="sensitivity-level">Choose your preconfigured WAF rule sensitivity level</h3>
<p>When you implement any of the preconfigured WAF rules, you can choose an
appropriate sensitivity level based on your security requirements and timelines.
We recommend that you begin with a sensitivity level of 1 for most applications
that must meet your organization's security requirements. Rules configured for
sensitivity 1 use high fidelity signatures and reduce potential noise from the
rule. Signatures associated with higher sensitivities might detect and prevent a
larger set of exploit attempts, at the expense of potential noise for some
protected applications. However, workloads subject to more strict security
requirements might prefer the highest sensitivity level. For these use-cases,
there might be a great amount of noise or irrelevant findings, which you must
address using tuning before the security policy goes into production.</p>
<h3 data-text="Enable verbose logging" id="verbose-logging">Enable verbose logging</h3>
<p>If you require additional information about which request attributes and
payloads are triggering a particular WAF rule, enable
<a href="/armor/docs/request-logging#verbose-logging">verbose logging</a>. Verbose logging
provides details from requests that trigger particular rules, including a
snippet of the offending portion of the request, which is
helpful for troubleshooting and tuning Google Cloud Armor. Because verbose
logging can cause end-user request content to be logged in Cloud Logging,
there is a chance that you accumulate end-user PII in your logs. As a result, we
do not recommend running production workloads with verbose logging enabled for
long periods of time.</p>
<h3 data-text="Use stable or canary rules" id="stable-vs-canary">Use stable or canary rules</h3>
<p>There are two types of Google Cloud Armor preconfigured WAF rules: stable and
canary. When new rules are added to the current ModSecurity Core Rule Set (CRS),
we publish them to the canary rule builds before automatically publishing them
into the stable rule builds. We recommend that you deploy the canary rules in a
testing environment so that you can see the effects of any changes and additions
in your environment. You can check rule names on the
<a href="/armor/docs/rule-tuning#preconfigured_rules">Tuning Google Cloud Armor WAF rules</a>
page to verify whether the canary build is in sync with the stable build.</p>
<h2 data-text="Logging and monitoring" id="logging-monitoring">Logging and monitoring</h2>
<p>The following sections contain best practices and recommendations for
configuring logging and monitoring.</p>
<h3 data-text="Use the Security Command Center" id="security-command-center">Use the Security Command Center</h3>
<p>Google Cloud Armor integrates automatically with the Security Command Center.
Google Cloud Armor exports different findings to the Security Command Center:</p>
<ul>
<li>Allowed Traffic Spike</li>
<li>Increasing Deny Ratio</li>
</ul>
<p>Make sure that your web security personnel examine these findings.</p>
<h3 data-text="Choose a Cloud Logging sampling rate" id="sampling-rate">Choose a Cloud Logging sampling rate</h3>
<p>Google Cloud Armor per-request logs use the external HTTP(S) load balancer's logging
infrastructure. As a result, Google Cloud Armor log generation is subject
to the log sampling rate configured on the load balancer. We recommend keeping
the sampling rate to 1 when you are actively tuning and implementing
Google Cloud Armor. After you finish tuning and implementing Google Cloud Armor,
we recommend that you keep full request logging turned on; however, some customers
may prefer to down-sample to a lower rate. By default, the external HTTP(S) load balancer does not
enable logs, so it is important that you enable logging.</p>
<aside class="note"><strong>Note:</strong><span> Adaptive Protection logs are exposed in the Google Cloud console under the
<code dir="ltr" translate="no">network_security_policy</code> resource, not the external HTTP(S) load balancer.</span></aside>
<h3 data-text="Use the Cloud Monitoring dashboard" id="monitoring-dashboard">Use the Cloud Monitoring dashboard</h3>
<p>Having a clear view of what is happening in your Google Cloud Armor
configuration is essential. To make this easier, you can use the
<a href="/armor/docs/monitoring#viewing_the_monitoring_dashboard">security dashboard</a>.
Additionally, you can export Google Cloud Armor logs directly from
Logging to your own platform. If you are using
Adaptive Protection, it is important to have an escalation path for any
Adaptive Protection alerts that are triggered.</p>
<h2 data-text="General management" id="general-management">General management</h2>
<p>The following contain additional best practices and recommendations for
configuring Google Cloud Armor.</p>
<h3 data-text="Set up Identity and Access Management access control" id="iam">Set up Identity and Access Management access control</h3>
<p>In accordance with general Google Cloud IAM best practices,
ensure that the right people have access to Google Cloud Armor. The Compute
Security Admin role is required to configure, modify, update, and delete
Google Cloud Armor security policies. Additionally, the Compute Network Admin
role or <code dir="ltr" translate="no">compute.backendServices.setSecurityPolicy</code> permission is required to
attach a Google Cloud Armor security policy to a backend service.</p>
<h3 data-text="Minimize the number of policies" id="minimize-policies">Minimize the number of policies</h3>
<p>A Google Cloud Armor policy can be reused across multiple backend services. We
recommend that you have a consistent set of reusable security policies.</p>
<h3 data-text="Use Terraform" id="terraform">Use Terraform</h3>
<p>To ensure that configurations can be easily rolled back, as well as reproduced
across projects, we recommend using Terraform. Google Cloud Armor has full
<a class="external" href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_security_policy">Terraform integration</a> 
for GA features.</p>
<h3 data-text="Google Kubernetes Engine integration" id="gke">Google Kubernetes Engine integration</h3>
<p>If you are using GKE, you must configure
Google Cloud Armor and other ingress features through <code dir="ltr" translate="no">BackendConfig</code>
parameters. We recommend that you do not manually configure an external HTTP(S) load balancer
to serve as an ingress point.  For more information about configuring
Google Cloud Armor with GKE, see
<a href="/kubernetes-engine/docs/how-to/ingress-features#cloud_armor">Configuring ingress features</a>.</p>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/security-policy-overview]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor security policies protect your application by providing Layer 7
filtering and by scrubbing incoming requests for common web attacks or other Layer 7
attributes to potentially block traffic before it reaches your load balanced
backend services or backend buckets. Each security policy is made up of a set of
rules that filter traffic based on conditions such as an incoming request's IP
address, IP range, region code, or request headers.</p>
<p>Google Cloud Armor security policies are available only for backend services
behind an external HTTP(S) load balancer, TCP proxy load balancer, or an SSL proxy load balancer. The load
balancer can be in
<a href="/network-tiers/docs/overview">Premium Tier or Standard Tier</a>.</p>
<p>The backends to the backend service can be any of the following:</p>
<ul>
<li><a href="/compute/docs/instance-groups">Instance groups</a></li>
<li><a href="/load-balancing/docs/negs/zonal-neg-concepts">Zonal network endpoint groups
(NEGs)</a></li>
<li><a href="/load-balancing/docs/negs/serverless-neg-concepts">Serverless NEGs</a>: One or
more <a href="/appengine/docs">App Engine</a>, <a href="/run/docs">Cloud Run</a>,
or <a href="/functions/docs">Cloud Functions</a> services</li>
<li><a href="/load-balancing/docs/negs/internet-neg-concepts">Internet NEGs</a> for
external backends</li>
<li>Buckets in <a href="/storage/docs">Cloud Storage</a></li>
</ul>
<p>When you use Google Cloud Armor to protect a hybrid deployment or a multi-cloud
architecture, the backends must be internet NEGs. Google Cloud Armor also
protects serverless NEGs when traffic is routed through a load balancer. To
ensure that only traffic that has been routed through your load balancer reaches
your serverless NEG, see
<a href="/appengine/docs/standard/python3/application-security#ingress_controls">Ingress controls</a>.</p>
<h2 data-text="Protect your Google Cloud deployments with Google Cloud Armor security policies" id="edge-security">Protect your Google Cloud deployments with Google Cloud Armor security policies</h2>
<p>External load balancing is implemented at the edge of Google's network in
<a href="/about/locations#network-tab">Google's points of presence (PoPs)</a> around the
world. In Premium Tier, user traffic directed to an
<a href="/load-balancing/docs/choosing-load-balancer#external-internal">external load balancer</a>
enters the PoP closest to the user. It is then load balanced over Google's
global network to the closest backend that has sufficient capacity available. In
Standard Tier, user traffic enters Google's network through peering, ISP, or
transit networks in the region where you have deployed your Google Cloud
resources.</p>
<p>Google Cloud Armor security policies enable you to rate-limit or redirect
requests to your HTTP(S) Load Balancing, TCP Proxy Load Balancing, or
SSL Proxy Load Balancing at the Google Cloud edge, as close as
possible to the source of incoming traffic. This prevents unwelcome traffic from
consuming resources or entering your Virtual Private Cloud (VPC) networks.</p>
<p>The following diagram illustrates the location of external HTTP(S) load balancers,
the Google network, and Google data centers.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-1.svg">
<img alt="Google Cloud Armor policy at network edge." border="0" src="/armor/images/ip-bl-wl-1.svg" width="700"/></a>
<figcaption>Google Cloud Armor policy at network edge (click to
   enlarge)</figcaption>
</figure>
<h2 data-text="Requirements" id="requirements">Requirements</h2>
<p>These are the requirements for using Google Cloud Armor security policies:</p>
<ul>
<li>The load balancer must be an external HTTP(S) load balancer, TCP proxy load balancer, or SSL proxy load balancer.</li>
<li>The backend service's load balancing scheme must be <code dir="ltr" translate="no">EXTERNAL</code>.</li>
<li>The backend service's protocol must be one of <code dir="ltr" translate="no">HTTP</code>, <code dir="ltr" translate="no">HTTPS</code>, <code dir="ltr" translate="no">HTTP/2</code>,
<code dir="ltr" translate="no">TCP</code>, or <code dir="ltr" translate="no">SSL</code>.</li>
</ul>
<h2 data-text="About Google Cloud Armor security policies" id="about">About Google Cloud Armor security policies</h2>
<p>Google Cloud Armor security policies are sets of rules that match on
attributes from Layer 3 to Layer 7 to protect externally facing applications or
services. Each rule is evaluated with respect to incoming traffic.</p>
<p>A Google Cloud Armor security policy <em>rule</em> consists of a match condition and
an action to take when that condition is met. Conditions can be as simple as
whether the incoming traffic's source IP address matches a specific IP address
or CIDR range (also known as IP address allowlist and denylist rules).
Alternatively, by using the
<a href="/armor/docs/rules-language-reference">Google Cloud Armor custom rules language reference</a>,
you can create custom conditions that match on various attributes of the
incoming traffic, such as the URL path, request method, or request header values.</p>
<p>When an incoming request matches a condition in a security policy rule,
Google Cloud Armor allows, denies, or redirects the request, based on whether
the rule is an allow rule, a deny rule, or a redirect rule. There can be
additional action parameters to apply, like inserting request headers; this
feature is part of Google Cloud Armor bot management. For more information
about bot management, see the
<a href="/armor/docs/bot-management">bot management overview</a>.</p>
<p>You can associate a Google Cloud Armor security policy with one or more
backend services. A backend service can have only one security policy associated
with it, but your backend services do not all need to be associated with the
same security policy.</p>
<p>If a Google Cloud Armor security policy is associated with any backend
service, it can't be deleted. A backend service can be deleted regardless of
whether it has an associated security policy.</p>
<p>If multiple forwarding rules point to a backend service that has an associated
security policy, the policy rules are enforced for all traffic coming in to each
of the forwarding rule IP addresses.</p>
<p>In the following illustration, the Google Cloud Armor security policy
<code dir="ltr" translate="no">internal-users-policy</code> is associated with the backend service <code dir="ltr" translate="no">test-network</code>.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-8.svg">
<img alt="Google Cloud Armor security policy at network edge." border="0" src="/armor/images/ip-bl-wl-8.svg" width="700"/></a>
<figcaption>Google Cloud Armor security policy at network edge
      (click to enlarge)</figcaption>
</figure>
<p>Google Cloud Armor security policies have the following core features:</p>
<ul>
<li><p>You can optionally use the <code dir="ltr" translate="no">QUIC</code> protocol with load balancers that use
Google Cloud Armor.</p></li>
<li><p>You can use Google Cloud Armor with load balancers that are in
either of the following Network Service Tiers:</p>
<ul>
<li>Premium Tier</li>
<li>Standard Tier</li>
</ul></li>
<li><p>You can use security policies with GKE and the default Ingress
controller.</p></li>
</ul>
<h3 data-text="Types of security policies" id="policy-types">Types of security policies</h3>
<p>The following table shows the types of security policies and what you can do
with them. A check mark (✔) indicates that the type of security policy supports
the feature.</p>
<table class="vertical-rules">
<colgroup>
<col span="2"/>
</colgroup>
<thead>
<tr>
<th width="20%"></th>
<th colspan="2" scope="colgroup" width="50%"><center>Backend security policy</center></th>
<th width="30%"><center>Edge security policy</center></th>
</tr>
</thead>
<tbody>
<tr>
<td>Frontend Type</td>
<td>HTTP(S) Load Balancing</td>
<td>TCP proxy load balancer/SSL proxy load balancer<break></break>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</td>
<td>HTTP(S) Load Balancing</td>
</tr>
<tr>
<td>Attachment point (protected resource)</td>
<td>Backend service</td>
<td>Backend service</td>
<td><ul><li>Backend service</li><li>Backend bucket</li></ul></td>
</tr>
<tr>
<td>Rule actions</td>
<td><ul>
<li>Allow</li>
<li>Deny</li>
<li>Redirect (GOOGLE_RECAPTCHA and EXTERNAL_302)</li>
<li>Throttle</li>
<li>Rate-based ban</li>
</ul></td>
<td><ul>
<li>Allow</li>
<li>Deny</li>
<li>Throttle</li>
<li>Rate-based ban</li>
</ul></td>
<td><ul>
<li>Allow</li>
<li>Deny</li>
</ul></td>
</tr>
<tr>
<td>Source IP address</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td>Source geography</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td>Source ASN</td>
<td>✔</td>
<td>✔</td>
<td></td>
</tr>
<tr>
<td>Rate limiting</td>
<td>✔</td>
<td>✔</td>
<td></td>
</tr>
<tr>
<td>Bot management</td>
<td>✔ (preview)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Layer 7 filtering</td>
<td>✔</td>
<td></td>
<td></td>
</tr>
<tr>
<td>WAF</td>
<td>✔</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Adaptive protection</td>
<td>✔</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Named IP address lists</td>
<td>✔</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 data-text="Backend security policies" id="backend-policies">Backend security policies</h4>
<p>Backend security policies are used to protect backend services exposed by an
HTTP(S) Load Balancing, TCP Proxy Load Balancing, or SSL Proxy Load Balancing. They can be
used to filter requests and protect backend services containing instance groups
or network endpoint groups (NEGs) including internet, zonal, and serverless NEGs.</p>
<p>When using an TCP proxy load balancer, Google Cloud Armor enforces the security policy
rule action <code dir="ltr" translate="no">deny</code> only on new connection requests. The <code dir="ltr" translate="no">deny</code> action
terminates the TCP connection. In addition, if you provide a status code with
your <code dir="ltr" translate="no">deny</code> action, the status code is ignored.</p>
<h4 data-text="Edge security policies" id="edge-policies">Edge security policies</h4>
<p>Edge security policies enable users to configure filtering and access control
policies for content that is stored in cache; this includes endpoints like
Cloud CDN-enabled backend services and Cloud Storage buckets. Edge
security policies support filtering based on a subset of parameters compared to
backend security policies. You cannot set an edge security policy as a backend
policy. Edge security policies are not supported for TCP proxy load balancers or
SSL proxy load balancers.</p>
<p>Edge security policies can be configured to filter requests before the request
is served from Google's cache. Edge security policies are deployed and enforced
at the outermost perimeter of Google's network, upstream of where the
Cloud CDN cache resides. Edge security policies can coexist with backend
security policies to provide two layers of protection. They can be
simultaneously applied to a backend service regardless of the resources that the
backend service points to (for example, instance groups or network endpoint
groups). Only edge security policies can be applied to backend buckets.</p>
<aside class="note"><strong>Note:</strong><span> Edge security policies are evaluated and enforced upstream of the
Identity-Aware Proxy (IAP). A request blocked by an edge security policy is
denied before IAP evaluates the identity of the requestor.
Blocking a request with a rule at the edge security policy prevents the
IAP from serving a sign-in page or otherwise attempting to
authenticate the user.</span></aside>
<h3 data-text="Rule evaluation order" id="eval-order">Rule evaluation order</h3>
<p>Rule evaluation order is determined by <em>rule priority</em>, from the lowest number
to the highest number. The rule with the lowest numeric value assigned has the
highest logical priority and is evaluated prior to rules with lower logical
priorities. The minimum numeric priority is 0. The priority of a rule decreases
as its number increases (1, 2, 3, <em>N</em>+1). You cannot configure two or more rules
with the same priority. The priority for each rule must be set to a number from
0 to 2147483646 inclusive. The priority value 2147483647, also known as
<code dir="ltr" translate="no">INT-MAX</code>, is reserved for the <a href="#default-rule">default rule</a>.</p>
<p>Priority numbers can have gaps, which enable you to add or remove rules in the
future without affecting the rest of the rules. For example, 1, 2, 3, 4, 5, 9,
12, 16 is a valid series of priority numbers to which you could add rules
numbered from 6 to 8, 10 to 11, and 13 to 15 in the future. You don't need to
change the existing rules except for the order of execution.</p>
<p>Typically, the highest priority rule that matches the request is applied.
However, there is an exception when <code dir="ltr" translate="no">HTTP POST</code> requests are evaluated against
preconfigured rules that use <code dir="ltr" translate="no">evaluatePreconfiguredExpr()</code>. The exception is as
follows.</p>
<p>For <code dir="ltr" translate="no">HTTP POST</code> requests, Google Cloud Armor receives the request's header
before the body (payload). Because Google Cloud Armor receives the
header information first, it evaluates rules that match against the header, but
it does not match any preconfigured rules on the body. If there are multiple
header-based rules, Google Cloud Armor evaluates them based on their
priority as expected. Note that <code dir="ltr" translate="no">redirect</code> actions and inserting custom header
actions work only during the header processing phase. The <code dir="ltr" translate="no">redirect</code> action, if
matched during the following body processing phase, is translated to a <code dir="ltr" translate="no">deny</code>
action. The custom request header action, if matched during the body
processing phase, will not take effect.</p>
<p>After Google Cloud Armor receives the <code dir="ltr" translate="no">HTTP POST</code> body, it evaluates rules
that apply to both the request headers and body. As a result, it's possible that
lower priority rules that allow a request's header are matched before higher
priority rules that block the request's body. In such cases, it is possible that
the HTTP header portion of the request is sent to the target backend
service, but the <code dir="ltr" translate="no">POST</code> body containing potentially malicious content is
blocked. Google Cloud Armor inspects the first 8KB of the <code dir="ltr" translate="no">POST</code> body.
For more information about this limitation, see
<a href="#post-body">POST body inspection limitation</a>.</p>
<p>The <code dir="ltr" translate="no">evaluatePreconfiguredExpr()</code> expression for preconfigured rules is
the only expression that is evaluated against the request body. All other
expressions are evaluated against the request header only. Among the <code dir="ltr" translate="no">HTTP</code>
request types with a request body, Google Cloud Armor processes only <code dir="ltr" translate="no">POST</code>
requests. The inspection is limited to the first 8 KB of the <code dir="ltr" translate="no">POST</code> body and
gets decoded like URL query parameters. Google Cloud Armor can parse and apply
preconfigured WAF rules for JSON-formatted POST bodies (Content-
Type='application/json'). However, Google Cloud Armor does not support other
HTTP Content-Type/Content-Encoding-based decoders such as XML and Gzip.</p>
<h4 data-text="Examples" id="examples">Examples</h4>
<p>In the following example, rules 1, 2, and 3 are evaluated in that order for the
<code dir="ltr" translate="no">IP</code> and <code dir="ltr" translate="no">HTTP</code> header fields. However, if an <code dir="ltr" translate="no">IP 9.9.9.1</code> launches an XSS
attack in the <code dir="ltr" translate="no">HTTP POST</code> body, only the body is blocked (by rule 2); the <code dir="ltr" translate="no">HTTP</code>
header passes through to the backend (by rule 3).</p>
<pre dir="ltr" translate="no">
Rule1
expr: inIPRange(origin.ip, '10.10.10.0/24')
action: deny(403)
priority: 1
Rule2
expr: evaluatePreconfiguredExpr('xss-stable')
action: deny(403)
priority: 2
Rule3
expr: inIPRange(origin.ip, '9.9.9.0/24')
action: allow
priority: 3
Rule-default
action: deny(403)
priority: INT-MAX
</pre>
<p>In the following example, the policy allows <code dir="ltr" translate="no">IP 9.9.9.1</code> without scanning against
XSS attacks:</p>
<pre dir="ltr" translate="no">
Rule1
expr: inIPRange(origin.ip, '10.10.10.0/24')
action: deny(403)
priority: 1
Rule2
expr: inIPRange(origin.ip, '9.9.9.0/24')
action: allow
priority: 2
Rule3
expr: evaluatePreconfiguredExpr('xss-stable')
action: deny(403)
priority: 3
Rule-default
action: allow
priority: INT-MAX
</pre>
<h3 data-text="Default rule" id="default-rule">Default rule</h3>
<p>Each Google Cloud Armor security policy contains a <em>default</em> rule that is
matched if none of the higher priority rules are matched or if there are no
other rules in the policy. The default rule is automatically assigned a priority
of 2147483647 (<code dir="ltr" translate="no">INT-MAX</code>), and it is always present in the security policy.</p>
<p>You cannot delete the default rule, but you can modify it. The default action
for the default rule is allow, but you can change the action to deny.</p>
<h3 data-text="Fingerprint" id="fingerprint">Fingerprint</h3>
<p>Each Google Cloud Armor security policy has a field <code dir="ltr" translate="no">fingerprint</code>. The
fingerprint is a hash of the contents stored in the policy. When you create a
new policy, do not provide the value of this field. If you provide a value, it
is ignored. However, when you update a security policy, you must specify the
current fingerprint, which you get when you export or describe the policy (using
<code dir="ltr" translate="no">EXPORT</code> or <code dir="ltr" translate="no">DESCRIBE</code>, respectively).</p>
<p>The fingerprint protects you from overriding another user's update. If the
fingerprint that you provide is out of date, it means that the security policy
was updated since you last retrieved the fingerprint. To check for any
differences and to retrieve the latest fingerprint, run the <code dir="ltr" translate="no">DESCRIBE</code>
command.</p>
<h3 data-text="Rules language and enforcement engine" id="rules_language_and_enforcement_engine">Rules language and enforcement engine</h3>
<p>The rules language and enforcement engine provide the following:</p>
<ul>
<li><p>The ability to write custom rule expressions that can match on various Layer 3
through Layer 7 attributes of incoming requests. Google Cloud Armor provides a
<a href="/armor/docs/rules-language-reference">flexible language</a> for writing custom
match conditions.</p></li>
<li><p>The ability to combine multiple subexpressions in a single rule.</p></li>
<li><p>The ability to deny or allow requests based on the incoming request's region
code. The region codes are based on the
<a class="external" href="https://www.wikipedia.org/wiki/ISO_3166-1_alpha-2" target="wiki">ISO 3166-1 alpha 2</a> 
codes. The region codes sometimes correspond to specific countries, but some
encompass a country plus its associated areas. For example, the <code dir="ltr" translate="no">US</code> code
includes all states of the United States, one district, and six outlying areas.</p></li>
</ul>
<h3 data-text="Types of rules" id="types_of_rules">Types of rules</h3>
<p>Google Cloud Armor has the following types of rules.</p>
<aside class="note"><strong>Note:</strong><span> Edge security policies only support filtering based on source IP address
and geography attributes, which are <code dir="ltr" translate="no">origin.ip</code> and <code dir="ltr" translate="no">origin.region_code</code>.</span></aside>
<h4 data-text="IP address allowlist and denylist rules" id="ip-address-rules">IP address allowlist and denylist rules</h4>
<p>You can create IP address allowlist and denylist rules within a security
policy. Some examples include the following:</p>
<ul>
<li><p>Denylisting for IP address/<a class="external" href="https://wikipedia.org/wiki/Classless_Inter-Domain_Routing" target="wiki">CIDR</a> 
enables you to block a source IP address or CIDR range from
accessing supported load balancers.</p></li>
<li><p>Allowlisting for IP address/CIDR enables you to allow a source
IP address or CIDR range to access supported load balancers.</p></li>
<li><p>IPv4 and IPv6 addresses are supported in allowlist and denylist rules.</p></li>
<li><p>IP address rules can block or allow individual source IP
addresses or CIDRs. Both IPv4 and IPv6 source addresses are supported, but
IPv6 addresses must have subnet masks no larger than /64.</p></li>
<li><p>Deny rules can return an HTTP <code dir="ltr" translate="no">403</code> (Unauthorized), <code dir="ltr" translate="no">404</code> (Access Denied),
or <code dir="ltr" translate="no">502</code> (Bad Gateway) response.</p></li>
<li><p>Exceed action rules can return an HTTP <code dir="ltr" translate="no">429</code> (Too Many Requests).</p></li>
</ul>
<h4 data-text="Preconfigured rules for XSS, SQLi, LFI, RFI, and RCE" id="preconfigured-rules">Preconfigured rules for XSS, SQLi, LFI, RFI, and RCE</h4>
<p>You can use preconfigured rules to mitigate the following attacks:</p>
<ul>
<li>Cross-site scripting (XSS)</li>
<li>SQL injection (SQLi) attacks</li>
<li>Local file inclusion (LFI) attacks</li>
<li>Remote file inclusion (RFI) attacks</li>
<li>Remote code execution (RCE) attacks</li>
</ul>
<p>These rules are based on the
<a class="external" href="https://modsecurity.org/crs/" target="github">OWASP Modsecurity</a> 
core rule set version 3.0.2.</p>
<h4 data-text="Bot management rules" id="recaptcha">Bot management rules</h4>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
<p>You can use bot management rules to do the following:</p>
<ol>
<li>Redirect requests for reCAPTCHA Enterprise assessment with optional
manual challenges.</li>
<li>Evaluate reCAPTCHA Enterprise tokens attached with a request and apply
the configured action based on token attributes.</li>
<li>Redirect requests to your configured alternative URL with a 302 response.</li>
<li>Insert custom headers to requests before proxying them to your backends.</li>
</ol>
<p>For more information about bot management, see the
<a href="/armor/docs/bot-management">bot management overview</a>.</p>
<h4 data-text="Preconfigured rules for named IP address lists" id="preconfigured-rules-named-ip-address-lists">Preconfigured rules for named IP address lists</h4>
<p>Preconfigured rules for named IP address lists provide the following:</p>
<ul>
<li><p>Integrate third-party providers' named IP address lists with
Google Cloud Armor.</p></li>
<li><p>Simplify maintenance of allowed or denied IP address ranges.</p></li>
<li><p>Synchronize third-party providers' lists daily.</p></li>
<li><p>Increase your capacity for configuring IP addresses and ranges in security
policies because named IP address lists are not subject to limits on the number
of IP addresses per rule.</p></li>
</ul>
<h4 data-text="Rate limiting rules" id="rate-limiting-rules">Rate limiting rules</h4>
<p>You can use rate limiting rules to do the following:</p>
<ul>
<li>Throttle requests per client based on a threshold you configure.</li>
<li>Temporarily ban clients that exceed a request threshold that you set for a
configured duration.</li>
</ul>
<p>When you use rate limiting with TCP proxy load balancers or SSL proxy load balancers, the
following restrictions apply:</p>
<ul>
<li>Google Cloud Armor only enforces rate limiting actions like throttling or
banning on new connection requests from clients.</li>
<li>Only the key types <code dir="ltr" translate="no">ALL</code> and <code dir="ltr" translate="no">IP</code> are supported for TCP Proxy Load Balancing and
SSL Proxy Load Balancing.</li>
<li>If you attempt to use the key type <code dir="ltr" translate="no">HTTP-HEADER</code> or <code dir="ltr" translate="no">HTTP-COOKIE</code> with TCP/SSL
load balancers, the key type is interpreted as <code dir="ltr" translate="no">ALL</code>, and likewise
<code dir="ltr" translate="no">XFF-IP</code> is interpreted as <code dir="ltr" translate="no">IP</code>.</li>
</ul>
<p>For more information about rate limiting and how it works, see the
<a href="/armor/docs/rate-limiting-overview">Rate limiting overview</a>.</p>
<h3 data-text="Preview mode" id="preview_mode">Preview mode</h3>
<p>You can preview the effects of a rule without enforcing it. In preview mode,
actions are noted in <a href="/monitoring/docs">Cloud Monitoring</a>. You can choose to
preview individual rules in a security policy, or you can preview every rule in
the policy.</p>
<p>You can enable preview mode for a rule by using the Google Cloud CLI and the
<code dir="ltr" translate="no">--preview</code> flag of
<a href="/sdk/gcloud/reference/compute/security-policies/rules/update"><code dir="ltr" translate="no">gcloud compute security-policies rules update</code></a>.</p>
<p>To disable preview mode, use the <code dir="ltr" translate="no">--no-preview</code> flag, which is not currently
documented. You can also use the Cloud console.</p>
<p>If a request triggers a preview, Google Cloud Armor will continue to evaluate
other rules until finding a match. Both the matched and preview rule will be
available in the logs.</p>
<h3 data-text="Logging" id="logging">Logging</h3>
<p>Google Cloud Armor has extensive logging and lets you define how verbose
your logging is. For complete information about logging, see
<a href="/armor/docs/request-logging">Using request logging</a>.</p>
<h3 data-text="JSON parsing and verbose logging" id="json-parsing">JSON parsing and verbose logging</h3>
<p>By default, Google Cloud Armor does not parse the JSON content of POST bodies
when preconfigured WAF (web application firewall) rules are evaluated. This can
cause the WAF rules to be noisy and potentially generate false positive matches
on incoming requests if the protected workloads serve REST APIs or otherwise
receive requests with JSON in the POST Body
(<code dir="ltr" translate="no">Content-Type = "application/json"</code>).</p>
<p>A noisy rule is triggered by requests that you would most likely consider to be
false positives. For example, a JSON request body such as <code dir="ltr" translate="no">'{"test": "123"}'</code>
triggers the SQL injection rule <code dir="ltr" translate="no">owasp-crs-v030001-id942431-sqli</code> if JSON
parsing is not enabled.</p>
<p>We recommend that you enable JSON parsing if you expect your workload to receive
requests with <code dir="ltr" translate="no">Content-Type = "application/json"</code>—for example, if you are
serving REST APIs. By default, this option is disabled. The syntax for the flag
is as follows:</p>
<p><code dir="ltr" translate="no">--json-parsing=[STANDARD | DISABLED]</code></p>
<p>The flag is available only with <code dir="ltr" translate="no">gcloud compute security-policies update</code>. You
cannot create a new security policy with this option unless you create a
security policy in a file and then import that file.</p>
<p>To reduce the noise and false positives, you can configure Google Cloud Armor
to parse the JSON content of POST bodies. This means that Google Cloud Armor
ignores structural characters of the JSON message in the POST body and looks
only at the end-user-provided values in the JSON message. For more information
about preconfigured WAF rules, see
<a href="/armor/docs/rule-tuning">Tuning Google Cloud Armor WAF rules</a>.</p>
<p>Additionally, you might not be able to tell why a preconfigured WAF rule was
triggered by a particular request. Google Cloud Armor's default event logs
contain the rule that was triggered, as well as the subsignature. However, you might
need to identify the details from the incoming request that triggered the rule
for troubleshooting, rule validation, or rule tuning purposes.</p>
<p>You can adjust the level of detail recorded in your logs. We recommend that you
enable verbose logging only when you first create a policy, make
changes to a policy, or troubleshoot a policy. If you enable verbose
logging, it is in effect for rules in preview mode as well as active
(non-previewed) rules during standard operations.</p>
<p>For more information about verbose logging, see <a href="/armor/docs/request-logging#verbose-logging">Using request
logging</a>.</p>
<h4 data-text="HTTP(S) Load Balancing request logging" id="https-request-logging">HTTP(S) Load Balancing request logging</h4>
<p>Each HTTP(S) request that is evaluated against a Google Cloud Armor security
policy is logged through Cloud Logging. The logs provide details such as the
name of the applied security policy, the matching rule, and whether the rule was
enforced. Request logging for new backend service resources is disabled by
default. To ensure that Google Cloud Armor requests are logged, you must
enable HTTP(S) logging for each backend service protected by a security policy.</p>
<p>For more information, see
<a href="/load-balancing/docs/https/https-logging-monitoring">HTTP(S) Load Balancing logging and monitoring</a>
and <a href="/armor/docs/request-logging">Using request logging</a>.</p>
<p>To view Google Cloud Armor logs, see <a href="/armor/docs/request-logging#view-logs">Viewing logs</a>.</p>
<h4 data-text="TCP Proxy Load Balancing and SSL Proxy Load Balancing request logging" id="and_request_logging">TCP Proxy Load Balancing and SSL Proxy Load Balancing request logging</h4>
<p>You can configure TCP Proxy Load Balancing and SSL Proxy Load Balancing
logging using the Google Cloud CLI commands as listed in
<a href="/load-balancing/docs/https/https-logging-monitoring#logging">HTTP(S) Load Balancing logging and monitoring</a>.
You cannot enable logging for TCP Proxy Load Balancing and SSL Proxy Load Balancing
using the Google Cloud console.</p>
<h2 data-text="Limitations" id="limitations">Limitations</h2>
<ul>
<li>Backend security policies are enforced only for cache miss requests that
have passed edge security policies.</li>
</ul>
<h3 data-text="POST body inspection limitation" id="post-body">POST body inspection limitation</h3>
<p>The <code dir="ltr" translate="no">evaluatePreconfiguredExpr()</code> expression for preconfigured rules is the only
expression that Google Cloud Armor evaluates against the request body. Among
the HTTP request types with a request body, Google Cloud Armor processes only
POST requests.</p>
<p>The inspection is limited to the first 8 KB of the POST body, which gets decoded
like URL query parameters. The remainder of the POST body might contain
malicious code, which your application might accept. To mitigate the risk of
POST bodies whose size exceeds 8 KB, see the
<a href="/armor/docs/troubleshooting#post-body">troubleshooting guide</a>.</p>
<p>Google Cloud Armor can parse and apply preconfigured WAF rules for default
URL-encoded and JSON-formatted POST bodies (Content-Type='application/json'),
in which case rules are independently applied on the decoded names and values in
the data. For other HTTP content types, Google Cloud Armor does not decode the
data, but applies the preconfigured rules on raw data.</p>
<h3 data-text="How WebSocket connections are handled" id="websocket">How WebSocket connections are handled</h3>
<p>External HTTP(S) Load Balancing has built-in support for the WebSocket protocol.
WebSocket channels are initiated from HTTP(S) requests. Google Cloud Armor
can block a WebSocket channel from being established, for example, if an IP
address denylist blocks the originating IP address. However, subsequent
transactions in the channel do not conform to the HTTP protocol, and
Google Cloud Armor does not evaluate any messages after the first request.</p>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/configure-security-policies">Configure security policies, rules, and expressions</a></li>
<li><a href="/armor/docs/managed-protection-overview">Learn about the features in Managed Protection tiers</a></li>
<li><a href="/armor/docs/armor-named-ip">Learn about named IP address lists</a></li>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="mwETRvWii0eU5NUYprb0Y9z5GVbc" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/common-use-cases]</H1></p><div class="devsite-article-body clearfix">
<p>This page features common use cases for Google Cloud Armor security policies.
Google Cloud Armor security policies can protect your application with
features like IP address allowlists and denylists, and preconfigured
rules to deter common web attacks.</p>
<h2 data-text="Controlling access to your web applications and services" id="controlling_access_to_your_web_applications_and_services">Controlling access to your web applications and services</h2>
<p>This section presents several ways to use Google Cloud Armor security policies
to control access to your applications or services.</p>
<h3 data-text="Enable access for users at specific IP addresses with allowlists" id="limit-access-to-https">Enable access for users at specific IP addresses with allowlists</h3>
<p>A typical use case for placing user IP addresses on an allowlist is when your
external HTTP(S) load balancer is accessed only by a specific set of users. In the following
example, only users from your organization are allowed access to services behind
your load balancer. These users have IP addresses or address blocks assigned by
your organization. You can place these IP addresses or CIDR ranges on an
allowlist so that only these users have access to the load balancer.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-2.svg">
<img alt="Restricting load balancer access with an allowlist." border="0" src="/armor/images/ip-bl-wl-2.svg" width="700"/></a>
<figcaption>Restricting load balancer access with an allowlist
      (click to enlarge)</figcaption>
</figure>
<p>You control access to the external HTTP(S) load balancer by configuring an allowlist with
source IP addresses or source CIDR ranges from which access to your load
balancer is permitted. The following section further describes this
configuration.</p>
<p>In this configuration, you only want to allow users from your organization with
IP addresses from an IP range to access the external HTTP(S) load balancer. You want
all other traffic to be denied.</p>
<p>To create this configuration, follow these steps:</p>
<ol>
<li>Create a Google Cloud Armor security policy.</li>
<li>In the security policy, add a rule that adds the range to the allowlist
as the first rule. This rule has the description <code dir="ltr" translate="no">allow <var translate="no">[RANGE]</var></code>,
where <code dir="ltr" translate="no"><var translate="no">[RANGE]</var></code> is the desired IP range.</li>
<li>Modify the default rule in the policy from an allow rule to a
deny rule. The default rule governs traffic that does not match any of
the preceding rules. It is the last rule in the policy. Changing the rule
from <code dir="ltr" translate="no">allow</code> to <code dir="ltr" translate="no">deny</code> blocks all traffic that does not originate in the
range on the allowlist.</li>
<li>Associate this policy with the external HTTP(S) load balancer's backend service.</li>
</ol>
<p>If your organization uses a third-party security provider to scrub traffic, you
can add the security provider's IP address to an allowlist to ensure that only
scrubbed traffic can access the external HTTP(S) load balancer and backends.</p>
<p>In the following illustration, the third-party provider is identified by the
CIDR range 192.0.2.0/24, and this range is on an allowlist.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-4.svg">
<img alt="Restricting load balancer access by allowlisting traffic from a
       third-party security provider." border="0" src="/armor/images/ip-bl-wl-4.svg" width="700"/></a>
<figcaption>Restricting load balancer access by allowlisting traffic from a
       third-party security provider (click to enlarge)</figcaption>
</figure>
<h3 data-text="Block access for users at specific IP addresses with denylists" id="block-traffic">Block access for users at specific IP addresses with denylists</h3>
<p>Use denylists to create Google Cloud Armor security policies that reject
traffic from an IP address or CIDR range. In the following illustration, the
Google Cloud Armor security policy has a <code dir="ltr" translate="no">deny</code> rule that blocks traffic
from the IP address 198.51.100.1, where a malicious user has been identified.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-3.svg">
<img alt="Restricting load balancer access with a denylist." border="0" src="/armor/images/ip-bl-wl-3.svg" width="700"/></a>
<figcaption>Restricting load balancer access with a denylist
      (click to enlarge)</figcaption>
</figure>
<h3 data-text="Custom rules to filter based on Layer 3 through Layer 7 parameters" id="customize-defenses">Custom rules to filter based on Layer 3 through Layer 7 parameters</h3>
<p>Use the Google Cloud Armor custom rules language to define one or more
expressions in a rule's match condition. When Google Cloud Armor receives a
request, it evaluates the request against these expressions. If there is a
match, the rule's action takes effect, either denying or allowing the incoming
traffic.</p>
<p>The following examples are expressions that are written in the
Google Cloud Armor extension of the <a class="external" href="https://github.com/google/cel-spec" target="github">Common Expression Language
(CEL)</a>.
For more information, see the
<a href="/armor/docs/rules-language-reference">Custom rules language reference</a>.</p>
<p>To define expressions in a rule, use the gcloud <code dir="ltr" translate="no">--expression</code> flag or the
Google Cloud console. For more information, see
<a href="/armor/docs/configure-security-policies#creating-policy-rules">Creating Google Cloud Armor security policies, rules, and expressions</a>.</p>
<p>In the following example, requests from <code dir="ltr" translate="no">2001:db8::/32</code> (such as your alpha
testers) in the <code dir="ltr" translate="no">AU</code> region match the following expression:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.region_code == "AU" &amp;&amp; inIpRange(origin.ip, '2001:db8::/32')
</pre>
<p>The following example matches with requests from <code dir="ltr" translate="no">192.0.2.0/24</code> and with a user
agent that contains the string <code dir="ltr" translate="no">WordPress</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '192.0.2.0/24') &amp;&amp; has(request.headers['user-agent']) &amp;&amp; request.headers['user-agent'].contains('WordPress')
</pre>
<p>For additional examples, see <a href="/armor/docs/rules-language-reference#expression-examples">Example
expressions</a> in the
custom rules language reference.</p>
<h2 data-text="Protect your deployment against application layer attacks and help mitigate OWASP Top 10 risks" id="protect_your_deployment_against_application_layer_attacks_and_help_mitigate_owasp_top_10_risks">Protect your deployment against application layer attacks and help mitigate OWASP Top 10 risks</h2>
<p>You can use Google Cloud Armor to protect a Cloud CDN origin server
from application layer (L7) attacks such as SQL injection (SQLi) and
cross-site scripting (XSS). Content in a cache is static and presumably does not
pose a risk of a targeted attack from the web. However, the underlying content
origin server might be a dynamic application with known or potential web-app
vulnerabilities. Your security or compliance requirements might require you to
mitigate these risks to prevent vulnerability exploits from the internet from
successfully attacking the origin server.</p>
<p>To mitigate the risks, follow these steps:</p>
<ol>
<li>Create or identify a  backend service with CDN enabled.</li>
<li>Create a Google Cloud Armor security policy.</li>
<li>Create one or more rules in the security policy to deny L7 attacks.</li>
<li>Configure one of the targets of the security policy to be the backend
service that you created or identified in step 1.</li>
</ol>
<p>You can also use preconfigured rules to detect and block common application layer
attacks. Preconfigured rules are predefined expression sets that you can add to
a Google Cloud Armor security policy. To add these expression sets to a rule,
use the gcloud <code dir="ltr" translate="no">--expression</code> flag or Cloud console.
For more information, see
<a href="/armor/docs/configure-security-policies#creating-policy-rules">Creating security policies, rules, and expressions</a>.</p>
<p>For more information about preconfigured rules, see <a href="/armor/docs/rules-language-reference#preconfigured-rules">Preconfigured
rules</a> in the custom
rules language reference.</p>
<p>The following example uses a preconfigured rule to mitigate cross-site
scripting (XSS) attacks:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
evaluatePreconfiguredExpr('xss-stable')
</pre>
<p>The following example uses a preconfigured rule to mitigate SQL injection
(SQLi) attacks:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
evaluatePreconfiguredExpr('sqli-stable')
</pre>
<p>You can also combine preconfigured rules with other expressions. The following
example uses a preconfigured rule to mitigate SQLi attacks from the
<code dir="ltr" translate="no">192.0.2.1/24</code> IP address range:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '192.0.2.1/24') &amp;&amp; evaluatePreconfiguredExpr('sqli-stable')
</pre>
<h3 data-text="OWASP Top 10 mitigation for hybrid workloads" id="owasp-top-10">OWASP Top 10 mitigation for hybrid workloads</h3>
<p>Google Cloud Armor offers mitigations for the following attacks, whether they
are deployed in Google Cloud,on-premises, or in a third-party provider:</p>
<ul>
<li>SQL injection (SQLi)</li>
<li>Cross-site scripting (XSS)</li>
<li>Local File Inclusion (LFI)</li>
<li>Remote File Inclusion (RFI)</li>
<li>Remote Code Execution (RCE)</li>
</ul>
<p>You can use these capabilities to address some of the most common web
application security risks, including those risks identified in the
<a class="external" href="https://owasp.org/www-project-top-ten/" target="owasp">OWASP Top 10</a> 
list.</p>
<p>Google Cloud Armor's preconfigured <a href="/armor/docs/rule-tuning">WAF rules</a> can be
added to a security policy to detect and deny unwelcome layer 7 requests
containing SQLi or XSS attempts. Google Cloud Armor detects malicious requests
and drops them at the edge of Google's infrastructure. The requests are not
proxied to the backend service, regardless of where the backend service is
deployed.</p>
<p>To defend a non-Google Cloud-hosted workload from these attacks
at the edge of Google's network, follow these steps:</p>
<ol>
<li>Configure an external HTTP(S) load balancer with a backend service that has an internet
NEG as a backend.</li>
<li>Create a Google Cloud Armor security policy.</li>
<li>Add preconfigured SQLi and XSS rules to the policy.</li>
<li>Attach the security policy to the backend service that you created in step 1.</li>
<li>Monitor Google Cloud Armor activity by using Cloud Logging,
Cloud Monitoring, and the findings sent to Security Command Center.</li>
</ol>
<h3 data-text="Cloud CDN external origin server DDoS defense and layer 7 monitoring" id="cdn-ddos-defense">Cloud CDN external origin server DDoS defense and layer 7 monitoring</h3>
<p>Cloud CDN deployments with an external origin server can have
Google's edge infrastructure as the frontend for proxying, caching, and
Google Cloud Armor layer 7 filtering. Using internet NEGs, the origin
server can be located on-premises or with a third-party infrastructure
provider.</p>
<p>Google Cloud Armor and the rest of Google's edge infrastructure mitigates
and drops L3/L4 attacks, alerts on suspicious Layer 7 activity, and stands
ready to deny unwelcome layer 7 requests with custom rules. Google Cloud Armor
logging and telemetry across Cloud Logging, Cloud Monitoring, and
Security Command Center provide actionable insight for protected
applications regardless of where they are deployed.</p>
<p>To enable Google Cloud Armor protection for CDN external origins servers,
follow these steps:</p>
<ol>
<li>Configure an external HTTP(S) load balancer with a backend service that has an internet
NEG as a backend.</li>
<li>Enable Cloud CDN for this backend service.</li>
<li>Create a Google Cloud Armor security policy.</li>
<li>Attach the security policy to the backend service that you created in step 1.</li>
<li>Access Google Cloud Armor alerts, logging and telemetry in
Security Command Center, Cloud Logging, and Cloud Monitoring.</li>
</ol>
<p>In addition, you can use edge security policies to protect content stored in
cache. For more information on edge security policies, see the
<a href="/armor/docs/security-policy-overview#edge-policies">Security policy overview</a>.</p>
<h3 data-text="Layer 7 access controls and cache-busting attacks" id="layer-7-access-controls">Layer 7 access controls and cache-busting attacks</h3>
<p>Depending on the application architecture, you can configure one backend service
to serve requests for various URLs, including cacheable and non-cacheable
content. In such deployment scenarios, create Google Cloud Armor security
policies that deny unwelcome traffic on certain request paths, but allow all
clients to access static content on a different request path.</p>
<p>In other situations, even though the content is being efficiently served from
cache, a malicious or faulty client might generate a high volume of requests
that result in a cache miss and require the underlying origin server to fetch or
generate the requested content. This can strain limited resources and have a
negative impact on the availability of the application for all users. You can
create a Google Cloud Armor security policy to match the signature of
any clients that are causing the issue and deny the requests before they reach
the origin server and affect performance.</p>
<p>To accomplish this, follow these steps:</p>
<ol>
<li>Create a Google Cloud Armor security policy.</li>
<li><p>Configure a rule; for example, the following rule denies access to <code dir="ltr" translate="no">"/admin"</code>:</p>
<pre class="prettyprint lang-sh" dir="ltr" translate="no"><code dir="ltr" translate="no">request.path.contains("/admin") &amp;&amp; !inIpRange(origin.ip, '&lt;allowed_ip_range&gt;'
</code></pre></li>
<li><p>Attach the security policy from step 1 to the backend service that has
Cloud CDN enabled.</p></li>
</ol>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/configure-security-policies">Configure security policies</a></li>
<li><a href="/armor/docs/rules-language-reference">Learn about the custom rules language</a></li>
<li><a href="/armor/docs/rule-tuning">Tune WAF rules</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/configure-security-policies]</H1></p><div class="devsite-article-body clearfix">
<p>Use these instructions to create Google Cloud Armor security policies to
filter incoming traffic that is destined to external HTTP(S) load balancers. For conceptual
information about security policies, see the
<a href="/armor/docs/security-policy-overview">Google Cloud Armor security policy overview</a>.</p>
<p>For information about configuring Google Cloud Armor on
Google Kubernetes Engine (GKE), see
<a href="/kubernetes-engine/docs/how-to/ingress-features#cloud_armor">Google Cloud Armor security policy</a> in the section <em>Configuring Ingress features through
BackendConfig parameters</em>.</p>
<h2 data-text="Before you begin" id="before_you_begin">Before you begin</h2>
<p>Before you configure security policies, do the following:</p>
<ul>
<li><p>Make sure that you are familiar with <a href="/load-balancing/docs/https">HTTP(S) Load Balancing</a>
concepts.</p></li>
<li><p>Examine your existing backend services to determine which do not already
have a security policy attached. These backend services and their associated
backends are not protected by Google Cloud Armor. To add the protection
that Google Cloud Armor provides, use the instructions in this document to
attach a newly-created or existing security policy to the backend service.</p></li>
</ul>
<h3 data-text="Set up IAM permissions for Google Cloud Armor security policies" id="iam-perms">Set up IAM permissions for Google Cloud Armor security policies</h3>
<p>The following operations require the Identity and Access Management (IAM) role
<a href="/iam/docs/understanding-roles#compute-engine-roles">Compute Security Admin (roles/compute.securityAdmin)</a>:</p>
<ul>
<li>configuring, modifying, updating, and deleting a Google Cloud Armor
security policy</li>
<li>API methods allowed:
<ul>
<li><code dir="ltr" translate="no">SecurityPolicies insert</code></li>
<li><code dir="ltr" translate="no">SecurityPolicies delete</code></li>
<li><code dir="ltr" translate="no">SecurityPolicies patch</code></li>
<li><code dir="ltr" translate="no">SecurityPolicies addRule</code></li>
<li><code dir="ltr" translate="no">SecurityPolicies patchRule</code></li>
<li><code dir="ltr" translate="no">SecurityPolicies removeRule</code></li>
</ul></li>
</ul>
<p>A user with the Compute Network Admin role (roles/compute.networkAdmin) can
perform the following operations:</p>
<ul>
<li>Setting a Google Cloud Armor security policy for a backend service</li>
<li>API methods allowed:
<ul>
<li><code dir="ltr" translate="no">BackendServices setSecurityPolicy</code></li>
</ul></li>
</ul>
<p>Users with the roles Security Admin and Network Admin can view
Google Cloud Armor security policies using the API methods
SecurityPolicies <code dir="ltr" translate="no">get</code>, <code dir="ltr" translate="no">list</code>, and <code dir="ltr" translate="no">getRule</code>.</p>
<h3 data-text="Setting up IAM permissions for custom roles" id="iam-custom-perms">Setting up IAM permissions for custom roles</h3>
<p>The following table lists the IAM roles' base permissions and
their associated API methods.</p>
<table>
<thead>
<tr>
<th width="50%">IAM permission</th>
<th width="50%">API methods</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">compute.securityPolicies.create</code></td>
<td><code dir="ltr" translate="no">SecurityPolicies insert</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">compute.securityPolicies.delete</code></td>
<td><code dir="ltr" translate="no">SecurityPolicies delete</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">compute.securityPolicies.get</code></td>
<td><code dir="ltr" translate="no">SecurityPolicies get</code><br/>
<code dir="ltr" translate="no">SecurityPolicies getRule</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">compute.securityPolicies.list</code></td>
<td><code dir="ltr" translate="no">SecurityPolicies list</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">compute.securityPolicies.use</code></td>
<td><code dir="ltr" translate="no">BackendServices setSecurityPolicy</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">compute.securityPolicies.update</code></td>
<td><code dir="ltr" translate="no">SecurityPolicies patch</code><br/>
<code dir="ltr" translate="no">SecurityPolicies addRule</code><br/>
<code dir="ltr" translate="no">SecurityPolicies patchRule</code><br/>
<code dir="ltr" translate="no">SecurityPolicies removeRule</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">compute.backendServices.setSecurityPolicy</code></td>
<td><code dir="ltr" translate="no">BackendServices setSecurityPolicy</code></td>
</tr>
</tbody></table>
<h2 data-text="Configuring security policies for HTTP(S) Load Balancing" id="https-load-balancer">Configuring security policies for HTTP(S) Load Balancing</h2>
<p>The following are the high-level steps for configuring Google Cloud Armor
security policies to enable rules that allow or deny traffic to
external HTTP(S) load balancers:</p>
<ol>
<li>Create a Google Cloud Armor security policy.</li>
<li>Add rules to the security policy based on IP address lists, custom expressions, or
preconfigured expression sets.</li>
<li>Attach the security policy to a backend service of
the external HTTP(S) load balancer for which you want to control access.</li>
<li>Update the security policy as needed.</li>
</ol>
<p>In the following example, you create two Google Cloud Armor security
policies and apply them to different backend services.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-7.svg">
<img alt="Example in which two security policies are applied to different backend services." border="0" src="/armor/images/ip-bl-wl-7.svg" width="700"/></a>
<figcaption>Example in which two security policies are applied to different backend services (click to enlarge)</figcaption>
</figure>
<p>In the example, these are the Google Cloud Armor security policies:</p>
<ul>
<li><code dir="ltr" translate="no">mobile-clients-policy</code> applies to external users of your <code dir="ltr" translate="no">games</code> services.</li>
<li><code dir="ltr" translate="no">internal-users-policy</code> applies to your organization's <code dir="ltr" translate="no">test-network</code> team.</li>
</ul>
<p>You apply <code dir="ltr" translate="no">mobile-clients-policy</code> to the <code dir="ltr" translate="no">games</code> service, whose backend service
is called <code dir="ltr" translate="no">games</code>, and you apply <code dir="ltr" translate="no">internal-users-policy</code> to the internal <code dir="ltr" translate="no">test</code>
service for the testing team, whose corresponding backend service is called
<code dir="ltr" translate="no">test-network</code>.</p>
<p>If the backend instances for a backend service are in multiple regions,
the Google Cloud Armor security policy associated with the service is
applicable to instances in all regions. In the preceding example, the
security policy <code dir="ltr" translate="no">mobile-clients-policy</code> is applicable
to instances 1, 2, 3, and 4 in <code dir="ltr" translate="no">us-central</code> and to instances 5 and 6 in
<code dir="ltr" translate="no">us-east</code>.</p>
<h3 data-text="Creating the example" id="create-example-policies">Creating the example</h3>
<p>Use these instructions to create the example configuration discussed in the
previous section.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console"> Console </h3><p>Configure the security policy for external users:</p>
<ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>On the <strong>Policies</strong> page, click <strong>Create policy</strong>.</p></li>
<li><p>In the <strong>Name</strong> field, enter <code dir="ltr" translate="no">mobile-clients-policy</code>.</p></li>
<li><p>In the <strong>Description</strong> field, enter <code dir="ltr" translate="no">Policy for external users</code>.</p></li>
<li><p>For <strong>Default rule action</strong>, select <strong>Deny</strong>.</p></li>
<li><p>For <strong>Deny status</strong>, select <strong>404 (Not Found)</strong>.</p></li>
<li><p>Click <strong>Next step</strong>.</p></li>
</ol>
<p>Add more rules:</p>
<ol>
<li>Click <strong>Add rule</strong>.</li>
<li>In the <strong>Description</strong> field, enter <code dir="ltr" translate="no">allow traffic from 192.0.2.0/24</code>.</li>
<li>For <strong>Mode</strong>, select <strong>Basic mode (IP addresses/ranges only)</strong>.</li>
<li>In the <strong>Match</strong> field, enter <code dir="ltr" translate="no">192.0.2.0/24</code>.</li>
<li>For <strong>Action</strong>, select <strong>Allow</strong>.</li>
<li>In the <strong>Priority</strong> field, enter <code dir="ltr" translate="no">1000</code>.</li>
<li>Click <strong>Done</strong>.</li>
<li>Click <strong>Next step</strong>.</li>
</ol>
<p>Apply policy to targets:</p>
<ol>
<li>Click <strong>Add Target</strong>.</li>
<li>In the <strong>Target</strong> list, select a target.</li>
<li>Click <strong>Done</strong>.</li>
<li>Click <strong>Create policy</strong>.</li>
</ol>
<p>Optionally, enable Adaptive Protection:</p>
<ol>
<li>To enable Adaptive Protection, check the <strong>Enable</strong> check box.</li>
</ol>
<p>Configure the security policy for internal users:</p>
<ol>
<li>On the <strong>Policies</strong> page, click <strong>Create policy</strong>.</li>
<li>In the <strong>Name</strong> field, enter <code dir="ltr" translate="no">internal-users-policy</code>.</li>
<li>In the <strong>Description</strong> field, enter <code dir="ltr" translate="no">Policy for internal test users</code>.</li>
<li>For <strong>Default rule action</strong>, select <strong>Deny</strong>.</li>
<li>For <strong>Deny status</strong>, select <strong>502 (Bad Gateway)</strong>.</li>
<li>Click <strong>Next step</strong>.</li>
</ol>
<p>Add more rules:</p>
<ol>
<li>Click <strong>Add rule</strong>.</li>
<li>In the <strong>Description</strong> field, enter <code dir="ltr" translate="no">allow traffic from 198.51.100.0/24</code>.</li>
<li>For <strong>Mode</strong>, select <strong>Basic mode (IP addresses/ranges only)</strong>.</li>
<li>In the <strong>Match</strong> field, enter <code dir="ltr" translate="no">198.51.100.0/24</code>.</li>
<li>For <strong>Action</strong>, select <strong>Allow</strong>.</li>
<li>For <strong>Preview only</strong>, select the <strong>Enable</strong> checkbox.</li>
<li>In the <strong>Priority</strong> field, enter <code dir="ltr" translate="no">1000</code>.</li>
<li>Click <strong>Done</strong>.</li>
<li>Click <strong>Next step</strong>.</li>
</ol>
<p>Apply policy to targets:</p>
<ol>
<li>Click <strong>Add Target</strong>.</li>
<li>In the <strong>Target</strong> list, select a target.</li>
<li>Click <strong>Done</strong>.</li>
<li>Click <strong>Create policy</strong>.</li>
</ol></section>
<section><h3 data-text=" gcloud " id="gcloud"> gcloud </h3><ol>
<li><p>Create the Google Cloud Armor security policies:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies create mobile-clients-policy \
    --description "policy for external users"
</pre>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies create internal-users-policy \
    --description "policy for internal test users"
</pre></li>
<li><p>Update the default rules to the security policies to deny traffic:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules update 2147483647 \
    --security-policy mobile-clients-policy \
    --action "deny-404"
</pre>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules update 2147483647 \
    --security-policy internal-users-policy \
    --action "deny-502"
</pre></li>
<li><p>Add rules to the security policies:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy mobile-clients-policy \
    --description "allow traffic from 192.0.2.0/24" \
    --src-ip-ranges "192.0.2.0/24" \
    --action "allow"
</pre>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy internal-users-policy \
    --description "allow traffic from 198.51.100.0/24" \
    --src-ip-ranges "198.51.100.0/24" \
    --action "allow"
</pre></li>
<li><p>Attach the security policies to the backend services:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute backend-services update games \
    --security-policy mobile-clients-policy
</pre>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute backend-services update test-network \
    --security-policy internal-users-policy
</pre></li>
<li><p>Optionally, enable Adaptive Protection:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies update mobile-clients-policy \
   --enable-layer7-ddos-defense
</pre>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies update internal-users-policy \
   --enable-layer7-ddos-defense
</pre></li>
</ol></section>
</div>
<h2 data-text="Configuring security policies, rules, and expressions" id="creating-policy-rules">Configuring security policies, rules, and expressions</h2>
<p>You can configure Google Cloud Armor security policies, rules, and expressions
by using the Google Cloud console, the Google Cloud CLI, or the REST API. When you
use the gcloud CLI to create security policies, use the <code dir="ltr" translate="no">--type</code>
flag to specify whether the security policy is a backend security policy or an
edge security policy.</p>
<h3 data-text="Testing security policies" id="testing-policies">Testing security policies</h3>
<p>We recommend that you deploy all new rules in preview mode, then examine your
<a href="/armor/docs/request-logging">request logs</a>, to verify that the policies and
rules are behaving as expected.</p>
<h3 data-text="Sample expressions" id="sample-expressions">Sample expressions</h3>
<p>The following are sample expressions. For more information about expressions,
see the
<a href="/armor/docs/rules-language-reference">Google Cloud Armor custom rules language reference</a>.</p>
<p>If you are configuring a rule or expression that uses
<a class="external" href="https://www.wikipedia.org/wiki/ISO_3166-1_alpha-2" target="wiki">ISO 3166-1 alpha 2</a> 
country or region codes, Google Cloud Armor treats each code
independently. Google Cloud Armor rules and expressions explicitly
use those region codes to allow or deny requests.</p>
<ul>
<li><p>The following expression matches against requests from the IP
address <code dir="ltr" translate="no">1.2.3.4</code> and contains the string <code dir="ltr" translate="no">Godzilla</code> in the
user-agent header:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '1.2.3.4/32') &amp;&amp; has(request.headers['user-agent']) &amp;&amp; request.headers['user-agent'].contains('Godzilla')
</pre></li>
<li><p>The following expression matches against requests that have a
cookie with a specific value:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
has(request.headers['cookie']) &amp;&amp; request.headers['cookie'].contains('cookie_name=cookie_value')
</pre></li>
<li><p>The following expression matches against requests from the
region <code dir="ltr" translate="no">AU</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.region_code == 'AU'
</pre></li>
<li><p>The following expression matches against requests from the
region <code dir="ltr" translate="no">AU</code> that are not in the specified IP range:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.region_code == "AU" &amp;&amp; !inIpRange(origin.ip, '1.2.3.0/24')
</pre></li>
<li><p>The following expression matches against requests if the URI
matches a regular expression:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
request.path.matches('/bad_path/')
</pre></li>
<li><p>The following expression matches against requests if the Base64
decoded value of the <code dir="ltr" translate="no">user-id</code> header contains a specific value:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
has(request.headers['user-id']) &amp;&amp; request.headers['user-id'].base64Decode().contains('myValue')
</pre></li>
<li><p>The following expression uses a preconfigured expression set
match against SQLi attacks:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
evaluatePreconfiguredExpr('sqli-stable')
</pre></li>
</ul>
<h3 data-text="Using JSON parsing" id="enable-json-parsing">Using JSON parsing</h3>
<p>You can enable or disable parsing of the JSON body content of POST requests for
each security policy. When the <code dir="ltr" translate="no">Content-Type</code> header is set to
<code dir="ltr" translate="no">application/json</code>, use the <code dir="ltr" translate="no">--json-parsing</code> flag in the Google Cloud CLI.</p>
<p>By default, this option is disabled. The syntax for the flag is as follows:</p>
<p><code dir="ltr" translate="no">--json-parsing=[STANDARD | DISABLED]</code></p>
<p>The flag is available only with <code dir="ltr" translate="no">gcloud compute security-policies update</code>. You
cannot create a new security policy with this option unless you create a
security policy in a file and then import that file. For more information, see
<a href="#importing-policies">Importing security policies</a>.</p>
<p>For more information about JSON parsing, see
<a href="/armor/docs/security-policy-overview#json-parsing">JSON parsing and verbose logging</a>.</p>
<h3 data-text="Using verbose logging" id="enable-verbose-logging">Using verbose logging</h3>
<p>You can configure the Google Cloud Armor logging level to enable more detailed
logging for each security policy by using the <code dir="ltr" translate="no">--log-level</code> flag in the
gcloud CLI.</p>
<p>By default, this option is disabled. The syntax for the flag is as follows:</p>
<p><code dir="ltr" translate="no">--log-level=[NORMAL | VERBOSE]</code></p>
<p>The flag is available only with <code dir="ltr" translate="no">gcloud compute security-policies update</code>. You
cannot create a new security policy with this option unless you create a
security policy in a file and then import that file. For more information, see
<a href="#importing-policies">Importing security policies</a>.</p>
<p>For more information about verbose logging, see <a href="/armor/docs/security-policy-overview#json-parsing">JSON parsing and verbose logging</a>.</p>
<h3 data-text="Configuring rules for rate limiting" id="rate-limiting">Configuring rules for rate limiting</h3>
<p>This section contains information about configuring Google Cloud Armor rules
to enforce per-client rate limits by configuring a throttle or rate-based ban
action.</p>
<h4 data-text="Rules for rate-based throttling" id="rate-limiting-throttling">Rules for rate-based throttling</h4>
<p>Rules for rate-based throttling have the following format in the
gcloud CLI:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create <var translate="no">PRIORITY</var>
   --security-policy=<var translate="no">SECURITY_POLICY</var>
   (--expression=<var translate="no">EXPRESSION</var> | --src-ip-ranges=<var translate="no">SRC_IP_RANGE</var>)
   --action "throttle"
   --rate-limit-threshold-count=<var translate="no">RATE_LIMIT_THRESHOLD_COUNT</var>
   --rate-limit-threshold-interval-sec=<var translate="no">RATE_LIMIT_THRESHOLD_INTERVAL_SEC</var>
   --conform-action=[allow]
   --exceed-action=[deny-403|deny-404|deny-429|deny-502|redirect]
   --exceed-redirect-type=[google-recaptcha|external-302]
   --exceed-redirect-target=<var translate="no">REDIRECT_URL</var>
   --enforce-on-key=[IP | ALL | HTTP-HEADER | XFF-IP | HTTP-COOKIE]
   --enforce-on-key-name=[<var translate="no">HTTP_HEADER_NAME</var>|<var translate="no">HTTP_COOKIE_NAME</var>]
</pre>
<p>For example, the following <code dir="ltr" translate="no">gcloud</code> command creates a <code dir="ltr" translate="no">throttle</code> rule at
priority <code dir="ltr" translate="no">105</code> with a rate limit of 100 requests each 60 seconds for each IP
address in <code dir="ltr" translate="no">1.2.3.0/24</code>. Requests that exceed the throttling limit return a
<code dir="ltr" translate="no">429</code> error code.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 105 \
    --security-policy sec-policy     \
    --src-ip-ranges="1.2.3.0/24"     \
    --action=throttle                \
    --rate-limit-threshold-count=100 \
    --rate-limit-threshold-interval-sec=60 \
    --conform-action=allow           \
    --exceed-action=deny-429         \
    --enforce-on-key=IP
</pre>
<p>For example, the following <code dir="ltr" translate="no">gcloud</code> command creates a <code dir="ltr" translate="no">throttle</code> rule at
priority <code dir="ltr" translate="no">110</code> with a rate limit of 10 requests each 60 seconds for each unique
value of the HTTP header <code dir="ltr" translate="no">User-Agent</code> across all requests coming from IP
addresses in <code dir="ltr" translate="no">1.2.3.0/24</code>. Requests that exceed the throttling limit return a
<code dir="ltr" translate="no">429</code> error code.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 110 \
    --security-policy sec-policy     \
    --src-ip-ranges="1.2.3.0/24"     \
    --action=throttle                \
    --rate-limit-threshold-count=10 \
    --rate-limit-threshold-interval-sec=60 \
    --conform-action=allow           \
    --exceed-action=deny-429         \
    --enforce-on-key=HTTP-HEADER \
    --enforce-on-key-name='User-Agent'
</pre>
<p>You can also issue rate-based bans for users who have a valid reCAPTCHA
exemption cookie. For example, the following <code dir="ltr" translate="no">gcloud</code> command creates a
<code dir="ltr" translate="no">throttle</code> rule at priority <code dir="ltr" translate="no">115</code> with a rate limit of 20 requests per 5 minutes
for each unique reCAPTCHA exemption cookie across all requests that have a
valid reCAPTCHA exemption cookie. Requests that exceed the throttling limit are
redirected for reCAPTCHA Enterprise assessment. For more information about
exemption cookies and reCAPTCHA Enterprise assessment, see the
<a href="/armor/docs/bot-management">bot management overview</a>.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 115 \
    --security-policy sec-policy     \
    --expression="token.recaptcha_exemption.valid"     \
    --action=throttle                \
    --rate-limit-threshold-count=20 \
    --rate-limit-threshold-interval-sec=300 \
    --conform-action=allow           \
    --exceed-action=redirect         \
    --exceed-redirect-type=google-recaptcha         \
    --enforce-on-key=HTTP-COOKIE         \
    --enforce-on-key-name="recaptcha-ca-e"
</pre>
<h4 data-text="Rules for rate-based bans" id="rate-limiting-bans">Rules for rate-based bans</h4>
<p>Rules for rate-based bans have the following format in the gcloud CLI:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create <var translate="no">PRIORITY</var> \
     --security-policy=<var translate="no">SECURITY_POLICY</var> \
     (--expression=<var translate="no">EXPRESSION</var> | --src-ip-ranges=<var translate="no">SRC_IP_RANGE</var>) \
     --action "rate-based-ban" \
     --rate-limit-threshold-count=<var translate="no">RATE_LIMIT_THRESHOLD_COUNT</var> \
     --rate-limit-threshold-interval-sec=<var translate="no">RATE_LIMIT_THRESHOLD_INTERVAL_SEC</var> \
     --ban-duration-sec=<var translate="no">BAN_DURATION_SEC</var> \
     --ban-threshold-count=<var translate="no">BAN_THRESHOLD_COUNT</var> \
     --ban-threshold-interval-sec=<var translate="no">BAN_THRESHOLD_INTERVAL_SEC</var> \
     --conform-action=[allow] \
     --exceed-action=[deny-403|deny-404|deny-429|deny-502|redirect]
     --exceed-redirect-type=[google-recaptcha|external-302]
     --exceed-redirect-target=<var translate="no">REDIRECT_URL</var>
     --enforce-on-key=[IP | ALL | HTTP-HEADER | XFF-IP | HTTP-COOKIE]
     --enforce-on-key-name=[<var translate="no">HTTP_HEADER_NAME</var>|<var translate="no">HTTP_COOKIE_NAME</var>]
</pre>
<p>For example, the following <code dir="ltr" translate="no">gcloud</code> command creates a rate-based ban rule at
priority 100 for each IP address whose requests match a header <code dir="ltr" translate="no">fish</code> with value
<code dir="ltr" translate="no">tuna</code> and ban it for 300 seconds when its rate exceeds a limit of 50 requests
for each 120 seconds. Banned requests return an error code of <code dir="ltr" translate="no">404</code>.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 100 \
    --security-policy=sec-policy     \
    --expression="request.headers['fish'] == 'tuna'" \
    --action=rate-based-ban                   \
    --rate-limit-threshold-count=50           \
    --rate-limit-threshold-interval-sec=120   \
    --ban-duration-sec=300           \
    --conform-action=allow           \
    --exceed-action=deny-404         \
    --enforce-on-key=IP
</pre>
<p>For example, the following <code dir="ltr" translate="no">gcloud</code> command creates a rate-based ban rule at
priority 101 to limit all requests whose region code matches <code dir="ltr" translate="no">US</code> to 10 requests
per 60 seconds. The rule also bans requests from the <code dir="ltr" translate="no">US</code> region for 300 seconds
when their rate exceeds a limit of 1000 requests per 600 seconds. Banned
requests return an error code of <code dir="ltr" translate="no">403</code>.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
 gcloud compute security-policies rules create 101 \
    --security-policy sec-policy     \
    --expression "origin.region_code == 'US'" \
    --action rate-based-ban                 \
    --rate-limit-threshold-count 10         \
    --rate-limit-threshold-interval-sec 60  \
    --ban-duration-sec 300           \
    --ban-threshold-count 1000       \
    --ban-threshold-interval-sec 600 \
    --conform-action allow           \
    --exceed-action deny-403         \
    --enforce-on-key ALL
</pre>
<p>For example, the following <code dir="ltr" translate="no">gcloud</code> command creates a rate-based ban rule at
priority 102 to limit all requests from any source IP address range to 20 requests per
60 seconds. The rule also bans requests from any source IP address range for 600 seconds
when their rate exceeds a limit of 500 requests per 400 seconds. Banned requests
return an error code of <code dir="ltr" translate="no">429</code>.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
 gcloud compute security-policies rules create 102 \
    --security-policy sec-policy     \
    --src-ip-ranges="*" \
    --action rate-based-ban                 \
    --rate-limit-threshold-count 20         \
    --rate-limit-threshold-interval-sec 60  \
    --ban-duration-sec 600           \
    --ban-threshold-count 500       \
    --ban-threshold-interval-sec 400 \
    --conform-action allow           \
    --exceed-action deny-429         \
    --enforce-on-key ALL
</pre>
<h3 data-text="Using the Cloud console and the gcloud CLI to create security policies" id="use-console-gcloud">Using the Cloud console and the gcloud CLI to create security policies</h3>
<p>The instructions in this section assume that you are configuring security
policies to apply to an existing external HTTP(S) load balancer and backend service. For an
example of how to complete the fields, see
<a href="#create-example-policies">Creating the example</a>.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console_1"> Console </h3><p>Create Google Cloud Armor security policies and rules and attach
a security policy to a backend service:</p>
<ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>On the <strong>Policies</strong> page, click <strong>Create policy</strong>.</p></li>
<li><p>In the <strong>Name</strong> field, enter the name of your policy.</p></li>
<li><p>Optional: Enter a description of the policy.</p></li>
<li><p>For <strong>Policy type</strong> choose <strong>Backend security policy</strong> or <strong>Edge security
policy</strong>.</p></li>
<li><p>For <strong>Default rule action</strong>, select <strong>Allow</strong> for a default rule that
permits access, or select <strong>Deny</strong> for a default rule that forbids access
to an IP address or IP address range.</p>
<p>The default rule is the lowest priority rule that takes effect only
if no other rule applies.</p></li>
<li><p>If you are configuring a <strong>Deny</strong> rule, select a <strong>Deny status</strong> message.
This is the error message that Google Cloud Armor displays if a user
without access tries to gain access.</p></li>
<li><p>Regardless of the type of rule that you are configuring, click <strong>Next step</strong>.</p></li>
</ol>
<p>Add more rules:</p>
<ol>
<li>Click <strong>Add rule</strong>.</li>
<li>Optional: Enter a description for the rule.</li>
<li><p>Select the mode:</p>
<ul>
<li><strong>Basic mode</strong>: allow or deny traffic based on IP addresses or
IP ranges.</li>
<li><strong>Advanced mode</strong>: allow or deny traffic based on rule
expressions.</li>
</ul></li>
<li><p>In the <strong>Match</strong> field, specify the conditions under which the rule
applies:</p>
<ul>
<li><strong>Basic mode</strong>: enter IP addresses or IP ranges to match in the rule.</li>
<li><strong>Advanced mode</strong>: enter an expression or subexpressions to
evaluate against incoming requests. For information about how to
write the expressions, see the
<a href="/armor/docs/rules-language-reference">custom rules language reference</a>.</li>
</ul></li>
<li><p>For <strong>Action</strong>, select <strong>Allow</strong> or <strong>Deny</strong> to allow or deny traffic
if the rule matches.</p></li>
<li><p>To enable preview mode, select the <strong>Enable</strong> checkbox. In preview mode,
you can see how the rule behaves, but the rule is not enabled.</p></li>
<li><p>Enter the rule's <strong>Priority</strong>. This can be any positive integer from 0 to
2,147,483,646 inclusive. For more information about the evaluation order,
see <a href="/armor/docs/security-policy-overview#eval-order">Rule evaluation order</a>.</p></li>
<li><p>Click <strong>Done</strong>.</p></li>
<li><p>To add more rules, click <strong>Add rule</strong> and repeat the previous steps.
Otherwise, click <strong>Next step</strong>.</p></li>
</ol>
<p>Apply policy to targets:</p>
<ol>
<li>Click <strong>Add Target</strong>.</li>
<li>In the <strong>Target</strong> list, select a target.</li>
<li>To add more targets, click <strong>Add Target</strong>.</li>
<li>Click <strong>Done</strong>.</li>
<li>Click <strong>Create policy</strong>.</li>
</ol></section>
<section><h3 data-text=" gcloud " id="gcloud_1"> gcloud </h3><ol>
<li><p>To create a new Google Cloud Armor security policy, use the command
<code dir="ltr" translate="no">gcloud compute security-policies create</code>. Replace
<code dir="ltr" translate="no"><var translate="no">NAME</var></code> and <code dir="ltr" translate="no"><var translate="no">DESCRIPTION</var></code> with the name
and description of the security policy. In the <code dir="ltr" translate="no">type</code> field, use
<code dir="ltr" translate="no">CLOUD_ARMOR</code> to create a backend security policy or <code dir="ltr" translate="no">CLOUD_ARMOR_EDGE</code>
to create an edge security policy. The <code dir="ltr" translate="no">type</code> flag is not a required
flag; if no type is specified, a backend security policy is created by
default:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies create <var translate="no">NAME</var> \
   [--type=CLOUD_ARMOR|CLOUD_ARMOR_EDGE] \
   [--file-format=<var translate="no">FILE_FORMAT</var> | --description=<var translate="no">DESCRIPTION</var>] \
   [--file-name=<var translate="no">FILE_NAME</var>]

</pre>
<p>The following command updates a policy that you previously created,
turns JSON parsing on, and changes the log level to <code dir="ltr" translate="no">VERBOSE</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies update my-policy \
    --json-parsing=STANDARD
    --log-level=VERBOSE
</pre></li>
<li><p>To add rules to a security policy, use the command <code dir="ltr" translate="no">gcloud
compute security-policies rules create <var translate="no">PRIORITY</var></code>. Replace
<code dir="ltr" translate="no"><var translate="no">PRIORITY</var></code> with the priority assigned to the rule
in the policy. For information about how rule priority works, see
<a href="/armor/docs/security-policy-overview#eval-order">Rule evaluation order</a>.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create <var translate="no">PRIORITY</var>  \
   [--security-policy <var translate="no">POLICY_NAME</var>] \
   [--description <var translate="no">DESCRIPTION</var>] \
    --src-ip-ranges <var translate="no">IP_RANGE,...</var> | --expression <var translate="no">EXPRESSION</var> \
    --action=[ allow | deny-403 | deny-404 | deny-502 ]  \
   [--preview]
</pre>
<p>For example, the following command adds a rule to block traffic from
IP address ranges 192.0.2.0/24 and 198.51.100.0/24. The rule has
priority 1000, and it is a rule in a policy called <code dir="ltr" translate="no">my-policy</code>.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --description "block traffic from 192.0.2.0/24 and 198.51.100.0/24" \
    --src-ip-ranges "192.0.2.0/24","198.51.100.0/24" \
    --action "deny-403"
</pre>
<p>With the <code dir="ltr" translate="no">--preview</code> flag added, the rule is added to the policy, but not
enforced, and any traffic that triggers the rule is only logged.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --description "block traffic from 192.0.2.0/24 and 198.51.100.0/24" \
    --src-ip-ranges "192.0.2.0/24","198.51.100.0/24" \
    --action "deny-403" \
    --preview
</pre>
<p>Use the <code dir="ltr" translate="no">--expression</code> flag to specify a custom condition in the
<a href="/armor/docs/rules-language-reference">custom rules language reference</a>.
The following command adds a rule to allow traffic from the IP address
<code dir="ltr" translate="no">1.2.3.4</code> and contains the string <code dir="ltr" translate="no">Godzilla</code> in the user-agent header:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud beta compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "inIpRange(origin.ip, '1.2.3.4/32') &amp;&amp; has(request.headers['user-agent']) &amp;&amp; request.headers['user-agent'].contains('Godzilla')" \
    --action allow \
    --description "Block User-Agent 'Godzilla'"
</pre>
<p>The following command adds a rule to block requests if the request's
cookie contains a specific value:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "has(request.headers['cookie']) &amp;&amp; request.headers['cookie'].contains('cookie_name=cookie_value')" \
    --action "deny-403" \
    --description "Cookie Block"
</pre>
<p>The following command adds a rule to block requests from the region
<code dir="ltr" translate="no">AU</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "origin.region_code == 'AU'" \
    --action "deny-403" \
    --description "AU block"
</pre>
<p>The following command adds a rule to block requests from the region <code dir="ltr" translate="no">AU</code>
that are not in the specified IP range:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "origin.region_code == 'AU' &amp;&amp; !inIpRange(origin.ip, '1.2.3.0/24')" \
    --action "deny-403" \
    --description "country and IP block"
</pre>
<p>The following command adds a rule to block requests with a URI that
matches a regular expression:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "request.path.matches('/bad_path/)')" \
    --action "deny-403" \
    --description "regex block"
</pre>
<p>The following command adds a rule to block requests if the Base64
decoded value of the <code dir="ltr" translate="no">user-id</code> header contains a specific value:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "has(request.headers['user-id']) &amp;&amp; request.headers['user-id'].base64Decode().contains('myValue')" \
    --action "deny-403" \
    --description "country and IP block"
</pre>
<p>The following command adds a rule that uses a preconfigured expression
set to mitigate SQLi attacks:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "evaluatePreconfiguredExpr('sqli-stable')" \
    --action "deny-403"
</pre>
<p>The following command adds a rule that uses a preconfigured expression
to allow access from all IP addresses on a named IP address list:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "evaluatePreconfiguredExpr('sourceiplist-fastly')" \
    --action "allow"
</pre></li>
</ol></section>
</div>
<h2 data-text="Configuring rules for bot management" id="bot-management">Configuring rules for bot management</h2>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
<p>This section contains information about configuring Google Cloud Armor
security policy rules for bot management. For more information, see the
<a href="/armor/docs/bot-management">bot management overview</a>.</p>
<h3 data-text="Use a reCAPTCHA Enterprise manual challenge to distinguish between human or automated clients" id="use_a_manual_challenge_to_distinguish_between_human_or_automated_clients">Use a reCAPTCHA Enterprise manual challenge to distinguish between human or automated clients</h3>
<p>To associate or disassociate your own reCAPTCHA WAF site key with a security policy,
use the following command, replacing the security policy name
(<var translate="no">SECURITY_POLICY</var>) and reCAPTCHA WAF challenge site key
(<var translate="no">SITE_KEY</var>) as appropriate.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies update <var translate="no">SECURITY_POLICY</var> \
   --recaptcha-redirect-site-key <var translate="no">SITE_KEY</var>
</pre>
<p>The following example associates a reCAPTCHA WAF site key with a
security policy. The associated site key applies to all the rules using the
manual challenge feature under the given security policy.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies update my-policy \
   --recaptcha-redirect-site-key "<var translate="no">SITE_KEY</var>"
</pre>
<p>You can also disassociate a reCAPTCHA WAF site key with a security policy as
follows:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies update my-policy \
   --recaptcha-redirect-site-key ""
</pre>
<p>To create a rule to internally redirect traffic for reCAPTCHA Enterprise
assessment, use the following format in <code dir="ltr" translate="no">gcloud</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create <var translate="no">PRIORITY</var> \
   --security-policy <var translate="no">SECURITY_POLICY</var> \
   (--expression <var translate="no">EXPRESSION</var> | --src-ip-ranges <var translate="no">SRC_IP_RANGE</var>) \
   --action redirect \
   --redirect-type google-recaptcha
</pre>
<p>The following example creates a rule that redirects traffic attempting to reach
<code dir="ltr" translate="no">/login.html</code> for reCAPTCHA Enterprise manual challenge.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
   --security-policy my-policy \
   --expression "request.path.matches(\"/login.html\")" \
   --action redirect \
   --redirect-type google-recaptcha
</pre>
<h3 data-text="Enforce reCAPTCHA Enterprise frictionless assessment" id="enforce-assessment">Enforce reCAPTCHA Enterprise frictionless assessment</h3>
<p>Before you proceed, see the
<a href="/armor/docs/bot-management#recaptcha-tokens">bot management overview</a>
for prerequisites on using reCAPTCHA Enterprise action-tokens or
session-tokens.</p>
<p>You can use <code dir="ltr" translate="no">token.recaptcha_action.<var translate="no">ATTRIBUTE</var></code>
(replacing <var translate="no">ATTRIBUTE</var> with a valid token
attribute in the Google Cloud Armor
<a href="/armor/docs/rules-language-reference#attributes">rules language</a>) to extract
attributes from a reCAPTCHA Enterprise action-token. Similarly, you can use
<code dir="ltr" translate="no">token.recaptcha_session.<var translate="no">ATTRIBUTE</var></code> for a
reCAPTCHA Enterprise session-token. For more information on the syntax of
available reCAPTCHA Enterprise token attributes, see the
<a href="/armor/docs/rules-language-reference#attributes">rules language reference</a>.</p>
<p>The following example creates a rule that allows traffic targeting for
<code dir="ltr" translate="no">/login.html</code> and with a reCAPTCHA Enterprise action-token whose score is
no less than <code dir="ltr" translate="no">0.8</code>.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
   --security-policy my-policy \
   --expression "request.path.matches(\"/login.html\") &amp;&amp; token.recaptcha_action.score &gt;= 0.8" \
   --action allow
</pre>
<h3 data-text="Redirect (302 response)" id="redirect_302_response">Redirect (302 response)</h3>
<p>To create a rule to redirect traffic to a user-configured URL, use the
following format in <code dir="ltr" translate="no">gcloud</code>.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create <var translate="no">PRIORITY</var> \
   --security-policy <var translate="no">SECURITY_POLICY</var> \
   (--expression <var translate="no">EXPRESSION</var> | --src-ip-ranges <var translate="no">SRC_IP_RANGE</var>) \
   --action redirect \
   --redirect-type external-302 \
   --redirect-target <var translate="no">REDIRECT_URL</var>
</pre>
<p>The following example creates a rule that redirects traffic coming from
10.10.10.0/24 to https://www.example.com.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
   --security-policy my-policy \
   --src-ip-ranges "10.10.10.0/24" \
   --action redirect \
   --redirect-type external-302 \
   --redirect-target "https://www.example.com"
</pre>
<h3 data-text="Decorate request" id="decorate_request">Decorate request</h3>
<p>To create a rule that allows traffic but adds custom headers and user-defined
static values before proxying them to protected backends, use the following
format in <code dir="ltr" translate="no">gcloud</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create <var translate="no">PRIORITY</var> \
   --security-policy <var translate="no">SECURITY_POLICY</var> \
   (--expression <var translate="no">EXPRESSION</var> | --src-ip-ranges <var translate="no">SRC_IP_RANGE</var>) \
   --action allow \
   --request-headers-to-add <var translate="no">HEADER_1</var>=<var translate="no">VALUE_1</var>,<var translate="no">HEADER_2</var>=<var translate="no">VALUE_2,...</var>
</pre>
<p>The following example creates a rule that allows but adds a custom header for
traffic targeting for <code dir="ltr" translate="no">/login.html</code> and with a reCAPTCHA Enterprise
action-token score lower than <code dir="ltr" translate="no">0.2</code>.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
   --security-policy my-policy \
   --expression "request.path.matches("/login.html") &amp;&amp; token.recaptcha_action.score &lt; 0.2" \
   --action allow \
   --request-headers-to-add "reCAPTCHA-Warning=high"
</pre>
<h2 data-text="Using Adaptive Protection" id="using">Using Adaptive Protection</h2>
<p>Adaptive Protection is applied on a per-security-policy basis.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console_2"> Console </h3><p>To activate Adaptive Protection for a security policy:</p>
<ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>On the <strong>Policies</strong> page, click the name of a security policy.</p></li>
<li><p>Click <strong>Edit</strong>.</p></li>
<li><p>Under <strong>Adaptive Protection</strong>, select <strong>Enable</strong>.</p></li>
<li><p>Click <strong>Update</strong>.</p></li>
</ol>
<p>To deactivate Adaptive Protection for a security policy:</p>
<ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>On the <strong>Policies</strong> page, click the name of a security policy.</p></li>
<li><p>Click <strong>Edit</strong>.</p></li>
<li><p>Under <strong>Adaptive Protection</strong>, deselect <strong>Enable</strong>.</p></li>
<li><p>Click <strong>Update</strong>.</p></li>
</ol></section>
<section><h3 data-text=" gcloud " id="gcloud_2"> gcloud </h3><p>To activate Adaptive Protection for a security policy:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies update <var translate="no">MY-SECURITY-POLICY</var> \
   --enable-layer7-ddos-defense
</pre>
<p>To deactivate Adaptive Protection for a security policy:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies update <var translate="no">MY-SECURITY-POLICY</var> \
   --no-enable-layer7-ddos-defense
</pre></section>
</div>
<h2 data-text="Listing available preconfigured rules" id="list-preconfig-rules">Listing available preconfigured rules</h2>
<p>List preconfigured rules to view the predefined application protection rules
and signatures such as the
<a class="external" href="https://modsecurity.org/crs/" target="github">ModSecurity Core Rule Set</a> 
that Google Cloud Armor provides. These preconfigured rules contain multiple
built-in signatures that Google Cloud Armor uses to evaluate against
incoming requests. You add these preconfigured rules to new or existing rules by
using the <a href="/armor/docs/rules-language-reference">custom rules language reference</a>.</p>
<p>For more information, see <a href="/armor/docs/rules-language-reference#preconfigured-rules">preconfigured rules</a>.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" gcloud " id="gcloud_3"> gcloud </h3><ol>
<li><p>Run the
<code dir="ltr" translate="no">gcloud compute security-policies list-preconfigured-expression-sets</code> command:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies list-preconfigured-expression-sets
</pre>
<p>The follow example shows the form of the output from the command:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
EXPRESSION_SET
expression-set-1
   RULE_ID
   expression-set-1-id-1
   expression-set-1-id-2
expression-set-2
   alias-1
   RULE_ID
   expression-set-2-id-1
   expression-set-2-id-2
</pre>
<p>The follow example includes a sample of the actual output from the
command. Note that the actual output would include all of the rules
that are listed in
<a href="/armor/docs/rule-tuning">Tuning Google Cloud Armor WAF rules</a>.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies list-preconfigured-expression-sets
</pre>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
EXPRESSION_SET
sqli-canary
    RULE_ID
    owasp-crs-v030001-id942110-sqli
    owasp-crs-v030001-id942120-sqli
    …
xss-canary
    RULE_ID
    owasp-crs-v030001-id941110-xss
    owasp-crs-v030001-id941120-xss
…
sourceiplist-fastly
sourceiplist-cloudflare
sourceiplist-imperva
</pre></li>
</ol></section>
</div>
<h2 data-text="Listing security policies" id="list-policies">Listing security policies</h2>
<p>Use these instructions to list all Google Cloud Armor security policies in
the current project or in a project that you specify.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console_3"> Console </h3><ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>To view a particular policy, on the <strong>Security policies</strong> page, in the
list of policies, click its name.</p></li>
</ol></section>
<section><h3 data-text=" gcloud " id="gcloud_4"> gcloud </h3><pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies list
</pre>
<p>For example:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies list
</pre>
<pre dir="ltr" translate="no">
NAME
my-policy
</pre>
<p>For more information, see
<a href="/sdk/gcloud/reference/compute/security-policies/list"><code dir="ltr" translate="no">gcloud compute security-policies list</code></a>.</p></section>
</div>
<h2 data-text="Updating security policies" id="update-policies">Updating security policies</h2>
<p>Use these instructions to update a Google Cloud Armor security policy.
For example, you can modify the policy's description, modify the default
rule's behavior, change the target backend service, or add new rules.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console_4"> Console </h3><ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>To update a particular policy, on the <strong>Security policies</strong> page, in the
list of policies, click
<span aria-hidden="true" class="material-icons" translate="no">more_vert</span><strong>Menu</strong>
for the policy that you want to update.</p>
<ul>
<li>To update the policy description of the default rule action, select
<strong>Edit</strong>, make the desired changes, and then click <strong>Update</strong>.</li>
<li>To add a rule, select <strong>Add rule</strong>, and then follow the
instructions in
<a href="#create-rules">Adding rules to a security policy</a>.</li>
<li>To change the target backend service for the policy, select
<strong>Apply policy to target</strong>, click <strong>Add Target</strong>, select a target,
and then click <strong>Add</strong>.</li>
</ul></li>
</ol></section>
<section><h3 data-text=" gcloud " id="gcloud_5"> gcloud </h3><p>To update a security policy, use the following Google Cloud CLI
instructions:</p>
<ul>
<li>To update a rule in a security policy, see
<a href="#update-rules">Updating a single rule in a security policy</a>.</li>
<li>To add a rule to a security policy, see
<a href="#create-rules">Adding rules to a security policy</a>.</li>
<li>To delete a rule from a security policy, see
<a href="#delete-rules">Deleting rules from a security policy</a>.</li>
<li>To update multiple rules in a single update (atomic update), see
<a href="#atomic-update">Atomically updating multiple rules in a security policy</a>.</li>
<li>To update non-rule fields in a security policy (such as the description
field), see <a href="#export-policies">Exporting security policies</a> and
<a href="#importing-policies">Importing security policies</a>.</li>
</ul></section>
</div>
<h2 data-text="Exporting security policies" id="export-policies">Exporting security policies</h2>
<p>You can export a Google Cloud Armor security policy as a YAML or JSON file
by using the Google Cloud CLI. Exporting a policy enables you to
retrieve a copy of it that you can modify or save in source control.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" gcloud " id="gcloud_6"> gcloud </h3><ol>
<li><p>In the following command, <code dir="ltr" translate="no"><var translate="no">NAME</var></code> is the name of the
security policy. Valid file formats are YAML and JSON. If you do not
provide the file format, Google Cloud Armor uses the default YAML.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies export <var translate="no">NAME</var> \
    --file-name <var translate="no">FILE_NAME</var>  \
    --file-format <var translate="no">FILE_FORMAT</var>
</pre>
<p>The following example exports the <code dir="ltr" translate="no">my-policy</code> security policy to the
<code dir="ltr" translate="no">my-file</code> file in the YAML format:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies export my-policy \
    --file-name my-file \
    --file-format yaml
 </pre>
<p>The following example shows an exported security policy:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
description: my description
fingerprint: PWfLGDWQDLY=
id: '123'
name: my-policy
rules:
- action: allow
  description: default rule
  match:
      config:
        srcIpRanges:
        - '*'
      versionedExpr: SRC_IPS_V1
    preview: false
    priority: 2147483647
  selfLink: https://www.googleapis.com/compute/v1/projects/my-project/global/securityPolicies/my-policy
  </pre></li>
<li><p>You can modify the exported file with any text editor, and then
<a href="#importing-policies">import</a> it back to Google Cloud by using the
<code dir="ltr" translate="no">import</code> command.</p></li>
</ol></section>
</div>
<h2 data-text="Importing security policies" id="importing-policies">Importing security policies</h2>
<p>You can import Google Cloud Armor security policies from a YAML or JSON file
by using the Google Cloud CLI. You can't use the <code dir="ltr" translate="no">import</code> command to update an
existing policy's rules. Instead, you must update rules one-by-one by using the
<a href="#update-rules">Updating a single rule in a security policy</a> procedure, or all
at once by using the
<a href="#atomic-update">Atomically updating multiple rules in a security policy</a> procedure.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" gcloud " id="gcloud_7"> gcloud </h3><p>To import security policies, use the
<code dir="ltr" translate="no">gcloud compute security-policies import <var translate="no">NAME</var></code> command.
Replace <code dir="ltr" translate="no"><var translate="no">NAME</var></code> with the name of the security policy that
you are importing. If you do not provide the file format, the correct format
is assumed based on the file structure. If the structure is invalid, you
see an error.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies import <var translate="no">NAME</var> \
    --file-name <var translate="no">FILE_NAME</var>  \
   [--file-format <var translate="no">FILE_FORMAT</var>]
</pre>
<p>For example, the following command updates the policy <code dir="ltr" translate="no">my-policy</code> by
importing the file <code dir="ltr" translate="no">my-file</code>.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies import my-policy \
    --file-name my-file \
    --file-format json
</pre>
<p>If the policy's
<a href="/armor/docs/security-policy-overview#fingerprint">fingerprint</a> is out of
date when you import it, Google Cloud Armor shows an error. This means
that the policy has been modified since you last exported it. To fix this,
use the <code dir="ltr" translate="no">describe</code> command on the policy to get the latest fingerprint.
Merge any differences between the described policy and your policy, and
then replace the outdated fingerprint with the latest one.</p></section>
</div>
<h2 data-text="Deleting security policies" id="delete-policies">Deleting security policies</h2>
<p>Use these instructions to delete a Google Cloud Armor security policy. You
must <a href="#remove-policies">remove</a> all backend services from the policy before you
can delete it.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console_5"> Console </h3><ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>On the <strong>Security policies</strong> page, next to the name of the
security policy that you want to delete, select the checkbox.</p></li>
<li><p>In the upper-right corner of the page, click
<span aria-hidden="true" class="material-icons" translate="no">delete</span><strong>Delete</strong>.</p></li>
</ol></section>
<section><h3 data-text=" gcloud " id="gcloud_8"> gcloud </h3><p>Use <code dir="ltr" translate="no">gcloud compute security-policies delete <var translate="no">NAME</var></code>.
Replace <code dir="ltr" translate="no"><var translate="no">NAME</var></code> with the name of the security policy:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies delete <var translate="no">NAME</var>
</pre></section>
</div>
<h2 data-text="Attaching a security policy to a backend service" id="attach-policies">Attaching a security policy to a backend service</h2>
<p>Use these instructions to attach a Google Cloud Armor security policy to a
backend service. A security policy can be attached to more than one backend
service, but a backend service can have only one of each type of security policy
attached to it.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console_6"> Console </h3><ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>On the <strong>Security policies</strong> page, click the name of the
security policy. The <strong>Policy details</strong> page is displayed.</p></li>
<li><p>In the middle of the page, click the <strong>Targets</strong> tab.</p></li>
<li><p>Click <strong>Apply policy to new target</strong>.</p></li>
<li><p>Click <strong>Add Target</strong>.</p></li>
<li><p>In the <strong>Target</strong> list, select a target, and then click <strong>Add</strong>.</p></li>
</ol></section>
<section><h3 data-text=" gcloud " id="gcloud_9"> gcloud </h3><p>When you attach a backend security policy to a backend service, use the
<code dir="ltr" translate="no">gcloud compute backend-services</code> command and the <code dir="ltr" translate="no">--security-policy</code> flag:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute backend-services update my-backend \
    --security-policy my-policy
</pre>
<p>When you attach an edge security policy to a backend service, use the
<code dir="ltr" translate="no">gcloud compute backend-services</code> command and the
<code dir="ltr" translate="no">--edge-security-policy</code> flag:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute backend-services update my-backend \
    --edge-security-policy my-policy
</pre></section>
</div>
<h2 data-text="Removing a security policy from a backend service" id="remove-policies">Removing a security policy from a backend service</h2>
<p>Use these instructions to remove a Google Cloud Armor backend security policy
or edge security policy from a backend service. To remove edge security policies,
use the Google Cloud CLI.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console_7"> Console </h3><ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>On the <strong>Security policies</strong> page, click the name of the
security policy. The <strong>Policy details</strong> page is displayed.</p></li>
<li><p>In the middle of the page, click the <strong>Targets</strong> tab.</p></li>
<li><p>Select the target backend service from which you are removing the policy.</p></li>
<li><p>Click <strong>Remove</strong>.</p></li>
<li><p>In the <strong>Remove target</strong> message, click <strong>Remove</strong>.</p></li>
</ol></section>
<section><h3 data-text=" gcloud " id="gcloud_10"> gcloud </h3><p>When you remove a backend security policy, use the <code dir="ltr" translate="no">gcloud compute
backend-services</code> command and the <code dir="ltr" translate="no">--security-policy</code> flag:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute backend-services update my-backend \
    --security-policy ""
</pre>
<p>When you remove an edge security policy, use the <code dir="ltr" translate="no">gcloud compute
backend-services</code> command and the <code dir="ltr" translate="no">--edge-security-policy</code> flag:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute backend-services update my-backend \
    --edge-security-policy ""
</pre></section>
</div>
<h2 data-text="Adding rules to a security policy" id="create-rules">Adding rules to a security policy</h2>
<p>Use these instructions to add rules to a Google Cloud Armor security policy.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console_8"> Console </h3><ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>On the <strong>Security policies</strong> page, click the name of the
security policy. The <strong>Policy details</strong> page is displayed.</p></li>
<li><p>In the middle of the page, click the <strong>Rules</strong> tab.</p></li>
<li><p>Click <strong>Add rule</strong>.</p></li>
<li><p>Optional: Enter a description of the rule.</p></li>
<li><p>Select the mode:</p>
<ul>
<li><strong>Basic mode</strong>: allow or deny traffic based on IP addresses or
IP ranges.</li>
<li><strong>Advanced mode</strong>: allow or deny traffic based on rule
expressions.</li>
</ul></li>
<li><p>In the <strong>Match</strong> field, specify the conditions under which the rule
applies:</p>
<ul>
<li><strong>Basic mode</strong>: enter from one (1) to five (5) IP address
ranges to match in the rule.</li>
<li><p><strong>Advanced mode</strong>: enter an expression or subexpressions to
evaluate against incoming requests. For information about how to write
the expressions and read the following examples, see the
<a href="/armor/docs/rules-language-reference">custom rules language reference</a>.</p>
<ul>
<li><p>The following expression matches against requests from the IP
address <code dir="ltr" translate="no">1.2.3.4</code> and contains the string <code dir="ltr" translate="no">Godzilla</code> in the
user-agent header:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '1.2.3.4/32') &amp;&amp; has(request.headers['user-agent']) &amp;&amp; request.headers['user-agent'].contains('Godzilla')
</pre></li>
<li><p>The following expression matches against requests that have a
cookie with a specific value:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
has(request.headers['cookie']) &amp;&amp; request.headers['cookie'].contains('<var translate="no">cookie_name</var>=<var translate="no">cookie_value</var>')
</pre></li>
<li><p>The following expression matches against requests from the
region <code dir="ltr" translate="no">AU</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.region_code == 'AU'
</pre></li>
<li><p>The following expression matches against requests from the
region <code dir="ltr" translate="no">AU</code> that are not in the specified IP range:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.region_code == "AU" &amp;&amp; !inIpRange(origin.ip, '1.2.3.0/24')
</pre></li>
<li><p>The following expression matches against requests if the URI
matches a regular expression:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
request.path.matches('/bad_path/)')
</pre></li>
<li><p>The following expression matches against requests if the Base64
decoded value of the <code dir="ltr" translate="no">user-id</code> header contains a specific value:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
has(request.headers['user-id']) &amp;&amp; request.headers['user-id'].base64Decode().contains('myValue')
</pre></li>
<li><p>The following expression uses a preconfigured expression set to
match against SQLi attacks:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
evaluatePreconfiguredExpr('sqli-stable')
</pre></li>
</ul></li>
</ul></li>
<li><p>For <strong>Action</strong>, select <strong>Allow</strong> or <strong>Deny</strong>.</p></li>
<li><p>If you are configuring a deny rule, select a <strong>Deny status</strong> message.</p></li>
<li><p>If you want to enable preview mode for the rule, select the <strong>Enable</strong>
checkbox.</p></li>
<li><p>In the <strong>Priority</strong> field, enter a positive integer.</p></li>
<li><p>Click <strong>Add</strong>.</p></li>
</ol></section>
<section><h3 data-text=" gcloud " id="gcloud_11"> gcloud </h3><p>Use the command
<code dir="ltr" translate="no">gcloud compute security-policies rules create <var translate="no">PRIORITY</var></code>.
Replace <code dir="ltr" translate="no"><var translate="no">PRIORITY</var></code> with the priority of the rule in the
policy:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create <var translate="no">PRIORITY</var> \
    --security-policy <var translate="no">POLICY_NAME</var> \
    --description <var translate="no">DESCRIPTION</var> \
    --src-ip-ranges <var translate="no">IP_RANGES</var> | --expression <var translate="no">EXPRESSION</var> \
    --action=[ allow | deny-403 | deny-404 | deny-502 ] \
    --preview
</pre>
<p>For example, the following command adds a rule to block traffic from IP
address ranges 192.0.2.0/24 and 198.51.100.0/24. The rule has priority
1000 and is a rule in a policy called <code dir="ltr" translate="no">my-policy</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --description "block traffic from 192.0.2.0/24 and 198.51.100.0/24" \
    --src-ip-ranges "192.0.2.0/24","198.51.100.0/24" \
    --action "deny-403"
</pre>
<p>Use the <code dir="ltr" translate="no">--expression</code> flag to specify a condition in the
<a href="/armor/docs/rules-language-reference">custom rules language reference</a>.
The following command adds a rule to allow traffic from the IP address
<code dir="ltr" translate="no">1.2.3.4</code> and contains the string <code dir="ltr" translate="no">Godzilla</code> in the user-agent header:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "inIpRange(origin.ip, '1.2.3.4/32') &amp;&amp; has(request.headers['user-agent']) &amp;&amp; request.headers['user-agent'].contains('Godzilla')" \
    --action allow \
    --description "Block User-Agent 'Godzilla'"
</pre>
<p>The following command adds a rule to block requests if the request's
cookie contains a specific value:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "has(request.headers['cookie']) &amp;&amp; request.headers['cookie'].contains('80=BLAH')" \
    --action deny-403 \
    --description "Cookie Block"
</pre>
<p>The following command adds a rule to block requests from the region <code dir="ltr" translate="no">AU</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "origin.region_code == 'AU'" \
    --action deny-403 \
    --description "AU block"
</pre>
<p>The following command adds a rule to block requests from the region <code dir="ltr" translate="no">AU</code>
that are not in the specified IP range:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "origin.region_code == "AU" &amp;&amp; !inIpRange(origin.ip, '1.2.3.0/24')" \
    --action deny-403 \
    --description "country and IP block"
</pre>
<p>The following command adds a rule to block requests with a URI that
matches a regular expression:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "request.path.matches('/bad_path/)')" \
    --action deny-502 \
    --description "regex block"
</pre>
<p>The following command adds a rule to block requests if the Base64
decoded value of the <code dir="ltr" translate="no">user-id</code> header contains a specific value:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "has(request.headers['user-id']) &amp;&amp; request.headers['user-id'].base64Decode().contains('myValue')" \
    --action deny-403 \
    --description "country and IP block"
</pre>
<p>The following command adds a rule that uses a preconfigured expression set
to mitigate SQLi attacks:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000 \
    --security-policy my-policy \
    --expression "evaluatePreconfiguredExpr('sqli-stable')" \
    --action deny-403
</pre></section>
</div>
<h2 data-text="Listing the rules in a security policy" id="list-rules">Listing the rules in a security policy</h2>
<p>Use these instructions to list the rules in a Google Cloud Armor security
policy.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console_9"> Console </h3><ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>On the <strong>Security policies</strong> page, click the name of the
security policy. The <strong>Policy details</strong> page is displayed, and the
policy rules are listed on the <strong>Rules</strong> tab in the middle of the page.</p></li>
</ol></section>
<section><h3 data-text=" gcloud " id="gcloud_12"> gcloud </h3><p>Use the following <code dir="ltr" translate="no">gcloud</code> command to list all rules in a single security
policy along with a description of the policy:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies describe <var translate="no">NAME</var> \
</pre>
<p>Use the following <code dir="ltr" translate="no">gcloud</code> command to describe a rule with the specified
priority in the specified security policy:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules describe <var translate="no">PRIORITY</var> \
    --security-policy <var translate="no">POLICY_NAME</var>
</pre>
<p>For example, the following command describes the rule with priority 1000 in
the security policy <code dir="ltr" translate="no">my-policy</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules describe 1000 \
    --security-policy my-policy
</pre>
<p>Output:
<pre dir="ltr" translate="no">
action: deny(403)
description: block traffic from 192.0.2.0/24 and 198.51.100.0/24
kind: compute#securityPolicyRule
match:
  srcIpRanges:
  - '192.0.2.0/24'
  - '198.51.100.0/24'
preview: false
priority: 1000
</pre></p></section>
</div>
<h2 data-text="Updating a single rule in a security policy" id="update-rules">Updating a single rule in a security policy</h2>
<p>Use these instructions to update a single rule in a Google Cloud Armor
security policy. To atomically update multiple rules, see
<a href="#atomic-update">Atomically updating multiple rules in a security policy</a>.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console_10"> Console </h3><ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>On the <strong>Security policies</strong> page, click the name of the
security policy. The <strong>Policy details</strong> page is displayed.</p></li>
<li><p>In the middle of the page, click the <strong>Rules</strong> tab.</p></li>
<li><p>Next to the rule that you want to update, click
<span aria-hidden="true" class="material-icons" translate="no">edit</span><strong>Edit</strong>.
The <strong>Edit rule</strong> page is displayed.</p></li>
<li><p>Make the desired changes, and then click <strong>Update</strong>.</p></li>
</ol></section>
<section><h3 data-text=" gcloud " id="gcloud_13"> gcloud </h3><p>Use this command to update a rule with the specified priority in a
designated security policy. You can only update one security policy at a
time using this command:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules update <var translate="no">PRIORITY</var> [ \
    --security-policy <var translate="no">POLICY_NAME</var>  \
    --description <var translate="no">DESCRIPTION</var>  \
    --src-ip-ranges <var translate="no">IP_RANGES</var>  | --expression <var translate="no">EXPRESSION</var> \
    --action=[ allow | deny-403 | deny-404 | deny-502 ]  \
    --preview
  ]
  </pre>
<p>For example, the following command updates a rule with priority 1111 to
allow traffic from the IP address range 192.0.2.0/24:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules update 1111 \
    --security-policy my-policy \
    --description "allow traffic from 192.0.2.0/24" \
    --src-ip-ranges "192.0.2.0/24" \
    --action "allow"
</pre>
<p>For more information about this command, see
<a href="/sdk/gcloud/reference/compute/security-policies/rules/update"><code dir="ltr" translate="no">gcloud compute security-policies rules update</code></a>.</p>
<p>To update the priority of a rule, you must use the REST API. For more
information, see
<a href="/compute/docs/reference/rest/v1/securityPolicies/patchRule"><code dir="ltr" translate="no">securityPolicies.patchRule</code></a>.</p></section>
</div>
<h2 data-text="Atomically updating multiple rules in a security policy" id="atomic-update">Atomically updating multiple rules in a security policy</h2>
<p>An atomic update applies changes to multiple rules in a single update. If you
were to update rules one-by-one, you might see some unintended behavior because
old and new rules might be working together for a short period of time.</p>
<p>To atomically update multiple rules, export the current security policy to a
JSON or YAML file, and then modify it. Use the modified file to create a new
security policy, and then switch the security policy for the relevant backend
services.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" gcloud " id="gcloud_14"> gcloud </h3><ol>
<li><p>Export the policy to update, as shown in the following example:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies export my-policy \
    --file-name my-file \
    --file-format yaml
</pre>
<p>The exported policy will look similar to the following example:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
description: my description
fingerprint: PWfLGDWQDLY=
id: '123'
name: my-policy
rules:
- action: deny(404)
  description: my-rule-1
  match:
    expr:
      expression: evaluatePreconfiguredExpr('xss-stable')
    versionedExpr: SRC_IPS_V1
  preview: false
  priority: 1
- action: allow
  description: my-rule-2
  match:
    config:
      srcIpRanges:
      - '1.2.3.4'
    versionedExpr: SRC_IPS_V1
  preview: false
  priority: 2
- action: deny
  description: default rule
  kind: compute#securityPolicyRule
  match:
    config:
      srcIpRanges:
      - '*'
    versionedExpr: SRC_IPS_V1
  preview: false
  priority: 2147483647
selfLink: https://www.googleapis.com/compute/v1/projects/my-project/global/securityPolicies/my-policy
</pre></li>
<li><p>Use any text editor to modify the policy. For example, you can modify the
the priorities of the existing rules and add a new rule:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
description: my description
fingerprint: PWfLGDWQDLY=
id: '123'
name: my-policy
rules:
- action: deny(404)
  description: my-rule-1
  match:
    expr:
      expression: evaluatePreconfiguredExpr('xss-stable')
    versionedExpr: SRC_IPS_V1
  preview: false
  priority: 1
- action: allow
  description: my-new-rule
  match:
    config:
      srcIpRanges:
      - '1.2.3.1'
    versionedExpr: SRC_IPS_V1
  preview: false
  priority: 10
- action: allow
  description: my-rule-2
  match:
    config:
      srcIpRanges:
      - '1.2.3.4'
    versionedExpr: SRC_IPS_V1
  preview: false
  priority: 11
- action: deny
  description: default rule
  kind: compute#securityPolicyRule
  match:
    config:
      srcIpRanges:
      - '*'
    versionedExpr: SRC_IPS_V1
  preview: false
  priority: 2147483647
selfLink: https://www.googleapis.com/compute/v1/projects/my-project/global/securityPolicies/my-policy
</pre></li>
<li><p>Create a new Google Cloud Armor security policy and specify the
modified file name and format, as shown in the following example:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies create new-policy \
    --file-name modified-policy \
    --file-format yaml
</pre></li>
<li><p>Remove the old security policy from the relevant backend service, as
shown in the following example:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute backend-services update my-backend \
    --security-policy ""
</pre></li>
<li><p>Add the new security policy to the backend service, as shown in the
following example:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute backend-services update my-backend \
    --security-policy new-policy
</pre></li>
<li><p>If the old policy is unused, delete it:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies delete my-policy
</pre></li>
</ol></section>
</div>
<h2 data-text="Deleting rules from a security policy" id="delete-rules">Deleting rules from a security policy</h2>
<p>Use these instructions to delete rules from a Google Cloud Armor security
policy.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console_11"> Console </h3><ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>On the <strong>Security policies</strong> page, click the name of the
security policy. The <strong>Policy details</strong> page is displayed.</p></li>
<li><p>In the middle of the page, on the <strong>Rules</strong> tab, select the checkbox
next to the rule that you want to delete.</p></li>
<li><p>Click <span aria-hidden="true" class="material-icons" translate="no">delete</span><strong>Delete</strong>.</p></li>
</ol></section>
<section><h3 data-text=" gcloud " id="gcloud_15"> gcloud </h3><p>Use this command to remove a rule with the specified priority from a
designated security policy. You can modify only one security policy at a
time, but you can delete multiple rules at once:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules delete PRIORITY [...] [
    --security-policy <var translate="no">POLICY_NAME</var> \
  ]
</pre>
<p>For example:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules delete 1000 \
    --security-policy my-policy
</pre></section>
</div>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/rule-tuning">Tune web application firewall (WAF) rules</a></li>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
<li><a href="/armor/docs/rules-language-reference">Use the custom rules language reference</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/rules-language-reference]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor enables you to define prioritized rules with configurable
match conditions and actions in a security policy. A rule takes effect, meaning
that the configured action is applied, if the rule is the highest priority rule
whose conditions match the attributes of the incoming request.</p>
<p>There are two kinds of match conditions:</p>
<ul>
<li>A <em>basic match condition</em> contains lists of IP addresses or lists of IP
address ranges.</li>
<li>An <em>advanced match condition</em> contains an expression with multiple
subexpressions to match on a variety of attributes of an incoming request.</li>
</ul>
<p>The custom rules language is used to write the expressions in advanced match
conditions for security policy rules. The Google Cloud Armor
custom rules language is an extension of the
<a href="https://github.com/google/cel-spec">Common Expression Language (CEL)</a>.</p>
<p>An expression requires two components:</p>
<ul>
<li><em>Attributes</em> that can be inspected in rule expressions.</li>
<li><em>Operations</em> that can be performed on the attributes as part of an
expression.</li>
</ul>
<p>For example, the following expression uses the attributes <code dir="ltr" translate="no">origin.ip</code> and
<code dir="ltr" translate="no">9.9.9.0/24</code> in the operation <code dir="ltr" translate="no">inIpRange()</code>. In this case, the expression
returns true if <code dir="ltr" translate="no">origin.ip</code> is within the <code dir="ltr" translate="no">9.9.9.0/24</code> IP address range.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '9.9.9.0/24')
</pre>
<h2 data-text="Attributes" id="attributes">Attributes</h2>
<p>Attributes represent information from an incoming request, such as the
origin IP address or the requested URL path.</p>
<table>
<thead>
<tr>
<th width="20%">Field</th>
<th width="10%">Type</th>
<th width="70%">Field description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">origin.ip</code></td>
<td>string</td>
<td>The source IP address of the request.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">request.headers</code></td>
<td>map</td>
<td>A string-to-string map of the HTTP request headers. If a header
      contains multiple values, the value in this map would be a comma-separated
      string of all of the values of the header. The keys in this map are all
      <em>lowercase</em>. Only the first 16 KB of each header value is available for
      inspection. Any header value over 16 KB is truncated per
      Google Cloud load balancer specifications.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">request.method</code></td>
<td>string</td>
<td>The HTTP request method, such as <code dir="ltr" translate="no">GET</code> or <code dir="ltr" translate="no">POST</code>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">request.path</code></td>
<td>string</td>
<td>The requested HTTP URL path.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">request.scheme</code></td>
<td>string</td>
<td>The HTTP URL scheme such as <code dir="ltr" translate="no">http</code> or <code dir="ltr" translate="no">https</code>.
      Values for this attribute are all <em>lowercase</em>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">request.query</code></td>
<td>string</td>
<td>The HTTP URL query in the format of
      <code dir="ltr" translate="no">name1=value&amp;name2=value2</code>, as it appears in the first line of
      the HTTP request. No decoding is performed.
      </td>
</tr>
<tr>
<td><code dir="ltr" translate="no">origin.region_code</code></td>
<td>string</td>
<td>The Unicode country code that is associated with the origin IP, such
      as <code dir="ltr" translate="no">US</code>. If you are creating a rule or expression that uses
      <a class="external" href="https://www.wikipedia.org/wiki/ISO_3166-1_alpha-2" target="wiki">ISO 3166-1 alpha 2</a>
      country or region codes, Google Cloud Armor treats each code
      independently. Google Cloud Armor rules and expressions explicitly
      use those region codes to allow or deny requests.
      <p>For more information, see <a class="external" href="http://www.unicode.org/reports/tr35/#unicode_region_subtag" target="unicode">unicode_region_subtag</a>
      in the Unicode Technical Standard.</p>
</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">origin.asn</code></td>
<td>integer</td>
<td>The autonomous system number (ASN) that is associated with the origin
      IP address. The globally unique ASN is determined based on the network
      operator supporting the IP address prefixes that contain the origin IP address.
      </td>
</tr>
</tbody>
</table>
<aside class="note"><strong>Note:</strong><span> Edge security policies only support filtering based on source IP address
and geography attributes, which are <code dir="ltr" translate="no">origin.ip</code> and <code dir="ltr" translate="no">origin.region_code</code>.</span></aside>
<h3 data-text="reCAPTCHA Enterprise attributes" id="recaptcha-attributes">reCAPTCHA Enterprise attributes</h3>
<p>This section lists attributes that are only applicable to
reCAPTCHA Enterprise tokens or exemption cookies. A subexpression
based on these attributes returns <code dir="ltr" translate="no">false</code> if the reCAPTCHA token or exemption
cookie to be evaluated is not available or is invalid (malformed, mismatched,
or expired).</p>
<h4 data-text="Exemption cookie attributes" id="exemption_cookie_attributes">Exemption cookie attributes</h4>
<table>
<thead>
<tr>
<th width="30%">Field</th>
<th width="10%">Type</th>
<th width="60%">Field description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">token.recaptcha_exemption.valid</code></td>
<td><code dir="ltr" translate="no">bool</code></td>
<td>The presence of a valid reCAPTCHA exemption cookie.</td>
</tr>
</tbody>
</table>
<h4 data-text="Action-token attributes" id="action-token_attributes">Action-token attributes</h4>
<table>
<thead>
<tr>
<th width="30%">Field</th>
<th width="10%">Type</th>
<th width="60%">Field description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">token.recaptcha_action.score</code></td>
<td><code dir="ltr" translate="no">float</code></td>
<td>The score from a reCAPTCHA action-token. A valid score ranges from
        <code dir="ltr" translate="no">0.0</code> to <code dir="ltr" translate="no">1.0</code>, with <code dir="ltr" translate="no">0.0</code> being very
        likely an illegitimate user, and <code dir="ltr" translate="no">1.0</code> being very likely a
        legitimate user.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">token.recaptcha_action.captcha_status</code></td>
<td><code dir="ltr" translate="no">string</code></td>
<td>The captcha status from a reCAPTCHA action-token. A valid status is
        <code dir="ltr" translate="no">NONE</code>, <code dir="ltr" translate="no">PASS</code>, or <code dir="ltr" translate="no">FAIL</code>, where
        <code dir="ltr" translate="no">NONE</code> refers to when there are no challenges involved during
        reCAPTCHA assessment, such that the captcha field is missing in the
        action-token.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">token.recaptcha_action.action</code></td>
<td><code dir="ltr" translate="no">string</code></td>
<td>The action name (up to 100 characters) from a reCAPTCHA action-token.
        See <a href="/recaptcha-enterprise/docs/actions">Action names</a>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">token.recaptcha_action.valid</code></td>
<td><code dir="ltr" translate="no">bool</code></td>
<td>The presence of a valid reCAPTCHA action-token.</td>
</tr>
</tbody>
</table>
<h4 data-text="Session-token attributes" id="session-token_attributes">Session-token attributes</h4>
<table>
<thead>
<tr>
<th width="30%">Field</th>
<th width="10%">Type</th>
<th width="60%">Field description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">token.recaptcha_session.score</code></td>
<td><code dir="ltr" translate="no">float</code></td>
<td>The score from a reCAPTCHA session-token. A valid score ranges from
        <code dir="ltr" translate="no">0.0</code> to <code dir="ltr" translate="no">1.0</code>, with <code dir="ltr" translate="no">0.0</code> being very
        likely an illegitimate user, and <code dir="ltr" translate="no">1.0</code> being very likely a
        legitimate user.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">token.recaptcha_session.valid</code></td>
<td><code dir="ltr" translate="no">bool</code></td>
<td>The presence of a valid reCAPTCHA session-token.</td>
</tr>
</tbody>
</table>
<h2 data-text="Operations" id="operations">Operations</h2>
<p>The following reference describes the operators that you can use with attributes
(represented by <code dir="ltr" translate="no">x</code>, <code dir="ltr" translate="no">y</code>, and <code dir="ltr" translate="no">k</code>) to define rule expressions.</p>
<table>
<thead>
<tr>
<th width="20%">Expressions</th>
<th width="80%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">x == "foo"</code></td>
<td>Returns true if <i>x</i> is equal to the given constant string literal.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x == R"fo'o"</code></td>
<td>Returns true if <i>x</i> is equal to the given raw string literal that does
      not interpret escape sequences. Raw string literals are convenient for
      expressing strings that themselves must use escape sequence characters.
    </td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x == y</code></td>
<td>Returns true if <i>x</i> is equal to <i>y</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x != y</code></td>
<td>Returns true if <i>x</i> is not equal to <i>y</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x + y</code></td>
<td>Returns the concatenated string <i>xy</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x &amp;&amp; y</code></td>
<td>Returns true if both <i>x</i> and <i>y</i> are true.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x || y</code></td>
<td>Returns true if <i>x</i>, <i>y</i>, or both are true.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">!x</code></td>
<td>Returns true if the Boolean value <i>x</i> is false, or returns false if
    the Boolean value <i>x</i> is true.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x.contains(y)</code></td>
<td>Returns true if the string <i>x</i> contains the substring <i>y</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x.startsWith(y)</code></td>
<td>Returns true if the string <i>x</i> begins with the substring <i>y</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x.endsWith(y)</code></td>
<td>Returns true if the string <i>x</i> ends with the substring <i>y</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x.matches(y)</code></td>
<td>Returns true if the string <i>x</i> matches the specified
    <a class="external" href="https://www.wikipedia.org/wiki/RE2_(software)" target="wiki">RE2</a>
    pattern <i>y</i>. The RE2 pattern is compiled by using the RE2::Latin1
    option that disables Unicode features.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">inIpRange(x, y)</code></td>
<td>Returns true if the IP address <i>x</i> is contained within the IP range
    <i>y</i>. Subnet masks for IPv6 addresses cannot be larger than /64.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x.lower()</code></td>
<td>Returns the lowercase value of the string <i>x</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x.upper()</code></td>
<td>Returns the uppercase value of the string <i>x</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x.base64Decode()</code></td>
<td>Returns the base64 decoded value of <i>x</i>; the characters
    <code dir="ltr" translate="no">_ -</code> are first replaced with <code dir="ltr" translate="no">/ +</code> respectively.
    Returns <code dir="ltr" translate="no">""</code> (empty string) if <i>x</i> is not a valid base64
    value.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">has(m['k'])</code></td>
<td>Returns true if key <i>k</i> is available in the map <i>m</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">m['k']</code></td>
<td>Returns the value at key <i>k</i> in the string-to-string map <i>m</i> if
    <i>k</i> is available; otherwise, returns an error. Recommended approach is
    to first check for availability by using <code dir="ltr" translate="no">"has(m['k'])==true"</code>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">int(x)</code></td>
<td>Converts the string result of <i>x</i> to an <code dir="ltr" translate="no">int</code> type. It can
    then be used to do an integer comparison by using standard arithmetic
    operators such as &gt; and &lt;=. This works only for values that are
    supposed to be integers.</td>
</tr>
</tbody>
</table>
<h2 data-text="Example expressions" id="expression-examples">Example expressions</h2>
<p>For each of these expressions, the action taken depends on whether the
expression is included in a deny rule or an allow rule.</p>
<h3 data-text="Allow or deny access based on an IP address range in IPv4 or IPv6" id="allow_or_deny_access_based_on_an_ip_address_range_in_ipv4_or_ipv6">Allow or deny access based on an IP address range in IPv4 or IPv6</h3>
<ul>
<li><p>The following expression matches with requests from the <code dir="ltr" translate="no">9.9.9.0/24</code>
IP address range:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '9.9.9.0/24')
</pre></li>
<li><p>The following expression matches with requests from the <code dir="ltr" translate="no">2001:db8::/32</code>
IP address range:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '2001:db8::/32')
</pre></li>
</ul>
<h3 data-text="Allow or deny traffic with a specific cookie" id="allow_or_deny_traffic_with_a_specific_cookie">Allow or deny traffic with a specific cookie</h3>
<ul>
<li><p>The following expression matches with requests that have a cookie containing
<code dir="ltr" translate="no">80=BLAH</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
has(request.headers['cookie']) &amp;&amp; request.headers['cookie'].contains('80=BLAH')
</pre></li>
</ul>
<h3 data-text="Allow or deny traffic with a non-empty referer header" id="allow_or_deny_traffic_with_a_non-empty_referer_header">Allow or deny traffic with a non-empty <code dir="ltr" translate="no">referer</code> header</h3>
<ul>
<li><p>The following expression matches with requests that have a non-empty
<code dir="ltr" translate="no">referer</code> header:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
has(request.headers['referer']) &amp;&amp; request.headers['referer'] != ""
</pre></li>
</ul>
<h3 data-text="Allow or deny traffic based on host URL in header" id="allow_or_deny_traffic_based_on_host_url_in_header">Allow or deny traffic based on host URL in header</h3>
<ul>
<li><p>The following expression matches with requests to a specific URL:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
request.headers['host'].lower().contains('test.example.com')
</pre></li>
</ul>
<h3 data-text="Allow or deny traffic from a specific region" id="allow_or_deny_traffic_from_a_specific_region">Allow or deny traffic from a specific region</h3>
<p>If your web application isn't available in the <code dir="ltr" translate="no">AU</code> region, then all
requests from that region must be blocked.</p>
<ul>
<li><p>In a deny rule, use the following expression, which matches requests from the
<code dir="ltr" translate="no">AU</code> region:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.region_code == 'AU'
</pre></li>
</ul>
<p>Alternatively, if your web application is <em>only</em> available in the <code dir="ltr" translate="no">AU</code> region,
 then requests from all other regions must be blocked.</p>
<ul>
<li><p>In a deny rule, use the following expression, which matches requests from all
regions other than the <code dir="ltr" translate="no">AU</code> region:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.region_code != 'AU'
</pre></li>
</ul>
<p>The region codes are based on the
<a class="external" href="https://www.wikipedia.org/wiki/ISO_3166-1_alpha-2" target="wiki">ISO 3166-1 alpha 2</a> 
codes. In some cases, a region corresponds to a country, but this is not always
the case. For example, the <code dir="ltr" translate="no">US</code> code includes all states of the United States,
one district, and six outlying areas.</p>
<h3 data-text="Allow or deny traffic from a specific ASN" id="allow_or_deny_traffic_from_a_specific_asn">Allow or deny traffic from a specific ASN</h3>
<p>If your web application needs to be blocked to customers serviced by a specific
network operator, you can use the ASN number of the network operator to block.</p>
<ul>
<li><p>In a deny rule, use the following expression, which matches requests from a specific ASN:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.asn == 123
</pre></li>
</ul>
<p>Alternatively, if your web application is to be <em>only</em> available to customers
behind a specific network operator, then requests from all other network
operators must be blocked.</p>
<ul>
<li><p>In a deny rule, use the following expression, which matches all other network
operators other than the one that you are interested in allowing.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.asn != 123
</pre></li>
</ul>
<h3 data-text="Multiple expressions" id="multiple_expressions">Multiple expressions</h3>
<p>To include multiple conditions in a single rule, combine multiple
subexpressions.</p>
<ul>
<li><p>In the following example, requests from <code dir="ltr" translate="no">1.2.3.0/24</code> (such as
your alpha testers) in the <code dir="ltr" translate="no">AU</code> region match the following expression:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.region_code == "AU" &amp;&amp; inIpRange(origin.ip, '1.2.3.0/24')
</pre></li>
<li><p>The following expression matches requests from <code dir="ltr" translate="no">1.2.3.4</code> where a user
agent contains the string <code dir="ltr" translate="no">WordPress</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '1.2.3.4/32') &amp;&amp;
has(request.headers['user-agent']) &amp;&amp; request.headers['user-agent'].contains('WordPress')
</pre></li>
</ul>
<h3 data-text="Allow or deny traffic for a request URI that matches a regular expression" id="allow_or_deny_traffic_for_a_request_uri_that_matches_a_regular_expression">Allow or deny traffic for a request URI that matches a regular expression</h3>
<ul>
<li><p>The following expression matches with requests that contain the string
<code dir="ltr" translate="no">bad_path</code> in the URI:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
request.path.matches('/bad_path/')
</pre></li>
<li><p>The following expression matches with requests that have <code dir="ltr" translate="no">Chrome</code> in the
<code dir="ltr" translate="no">User-Agent</code> header field:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
request.headers['user-agent'].matches('Chrome')
</pre></li>
<li><p>The following expression shows case-insensitive matching for the
<code dir="ltr" translate="no">User-Agent</code> header containing <code dir="ltr" translate="no">wordpress</code>; it matches with
<code dir="ltr" translate="no">User-Agent:WordPress/605.1.15</code>, <code dir="ltr" translate="no">User-Agent:wordPress</code>, and other variations
of <code dir="ltr" translate="no">wordpress</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
request.headers['user-agent'].matches('(?i:wordpress)')
</pre></li>
</ul>
<h3 data-text="Allow or deny traffic that contains a specific Base64 decoded value" id="allow_or_deny_traffic_that_contains_a_specific_base64_decoded_value">Allow or deny traffic that contains a specific Base64 decoded value</h3>
<ul>
<li><p>The following expression matches with requests that have a Base64 decoded
value of <code dir="ltr" translate="no">myValue</code> for the <code dir="ltr" translate="no">user-id</code> header:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
has(request.headers['user-id']) &amp;&amp; request.headers['user-id'].base64Decode().contains('myValue')
</pre></li>
</ul>
<h3 data-text="Allow or deny traffic that has zero content-length in the HTTP body" id="allow_or_deny_traffic_that_has_zero_content-length_in_the_http_body">Allow or deny traffic that has zero <code dir="ltr" translate="no">content-length</code> in the HTTP body</h3>
<ul>
<li><p>The following expression matches requests that have a zero <code dir="ltr" translate="no">content-length</code>
in the HTTP body:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
int(request.headers["content-length"]) == 0
</pre></li>
</ul>
<h2 data-text="Preconfigured rules" id="preconfigured-rules">Preconfigured rules</h2>
<p>Preconfigured rules use preconfigured static signatures, regular expressions, or
both to match on HTTP request headers and query parameters. The available
preconfigured rules are based on the
<a class="external" href="https://modsecurity.org/crs/" target="mod">OWASP Modsecurity core rule set</a> 
version 3.0.2. Google Cloud Armor provides these predefined expression sets:</p>
<ul>
<li><code dir="ltr" translate="no">xss-&lt;version&gt;</code>: defends against cross-site scripting attacks</li>
<li><code dir="ltr" translate="no">sqli-&lt;version&gt;</code>: defends against SQL injection attacks</li>
<li><code dir="ltr" translate="no">lfi-&lt;version&gt;</code>: defends against local file inclusion attacks</li>
<li><code dir="ltr" translate="no">rfi-&lt;version&gt;</code>: defends against remote file inclusion attacks</li>
<li><code dir="ltr" translate="no">rce-&lt;version&gt;</code>: defends against remote code execution attacks</li>
</ul>
<p>To list all of the available preconfigured rules, see
<a href="/armor/docs/configure-security-policies#list-preconfig-rules">Listing the available preconfigured rules</a>.</p>
<p>For more information about preconfigured rules, see the use case
<a href="/armor/docs/security-policy-overview#preconfig-use-case">Mitigate application layer attacks by using preconfigured rules</a>.</p>
<h3 data-text="Expression set names" id="expression_set_names">Expression set names</h3>
<p>Expression set names have the format <code dir="ltr" translate="no">&lt;attack category&gt;-&lt;version field&gt;</code>. The
attack category specifies the type of attacks that you want to protect against,
such as <code dir="ltr" translate="no">xss</code> (cross-site scripting) or <code dir="ltr" translate="no">sqli</code> (SQL injection).</p>
<p>The supported version fields are <code dir="ltr" translate="no">stable</code> and <code dir="ltr" translate="no">canary</code>. Additions and
modifications to the rules are released in the <code dir="ltr" translate="no">canary</code> version first. When
additions and modifications are considered safe and stable, they are promoted
to the <code dir="ltr" translate="no">stable</code> version.</p>
<h3 data-text="Expression set member IDs" id="expression_set_member_ids">Expression set member IDs</h3>
<p>An expression set contains several expressions, each with its own core rule set
(CRS) ID.  For example, the expression set <code dir="ltr" translate="no">xss-stable</code> includes an expression
called <code dir="ltr" translate="no">owasp-crs-v020901-id981136-xss</code>, which corresponds to rule ID <code dir="ltr" translate="no">981136</code>
for <code dir="ltr" translate="no">version 2.9.1</code>. You can use the CRS IDs to exclude specific expressions from
being used, which is useful if a particular expression consistently triggers a
false positive. For more information, see the <a href="/armor/docs/troubleshooting#false-positives">false
positives</a>
troubleshooting information.</p>
<p>For information about the core rule set and tuning at different
sensitivity levels, see <a href="/armor/docs/rule-tuning">Tuning Google Cloud Armor WAF rules</a>.</p>
<h3 data-text="Operator for preconfigured rules" id="operator_for_preconfigured_rules">Operator for preconfigured rules</h3>
<table>
<thead>
<tr>
<th width="45%">Expressions</th>
<th width="55%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">evaluatePreconfiguredExpr(string, LIST)</code></td>
<td><p>Returns true if any one of the expressions inside the specified
      expression set returns true.</p>
<p>The first argument is the name of the expression set, such as
          <code dir="ltr" translate="no">xss-stable</code>. The second argument (optional) is a
          comma-separated string list of IDs that should be excluded from
          evaluation. The exclusion list is useful when a given member of the
          expression set triggers a false positive.</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Preconfigured rule examples" id="preconfigured_rule_examples">Preconfigured rule examples</h3>
<ul>
<li><p>The following expression uses the <code dir="ltr" translate="no">xss-stable</code> preconfigured rule to
mitigate XSS attacks:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
evaluatePreconfiguredExpr('xss-stable')
</pre></li>
<li><p>The following expression uses all the expressions from the <code dir="ltr" translate="no">xss-stable</code>
preconfigured rule except for member IDs <code dir="ltr" translate="no">981136</code> and <code dir="ltr" translate="no">981138</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
evaluatePreconfiguredExpr('xss-stable', ['owasp-crs-v020901-id981136-xss',
'owasp-crs-v020901-id981138-xss'])
</pre></li>
<li><p>The following expression uses a preconfigured rule to mitigate SQLi attacks
from the <code dir="ltr" translate="no">198.51.100.0/24</code> IP address range:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '198.51.100.0/24') &amp;&amp; evaluatePreconfiguredExpr('sqli-stable')
</pre></li>
</ul>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/configure-security-policies">Configure security policies, rules, and expressions</a></li>
<li><a href="/armor/docs/rule-tuning">Tune web application firewall (WAF) rules</a></li>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/rule-tuning]</H1></p><div class="devsite-article-body clearfix">
<h2 data-text="Preconfigured rules" id="preconfigured_rules">Preconfigured rules</h2>
<p>Google Cloud Armor preconfigured rules are complex web application firewall (WAF)
rules with dozens of <em>signatures</em> that are compiled from open source industry
standards. Google offers these rules as-is. The rules allow
Google Cloud Armor to evaluate dozens of distinct traffic signatures by
referring to conveniently-named rules, rather than requiring you to define
each signature manually.</p>
<p>The following table contains a comprehensive list of preconfigured WAF rules
that are available for use in a Google Cloud Armor security policy. The
rule source is
<a class="external" href="https://github.com/SpiderLabs/owasp-modsecurity-crs/releases/tag/v3.0.2" target="github">ModSecurity Core Rule Set (CRS) 3.0</a> 
and <a class="external" href="https://github.com/coreruleset/coreruleset/releases/tag/v3.3.2" target="github">CRS 3.3</a>.
We recommend that you use version 3.3 for increased sensitivity, and for an
increased breadth of protected attack types.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="33%">Google Cloud Armor rule name</th>
<th width="33%">ModSecurity rule name</th>
<th width="34%">Current status</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="2">SQL injection (public preview)</td>
<td><code dir="ltr" translate="no">sqli-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">sqli-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">sqli-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Cross-site scripting (public preview)</td>
<td><code dir="ltr" translate="no">xss-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">xss-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">xss-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Local file inclusion (public preview)</td>
<td><code dir="ltr" translate="no">lfi-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">lfi-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">lfi-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Remote file inclusion (public preview)</td>
<td><code dir="ltr" translate="no">rfi-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">rfi-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">rfi-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Remote code execution (public preview)</td>
<td><code dir="ltr" translate="no">rce-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">rce-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">rce-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Method enforcement (public preview)</td>
<td><code dir="ltr" translate="no">methodenforcement-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">methodenforcement-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">methodenforcement-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Scanner detection (public preview)</td>
<td><code dir="ltr" translate="no">scannerdetection-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">scannerdetection-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">scannerdetection-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Protocol attack (public preview)</td>
<td><code dir="ltr" translate="no">protocolattack-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">protocolattack-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">protocolattack-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">PHP injection attack (public preview)</td>
<td><code dir="ltr" translate="no">php-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">php-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">php-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Session fixation attack (public preview)</td>
<td><code dir="ltr" translate="no">sessionfixation-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">sessionfixation-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">sessionfixation-v33-canary</code></td>
<td>Latest</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="33%">Google Cloud Armor rule name</th>
<th width="33%">ModSecurity rule name</th>
<th width="34%">Current status</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="2">SQL injection</td>
<td><code dir="ltr" translate="no">sqli-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">sqli-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">sqli-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Cross-site scripting</td>
<td><code dir="ltr" translate="no">xss-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">xss-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">xss-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Local file inclusion</td>
<td><code dir="ltr" translate="no">lfi-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">lfi-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">lfi-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Remote file inclusion</td>
<td><code dir="ltr" translate="no">rfi-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">rfi-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">rfi-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Remote code execution</td>
<td><code dir="ltr" translate="no">rce-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">rce-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">rce-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Method enforcement (public preview)</td>
<td><code dir="ltr" translate="no">methodenforcement-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">methodenforcement-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">methodenforcement-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Scanner detection</td>
<td><code dir="ltr" translate="no">scannerdetection-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">scannerdetection-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">scannerdetection-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Protocol attack</td>
<td><code dir="ltr" translate="no">protocolattack-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">protocolattack-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">protocolattack-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">PHP injection attack</td>
<td><code dir="ltr" translate="no">php-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">php-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">php-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Session fixation attack</td>
<td><code dir="ltr" translate="no">sessionfixation-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">sessionfixation-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">sessionfixation-canary</code></td>
<td>Latest</td>
</tr>
</tbody>
</table></section>
</div>
<p>In addition, the following <code dir="ltr" translate="no">cve-canary</code> rule is available to all
Google Cloud Armor customers to help detect and optionally block exploit
attempts of the <code dir="ltr" translate="no">CVE-2021-44228</code> and <code dir="ltr" translate="no">CVE-2021-45046</code> vulnerabilities.</p>
<table>
<thead>
<tr>
<th width="33%">Google Cloud Armor rule name</th>
<th width="33%">Rule content</th>
<th width="34%">Covered vulnerability types</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">cve-canary</code></td>
<td>Newly discovered vulnerabilities</td>
<td>Log4j vulnerability</td>
</tr>
</tbody>
</table>
<p>Each preconfigured rule consists of multiple signatures. Incoming requests are
evaluated against the preconfigured rules. A request matches a preconfigured
rule if the request matches any of the signatures that are associated with the
preconfigured rule. A match is made when the <code dir="ltr" translate="no">evaluatePreconfiguredExpr()</code>
command returns the value <code dir="ltr" translate="no">true</code>.</p>
<p>If you decide that a preconfigured rule matches more traffic than is necessary,
or if the rule is blocking traffic that needs to be allowed, the rule can be
tuned to disable noisy or otherwise unnecessary signatures. To disable signatures
in a particular preconfigured rule, you provide a list of IDs of the unwanted
signatures to the <code dir="ltr" translate="no">evaluatePreconfiguredExpr()</code> command.</p>
<p>The following example excludes two CRS rule IDs from the preconfigured
<code dir="ltr" translate="no">xss-v33-stable</code> (CRS 3.3) WAF rule:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
evaluatePreconfiguredExpr('xss-v33-stable', ['owasp-crs-v030301-id941330-xss', 'owasp-crs-v030301-id941340-xss'])
</pre>
<p>When you exclude signature IDs from preconfigured CRS rule sets, you must match
the signature ID version with the rule set version (CRS 3.0 or 3.3) to avoid
configuration errors.</p>
<p>The preceding example is an expression in the <a href="/armor/docs/rules-language-reference">custom rules language</a>.
The general syntax is:</p>
<pre dir="ltr" translate="no">
evaluatePreconfiguredExpr(RULE, ['SIGNATURE1', 'SIGNATURE2', 'SIGNATURE3'])
</pre>
<h2 data-text="Preconfigured ModSecurity rules" id="preconfigured_modsecurity_rules">Preconfigured ModSecurity rules</h2>
<p>Each preconfigured rule has a sensitivity level that corresponds to a
ModSecurity
<a class="external" href="https://coreruleset.org/faq/#paranoialevel">paranoia level</a>.
A lower sensitivity level indicates a higher confidence signature, which is less
likely to generate a false positive. A higher sensitivity level increases
security, but also increases the risk of generating a false positive.</p>
<h3 data-text="SQL injection (SQLi)" id="sql_injection_sqli">SQL injection (SQLi)</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the SQLi preconfigured rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_1"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942140-sqli</code></td>
<td>1</td>
<td>SQL injection attack: Common DB Names Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942160-sqli</code></td>
<td>1</td>
<td>Detects blind SQLi tests using sleep() or benchmark()</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942170-sqli</code></td>
<td>1</td>
<td>Detects SQL benchmark and sleep injection attempts including
      conditional queries</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942190-sqli</code></td>
<td>1</td>
<td>Detects MSSQL code execution and information gathering attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942220-sqli</code></td>
<td>1</td>
<td>Looks for integer overflow attacks</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942230-sqli</code></td>
<td>1</td>
<td>Detects conditional SQL injection attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942240-sqli</code></td>
<td>1</td>
<td>Detects MySQL charset switch and MSSQL DoS attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942250-sqli</code></td>
<td>1</td>
<td>Detects MATCH AGAINST</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942270-sqli</code></td>
<td>1</td>
<td>Looks for basic SQL injection; common attack string for MySql</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942280-sqli</code></td>
<td>1</td>
<td>Detects Postgres pg_sleep injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942290-sqli</code></td>
<td>1</td>
<td>Finds basic MongoDB SQL injection attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942320-sqli</code></td>
<td>1</td>
<td>Detects MySQL and PostgreSQL stored procedure/function injections</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942350-sqli</code></td>
<td>1</td>
<td>Detects MySQL UDF injection and other data/structure manipulation
      attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942360-sqli</code></td>
<td>1</td>
<td>Detects concatenated basic SQL injection and SQLLFI attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942500-sqli</code></td>
<td>1</td>
<td>MySQL in-line comment detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942110-sqli</code></td>
<td>2</td>
<td>SQL injection attack: Common Injection Testing Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942120-sqli</code></td>
<td>2</td>
<td>SQL injection attack: SQL Operator Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942130-sqli</code></td>
<td>2</td>
<td>SQL Injection Attack: SQL Tautology Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942150-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942180-sqli</code></td>
<td>2</td>
<td>Detects basic SQL authentication bypass attempts 1/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942200-sqli</code></td>
<td>2</td>
<td>Detects MySQL comment-/space-obfuscated injections and backtick
      termination</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942210-sqli</code></td>
<td>2</td>
<td>Detects chained SQL injection attempts 1/2</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942260-sqli</code></td>
<td>2</td>
<td>Detects basic SQL authentication bypass attempts 2/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942300-sqli</code></td>
<td>2</td>
<td>Detects MySQL comments</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942310-sqli</code></td>
<td>2</td>
<td>Detects chained SQL injection attempts 2/2</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942330-sqli</code></td>
<td>2</td>
<td>Detects classic SQL injection probings 1/2</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942340-sqli</code></td>
<td>2</td>
<td>Detects basic SQL authentication bypass attempts 3/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942361-sqli</code></td>
<td>2</td>
<td>Detects basic SQL injection based on keyword alter or union</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942370-sqli</code></td>
<td>2</td>
<td>Detects classic SQL injection probings 2/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942380-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942390-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942400-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942410-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942470-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942480-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942430-sqli</code></td>
<td>2</td>
<td>Restricted SQL Character Anomaly Detection (args): # of special
      characters exceeded (12)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942440-sqli</code></td>
<td>2</td>
<td>SQL Comment Sequence Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942450-sqli</code></td>
<td>2</td>
<td>SQL Hex Encoding Identified</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942510-sqli</code></td>
<td>2</td>
<td>SQLi bypass attempt by ticks or backticks detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942251-sqli</code></td>
<td>3</td>
<td>Detects HAVING injections</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942490-sqli</code></td>
<td>3</td>
<td>Detects classic SQL injection probings 3/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942420-sqli</code></td>
<td>3</td>
<td>Restricted SQL Character Anomaly Detection (cookies): # of special
      characters exceeded (8)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942431-sqli</code></td>
<td>3</td>
<td>Restricted SQL Character Anomaly Detection (args): # of special
      characters exceeded (6)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942460-sqli</code></td>
<td>3</td>
<td>Meta-Character Anomaly Detection Alert - Repetitive Non-Word
      Characters</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942511-sqli</code></td>
<td>3</td>
<td>SQLi bypass attempt by ticks detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942421-sqli</code></td>
<td>4</td>
<td>Restricted SQL Character Anomaly Detection (cookies): # of special
      characters exceeded (3)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942432-sqli</code></td>
<td>4</td>
<td>Restricted SQL Character Anomaly Detection (args): # of special
      characters exceeded (2)</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_1"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942140-sqli</code></td>
<td>1</td>
<td>SQL injection attack: Common DB Names Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942160-sqli</code></td>
<td>1</td>
<td>Detects blind SQLi tests using sleep() or benchmark()</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942170-sqli</code></td>
<td>1</td>
<td>Detects SQL benchmark and sleep injection attempts including
      conditional queries</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942190-sqli</code></td>
<td>1</td>
<td>Detects MSSQL code execution and information gathering attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942220-sqli</code></td>
<td>1</td>
<td>Looks for integer overflow attacks</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942230-sqli</code></td>
<td>1</td>
<td>Detects conditional SQL injection attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942240-sqli</code></td>
<td>1</td>
<td>Detects MySQL charset switch and MSSQL DoS attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942250-sqli</code></td>
<td>1</td>
<td>Detects MATCH AGAINST</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942270-sqli</code></td>
<td>1</td>
<td>Looks for basic SQL injection; common attack string for MySql</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942280-sqli</code></td>
<td>1</td>
<td>Detects Postgres pg_sleep injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942290-sqli</code></td>
<td>1</td>
<td>Finds basic MongoDB SQL injection attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942320-sqli</code></td>
<td>1</td>
<td>Detects MySQL and PostgreSQL stored procedure/function injections</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942350-sqli</code></td>
<td>1</td>
<td>Detects MySQL UDF injection and other data/structure manipulation
      attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942360-sqli</code></td>
<td>1</td>
<td>Detects concatenated basic SQL injection and SQLLFI attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>MySQL in-line comment detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942110-sqli</code></td>
<td>2</td>
<td>SQL injection attack: Common Injection Testing Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942120-sqli</code></td>
<td>2</td>
<td>SQL injection attack: SQL Operator Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>SQL Injection Attack: SQL Tautology Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942150-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942180-sqli</code></td>
<td>2</td>
<td>Detects basic SQL authentication bypass attempts 1/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942200-sqli</code></td>
<td>2</td>
<td>Detects MySQL comment-/space-obfuscated injections and backtick
      termination</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942210-sqli</code></td>
<td>2</td>
<td>Detects chained SQL injection attempts 1/2</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942260-sqli</code></td>
<td>2</td>
<td>Detects basic SQL authentication bypass attempts 2/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942300-sqli</code></td>
<td>2</td>
<td>Detects MySQL comments</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942310-sqli</code></td>
<td>2</td>
<td>Detects chained SQL injection attempts 2/2</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942330-sqli</code></td>
<td>2</td>
<td>Detects classic SQL injection probings 1/2</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942340-sqli</code></td>
<td>2</td>
<td>Detects basic SQL authentication bypass attempts 3/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>Detects basic SQL injection based on keyword alter or union</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>Detects classic SQL injection probings 2/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942380-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942390-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942400-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942410-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942430-sqli</code></td>
<td>2</td>
<td>Restricted SQL Character Anomaly Detection (args): # of special
      characters exceeded (12)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942440-sqli</code></td>
<td>2</td>
<td>SQL Comment Sequence Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942450-sqli</code></td>
<td>2</td>
<td>SQL Hex Encoding Identified</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>SQLi bypass attempt by ticks or backticks detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942251-sqli</code></td>
<td>3</td>
<td>Detects HAVING injections</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>Detects classic SQL injection probings 3/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942420-sqli</code></td>
<td>3</td>
<td>Restricted SQL Character Anomaly Detection (cookies): # of special
      characters exceeded (8)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942431-sqli</code></td>
<td>3</td>
<td>Restricted SQL Character Anomaly Detection (args): # of special
      characters exceeded (6)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942460-sqli</code></td>
<td>3</td>
<td>Meta-Character Anomaly Detection Alert - Repetitive Non-Word
      Characters</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>3</td>
<td>SQLi bypass attempt by ticks detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942421-sqli</code></td>
<td>4</td>
<td>Restricted SQL Character Anomaly Detection (cookies): # of special
      characters exceeded (3)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942432-sqli</code></td>
<td>4</td>
<td>Restricted SQL Character Anomaly Detection (args): # of special
      characters exceeded (2)</td>
</tr>
</tbody>
</table></section>
</div>
<p>To configure a rule at a particular sensitivity level, disable the signatures
at greater sensitivity levels.</p>
<table>
<thead>
<tr>
<th>SQLi sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('sqli-v33-stable',
['owasp-crs-v030301-id942110-sqli',
  'owasp-crs-v030301-id942120-sqli',
  'owasp-crs-v030301-id942130-sqli',
  'owasp-crs-v030301-id942150-sqli',
  'owasp-crs-v030301-id942180-sqli',
  'owasp-crs-v030301-id942200-sqli',
  'owasp-crs-v030301-id942210-sqli',
  'owasp-crs-v030301-id942260-sqli',
  'owasp-crs-v030301-id942300-sqli',
  'owasp-crs-v030301-id942310-sqli',
  'owasp-crs-v030301-id942330-sqli',
  'owasp-crs-v030301-id942340-sqli',
  'owasp-crs-v030301-id942361-sqli',
  'owasp-crs-v030301-id942370-sqli',
  'owasp-crs-v030301-id942380-sqli',
  'owasp-crs-v030301-id942390-sqli',
  'owasp-crs-v030301-id942400-sqli',
  'owasp-crs-v030301-id942410-sqli',
  'owasp-crs-v030301-id942470-sqli',
  'owasp-crs-v030301-id942480-sqli',
  'owasp-crs-v030301-id942430-sqli',
  'owasp-crs-v030301-id942440-sqli',
  'owasp-crs-v030301-id942450-sqli',
  'owasp-crs-v030301-id942510-sqli',
  'owasp-crs-v030301-id942251-sqli',
  'owasp-crs-v030301-id942490-sqli',
  'owasp-crs-v030301-id942420-sqli',
  'owasp-crs-v030301-id942431-sqli',
  'owasp-crs-v030301-id942460-sqli',
  'owasp-crs-v030301-id942511-sqli',
  'owasp-crs-v030301-id942421-sqli',
  'owasp-crs-v030301-id942432-sqli']
)
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>SQLi sensitivity level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('sqli-v33-stable',
 ['owasp-crs-v030301-id942251-sqli',
  'owasp-crs-v030301-id942490-sqli',
  'owasp-crs-v030301-id942420-sqli',
  'owasp-crs-v030301-id942431-sqli',
  'owasp-crs-v030301-id942460-sqli',
  'owasp-crs-v030301-id942511-sqli',
  'owasp-crs-v030301-id942421-sqli',
  'owasp-crs-v030301-id942432-sqli']
)</pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>SQLi sensitivity level 3</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('sqli-v33-stable',
        ['owasp-crs-v030301-id942421-sqli',
         'owasp-crs-v030301-id942432-sqli']
         )</pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>SQLi sensitivity level 4</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('sqli-v33-stable')</pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Cross-site scripting (XSS)" id="cross-site_scripting_xss">Cross-site scripting (XSS)</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the XSS preconfigured rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_2"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941110-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 1: Script Tag Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941120-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 2: Event Handler Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941130-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 3: Attribute Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941140-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 4: JavaScript URI Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941160-xss</code></td>
<td>1</td>
<td>NoScript XSS InjectionChecker: HTML Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941170-xss</code></td>
<td>1</td>
<td>NoScript XSS InjectionChecker: Attribute Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941180-xss</code></td>
<td>1</td>
<td>Node-Validator Blacklist Keywords</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941190-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941200-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941210-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941220-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941230-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941240-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941250-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941260-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941270-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941280-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941290-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941300-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941310-xss</code></td>
<td>1</td>
<td>US-ASCII Malformed Encoding XSS Filter - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941350-xss</code></td>
<td>1</td>
<td>UTF-7 Encoding IE XSS - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941360-xss</code></td>
<td>1</td>
<td>Hieroglyphy obfuscation detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941370-xss</code></td>
<td>1</td>
<td>JavaScript global variable found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941150-xss</code></td>
<td>2</td>
<td>XSS Filter - Category 5: Disallowed HTML Attributes</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941320-xss</code></td>
<td>2</td>
<td>Possible XSS Attack Detected - HTML Tag Handler</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941330-xss</code></td>
<td>2</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941340-xss</code></td>
<td>2</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941380-xss</code></td>
<td>2</td>
<td>AngularJS client side template injection detected</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_2"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941110-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 1: Script Tag Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941120-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 2: Event Handler Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941130-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 3: Attribute Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941140-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 4: JavaScript URI Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941160-xss</code></td>
<td>1</td>
<td>NoScript XSS InjectionChecker: HTML Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941170-xss</code></td>
<td>1</td>
<td>NoScript XSS InjectionChecker: Attribute Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941180-xss</code></td>
<td>1</td>
<td>Node-Validator Blacklist Keywords</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941190-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941200-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941210-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941220-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941230-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941240-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941250-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941260-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941270-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941280-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941290-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941300-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941310-xss</code></td>
<td>1</td>
<td>US-ASCII Malformed Encoding XSS Filter - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941350-xss</code></td>
<td>1</td>
<td>UTF-7 Encoding IE XSS - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>JSFuck / Hieroglyphy obfuscation detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>JavaScript global variable found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941150-xss</code></td>
<td>2</td>
<td>XSS Filter - Category 5: Disallowed HTML Attributes</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941320-xss</code></td>
<td>2</td>
<td>Possible XSS Attack Detected - HTML Tag Handler</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941330-xss</code></td>
<td>2</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941340-xss</code></td>
<td>2</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>AngularJS client side template injection detected</td>
</tr>
</tbody>
</table></section>
</div>
<p>To configure a rule at a particular sensitivity level, disable the signatures
at greater sensitivity levels.</p>
<table>
<thead>
<tr>
<th>XSS sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('xss-v33-stable',
['owasp-crs-v030301-id941150-xss',
  'owasp-crs-v030301-id941320-xss',
  'owasp-crs-v030301-id941330-xss',
  'owasp-crs-v030301-id941340-xss',
  'owasp-crs-v030301-id941380-xss'
])
          </pre>
</p></td>
</tr>
</tbody>
</table>
<p><br/>
All signatures for XSS are below sensitivity level 2. The following
configuration works for other sensitivity levels:</p>
<table>
<thead>
<tr>
<th>XSS sensitivity level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('xss-v33-stable')</pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Local file inclusion (LFI)" id="local_file_inclusion_lfi">Local file inclusion (LFI)</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the LFI preconfigured rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_3"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id930100-lfi</code></td>
<td>1</td>
<td>Path Traversal Attack (/../)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id930110-lfi</code></td>
<td>1</td>
<td>Path Traversal Attack (/../)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id930120-lfi</code></td>
<td>1</td>
<td>OS File Access Attempt</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id930130-lfi</code></td>
<td>1</td>
<td>Restricted File Access Attempt</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_3"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id930100-lfi</code></td>
<td>1</td>
<td>Path Traversal Attack (/../)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id930110-lfi</code></td>
<td>1</td>
<td>Path Traversal Attack (/../)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id930120-lfi</code></td>
<td>1</td>
<td>OS File Access Attempt</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id930130-lfi</code></td>
<td>1</td>
<td>Restricted File Access Attempt</td>
</tr>
</tbody>
</table></section>
</div>
<p>All signatures for LFI are at sensitivity level 1. The following configuration
works for all sensitivity levels:</p>
<table>
<thead>
<tr>
<th>LFI sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('lfi-v33-canary')</pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Remote code execution (RCE)" id="remote_code_execution_rce">Remote code execution (RCE)</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the RCE preconfigured rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_4"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932100-rce</code></td>
<td>1</td>
<td>UNIX Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932105-rce</code></td>
<td>1</td>
<td>UNIX Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932110-rce</code></td>
<td>1</td>
<td>Windows Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932115-rce</code></td>
<td>1</td>
<td>Windows Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932120-rce</code></td>
<td>1</td>
<td>Windows PowerShell Command Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932130-rce</code></td>
<td>1</td>
<td>Unix Shell Expression Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932140-rce</code></td>
<td>1</td>
<td>Windows FOR/IF Command Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932150-rce</code></td>
<td>1</td>
<td>Direct UNIX Command Execution</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932160-rce</code></td>
<td>1</td>
<td>UNIX Shell Code Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932170-rce</code></td>
<td>1</td>
<td>Shellshock (CVE-2014-6271)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932171-rce</code></td>
<td>1</td>
<td>Shellshock (CVE-2014-6271)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932180-rce</code></td>
<td>1</td>
<td>Restricted File Upload Attempt</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932200-rce</code></td>
<td>2</td>
<td>RCE Bypass Technique</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932106-rce</code></td>
<td>3</td>
<td>Remote Command Execution: Unix Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932190-rce</code></td>
<td>3</td>
<td>Remote Command Execution: Wildcard bypass technique attempt</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_4"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932100-rce</code></td>
<td>1</td>
<td>UNIX Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932105-rce</code></td>
<td>1</td>
<td>UNIX Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932110-rce</code></td>
<td>1</td>
<td>Windows Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932115-rce</code></td>
<td>1</td>
<td>Windows Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932120-rce</code></td>
<td>1</td>
<td>Windows PowerShell Command Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932130-rce</code></td>
<td>1</td>
<td>Unix Shell Expression Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932140-rce</code></td>
<td>1</td>
<td>Windows FOR/IF Command Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932150-rce</code></td>
<td>1</td>
<td>Direct UNIX Command Execution</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932160-rce</code></td>
<td>1</td>
<td>UNIX Shell Code Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932170-rce</code></td>
<td>1</td>
<td>Shellshock (CVE-2014-6271)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932171-rce</code></td>
<td>1</td>
<td>Shellshock (CVE-2014-6271)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>Restricted File Upload Attempt</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>RCE Bypass Technique</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>3</td>
<td>Remote Command Execution: Unix Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>3</td>
<td>Remote Command Execution: Wildcard bypass technique attempt</td>
</tr>
</tbody>
</table></section>
</div>
<p>All signatures for RCE are at sensitivity level 1. The following configuration
works for all sensitivity levels:</p>
<table>
<thead>
<tr>
<th>RCE sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('rce-v33-stable',
          ['owasp-crs-v030301-id932200-rce',
           'owasp-crs-v030301-id932106-rce',
           'owasp-crs-v030301-id932190-rce'])
          )</pre>
</p></td>
</tr>
</tbody>
</table>
<p>The following configuration works for other sensitivity levels:</p>
<table>
<thead>
<tr>
<th>RCE sensitivity level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('rce-v33-stable',
          ['owasp-crs-v030301-id932106-rce',
           'owasp-crs-v030301-id932190-rce'])
          )
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>RCE sensitivity level 3</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('rce-v33-stable')
          </pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Remote file inclusion (RFI)" id="remote_file_inclusion_rfi">Remote file inclusion (RFI)</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the RFI preconfigured rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_5"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="22.5%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id931100-rfi</code></td>
<td>1</td>
<td>URL Parameter using IP Address</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id931110-rfi</code></td>
<td>1</td>
<td>Common RFI Vulnerable Parameter Name used w/URL Payload</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id931120-rfi</code></td>
<td>1</td>
<td>URL Payload Used w/Trailing Question Mark Character (?)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id931130-rfi</code></td>
<td>2</td>
<td>Off-Domain Reference/Link</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_5"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="22.5%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id931100-rfi</code></td>
<td>1</td>
<td>URL Parameter using IP Address</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id931110-rfi</code></td>
<td>1</td>
<td>Common RFI Vulnerable Parameter Name used w/URL Payload</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id931120-rfi</code></td>
<td>1</td>
<td>URL Payload Used w/Trailing Question Mark Character (?)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id931130-rfi</code></td>
<td>2</td>
<td>Off-Domain Reference/Link</td>
</tr>
</tbody>
</table></section>
</div>
<p>To configure a rule at a particular sensitivity level, disable the signatures
at greater sensitivity levels.</p>
<table>
<thead>
<tr>
<th>RFI sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('rfi-v33-canary', ['owasp-crs-v030301-id931130-rfi'])</pre>
</p></td>
</tr>
</tbody>
</table>
<p>All signatures for RFI are below sensitivity level 2. The following
configuration works for other sensitivity levels:</p>
<table>
<thead>
<tr>
<th>RFI sensitivity level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('rfi-v33-stable')</pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Method enforcement" id="method_enforcement">Method enforcement</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the method enforcement preconfigured
rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_6"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id911100-methodenforcement</code></td>
<td>1</td>
<td>Method is not allowed by policy</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_6"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id911100-methodenforcement</code></td>
<td>1</td>
<td>Method is not allowed by policy</td>
</tr>
</tbody>
</table></section>
</div>
<p>All signatures for Method Enforcement are below sensitivity level 2. The following
configuration works for other sensitivity levels:</p>
<table>
<thead>
<tr>
<th>Method Enforcement sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('methodenforcement-v33-stable')</pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Scanner detection" id="scanner_detection">Scanner detection</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the scanner detection preconfigured
rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_7"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id913100-scannerdetection</code></td>
<td>1</td>
<td>Found User-Agent associated with security scanner</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id913110-scannerdetection</code></td>
<td>1</td>
<td>Found request header associated with security scanner</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id913120-scannerdetection</code></td>
<td>1</td>
<td>Found request filename/argument associated with security scanner</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id913101-scannerdetection</code></td>
<td>2</td>
<td>Found User-Agent associated with scripting/generic HTTP client</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id913102-scannerdetection</code></td>
<td>2</td>
<td>Found User-Agent associated with web crawler/bot</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_7"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id913100-scannerdetection</code></td>
<td>1</td>
<td>Found User-Agent associated with security scanner</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id913110-scannerdetection</code></td>
<td>1</td>
<td>Found request header associated with security scanner</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id913120-scannerdetection</code></td>
<td>1</td>
<td>Found request filename/argument associated with security scanner</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id913101-scannerdetection</code></td>
<td>2</td>
<td>Found User-Agent associated with scripting/generic HTTP client</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id913102-scannerdetection</code></td>
<td>2</td>
<td>Found User-Agent associated with web crawler/bot</td>
</tr>
</tbody>
</table></section>
</div>
<p>To configure a rule at a particular sensitivity level, disable the signatures
at greater sensitivity levels.</p>
<table>
<thead>
<tr>
<th>Scanner Detection sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('scannerdetection-v33-stable',
  ['owasp-crs-v030301-id913101-scannerdetection',
  'owasp-crs-v030301-id913102-scannerdetection']
)
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Scanner Detection sensitivity level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('scannerdetection-v33-stable')
          </pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Protocol attack" id="protocol_attack">Protocol attack</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the protocol attack preconfigured
rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_8"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>HTTP Request Smuggling Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921110-protocolattack</code></td>
<td>1</td>
<td>HTTP Request Smuggling Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921120-protocolattack</code></td>
<td>1</td>
<td>HTTP Response Splitting Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921130-protocolattack</code></td>
<td>1</td>
<td>HTTP Response Splitting Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921140-protocolattack</code></td>
<td>1</td>
<td>HTTP Header Injection Attack via headers</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921150-protocolattack</code></td>
<td>1</td>
<td>HTTP Header Injection Attack via payload (CR/LF detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921160-protocolattack</code></td>
<td>1</td>
<td>HTTP Header Injection Attack via payload (CR/LF and header-name detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921190-protocolattack</code></td>
<td>1</td>
<td>HTTP Splitting (CR/LF in request filename detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921200-protocolattack</code></td>
<td>1</td>
<td>LDAP Injection Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921151-protocolattack</code></td>
<td>2</td>
<td>HTTP Header Injection Attack via payload (CR/LF detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921170-protocolattack</code></td>
<td>3</td>
<td>HTTP Parameter Pollution</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_8"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921100-protocolattack</code></td>
<td>1</td>
<td>HTTP Request Smuggling Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921110-protocolattack</code></td>
<td>1</td>
<td>HTTP Request Smuggling Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921120-protocolattack</code></td>
<td>1</td>
<td>HTTP Response Splitting Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921130-protocolattack</code></td>
<td>1</td>
<td>HTTP Response Splitting Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921140-protocolattack</code></td>
<td>1</td>
<td>HTTP Header Injection Attack via headers</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921150-protocolattack</code></td>
<td>1</td>
<td>HTTP Header Injection Attack via payload (CR/LF detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921160-protocolattack</code></td>
<td>1</td>
<td>HTTP Header Injection Attack via payload (CR/LF and header-name detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>HTTP Splitting (CR/LF in request filename detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>LDAP Injection Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921151-protocolattack</code></td>
<td>2</td>
<td>HTTP Header Injection Attack via payload (CR/LF detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921170-protocolattack</code></td>
<td>3</td>
<td>HTTP Parameter Pollution</td>
</tr>
</tbody>
</table></section>
</div>
<p>To configure a rule at a particular sensitivity level, disable the signatures
at greater sensitivity levels.</p>
<table>
<thead>
<tr>
<th>Protocol Attack sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('protocolattack-v33-stable',
  ['owasp-crs-v030301-id921151-protocolattack',
  'owasp-crs-v030301-id921170-protocolattack']
)
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Protocol Attack sensitivity level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('protocolattack-v33-stable',
  ['owasp-crs-v030301-id921170-protocolattack']
)
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Protocol Attack sensitivity level 3</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('protocolattack-v33-stable')
          </pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="PHP" id="php">PHP</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the PHP preconfigured rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_9"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933100-php</code></td>
<td>1</td>
<td>PHP Injection Attack: PHP Open Tag Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933110-php</code></td>
<td>1</td>
<td>PHP Injection Attack: PHP Script File Upload Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933120-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Configuration Directive Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933130-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Variables Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933140-php</code></td>
<td>1</td>
<td>PHP Injection Attack: I/O Stream Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933200-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Wrapper scheme detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933150-php</code></td>
<td>1</td>
<td>PHP Injection Attack: High-Risk PHP Function Name Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933160-php</code></td>
<td>1</td>
<td>PHP Injection Attack: High-Risk PHP Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933170-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Serialized Object Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933180-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Variable Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933210-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Variable Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933151-php</code></td>
<td>2</td>
<td>PHP Injection Attack: Medium-Risk PHP Function Name Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933131-php</code></td>
<td>3</td>
<td>PHP Injection Attack: Variables Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933161-php</code></td>
<td>3</td>
<td>PHP Injection Attack: Low-Value PHP Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933111-php</code></td>
<td>3</td>
<td>PHP Injection Attack: PHP Script File Upload Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933190-php</code></td>
<td>3</td>
<td>PHP Injection Attack: PHP Closing Tag Found</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_9"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933100-php</code></td>
<td>1</td>
<td>PHP Injection Attack: PHP Open Tag Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933110-php</code></td>
<td>1</td>
<td>PHP Injection Attack: PHP Script File Upload Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933120-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Configuration Directive Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933130-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Variables Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933140-php</code></td>
<td>1</td>
<td>PHP Injection Attack: I/O Stream Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>PHP Injection Attack: Wrapper scheme detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933150-php</code></td>
<td>1</td>
<td>PHP Injection Attack: High-Risk PHP Function Name Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933160-php</code></td>
<td>1</td>
<td>PHP Injection Attack: High-Risk PHP Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933170-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Serialized Object Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933180-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Variable Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>PHP Injection Attack: Variable Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933151-php</code></td>
<td>2</td>
<td>PHP Injection Attack: Medium-Risk PHP Function Name Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933131-php</code></td>
<td>3</td>
<td>PHP Injection Attack: Variables Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933161-php</code></td>
<td>3</td>
<td>PHP Injection Attack: Low-Value PHP Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933111-php</code></td>
<td>3</td>
<td>PHP Injection Attack: PHP Script File Upload Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>3</td>
<td>PHP Injection Attack: PHP Closing Tag Found</td>
</tr>
</tbody>
</table></section>
</div>
<p>To configure a rule at a particular sensitivity level, disable the signatures
at greater sensitivity levels.</p>
<table>
<thead>
<tr>
<th>PHP Injection Attack sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('php-v33-stable',
['owasp-crs-v030301-id933151-php',
  'owasp-crs-v030301-id933131-php',
  'owasp-crs-v030301-id933161-php',
  'owasp-crs-v030301-id933111-php',
  'owasp-crs-v030301-id933190-php']
)
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>PHP Injection Attack sensitivity level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('php-v33-stable',
  ['owasp-crs-v0303001-id933131-php',
  'owasp-crs-v0303001-id933161-php',
  'owasp-crs-v0303001-id933111-php'
  'owasp-crs-v030301-id933190-php'])
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>PHP Injection Attack sensitivity level 3</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('php-v33-stable')
          </pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Session fixation" id="session_fixation">Session fixation</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the session fixation preconfigured
rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_10"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id943100-sessionfixation</code></td>
<td>1</td>
<td>Possible Session Fixation Attack: Setting Cookie Values in HTML</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id943110-sessionfixation</code></td>
<td>1</td>
<td>Possible Session Fixation Attack: SessionID Parameter Name with Off-Domain Referer</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id943120-sessionfixation</code></td>
<td>1</td>
<td>Possible Session Fixation Attack: SessionID Parameter Name with No Referer</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_10"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id943100-sessionfixation</code></td>
<td>1</td>
<td>Possible Session Fixation Attack: Setting Cookie Values in HTML</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id943110-sessionfixation</code></td>
<td>1</td>
<td>Possible Session Fixation Attack: SessionID Parameter Name with Off-Domain Referer</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id943120-sessionfixation</code></td>
<td>1</td>
<td>Possible Session Fixation Attack: SessionID Parameter Name with No Referer</td>
</tr>
</tbody>
</table></section>
</div>
<p>All signatures for Session Fixation are below sensitivity level 2. The following
configuration works for other sensitivity levels:</p>
<table>
<thead>
<tr>
<th>Session Fixation sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('sessionfixation-v33-canary')</pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="CVEs and other vulnerabilities" id="cves_and_other_vulnerabilities">CVEs and other vulnerabilities</h3>
<p>The following signatures cover the <code dir="ltr" translate="no">CVE-2021-44228</code> and <code dir="ltr" translate="no">CVE-2021-45046</code> Log4j
RCE Vulnerabilities.</p>
<table>
<thead>
<tr>
<th width="30%">Signature ID (Rule ID)</th>
<th width="20%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id044228-cve</code></td>
<td>1</td>
<td>Base rule to help detect exploit attempts of <code dir="ltr" translate="no">CVE-2021-44228</code>
          &amp; <code dir="ltr" translate="no">CVE-2021-45046</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id144228-cve</code></td>
<td>1</td>
<td>Google-provided enhancements to cover more bypass and obfuscation attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id244228-cve</code></td>
<td>3</td>
<td>Increased sensitivity of detection to target even more bypass and
           obfuscation attempts, with nominal increase in risk of false positive detection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id344228-cve</code></td>
<td>3</td>
<td>Increased sensitivity of detection to target even more bypass and
           obfuscation attempts using base64 encoding, with nominal increase in risk of false positive detection</td>
</tr>
</tbody>
</table>
<p>To configure a rule at a particular sensitivity level, disable the signatures at greater sensitivity levels.</p>
<table>
<thead>
<tr>
<th>CVE sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('cve-canary', ['owasp-crs-v030001-id244228-cve',
  'owasp-crs-v030001-id344228-cve'])
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>CVE sensitivity level 3</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('cve-canary')</pre>
</p></td>
</tr>
</tbody>
</table>
<h2 data-text="Limitations" id="limitations">Limitations</h2>
<p>Google Cloud Armor preconfigured rules have the following limitations:</p>
<ul>
<li>Among the HTTP request types with a request body, Google Cloud Armor
processes only <code dir="ltr" translate="no">POST</code> requests. Google Cloud Armor evaluates preconfigured
rules against the first 8 KB of <code dir="ltr" translate="no">POST</code> body content. For more information, see
<a href="/armor/docs/security-policy-overview#post-body"><code dir="ltr" translate="no">POST</code> body inspection limitation</a>.</li>
<li>Google Cloud Armor can parse and apply preconfigured WAF rules for default
URL-encoded and JSON-formatted <code dir="ltr" translate="no">POST</code> bodies (Content-Type='application/json').
However, Google Cloud Armor does not parse or decode other HTTP Content-Type
and Content-Encoding formats.</li>
<li>Google Cloud Armor security policies are available only for backend services
behind a load balancer. Therefore, load balancing quotas and limits apply to
your deployment. See the load balancing
<a href="/load-balancing/docs/quotas">quotas</a> page for more information.</li>
<li>The following ModSecurity CRS rule IDs are not supported by
Google Cloud Armor.
<ul>
<li>sqli-942100</li>
<li>sqli-942101</li>
<li>xss-941100</li>
<li>xss-941101</li>
</ul></li>
</ul>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/configure-security-policies">Configure security policies, rules, and expressions</a></li>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
<li><a href="/armor/docs/rules-language-reference">Use the custom rules language reference</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="mwETRvWii0eU5NUYprb0Y9z5GVbc" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/armor-named-ip]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor named IP address lists let you reference lists of IP
addresses and IP ranges that are maintained by third-party providers. You
can configure named IP address lists within a security policy. You do not have to
manually specify each IP address or IP range individually.</p>
<p>In this document, the terms <em>IP address</em> and <em>IP address list</em> include <em>IP
address ranges</em>.</p>
<p>Named IP address lists are lists of IP addresses grouped under
different names. The name typically refers to the provider. Named IP address
lists are not subject to the quota limit on the number of IP addresses per rule.</p>
<p>Named IP address lists are not security policies. You incorporate them
into a security policy by referencing them as expressions the same way that you
reference a preconfigured rule.</p>
<p>For example, if a third-party provider has an IP address list of <code dir="ltr" translate="no">{ip1, ip2,
ip3....ip_N_}</code> under the name <code dir="ltr" translate="no">provider-a</code>, you can create a security rule that
allows all IP addresses that are in the <code dir="ltr" translate="no">provider-a</code> list and excludes IP
addresses that are not in that list:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud beta compute security-policies rules create 1000 \
    --security-policy <var translate="no">POLICY_NAME</var> \
    --expression "evaluatePreconfiguredExpr('provider-a')" \
    --action "allow"
</pre>
<p>You cannot create your own custom named IP address lists. This feature is
available only with respect to named IP address lists that are maintained by
third-party providers that partner with Google. If such named IP address lists
do not meet your needs, you can create a security policy where the rules allow
or deny access to your resources based on the IP address from which requests
originate. For more information, see <a href="/armor/docs/configure-security-policies">Configuring security
policies</a>.</p>
<p>To use named IP address lists, you must subscribe to
<a href="/armor/docs/managed-protection-overview">Google Cloud Armor Managed Protection</a> Plus and
enroll projects in Managed Protection. For more information, see
<a href="#named-ip-list-availability">Availability of named IP address lists</a>.</p>
<h2 data-text="Allowing traffic only from permitted third-party providers" id="ip-list-allow">Allowing traffic only from permitted third-party providers</h2>
<p>A typical use case is to create an allowlist containing the IP addresses of
a permitted third-party partner to ensure that only traffic coming from this
partner can access the load balancer and the backends.</p>
<p>For example, CDN providers need to pull content from origin servers at regular
intervals to distribute them to their own caches. A partnership with
Google provides a direct connection between CDN providers and the Google
network edge. CDN users on Google Cloud can use this direct connection
during origin pulls. In this case, the CDN user might want to build a security
policy that only allows traffic coming from that particular CDN provider.</p>
<p>In this example, a CDN provider publishes its IP address list
<code dir="ltr" translate="no">23.235.32.0/20, 43.249.72.0/22, ⋯,</code>. A CDN user configures a security rule
that only allows traffic coming from these IP addresses. As a result, two
CDN provider access points are allowed (<code dir="ltr" translate="no">23.235.32.10</code> and <code dir="ltr" translate="no">43.249.72.10</code>) and
their traffic is therefore permitted. Traffic from the unauthorized access point
<code dir="ltr" translate="no">198.51.100.1</code> is blocked.</p>
<figure style="text-align: center">
<a href="/armor/images/ca-named-ip.svg">
<img alt="Google Cloud Armor named IP address." border="0" src="/armor/images/ca-named-ip.svg"/></a>
<figcaption>Google Cloud Armor named IP address (click to
   enlarge)</figcaption>
</figure>
<h2 data-text="Simplifying configuration and management by using preconfigured rules" id="ip-list-simplify">Simplifying configuration and management by using preconfigured rules</h2>
<p>CDN providers often use IP addresses that are well-known and that many CDN
users need to use. These lists change over time, as providers add, remove, and
update the IP addresses.</p>
<p>Using a named IP address list in a security policy rule simplifies the process
of configuring and managing IP addresses because Google Cloud Armor
automatically synchronizes information from CDN providers on a daily basis.
This eliminates the time-consuming and error-prone process of maintaining a
large IP address list manually.</p>
<p>The following is an example of a preconfigured rule that allows all traffic
from a provider:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
evaluatePreconfiguredExpr('provider-a') =&gt; allow traffic
</pre>
<h2 data-text="IP address list providers" id="ip-list-providers">IP address list providers</h2>
<p>The IP address list providers in the following table are supported for
Google Cloud Armor. These are CDN providers that have partnered with
Google. Their IP address lists are published through individual public URLs.</p>
<p>These partners provide separate lists of IPv4 addresses and IPv6 addresses.
Google Cloud Armor uses the provided URLs to fetch lists, and then converts the
lists into named IP address lists. You refer to the lists by the names in the
table.</p>
<p>For example, the following code creates a rule in the security policy
<code dir="ltr" translate="no"><var translate="no">POLICY_NAME</var></code> with priority 750, incorporating the named IP
address list from Cloudflare and allowing access from those IP addresses:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud beta compute security-policies rules create 750 \
    --security-policy <var translate="no">POLICY_NAME</var> \
    --expression "evaluatePreconfiguredExpr('sourceiplist-cloudflare')" \
    --action "allow"
</pre>
<table>
<thead>
<tr>
<th width="15%">Provider</th>
<th width="55%">URL(s)</th>
<th width="30%">IP address list name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fastly</td>
<td><code dir="ltr" translate="no">https://api.fastly.com/public-ip-list</code></td>
<td><code dir="ltr" translate="no">sourceiplist-fastly</code></td>
</tr>
<tr>
<td>Cloudflare</td>
<td>
<p><code dir="ltr" translate="no">https://www.cloudflare.com/ips-v4</code></p>
<p><code dir="ltr" translate="no">https://www.cloudflare.com/ips-v6</code></p>
</td>
<td><code dir="ltr" translate="no">sourceiplist-cloudflare</code></td>
</tr>
<tr>
<td>Imperva</td>
<td>
<p><code dir="ltr" translate="no">https://my.imperva.com/api/integration/v1/ips</code></p>
<p>Access to Imperva's list requires a <code dir="ltr" translate="no">POST</code> request. You
          can use the following command as well:</p>
<p><code dir="ltr" translate="no">curl -d "" https://my.imperva.com/api/integration/v1/ips</code></p>
</td>
<td><code dir="ltr" translate="no">sourceiplist-imperva</code></td>
</tr>
</tbody>
</table>
<p>To list the preconfigured named IP address lists , use this <code dir="ltr" translate="no">gcloud</code> command:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies list-preconfigured-expression-sets \
    --filter="id:sourceiplist"
</pre>
<p>This returns:</p>
<pre dir="ltr" translate="no">
EXPRESSION_SET
sourceiplist-fastly
sourceiplist-cloudflare
sourceiplist-imperva
</pre>
<h2 data-text="Synchronizing IP address lists" id="ip-list-sync">Synchronizing IP address lists</h2>
<p>Google Cloud Armor synchronizes IP address lists with each provider only
when it detects changes that are in a valid format. Google Cloud Armor
performs basic syntax validation on the IP addresses in all lists.</p>
<h2 data-text="Availability of named IP address lists" id="named-ip-list-availability">Availability of named IP address lists</h2>
<p><a href="/armor/docs/managed-protection-using">Google Cloud Armor Managed Protection Plus</a> is in general
availability. Third-party named IP address lists availability is as follows:</p>
<ol>
<li>If you are subscribed to Google Cloud Armor Managed Protection Plus tier, you are licensed to
use named IP address lists in enrolled projects. You can create, update,
and delete rules with named IP address lists.</li>
<li>If your Google Cloud Armor Managed Protection Plus tier subscription expires or you otherwise
return to Standard tier, you cannot add or modify rules with named IP address
lists, but you can delete existing rules and update rules to remove a named
IP list.</li>
<li>In projects that already include rules with named IP address lists, but which
you did not enroll in Google Cloud Armor Managed Protection Plus, you can continue to use,
update, and delete existing rules with named IP address lists. In such
projects, you can create new rules that incorporate named IP address lists.</li>
</ol>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/configure-security-policies">Configure Google Cloud Armor security policies</a></li>
<li><a href="/armor/docs/managed-protection-overview">View pricing for Managed Protection tiers</a></li>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/bot-management]</H1></p><div class="devsite-article-body clearfix">
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
<p>Google Cloud Armor and <a href="/recaptcha-enterprise/docs/overview">reCAPTCHA Enterprise</a>
provide tools to help you evaluate and act on incoming requests that might be
from automated clients.</p>
<p>reCAPTCHA Enterprise uses advanced risk analysis techniques to distinguish
between human users and automated clients.
reCAPTCHA Enterprise assesses the user based on the configuration of
the reCAPTCHA WAF site keys. It then issues an encrypted token with attributes
that represent the associated risk. Google Cloud Armor deciphers this token
in-line, without an additional request/response to the reCAPTCHA Enterprise
service. Based on the token attributes, Google Cloud Armor lets you allow,
deny, rate-limit or redirect the incoming requests. For more information, see
the
<a href="/recaptcha-enterprise/docs/integration-overview">Google Cloud Armor and reCAPTCHA Enterprise integration overview</a>.</p>
<p>Google Cloud Armor's bot management includes the following integrated
capabilities.</p>
<ul>
<li>Manual challenge (reCAPTCHA challenge page)
<ul>
<li>You can permit only end-users who pass the reCAPTCHA Enterprise
manual challenge by redirecting end-users for reCAPTCHA Enterprise
assessment.</li>
<li>We recommend that you create your own reCAPTCHA WAF site key and associate
it with your security policy.
For more information, see
<a href="/recaptcha-enterprise/docs/implement-tokens#redirect">Implement a reCAPTCHA challenge</a>.</li>
<li>You must configure a security policy rule to redirect a request for
reCAPTCHA Enterprise assessment.</li>
</ul></li>
<li>Enforce reCAPTCHA Enterprise frictionless assessment
<ul>
<li>You can take different actions on incoming requests based on
reCAPTCHA Enterprise's assessment of the risk that the request
originates from a bot. You can write security policy rules to evaluate and
filter traffic based on the token score and other token attributes.</li>
<li>Google Cloud Armor security policy evaluation happens at the edge of
Google's network, so your backends are not involved in deciphering the token.</li>
<li>You must choose between using reCAPTCHA Enterprise action-tokens or
session-tokens, and then create your own reCAPTCHA WAF site key, before
you implement reCAPTCHA Enterprise. For more
information, see
<a href="/recaptcha-enterprise/docs/implement-tokens#action-tokens">Implementing reCAPTCHA action-tokens</a>
and
<a href="/recaptcha-enterprise/docs/implement-tokens#session-tokens">Implementing reCAPTCHA session-tokens</a>.</li>
<li>You must configure a security policy rule that evaluates
reCAPTCHA Enterprise tokens.</li>
</ul></li>
</ul>
<p>Google Cloud Armor bot management also includes the following
capabilities.</p>
<ul>
<li>Redirect (302)
<ul>
<li>You can redirect requests to your configured alternative URL by configuring
Google Cloud Armor to serve an HTTP 302 response to the client.</li>
</ul></li>
<li>Decorate request
<ul>
<li>You can insert custom headers in requests, and static values into those
headers, before proxying a requests to your backends.</li>
</ul></li>
</ul>
<h2 data-text="Use cases" id="use_cases">Use cases</h2>
<p>This section describes how you can use Google Cloud Armor bot management
capabilities to mitigate bot risk and to control access from automated clients.</p>
<h3 data-text="Use a manual challenge to distinguish between legitimate users and automated clients" id="use_a_manual_challenge_to_distinguish_between_legitimate_users_and_automated_clients">Use a manual challenge to distinguish between legitimate users and automated clients</h3>
<p>You can redirect a request to reCAPTCHA Enterprise to assess the end-client
and serve manual challenges if necessary, without any additional
reCAPTCHA Enterprise implementation. When human users share the same
signature (such as URL paths or other L7 signatures) as a bot or an abusive
system, this action provides a way for them to prove that they are human. Only
users who pass the assessment can gain access to your service.</p>
<p>The following diagram shows how a manual challenge distinguishes whether a
request comes from a human or an automated client:</p>
<figure style="text-align: center">
<a href="/armor/images/redirect-to-recaptcha.svg">
<img alt="Example of redirecting to reCAPTCHA." border="0" src="/armor/images/redirect-to-recaptcha.svg" width="700"/></a>
<figcaption>Example of redirecting to reCAPTCHA (click to
   enlarge)</figcaption>
</figure>
<p>Suppose a user Maya and a bot are both browsing the login page
(<code dir="ltr" translate="no">/login.html</code>) on your site. To allow access to Maya without
granting access to the bot, you can configure a security policy rule with the
advanced match expression <code dir="ltr" translate="no">request.path.matches("/login.html")</code>, with a
<code dir="ltr" translate="no">redirect</code> action of type <code dir="ltr" translate="no">GOOGLE_RECAPTCHA</code>. The end-to-end user experience
is as follows:</p>
<ol>
<li>An end user visits your site for the first time.</li>
<li>Google Cloud Armor evaluates the request, and determines to
redirect it to reCAPTCHA Enterprise.</li>
<li>reCAPTCHA Enterprise responds with an HTML page with the
reCAPTCHA Enterprise JavaScript embedded.</li>
<li>When the response is rendered, the embedded JavaScript runs to assess the user,
and serves manual challenges if necessary.
<ul>
<li>If the user passes the assessment, reCAPTCHA Enterprise issues an
exemption cookie, which is auto-attached by the browser to each of
the subsequent requests to the same site until the cookie expires.</li>
<li>Otherwise, reCAPTCHA Enterprise does not issue an exemption cookie.</li>
</ul></li>
</ol>
<p>In this example, only Maya passes reCAPTCHA Enterprise assessment and
receives an exemption cookie, gaining access to your site.</p>
<p>When you use manual challenges, we recommend that you create your own
reCAPTCHA WAF site key and associate it with the security policy.
This lets you view reCAPTCHA Enterprise metrics associated with the
site key and train a security model specific to the site key. For more
information, see
<a href="/recaptcha-enterprise/docs/implement-tokens#redirect">Create reCAPTCHA WAF challenge site key</a>.</p>
<p>If you do not create and associate a site key, reCAPTCHA Enterprise uses
a Google-managed site key during assessment. You cannot view reCAPTCHA metrics
associated with site keys that you don't own, including Google-managed site
keys.</p>
<h3 data-text="Enforce reCAPTCHA Enterprise assessment" id="enforce-bot-assessment">Enforce reCAPTCHA Enterprise assessment</h3>
<p>When there is a reCAPTCHA Enterprise token attached to an incoming request,
Google Cloud Armor evaluates the request and applies the configured action
based on the individual attributes in the token.</p>
<h4 data-text="reCAPTCHA Enterprise tokens" id="recaptcha-tokens">reCAPTCHA Enterprise tokens</h4>
<p>reCAPTCHA Enterprise issues two types of tokens: action-tokens and
session-tokens. Both types of token return a score for each request based on the
interactions with your site. Both types of token contain attributes, including a
score that represents the risk associated with the user.</p>
<p>Before you configure security policy rules, you must decide whether to use
action-tokens, session-tokens, or both. We recommend reading the
reCAPTCHA Enterprise documentation to inform your decision. See the
<a href="/recaptcha-enterprise/docs/usecase">reCAPTCHA Enterprise use case comparison</a> for
more information.</p>
<p>After determining which type of token you want to use, you implement
reCAPTCHA Enterprise for the token to be attached with a
request. For information on implementing tokens in reCAPTCHA Enterprise, see
<a href="/recaptcha-enterprise/docs/implement-tokens#action-token">Implementing reCAPTCHA Enterprise action-tokens</a>
and
<a href="/recaptcha-enterprise/docs/implement-tokens#session-token">Implementing reCAPTCHA Enterprise session-tokens</a>.</p>
<p>Finally, use the Google Cloud Armor rules language to configure security
policy rules to evaluate reCAPTCHA Enterprise tokens that are attached
with the request.</p>
<p>The following figure demonstrates the reCAPTCHA Enterprise token enforcement
flow.</p>
<figure style="text-align: center">
<a href="/armor/images/enforce-recaptcha-token.svg">
<img alt="reCAPTCHA token enforcement flow." border="0" src="/armor/images/enforce-recaptcha-token.svg" width="700"/></a>
<figcaption>reCAPTCHA token enforcement flow (click to
   enlarge)</figcaption>
</figure>
<h3 data-text="Redirect (302 response)" id="redirect_302_response">Redirect (302 response)</h3>
<p>You can use a URL-based redirect action to externally redirect requests to a
different endpoint. You supply a redirect target in the form of a URL, and
Google Cloud Armor redirects the request by serving an HTTP 302 response to
the client.</p>
<h3 data-text="Decorate request" id="decorate_request">Decorate request</h3>
<p>Google Cloud Armor can insert custom request headers with static user-defined values before proxying the
requests to your application. This option allows you to tag suspicious
requests for alternative downstream processing, like serving a honey-pot, or for
additional analysis and monitoring. Note that this action
parameter must be added to an existing <code dir="ltr" translate="no">allow</code> action.</p>
<aside class="note"><strong>Note:</strong><span> If you have custom headers enabled, and if you choose the same header name
as one of the external HTTP(S) load balancer's custom headers, then the header value will be
overwritten by the HTTP(S) Load Balancing. See
<a href="/load-balancing/docs/https/custom-headers#variables">Creating custom headers in backend services</a>
for more information.</span></aside>
<p>In addition, if you choose a header name that already exists on the request,
including standard HTTP headers, then the original value in that header will be
overwritten by the user-defined value provided to the Google Cloud Armor rule.</p>
<h2 data-text="Integrate with rate limiting" id="integrate_with_rate_limiting">Integrate with rate limiting</h2>
<p>Google Cloud Armor rate limiting rules are compatible with bot management
capabilities. For example, you can redirect a request for reCAPTCHA Enterprise
assessment or redirect to a different URL when the number of requests exceeds
the configured threshold. In addition, you can identify clients for rate
limiting based on reCAPTCHA Enterprise exemption cookies or tokens, to
throttle requests or ban clients that reuse or abuse the same cookie or token
at a rate exceeding the user-configured threshold.</p>
<h3 data-text="Rate limit reCAPTCHA Enterprise exemption cookies or tokens" id="rate-limiting">Rate limit reCAPTCHA Enterprise exemption cookies or tokens</h3>
<p>For security, we recommend that you configure rate limiting rules to prevent
token abuse through multiple uses per unique reCAPTCHA action-token,
session-token, or exemption cookie. The following table illustrates how you can
identify a reCAPTCHA Enterprise exemption cookie or token as the key in a
rate limiting rule.</p>
<table>
<thead>
<tr>
<th width="20%">Resource</th>
<th width="40%"><code dir="ltr" translate="no">enforce_on_key</code></th>
<th width="40%"><code dir="ltr" translate="no">enforce_on_key_name</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Exemption cookie</td>
<td><code dir="ltr" translate="no">HTTP-COOKIE</code></td>
<td><code dir="ltr" translate="no">recaptcha-ca-e</code></td>
</tr>
<tr>
<td>Action-token</td>
<td><code dir="ltr" translate="no">HTTP-HEADER</code></td>
<td><code dir="ltr" translate="no">X-Recaptcha-Token</code></td>
</tr>
<tr>
<td>Session-token</td>
<td><code dir="ltr" translate="no">HTTP-COOKIE</code></td>
<td><code dir="ltr" translate="no">recaptcha-ca-t</code></td>
</tr>
</tbody>
</table>
<p>You can throttle requests or ban clients that depend on the same exemption
cookie or token, and that exceed the configured threshold. For more information
about rate limiting parameters, see
<a href="/armor/docs/rate-limiting-overview">Apply rate limiting</a>.</p>
<h4 data-text="Rate limiting examples" id="rate_limiting_examples">Rate limiting examples</h4>
<p>First, suppose that you only use manual challenges on selected URLs
(<code dir="ltr" translate="no">/login.html</code>, for example) on your site. To accomplish this, configure
security policy rules as follows:</p>
<ul>
<li>Rule 1: If there is a valid exemption cookie attached with the request and
the number of uses for the exemption cookie is under your defined threshold,
allow the request.</li>
<li>Rule 2: Redirect the request for reCAPTCHA Enterprise assessment.</li>
</ul>
<figure style="text-align: center">
<a href="/armor/images/recaptcha-redirect.svg">
<img alt="reCAPTCHA Enterprise redirect example." border="0" src="/armor/images/recaptcha-redirect.svg" width="700"/></a>
<figcaption>Enforce manual challenges (click to enlarge)</figcaption>
</figure>
<p>Second, suppose that you only use action-tokens and/or session-tokens on your site.
For example, you might use action-tokens to protect high-profile user actions,
like <code dir="ltr" translate="no">/login.html</code>. To do this, take actions based on the score from the
action-token as follows:</p>
<ul>
<li>Rule 1: When the score from the action-token is higher than a predefined threshold
(<code dir="ltr" translate="no">0.8</code>, for example), allow the request if the number of uses for the
action-token is under your defined threshold.</li>
<li>Rule 2: Deny the request.</li>
</ul>
<figure style="text-align: center">
<a href="/armor/images/recaptcha-action.svg">
<img alt="reCAPTCHA Enterprise action example." border="0" src="/armor/images/recaptcha-action.svg" width="700"/></a>
<figcaption>Enforce reCAPTCHA Enterprise action-token assessment (click to
   enlarge)</figcaption>
</figure>
<p>You can configure similar security policy rules to enforce
reCAPTCHA Enterprise session-token assessment.</p>
<p>Third, suppose that you combine action-tokens or session-tokens with manual challenges
on selected URLs (like <code dir="ltr" translate="no">/login.html</code>) on your site, and you want to take actions
based on the score from the action-token. And you want to give the user a second
chance by solving challenges if the score is not satisfactory enough. To do this,
configure security policy rules as follows:</p>
<ul>
<li>Rule 1: When the score from the action-token is higher than a predefined threshold
(<code dir="ltr" translate="no">0.8</code>, for example), allow the request if the number of uses for the
action-token is under your defined threshold.</li>
<li>Rules 2 and 3: When the score from the action-token is higher than a different predefined
threshold (<code dir="ltr" translate="no">0.5</code>, for example), redirect the request for
reCAPTCHA Enterprise assessment unless there is a valid exemption cookie
attached to the request and the number of uses for the exemption cookie is
under your defined threshold.</li>
<li>Rule 4: Deny the request.</li>
</ul>
<figure style="text-align: center">
<a href="/armor/images/recaptcha-action-and-redirect.svg">
<img alt="reCAPTCHA Enterprise action and redirect example." border="0" src="/armor/images/recaptcha-action-and-redirect.svg" width="700"/></a>
<figcaption>Enforce reCAPTCHA Enterprise action-token assessment with manual challenges (click to
   enlarge)</figcaption>
</figure>
<p>You can configure similar security policy rules to enforce
reCAPTCHA Enterprise session-token assessment with manual challenges.</p>
<p>If you do not configure the rate limiting rules as above, Google Cloud Armor
imposes no limit on the number of uses for each reCAPTCHA exemption cookie,
action-token, and session-token. For action-tokens, we recommend using a low
threshold (<code dir="ltr" translate="no">1</code>, for example) and a high time interval (<code dir="ltr" translate="no">30</code> minutes for example,
since action-tokens are valid for 30 minutes). We recommend that you derive the
threshold based on your traffic statistics.</p>
<h2 data-text="Limitations" id="limitations">Limitations</h2>
<ul>
<li>Google Cloud Armor bot management does not support the
Global external HTTP(S) load balancer (Preview) mode of operation.
To configure bot management with an HTTP(S) load balancer, use
Global external HTTP(S) load balancer (classic). For more information, see
<a href="/load-balancing/docs/https#load-balancer-mode">Modes of operation</a>.</li>
</ul>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/configure-security-policies#bot-management">Configure security policies</a></li>
<li><a href="/armor/docs/rules-language-reference">View the rules language reference</a></li>
<li><a href="/armor/docs/request-logging">View logs</a></li>
<li><a href="/armor/docs/troubleshooting#recaptcha">Troubleshoot problems</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/rate-limiting-overview]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor provides capabilities to help protect your Google Cloud applications
against a variety of Layer 3 and Layer 7 attacks. Rate-based rules help you
protect your applications from a large volume of requests that flood your
instances and block access for legitimate users.</p>
<p>Rate limiting can do the following:</p>
<ul>
<li>Prevent any particular client from exhausting application resources.</li>
<li>Protect your application instances from erratic and unpredictable spikes
in the rate of client requests.</li>
</ul>
<p>In addition, when a resource is presented with a high volume of traffic from a
small number of clients, you can prevent your other clients from being affected
by large spikes of traffic from that small number of clients, enabling your
resources to handle as many requests as possible.</p>
<p>Google Cloud Armor has two types of rate-based rules:</p>
<ol>
<li>Throttle: You can enforce a maximum request limit per client or across all
clients by throttling individual clients to a user-configured threshold.</li>
<li>Rate-based ban: You can rate limit requests that match a rule on a per-client
basis and then temporarily ban those clients for a configured period of time
if they exceed a user-configured threshold.</li>
</ol>
<p>You can preview the effects of rate limiting rules in a security policy by
using preview mode and examining your request logs.</p>
<h2 data-text="Identifying clients for rate limiting" id="identifying_clients_for_rate_limiting">Identifying clients for rate limiting</h2>
<p>Google Cloud Armor identifies individual clients for rate limiting by using
the following key types for aggregating requests and enforcing rate limits:</p>
<ul>
<li><strong>ALL</strong>: A single key for all clients whose requests satisfy the rule
match condition.</li>
<li><strong>IP</strong>: A unique key for each client source IP address whose requests
satisfy the rule match condition.</li>
<li><strong>HTTP-HEADER</strong>: A unique key for each unique HTTP header value whose name is
configured. The key value is truncated to the first 128 bytes of the header
value. The key type defaults to ALL if no such header is present, or if you
attempt to use this key type with an TCP proxy load balancer or SSL proxy load balancer.</li>
<li><strong>XFF-IP</strong>: A unique key for each original source IP address of the client,
that is, the first IP address in the list of IPs specified in the
<code dir="ltr" translate="no">X-Forwarded-Header</code> HTTP header. The key type defaults to IP address if no
such header is present, if the value is not a valid IP address, or if you
attempt to use this key type with an TCP proxy load balancer or SSL proxy load balancer.</li>
<li><strong>HTTP-COOKIE</strong>: A unique key for each HTTP cookie value whose name is
configured. The key value is truncated to the first 128 bytes of the cookie
value. The key type defaults to ALL if no such cookie is present, or if you
attempt to use this key type with an TCP proxy load balancer or SSL proxy load balancer.</li>
</ul>
<h2 data-text="Throttling traffic" id="throttle-traffic">Throttling traffic</h2>
<p>The <code dir="ltr" translate="no">throttle</code> action in a rule allows you to enforce a per-client request
threshold to protect backend services. This rule enforces the threshold to limit
traffic from each client that satisfies the match conditions in the rule. The
threshold is configured as a specified number of requests in a specified time
interval.</p>
<p>For example, you might set the request threshold to 2,000 requests within 1,200
seconds (20 minutes). If a client sends 2,500 requests within any 1,200 second
period, approximately 20% of the client's traffic is throttled until the
permitted request volume is at or below the configured threshold.</p>
<p>You set these parameters to control the action:</p>
<ul>
<li><code dir="ltr" translate="no">rate_limit_threshold</code>: The number of requests per client allowed within a
specified time interval. The minimum value is 1 and the maximum value is
10,000.
<ul>
<li><code dir="ltr" translate="no">interval_sec</code>: The number of seconds in the time interval. The value must be
60, 120, 180, 240, 300, 600, 900, 1200, 1800, 2700, or 3600 seconds.</li>
</ul></li>
<li><code dir="ltr" translate="no">exceed_action</code>: When a request exceeds the <code dir="ltr" translate="no">rate_limit_threshold</code>,
Google Cloud Armor applies the configured <code dir="ltr" translate="no">exceed_action</code>. Possible values
for the <code dir="ltr" translate="no">exceed_action</code> are as follows:
<ul>
<li><code dir="ltr" translate="no">deny(status)</code>: The request is denied and the specified error code is
returned (valid values are 403, 404, 429 and 502). We recommend using the
<code dir="ltr" translate="no">429 (Too Many Requests)</code> response code.</li>
<li><code dir="ltr" translate="no">redirect</code>: The request is either redirected for reCAPTCHA Enterprise
assessment or to a different URL, based on the <code dir="ltr" translate="no">exceed_redirect_options</code>
parameter.</li>
</ul></li>
<li><code dir="ltr" translate="no">exceed_redirect_options</code>: When the <code dir="ltr" translate="no">exceed_action</code> is <code dir="ltr" translate="no">redirect</code>, use this
parameter to specify the redirect action:
<ul>
<li><code dir="ltr" translate="no">type</code>: Type for the redirect action, either <code dir="ltr" translate="no">GOOGLE_RECAPTCHA</code> or <code dir="ltr" translate="no">EXTERNAL_302</code>.</li>
<li><code dir="ltr" translate="no">target</code>: URL target for the redirect action. Only applicable when the <code dir="ltr" translate="no">type</code> is <code dir="ltr" translate="no">EXTERNAL_302</code>.</li>
</ul></li>
<li><code dir="ltr" translate="no">conform_action</code>: This is the action performed when the number of requests is
under the <code dir="ltr" translate="no">rate_limit_threshold</code>. This is always an <code dir="ltr" translate="no">allow</code> action.</li>
</ul>
<p>When a client's traffic rate is under or equal to the <code dir="ltr" translate="no">rate_limit_threshold</code>,
requests follow the <code dir="ltr" translate="no">conform-action</code>, which is always an <code dir="ltr" translate="no">allow</code> action. The request is
allowed through the security policy and permitted to reach its destination. When
a client's traffic rate exceeds the specified <code dir="ltr" translate="no">rate_limit_threshold</code>,
Google Cloud Armor applies the <code dir="ltr" translate="no">exceed_action</code>, which can be either <code dir="ltr" translate="no">deny</code> or
<code dir="ltr" translate="no">redirect</code>, for requests over the limit for the rest of the threshold interval.</p>
<h2 data-text="Banning clients based on request rates" id="ban-clients">Banning clients based on request rates</h2>
<p>The <code dir="ltr" translate="no">rate_based_ban</code> action in a rule allows you to enforce a per-client
threshold to temporarily ban clients that exceed the limit by applying the
configured <code dir="ltr" translate="no">exceed_action</code> for all requests from the client for a configurable
time period. The threshold is configured as a specified number of requests in a
specified time interval. You can temporarily ban traffic for a
user-configured time period (<code dir="ltr" translate="no">'ban_duration_sec'</code>), provided that the traffic
matches the specified match condition and exceeds the configured threshold.</p>
<p>For example, you might set the request threshold to 2,000 requests within 1,200
seconds (20 minutes). If a client sends 2,500 requests within any 1,200 seconds,
Google Cloud Armor applies the <code dir="ltr" translate="no">exceed_action</code> to traffic from that client
exceeding the 2,000 request threshold until the full 1,200 seconds has elapsed
and for an additional number of seconds that you set as the ban duration period.
If the ban duration period is set to <code dir="ltr" translate="no">3600</code>, for example, traffic from the
client would be banned for 3,600 seconds (one hour) beyond the end of the
threshold interval.</p>
<p>These parameters control the action of a <code dir="ltr" translate="no">rate_based_ban</code> rule:</p>
<ul>
<li><code dir="ltr" translate="no">rate_limit_threshold</code>: The number of requests per client allowed within a
specified time interval. The minimum value is 1 request and the maximum value
is 10,000 requests.
<ul>
<li><code dir="ltr" translate="no">interval_sec</code>: The number of seconds in the time interval. The value must be
60, 120, 180, 240, 300, 600, 900, 1200, 1800, 2700, or 3600 seconds.</li>
</ul></li>
<li><code dir="ltr" translate="no">exceed_action</code>: When a request exceeds the <code dir="ltr" translate="no">rate_limit_threshold</code>,
Google Cloud Armor applies the configured <code dir="ltr" translate="no">exceed_action</code>. Possible values
for the <code dir="ltr" translate="no">exceed_action</code> are as follows:
<ul>
<li><code dir="ltr" translate="no">deny(status)</code>: The request is denied and the specified error code is
returned. Valid values for the error code are 403, 404, 429 and 502. We
recommend using the response code <code dir="ltr" translate="no">429 (Too Many Requests)</code>.</li>
<li><code dir="ltr" translate="no">redirect</code>: The request is either redirected for reCAPTCHA Enterprise
assessment or to a different URL, based on the <code dir="ltr" translate="no">exceed_redirect_options</code>
parameter.</li>
</ul></li>
<li><code dir="ltr" translate="no">exceed_redirect_options</code>: When the <code dir="ltr" translate="no">exceed_action</code> is <code dir="ltr" translate="no">redirect</code>, use this
parameter to specify the redirect action:
<ul>
<li><code dir="ltr" translate="no">type</code>: Type for the redirect action, either <code dir="ltr" translate="no">GOOGLE_RECAPTCHA</code> or <code dir="ltr" translate="no">EXTERNAL_302</code>.</li>
<li><code dir="ltr" translate="no">target</code>: URL target for the redirect action. Only applicable when the <code dir="ltr" translate="no">type</code> is <code dir="ltr" translate="no">EXTERNAL_302</code>.</li>
</ul></li>
<li><code dir="ltr" translate="no">conform_action</code>: This is the action performed when the number of requests is
under the <code dir="ltr" translate="no">rate_limit_threshold</code>. This is always an <code dir="ltr" translate="no">allow</code> action.</li>
<li><code dir="ltr" translate="no">ban_duration_sec</code>: This is the additional number of seconds for which a
client is banned after the <code dir="ltr" translate="no">interval_sec</code> period elapses. The value must be
60, 120, 180, 240, 300, 600, 900, 1200, 1800, 2700, or 3600 seconds.</li>
</ul>
<p>When a client's request rate is under the rate limit threshold, this immediately
allows the request to proceed to the backend service. When a client's traffic rate
exceeds the specified <code dir="ltr" translate="no">rate_limit_threshold</code>, Google Cloud Armor applies the
<code dir="ltr" translate="no">exceed_action</code> to all incoming requests from the client for the rest of the
threshold interval and for the next <code dir="ltr" translate="no">ban-duration_sec</code> seconds, regardless of
whether or not the threshold is exceeded.</p>
<p>With this configuration, it is possible to accidentally ban welcome clients that
only occasionally exceed the allowable request rate. To prevent this, and ban
only clients that frequently exceed the request rate, you can
optionally track the total client requests against an additional, preferably
longer, threshold configuration called the <code dir="ltr" translate="no">ban_threshold</code>. In this mode, the
client is banned for the configured <code dir="ltr" translate="no">ban_duration</code> seconds only if the request
rate crosses the configured <code dir="ltr" translate="no">ban-threshold</code>.  If the request rate does not exceed
the <code dir="ltr" translate="no">ban-threshold</code>, the requests keep getting throttled to
<code dir="ltr" translate="no">rate_limit_threshold</code>. For the purpose of <code dir="ltr" translate="no">ban_threshold</code>, the total requests
from the client, consisting of all incoming requests before throttling, are
counted.</p>
<h2 data-text="Threshold enforcement" id="threshold_enforcement">Threshold enforcement</h2>
<p>The configured thresholds for throttling and rate-based bans are enforced
independently in each of the Google Cloud regions where your HTTP(S)
backend services are deployed. For example, if your service is deployed in two
regions, each of the two regions rate limits each key to the configured
threshold, so your backend service might experience cross-region aggregated
traffic volumes that are twice the configured threshold. If the configured
threshold is set to 5,000 requests, the backend service might receive 5,000
requests from one region and 5,000 requests from the second region.</p>
<p>However, for the key type IP address, it is reasonable to assume that traffic
from the same client IP address is directed to the region that is closest to the
region where your backends are deployed. In this case, rate limiting
can be considered to be enforced at a backend service level, regardless of the
regions it is deployed in.</p>
<p>It is important to note that the enforced rate limits are approximate and might
not be strictly accurate compared to the configured thresholds. Also, in rare
cases, because of internal routing behavior, it is possible that rate limiting
might be enforced in more regions than the regions you are deployed in, thus
impacting accuracy. For these reasons, we recommend that you use rate limiting
only for abuse mitigation or maintaining application and service availability,
not for enforcing strict quota or licensing requirements.</p>
<h2 data-text="Logging" id="rate-limiting-logging">Logging</h2>
<p>Cloud Logging records the security policy name, matched rate limit rule
priority, rule ID, the associated action, and other information in your request
logs. For more information about logging, see <a href="/armor/docs/request-logging">Using request logging</a>.</p>
<h2 data-text="Integration with reCAPTCHA Enterprise" id="integration_with">Integration with reCAPTCHA Enterprise</h2>
<p>You can apply rate limiting to some reCAPTCHA Enterprise resources in order to
mitigate token abuse and limit token re-use. These resources include
action-tokens, session-tokens, and exemption cookies. For more information about
using rate limiting with reCAPTCHA Enterprise, see the
<a href="/armor/docs/bot-management#rate-limiting">bot management overview</a>.</p>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li>Learn more about <a href="/armor/docs/configure-security-policies#rate-limiting">configuring security policy rules for rate limiting</a>.</li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/managed-protection-overview]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor Managed Protection is the managed application protection
service that helps protect your web applications and services from distributed
denial-of-service (DDoS) attacks and other threats from the internet.
Managed Protection helps protect applications deployed on Google Cloud,
on-premises, or on other infrastructure providers.</p>
<h2 data-text="Google Cloud Armor Standard versus Managed Protection Plus" id="standard_versus_plus">Google Cloud Armor Standard versus Managed Protection Plus</h2>
<p>Google Cloud Armor is offered in two service tiers, Standard and
Managed Protection Plus:</p>
<ul>
<li><p><strong>Google Cloud Armor Standard</strong> includes a pay-as-you go pricing model, always-on protection
from volumetric and protocol-based DDoS attacks across your globally
load-balanced infrastructure, and access to Google Cloud Armor web
application firewall (WAF) rule capabilities, including preconfigured WAF rules
for OWASP Top 10 protection.</p></li>
<li><p><strong>Managed Protection Plus</strong> includes a monthly subscription that includes all the features
of Google Cloud Armor Standard, as well as bundled Google Cloud Armor WAF usage (including
rules, policy, and HTTP(S) requests),
<a href="/armor/docs/armor-named-ip">third-party named IP address lists</a>, and
<a href="/armor/docs/adaptive-protection-overview">Adaptive Protection</a>.
Managed Protection Plus subscribers also get access to DDoS bill
protection and DDoS response team services.</p></li>
</ul>
<p>All projects that include HTTP(S) Load Balancing, TCP Proxy Load Balancing, or
SSL Proxy Load Balancing are automatically enrolled in Google Cloud Armor
Standard. After subscribing to Managed Protection Plus at the
billing account level, users can choose to enroll individual projects attached
to the billing account in Managed Protection Plus.</p>
<p>The following table summarizes the two service tiers.</p>
<table>
<thead>
<tr>
<th></th>
<th>Google Cloud Armor Standard</th>
<th>Managed Protection Plus</th>
</tr>
</thead>
<tbody>
<tr>
<td>Billing method</td>
<td>Pay-as-you-go</td>
<td>Monthly subscription + Data Processing Fee (see
         <a href="/armor/pricing">Pricing</a>)</td>
</tr>
<tr>
<td>DDoS attack protection</td>
<td><ul>
<li>HTTP(S) Load Balancing</li>
<li>TCP Proxy Load Balancing</li>
<li>SSL Proxy Load Balancing</li>
</ul></td>
<td><ul>
<li>HTTP(S) Load Balancing</li>
<li>TCP Proxy Load Balancing</li>
<li>SSL Proxy Load Balancing</li>
</ul></td>
</tr>
<td>Google Cloud Armor WAF</td>
<td>Per policy, per rule, per request (see
         <a href="/armor/pricing">Pricing</a>)</td>
<td>Included with Plus subscription</td>

<tr>
<td>Resource limits</td>
<td>Up to quota limit</td>
<td>Up to quota limit</td>
</tr>
<tr>
<td>Preconfigured WAF rules</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Time commitment</td>
<td>N/A</td>
<td>One year</td>
</tr>
<tr>
<td>Named IP address lists</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Adaptive Protection</td>
<td>Alerting only</td>
<td>Yes</td>
</tr>
<tr>
<td>DDoS response support</td>
<td>N/A</td>
<td>Yes (w/ Premium Support)</td>
</tr>
<tr>
<td>DDoS bill protection</td>
<td>N/A</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h2 data-text="Subscribing to Managed Protection Plus" id="subscribing_to_plus">Subscribing to Managed Protection Plus</h2>
<p>To use the additional services and capabilities in Managed Protection Plus,
you must first subscribe to Managed Protection Plus. After your Managed Protection Plus
subscription is activated for the billing account, you must then enroll
individual projects in Managed Protection Plus.</p>
<p>After a project is enrolled in Managed Protection Plus, the forwarding rules
for HTTP(S) Load Balancing, SSL Proxy Load Balancing, and
TCP Proxy Load Balancing within the project are added to the subscription. In
addition, all backend services and backend buckets are counted as protected
resources and are metered for the Managed Protection Plus monthly
subscription cost. The backend services and backend buckets in
Managed Protection Plus are aggregated across all enrolled projects in a
billing account.</p>
<aside class="note"><strong>Note:</strong><span> Subscribing to Managed Protection Plus requires a one-year (12-month)
commitment. Only users with the billing account role and permissions can
subscribe the billing account to Managed Protection Plus.</span></aside>
<h2 data-text="DDoS response support" id="ddos_response_support">DDoS response support</h2>
<p>Google Cloud Armor Managed Protection distributed denial-of-service (DDoS) response support lets
you receive 24/7 help and potential custom mitigations from DDoS attacks from
the same team that protects all Google services. You can engage DDoS support
during an attack to help mitigate the attack, or you can reach out proactively
to plan for an upcoming high volume or potentially viral event (one which might
attract an unusually high amount of visitors).</p>
<p>To engage DDoS response support, see
<a href="/armor/docs/managed-protection-using#ddos-response-support">Engaging DDoS response support</a>.</p>
<h2 data-text="DDoS bill protection" id="ddos_bill_protection">DDoS bill protection</h2>
<p>Google Cloud Armor DDoS bill protection provides credits for future
Google Cloud usage for some increases in the bills from Cloud Load
Balancing, Google Cloud Armor, and network internet, inter-region, and
inter-zone egress as a result of a verified DDoS attack. If a claim is
recognized and a credit is provided, the credit cannot be used to offset
existing usage; the credit can only apply to future usage. The following table
demonstrates what resources are covered by DDos bill protection:</p>
<table>
<tr>
<th width="30%">Endpoint Type</th>
<th width="70%">Covered Usage Increase</th>
</tr>
<tr>
<td>External HTTP(S) Load Balancing, external TCP Proxy Load Balancing, external SSL Proxy Load Balancing</td>
<td>Cloud Load Balancing
       <ul>
<li>Ingress Data Processing Fee</li>
<li>HTTP(S) Load Balancing Request Logging</li>
</ul>
</td>
</tr>
<tr>
<td></td>
<td>Google Cloud Armor
         <ul>
<li>Managed Protection data processing fee</li>
</ul>
</td>
</tr>
<tr>
<td></td>
<td>Network egress
        <ul>
<li>Inter-region, inter-zone egress</li>
<li>Internet egress</li>
<li>Carrier peering egress</li>
</ul>
</td>
</tr>
</table>
<p>To engage DDoS bill protection, see
<a href="/armor/docs/managed-protection-using#ddos-bill-protection">Engaging DDoS bill protection</a>.</p>
<h2 data-text="Terms and limitations" id="terms_and_limitations">Terms and limitations</h2>
<p>To learn more about the terms and limitations of Managed Protection Plus,
see the <a href="/terms/service-terms#networking">Service Specific Terms</a> page and
follow these steps:</p>
<ol>
<li>Click <strong>Service Terms</strong>. </li>
<li>Scroll to <strong>9. Google Cloud Armor – Managed Protection Plus</strong>.</li>
</ol>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/managed-protection-using">Subscribe and enroll projects in Managed Protection Plus</a></li>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
<li><a href="/armor/docs/rules-language-reference">Use the custom rules language reference</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/managed-protection-using]</H1></p><div class="devsite-article-body clearfix">
<p>This guide provides instructions for using Google Cloud Armor Managed Protection Plus. For more
information about Managed Protection, see the
<a href="/armor/docs/managed-protection-overview">Google Cloud Armor Managed Protection overview</a>.</p>
<p>To switch to Managed Protection Plus, complete these steps:</p>
<ol>
<li>Subscribe your billing account to the Managed Protection Plus tier.</li>
<li>Enroll individual projects in the Managed Protection Plus subscription.</li>
</ol>
<aside class="note"><strong>Note:</strong><span> Managed Protection Plus requires a one-year (12-month) commitment.
After you subscribe, you cannot unsubscribe for one year.</span></aside>
<h2 data-text="Required IAM permissions" id="required_permissions">Required IAM permissions</h2>
<p>To subscribe a billing account to Managed Protection Plus or to toggle the
auto-renew setting of the subscription, you must be a user with the
Identity and Access Management (IAM) permission <code dir="ltr" translate="no">billing.accounts.update</code> for the billing
account that is being subscribed.</p>
<p>To enroll a project into the Managed Protection Plus subscription, you must
have the following IAM permissions for the currently selected
project that you are enrolling in Managed Protection Plus:</p>
<ul>
<li><code dir="ltr" translate="no">resourcemanager.projects.createBillingAssignment</code></li>
<li><code dir="ltr" translate="no">resourcemanager.projects.update</code></li>
</ul>
<p>To learn more about billing permissions, see
<a href="/billing/docs/how-to/billing-access">Overview of Cloud Billing access control</a>.</p>
<h2 data-text="Subscribing to Managed Protection Plus and enrolling projects" id="enrolling">Subscribing to Managed Protection Plus and enrolling projects</h2>
<p>To subscribe to Managed Protection Plus and enroll the current project,
follow these steps:</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console"> Console </h3><ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>Click <strong>Cloud Armor</strong>.</p></li>
<li><p>Click <strong>Managed Protection</strong>. If your Plus tier subscription
is active, then the billing account is already subscribed.</p></li>
<li><p>Click <strong>Enroll in Plus tier</strong>. You see a confirming dialog box.</p></li>
<li><p>To enroll the current project, ensure that the <strong>Enroll current project</strong>
checkbox is selected.</p></li>
<li><p>To confirm your subscription, click <strong>Subscribe</strong>. Otherwise, click
<strong>Cancel</strong>.</p></li>
</ol></section>
</div><aside class="note"><strong>Note:</strong><span> After you enroll a project in Managed Protection Plus, up to
three hours might elapse before the change takes effect. You can continue to
enroll projects during this period.</span></aside>
<p>To enroll additional projects, follow these steps:</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console_1"> Console </h3><ol>
<li>When you are signed in to the subscribed billing account, go to an
additional project that you want to enroll.</li>
<li><p>In the Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>Click <strong>Cloud Armor</strong>, and then click <strong>Managed Protection</strong>.</p></li>
<li><p>Under <strong>Plus tier</strong>, click <strong>Change to Plus tier</strong>.</p></li>
</ol></section>
</div>
<h2 data-text="Removing a project from Managed Protection Plus" id="remove-project">Removing a project from Managed Protection Plus</h2>
<p>To unenroll a project from Managed Protection Plus, follow these steps:</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console_2"> Console </h3><ol>
<li>When you are signed in to the subscribed billing account, go to the
project that you want to remove from Plus tier.</li>
<li><p>In the Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>Click <strong>Cloud Armor</strong>, and then click <strong>Managed Protection</strong>.</p></li>
<li><p>Under <strong>Standard tier (default)</strong>, click <strong>Change to Standard tier</strong>.</p></li>
</ol></section>
</div><aside class="note"><strong>Note:</strong><span> After you unenroll a project from Managed Protection Plus, up to
three hours might elapse before the change takes effect. You can continue to
unenroll (or enroll) other projects during this period.</span></aside>
<h2 data-text="Unsubscribing a billing account from Managed Protection Plus" id="unsubscribing">Unsubscribing a billing account from Managed Protection Plus</h2>
<p>A Managed Protection Plus subscription is a one-year commitment that is
renewed automatically. To prevent renewal at the end of the one-year term, you
must disable automatic renewal. After automatic renewal is disabled, when you
reach the end of the current one-year subscription period, your
Managed Protection Plus subscription is not renewed, and all projects in
the billing account revert to Managed Protection Standard.</p>
<p>To cancel Managed Protection Plus auto-renewal, follow these steps:</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console_3"> Console </h3><ol>
<li><p>When you are signed in to the subscribed billing account, in the
Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to the Network Security page</a> </p></li>
<li><p>Click <strong>Cloud Armor</strong>, and then click <strong>Managed Protection</strong>.</p></li>
<li><p>Click <strong>Auto-Renew (off)</strong>. Your Managed Protection Plus
subscription is not renewed when your current subscription expires. At that
time, projects enrolled in Managed Protection Plus are no longer
enrolled. They still receive the DDoS protection provided in
Managed Protection Standard.</p></li>
</ol></section>
</div>
<p>You can resubscribe a billing account to Managed Protection Plus at any time.
If you do so, you must also re-enroll projects for which you want to benefit
from the Managed Protection Plus pricing models and additional capabilities.</p>
<h2 data-text="Engaging DDoS response support" id="ddos-response-support">Engaging DDoS response support</h2>
<p>The following are the qualification criteria in order to open a case and receive
help from the Google Cloud Armor DDoS response support team:</p>
<ul>
<li>An active Managed Protection Plus subscription on your billing account</li>
<li>The project with the workload that is under attack must be enrolled into the
Managed Protection Plus</li>
<li>The billing account must have a <a href="/support/docs/premium">Premium account</a> for
Cloud Support</li>
</ul>
<h3 data-text="Opening a case" id="opening_a_case">Opening a case</h3>
<p>To engage DDoS Response support, you open a support case through the
Google Cloud console. If you meet the eligibility requirements, your case will be
escalated to the Google Cloud Armor DDoS Response Team for support, triage,
and potential mitigation.</p>
<p>To open a DDoS Response Case, complete the following steps:</p>
<ol>
<li>Navigate to the Support Page in the Google Cloud console. <br/>
<a class="button button-primary" href="https://console.cloud.google.com/support/cases" target="console">Go to the Support page</a> </li>
<li>Select the project for which you would like to open a DDoS Response case.</li>
<li>Select <strong>Cases</strong>.</li>
<li>Click <strong>Create Case</strong>.</li>
<li>Specify that the case is a DDoS Response case.</li>
<li>Complete the required fields and submit the form.</li>
</ol>
<h2 data-text="Engaging DDoS Bill Protection" id="ddos-bill-protection">Engaging DDoS Bill Protection</h2>
<p>To file a claim for DDoS Bill Protection, you must prepare the following
information:</p>
<ul>
<li>The billing account associated with the targeted project.</li>
<li>The project number of the project containing the targeted resource.</li>
<li>The internet-facing IP address of the targeted resource.</li>
<li>The time that the attack started.</li>
<li>The time that the attack concluded.</li>
<li>Normal traffic volumes for the impacted service.</li>
<li>Attack volumes for the impacted service.</li>
</ul>
<p>You can initiate a chat or contact billing support through the Google Cloud console.
For more information on contacting Cloud Billing Support, see
<a href="/support/billing#how_to_contact_support">How to contact Cloud Billing Support</a>.</p>
<h2 data-text="Troubleshooting Managed Protection" id="troubleshooting">Troubleshooting Managed Protection</h2>
<p>This section provides information to help you resolve any issues with
Managed Protection.</p>
<h3 data-text="You subscribed to Managed Protection Plus, but your bill continues to be pay-as-you-go" id="you_subscribed_to_plus_but_your_bill_continues_to_be_pay-as-you-go">You subscribed to Managed Protection Plus, but your bill continues to be pay-as-you-go</h3>
<p>If you subscribed to Managed Protection Plus and you are still being billed on a pay-as-you-go
basis, check whether you enrolled your projects in Managed Protection Plus.</p>
<h3 data-text="The Subscribe button is unavailable" id="the_subscribe_button_is_unavailable">The <code dir="ltr" translate="no">Subscribe</code> button is unavailable</h3>
<p>If you are unable to subscribe to Managed Protection Plus because the
<code dir="ltr" translate="no">Subscribe</code> button is unavailable, do the following:</p>
<ul>
<li>Ensure that the user who is trying to subscribe has sufficient
IAM permissions:
<ul>
<li>The user must have <code dir="ltr" translate="no">billing.accounts.update</code> permissions for subscribing at
the billing account level.</li>
<li>The user must have <code dir="ltr" translate="no">resourcemanager.projects.createBillingAssignment</code> and
<code dir="ltr" translate="no">resourcemanager.projects.update</code> for enrolling individual projects into or
out of the Plus tier.</li>
</ul></li>
</ul>
<h3 data-text="Unable to subscribe or enroll projects in Managed Protection programmatically" id="unable_to_subscribe_or_enroll_projects_in_programmatically">Unable to subscribe or enroll projects in Managed Protection programmatically</h3>
<p>Subscription and enrollment in Managed Protection Plus is offered only
through the Cloud console interface. The Google Cloud CLI and REST API
are not supported.</p>
<h3 data-text="Determining the number of backend services and backend buckets covered by a subscription" id="determining_the_number_of_backend_services_and_backend_buckets_covered_by_a_subscription">Determining the number of backend services and backend buckets covered by a subscription</h3>
<p>Each project that is enrolled in Managed Protection Plus shows the number of
backend services and backend buckets covered, under the
<strong>Managed Protection</strong> tab on the Google Cloud Armor page. The number
that you see is aggregated across all projects under the billing account that is
enrolled into the subscription; it is the total number of backend services and
backend buckets covered by the subscription.</p>
<p>If the project is enrolled in Managed Protection Standard, which is the
default tier, this count is not displayed.</p>
<h3 data-text="Billing discrepancies" id="billing_discrepancies">Billing discrepancies</h3>
<p>If these troubleshooting tips do not resolve the problems that you are
experiencing, contact the
<a href="/support/billing">Google Cloud billing support team</a>.</p>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
<li><a href="/armor/docs/rules-language-reference">Use the custom rules language reference</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/adaptive-protection-overview]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor Adaptive Protection helps you protect your Google Cloud applications, websites,
and services against L7 distributed denial-of-service (DDoS) attacks such as
HTTP floods and other high-frequency layer 7 (application-level) malicious
activity. Adaptive Protection builds machine-learning models that do the
following:</p>
<ol>
<li>Detect and alert on anomalous activity</li>
<li>Generate a signature describing the potential attack</li>
<li>Generate a custom Google Cloud Armor WAF rule to block the signature</li>
</ol>
<p>You enable or disable Adaptive Protection on a per-security-policy
basis.</p>
<p>Alerts about anomalous traffic (potential attacks), which include the signatures
of the attacks, appear in the Adaptive Protection event dashboard with event
logs sent to Cloud Logging, where they can be directly analyzed or forwarded
to a downstream log or security event monitoring workflow. Alerts of potential
attacks are also generated as findings in the
<a href="https://console.cloud.google.com/projectselector2/security/command-center/welcome">Security Command Center</a>.</p>
<h2 data-text="Availability of Adaptive Protection" id="availability_of">Availability of Adaptive Protection</h2>
<p>Full Adaptive Protection alerts are available only if you
subscribe to Google Cloud Armor Managed Protection Plus. Otherwise, you receive only a
<em>basic alert</em>, without an <em>attack signature</em> or the ability to deploy a
suggested rule.</p>
<p>If your projects are not already enrolled in Managed Protection Plus, read
<a href="/armor/docs/managed-protection-using">Using Managed Protection</a> for
information about how to enroll.</p>
<h2 data-text="Cloud Logging and Cloud Monitoring" id="and">Cloud Logging and Cloud Monitoring</h2>
<p>Because using Adaptive Protection effectively requires you to understand
how logging and alerting work in Google Cloud, we recommend that you
familiarize yourself with Cloud Logging, alerting, and alerting policies.</p>
<ul>
<li>For general logging information, see the <a href="/logging/docs/basic-concepts">Cloud Logging documentation</a>.</li>
<li>For information about alerting, see the <a href="/monitoring/alerts">Cloud Monitoring documentation</a>.</li>
<li>For Google Cloud Armor-specific logging information, see <a href="/armor/docs/request-logging">Using request logging</a>.</li>
</ul>
<h2 data-text="Configuring and tuning alerts" id="configure-alert-tuning">Configuring and tuning alerts</h2>
<p>You can enable Adaptive Protection in projects where Google Cloud Armor
security policies already protect your applications. When you enable
Adaptive Protection for a particular security policy,
Adaptive Protection is in effect for all backend services with which the
security policy is associated.</p>
<p>After Adaptive Protection is enabled, there's a training period of at least
one hour before Adaptive Protection develops a reliable baseline and
begins monitoring traffic and generating alerts. During the training period,
Adaptive Protection models incoming traffic and usage patterns that are
specific to each backend service, so that it develops the baseline for each
backend service. When the training period is over, you receive real-time alerts
when Adaptive Protection identifies high frequency or high volume anomalies
in the traffic directed to any of the backend services associated with that
security policy.</p>
<p>You can tune Adaptive Protection alerts based on several metrics. The
alerts, which are sent to Cloud Logging, include a <em>confidence level</em>, an
<em>attack signature</em>, a suggested rule, and an estimated <em>impacted baseline rate</em>
associated with the suggested rule.</p>
<ul>
<li>The confidence level indicates the confidence with which Adaptive Protection
models predict that the observed change in traffic pattern is anomalous.</li>
<li>The impacted baseline rates associated with the suggested rule represent the
percentage of existing baseline traffic that is caught by the rule. Two
rates are provided. The first is the percentage relative to the traffic into
the specific backend service under attack. The second is the percentage
relative to all the traffic going through the security policy including all
configured backend service targets (not just the one being attacked).</li>
</ul>
<p>You can filter alerts in Cloud Logging based on the
confidence level or the impacted baseline rates, or both. For more information
about tuning alerts, see <a href="/monitoring/alerts/using-alerting-ui">Managing alerting policies</a>.</p>
<h2 data-text="Consuming and interpreting alerts" id="consume-interpret-alerts">Consuming and interpreting alerts</h2>
<p>As soon as Adaptive Protection detects a suspected attack, it generates an
event in the Adaptive Protection event dashboard and generates a log item in
Cloud Logging. The alert is in the JSON payload of the log item. The
log item is generated under the <strong>Network Security Policy</strong> resource in
Cloud Logging. The log message identifies the backend service under
attack and includes a confidence score indicating how strongly
Adaptive Protection rates the identified traffic pattern change as anomalous.
The log message also includes an <em>attack signature</em> that illustrates the
characteristics of the attack traffic, along with suggested
Google Cloud Armor rules that you might apply to mitigate the attack.</p>
<h3 data-text="Understanding attack signatures" id="understand-attack-signature">Understanding attack signatures</h3>
<p>An Adaptive Protection alert includes an <em>attack signature</em>, which is a
description of the traffic attributes of the potential attack. You use the
signature to identify and potentially block the attack. The signature takes two
forms: as a user-readable table and as a preconstructed Google Cloud Armor WAF
rule that you can deploy in the relevant security policy. If you are
not subscribed to Google Cloud Armor Managed Protection Plus, an <em>attack signature</em> is not included
in the basic alert.</p>
<p>The signature consists of a set of attributes, such as source IP address,
geographical regions, cookies, user agents, referers and other HTTP request
headers, and the set of values for those attributes thought to be associated
with the potential attack traffic. The set of attributes is not user-
configurable. The attribute values depend on the values in the incoming traffic
to your backend service.</p>
<p>For each attribute value that Adaptive Protection believes indicates the
potential attack, Adaptive Protection lists the following:</p>
<ul>
<li>The attack likelihood</li>
<li>The proportion of the attribute in the attack, which is the percentage of
potential attack traffic that had this value at the time that the attack
was detected</li>
<li>The proportion of the attribute in baseline, which is the percentage of
baseline traffic that possessed this attribute value at time that the
attack was detected</li>
</ul>
<p><a href="/armor/docs/adaptive-protection-overview#logging-entry">Cloud Logging entry specification</a>
contains details about the information in each alert.</p>
<p>The following is an example of a user-readable table that contains the signature
of a potential attack:</p>
<table>
<thead>
<tr>
<th width="16%">Attribute name</th>
<th width="16%">Value</th>
<th width="17%">Match type</th>
<th width="17%">Attack likelihood</th>
<th width="17%">Proportion in attack</th>
<th width="17%">Proportion in baseline</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">UserAgent</code></td>
<td>"foo"</td>
<td>Exact match</td>
<td>0.7</td>
<td>0.85</td>
<td>0.12</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">UserAgent</code></td>
<td>"bar"</td>
<td>Exact match</td>
<td>0.6</td>
<td>0.7</td>
<td>0.4</td>
</tr>
<tr>
<td>Source IP</td>
<td>"a.b.c.d"</td>
<td>Exact match</td>
<td>0.95</td>
<td>0.1</td>
<td>0.01</td>
</tr>
<tr>
<td>Source IP</td>
<td>a.b.c.e</td>
<td>Exact match</td>
<td>0.95</td>
<td>0.1</td>
<td>0.01</td>
</tr>
<tr>
<td>Source IP</td>
<td>a.b.c.f</td>
<td>Exact match</td>
<td>0.05</td>
<td>0.1</td>
<td>0.1</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">RegionCode</code></td>
<td>UK</td>
<td>Exact match</td>
<td>0.64</td>
<td>0.3</td>
<td>0.1</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">RegionCode</code></td>
<td>IN</td>
<td>Exact match</td>
<td>0.25</td>
<td>0.2</td>
<td>0.3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">RequestUri</code></td>
<td>/urlpart</td>
<td>Substring</td>
<td>0.7</td>
<td>0.85</td>
<td>0.12</td>
</tr>
</tbody>
</table>
<p>An Adaptive Protection alert and the relevant Cloud Logging event
log contain the following:</p>
<ul>
<li>A unique alert ID, or <code dir="ltr" translate="no">alertID</code>, which is used to refer to a specific alert
when it reports user feedback (more below)</li>
<li>The backend service under attack, or <code dir="ltr" translate="no">backendService</code></li>
<li>The confidence score, or <code dir="ltr" translate="no">confidence</code>, which is a number between 0 and 1 that
indicates how strongly the Adaptive Protection system rates the detected
event as a malicious attack</li>
</ul>
<p>You also receive a set of signatures and rules characterizing the
detected attack. Specifically, the set provides a list of <code dir="ltr" translate="no">headerSignatures</code>,
each corresponding to one HTTP header and containing a list of <code dir="ltr" translate="no">significantValues</code>
for the specific header. Each significant value is either an observed header
value or a substring of it.</p>
<p>The following is an example signature:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
...
headerSignatures: [
  0: {
   name: "Referer"
   significantValues: [
    0: {
     attackLikelihood: 0.95
     matchType: "MATCH_TYPE_EQUALS"
     proportionInAttack: 0.6
     proportionInBaseline: 0.01
     value: "foo.attacker.com"
    }
   ]
  }
...
</pre>
<p>The alert suggests that the value <code dir="ltr" translate="no">foo.attacker.com</code> in the header <code dir="ltr" translate="no">Referer</code> is
important in characterizing the attack. More specifically, 60% of the attack
traffic (<code dir="ltr" translate="no">proportionInAttack</code>) has this <code dir="ltr" translate="no">Referer</code> value and only 1% of baseline
traffic among all traffic (<code dir="ltr" translate="no">proportionInBaseline</code>) has the same <code dir="ltr" translate="no">Referer</code>
value. Moreover, among all traffic matching this <code dir="ltr" translate="no">Referer</code> value, 95% is attack
traffic (<code dir="ltr" translate="no">attackLikelihood</code>).</p>
<p>These values suggest that if you were to block all requests with <code dir="ltr" translate="no">foo.attacker.com</code>
in the <code dir="ltr" translate="no">Referer</code> header field, you would successfully block 60% of the attack
and also 1% of the baseline traffic.</p>
<p>The property <code dir="ltr" translate="no">matchType</code> specifies the relationship between the
attribute in the attack traffic and the significant value. It can be either
<code dir="ltr" translate="no">MATCH_TYPE_CONTAINS</code> or <code dir="ltr" translate="no">MATCH_TYPE_EQUALS</code>.</p>
<p>The next signature matches traffic with a substring <code dir="ltr" translate="no">/api?</code> in the request URI:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
...
headerSignatures: [
  0: {
   name: "RequestUri"
   significantValues: [
    0: {
     attackLikelihood: 0.95
     matchType: "MATCH_TYPE_CONTAINS"
     proportionInAttack: 0.9
     proportionInBaseline: 0.01
     value: "/api?"
    }
   ]
  }
...
</pre>
<h3 data-text="Deploying suggested rules" id="deploy-tune-rules">Deploying suggested rules</h3>
<p>Adaptive Protection alerts also provide a suggested Google Cloud Armor
rule expressed in the <a href="/armor/docs/rules-language-reference">custom rules language</a>.
This rule can be used to create a rule in a Google Cloud Armor security
policy to mitigate the attack. In addition to the signature, the alert
includes a rate of impacted baseline traffic to help you evaluate the impact of
deploying the rule. The rate of impacted baseline traffic is a projected
proportion of baseline traffic that matches the attack signature identified by
Adaptive Protection. If you are not subscribed to Google Cloud Armor Managed Protection Plus,
 <em>basic alerts</em> sent by Adaptive Protection do not include a suggested
Google Cloud Armor rule that you can apply.</p>
<p>You can find some of the alert signature as well as the impacted baseline rate
in the log message sent to Cloud Logging. The following example is the JSON
payload of a sample alert along with the resource labels on which you can filter
the logs.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
...
 jsonPayload: {
   alertId: "11275630857957031521"
   backendService: "test-service"
   confidence: 0.71828485
   headerSignatures: [

    0: {
     name: "RequestUri"
     significantValues: [
      0: {
       attackLikelihood: 0.88
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.85
       proportionInBaseline: 0.01
       value: "/"
      }
     ]
    }
    1: {
     name: "RegionCode"
     significantValues: [
      0: {
       attackLikelihood: 0.08
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.17
       proportionInBaseline: 0.28
       value: "US"
      }
      1: {
       attackLikelihood: 0.68
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.09
       proportionInBaseline: 0.01
       value: "DE"
      }
      2: {
       attackLikelihood: 0.74
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.05
       proportionInBaseline: 0
       value: "MD"
      }
     ]
    }
     2: {
     name: "UserAgent"
     significantValues: [
      0: {
       attackLikelihood: 0.92
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.85
       proportionInBaseline: 0
       value: "Unusual browser"
      }
      1: {
       attackLikelihood: 0.87
       proportionInAttack: 0.7
       proportionInBaseline: 0.1
       missing: true
      }
     ]
    }
   ]
   suggestedRule: [
    0: {
     action: "DENY"
     evaluation: {
       impactedAttackProportion: 0.95
       impactedBaselineProportion: 0.001
       impactedBaselinePolicyProportion: 0.001
     }
     expression: "evaluateAdaptiveProtection('11275630857957031521')"
    }
   ]
   ruleStatus: RULE_GENERATED
   attackSize: 5000
 }
 resource: {
    type: "network_security_policy",
    labels: {
      project_id: "your-project",
      policy_name: "your-security-policy-name"
    }
 },
}
}
...
</pre>
<p>You can deploy suggested rules by copying the CEL expression from the rule
signature and pasting the expression into the match condition of a newly created
rule, or by clicking the <strong>Apply</strong> button on the Adaptive Protection
dashboard in the Google Cloud Armor UI.</p>
<p>To deploy the rule, you create a new rule in the Google Cloud Armor security
policy that protects the targeted backend services identified by the alert.
Next, during rule configuration, copy and paste the CEL expression from the
alert into the <strong>Match condition</strong> field of the rule and set the rule action to
<code dir="ltr" translate="no">deny</code>. In the above example, you copy the expression
<code dir="ltr" translate="no">evaluateAdaptiveProtection('11275630857957031521')</code> from the <code dir="ltr" translate="no">suggestedRule</code>
section of the alert.</p>
<p>We strongly recommend that you initially deploy the rule in preview mode
so you can evaluate the impact of the rule on production traffic. When you do
this, Google Cloud Armor logs the action and the associated traffic whenever
the rule is triggered, but no action is taken on the matched traffic.</p>
<p>In addition, if your security policy is attached to multiple backend services,
note whether the effects of the new rule have unwanted effects in any of
the backend services. If this happens, configure new security policies to
mitigate the unwanted effects, and attach them to the correct backend services.</p>
<figure style="text-align: center">
<a href="/armor/images/caap-add-rule.svg">
<img alt="Deploying a suggested Adaptive Protection rule" border="0" src="/armor/images/caap-add-rule.svg" width="700"/></a>
<figcaption>Deploying a suggested Adaptive Protection rule (click to
   enlarge)</figcaption>
</figure>
<p>We recommend that you set the priority for the new rule higher than any rules
with the action set to allow. This is because, to have the projected impact and
have maximal effect in mitigating the attack, the rule should be deployed in the
highest logical priority position to ensure that all matching traffic is blocked
by the rule. Rules in a Google Cloud Armor security policy are evaluated in
priority order with evaluation terminating after the first matching rule is
triggered and the associated rule action is taken. If you need to grant an
exception for some traffic or specific clients from this rule, an "allow" rule
can be created with higher priority, that is, with a lower numerical value.
For more information about rule priority, see
<a href="/armor/docs/security-policy-overview#eval-order">Rule evaluation order</a>.</p>
<h3 data-text="Rule status" id="rule-status">Rule status</h3>
<p>If no rule is presented when you attempt to deploy a suggested rule, you can
use the <code dir="ltr" translate="no">ruleStatus</code> field to determine the cause.</p>
<pre dir="ltr" translate="no">
 ]
ruleStatus: RULE_GENERATED
attackSize: 5000
}
</pre>
<p>The following table describes the possible values of the field and what they
mean.</p>
<table>
<tr>
<th>Rule status</th>
<th>Description</th>
</tr>
<tr>
<td>RULE_GENERATED</td>
<td>A usable rule was generated normally.</td>
</tr>
<tr>
<td>BASELINE_TOO_RECENT</td>
<td>Not enough time to accumulate reliable baseline traffic. Up to one hour is necessary to generate rules.</td>
</tr>
<tr>
<td>NO_SIGNIFICANT_VALUE_DETECTED</td>
<td>No headers have significant values associated with attack traffic, so no rule could be generated.</td>
</tr>
<tr>
<td>NO_USABLE_RULE_FOUND</td>
<td>No usable rule could be created.</td>
</tr>
<tr>
<td>ERROR</td>
<td>An unspecified error occurred when creating the rule.</td>
</tr>
</table>
<h3 data-text="Monitoring, feedback, and reporting event errors" id="monitor-feedback-report-errors">Monitoring, feedback, and reporting event errors</h3>
<p>You need the following permissions to view or interact with the
Adaptive Protection dashboard.</p>
<ul>
<li><code dir="ltr" translate="no">compute.securityPolicies.list</code></li>
<li><code dir="ltr" translate="no">compute.backendServices.list</code></li>
<li><code dir="ltr" translate="no">logging.logEntries.list</code></li>
</ul>
<p>After you enable Adaptive Protection on any Google Cloud Armor security
policy, you can see the following page under <strong>Network Security &gt;
Google Cloud Armor</strong> panel. It displays the traffic volume over time for the
selected security policy and backend service, and the selected duration. Any
instances of potential attacks alerted by Adaptive Protection are annotated
on the graph and listed below the graph. When you click a specific attack event,
a side window is displayed with the attack signature and suggested rule shown in
tabular format. This is same information that's in the Cloud Logging log
entries that are described in <a href="#logging-entry">Cloud Logging entry specification</a>.
Click the <strong>Apply</strong> button to add the suggested rule to the same security policy.</p>
<figure style="text-align: center">
<a href="/armor/images/caap-dashboard.svg">
<img alt="Adaptive Protection dashboard" border="0" src="/armor/images/caap-dashboard.svg" width="700"/></a>
<figcaption>Adaptive Protection dashboard (click to
   enlarge)</figcaption>
</figure>
<figure style="text-align: center">
<a href="/armor/images/alert-details.svg">
<img alt="Adaptive Protection alert details" border="0" src="/armor/images/alert-details.svg" width="700"/></a>
<figcaption>Adaptive Protection dashboard (click to
   enlarge)</figcaption>
</figure>
<p>Not every Adaptive Protection finding is deemed an attack, given the
protected backend service's unique context and environmental factors. If you
determine that the potential attack described by the alert is normal or accepted
behavior, then you can report an event error to help train the
Adaptive Protection models. Next to each attack event listed under the graph
is a button that pops up an interactive window to allow you to report an event
error with some optional context. Reporting an event error helps reduce the
likelihood of similar errors in the future. Over time, this increases
Adaptive Protection's accuracy.</p>
<h3 data-text="Monitoring, alerting, and logging" id="monitor-alert-log">Monitoring, alerting, and logging</h3>
<p>Adaptive Protection telemetry is sent to Cloud Logging as well as
the Security Command Center. The Adaptive Protection log message sent to
Cloud Logging is described in the previous sections of this document. A
log entry is generated every time Adaptive Protection detects a potential
attack and each entry contains a confidence score describing how confident the
models are that the observed traffic is anomalous. To fine-tune alerting, an
alerting policy can be configured in Cloud Logging to trigger an alert
only when an Adaptive Protection log message has a confidence score above a
user-specified threshold. We recommend that you start with a low threshold, with
confidence &gt; 0.5, to avoid missing warnings of potential attacks. The confidence
threshold in the alerting policy can be increased over time if the alerts have
an unacceptable impacted baseline rate.</p>
<p>The Security Command Center dashboard also contains findings from
Adaptive Protection. They are located in the Google Cloud Armor card under
the <strong>Application DDoS Attacks</strong> category. Each finding includes the details of
the service, the attack confidence, the signature associated with the attack,
and a link to the specific alert on the Adaptive Protection dashboard.</p>
<h3 data-text="Cloud Logging entry specification" id="logging-entry">Cloud Logging entry specification</h3>
<p>The Adaptive Protection alert sent to Cloud Logging consists of a
log entry containing the following elements:</p>
<ul>
<li>Alert confidence: Adaptive Protection confidence that the event observed
is an attack.</li>
<li>Attack signature
<ul>
<li>Attribute name: The name of the attribute which matches to the <code dir="ltr" translate="no">Value</code>
below, such as a particular request header name or a geographic origin.</li>
<li>Value: The value to which the attribute in malicious traffic matches.</li>
<li>Match type: The relationship between <code dir="ltr" translate="no">Value</code> and the attribute in attack
traffic. The value is either equal to or a substring of an attribute in
attack traffic.</li>
<li>Attack likelihood: The likelihood that a given request is malicious, given
that the relevant attribute of this request matches <code dir="ltr" translate="no">Value</code>.</li>
<li>Proportion in attack: The percent of potential attack traffic that matches
<code dir="ltr" translate="no">Value</code>.</li>
<li>Proportion in baseline: The percent of normal, baseline traffic that matches
<code dir="ltr" translate="no">Value</code>.</li>
</ul></li>
<li>Suggested rule
<ul>
<li>Match condition: The expression to be used in the rules match condition to
identify malicious traffic.</li>
<li>Impacted baseline rate: The projected percentage of good traffic to the
specific backend service under attack that is captured by the suggested rule.</li>
<li>Impacted baseline rate across policy: The projected percentage of good
traffic to all the backend services in the same security policy that is
captured by the suggested rule.</li>
<li>Impacted attack rate: The projected percentage of attack traffic that is
captured by the suggested rule.</li>
</ul></li>
<li>Rule status: Additional details about rule generation.</li>
</ul>
<h2 data-text="Machine learning overview and privacy" id="ml-privacy">Machine learning overview and privacy</h2>
<ul>
<li>Training data and detection data
<ul>
<li>Adaptive Protection builds several models to
detect potential attacks and identify their signatures. The signals used by
these models to determine if an attack is ongoing are derived from the
observed metadata of incoming request traffic from your projects. Such
metadata includes: source IP address, source geography, and the values of
some HTTP request headers.</li>
<li>The actual features used by the models are derived statistical properties
of the above-mentioned signals. That is, the
training data for the models do not include the actual values of any
metadata, such as IP addresses and/or request header values.</li>
<li>A common set of detection models, trained with only artificial data are
shared across all customers, to determine whether an attack is taking place,
when Adaptive Protection is first enabled. Once you report any false
attack event and the models are updated using traffic signals specific from
your projects, these models are local to your projects and are not
used for any other customers.</li>
</ul></li>
<li>Signature generation data
<ul>
<li>After Adaptive Protection determines that a potential attack is
taking place, it generates an attack signature that's effective to help the
target mitigate the attack quickly. To achieve the above, after
you enable Adaptive Protection on a security policy, traffic metrics and
request metadata to a backend service (associated with the security policy)
are continually recorded to learn baseline traffic characteristics.</li>
<li>Because Adaptive Protection needs to learn about the baseline traffic,
Adaptive Protection might require up to one hour before generating rules
to mitigate potential attacks.</li>
</ul></li>
</ul>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/adaptive-protection-use-cases">Learn about common use cases for Adaptive Protection</a></li>
<li><a href="/armor/docs/managed-protection-overview">Learn about the features in Managed Protection tiers</a></li>
<li><a href="/armor/docs/managed-protection-using">Learn how to enable Managed Protection</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="mwETRvWii0eU5NUYprb0Y9z5GVbc" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/adaptive-protection-use-cases]</H1></p><div class="devsite-article-body clearfix">
<p>This document presents some common use cases for Google Cloud Armor Adaptive Protection.</p>
<h3 data-text="L7 DDoS attack detection and protection" id="l7-ddos-detect-protect">L7 DDoS attack detection and protection</h3>
<p>The most common use case for Adaptive Protection is detecting
and responding to L7 DDoS attacks such as HTTP GET floods, HTTP POST floods, or
other high frequency HTTP activities. L7 DDoS attacks often start relatively
slow and grow in intensity over time. By the time humans or automated spike
detection mechanisms detect an attack, it is likely to be high in intensity and
already having a strong negative impact on the application. Critically, while it
is possible to observe the spiking traffic in aggregate, it is much harder to
differentiate, in real time, individual requests as malicious or not because
they appear as normal, fully formed requests. Similarly, since the attack
sources are distributed amongst botnets or other groups of malicious clients
ranging in size from thousands to millions, it becomes increasingly difficult to
mitigate an ongoing attack by systematically identifying and blocking bad
clients based on IP alone. In the case of DDoS, the result is that the attack is
successful in making the targeted service unavailable for some or all regular
users.</p>
<aside class="note"><strong>Note:</strong><span> Adaptive Protection is intended to detect and alert on high frequency
traffic coming from single or distributed sources. Manual or automated malicious
activity is not guaranteed to be detected by Adaptive Protection,
particularly if the incoming traffic looks just like legitimate traffic at
similar volumes.</span></aside>
<figure style="text-align: center">
<a href="/armor/images/caap-http-flood-attack.svg">
<img alt="Illustration of an L7 DDoS attack (HTTP GET flood). A successful attack might overwhelm the targeted application and prevent legitimate users from accessing the service." border="0" src="/armor/images/caap-http-flood-attack.svg" width="700"/></a>
<figcaption>Illustration of an L7 DDoS attack (HTTP GET flood). A successful attack might overwhelm the targeted application and prevent legitimate users from accessing the service. (click to
   enlarge)</figcaption>
</figure>
<p>To rapidly detect and respond to L7 DDoS attacks, the project or security policy
owner can enable Adaptive Protection protection on a per-security policy
basis in their project. After at least one hour of training and observing normal
traffic patterns, Adaptive Protection will be ready to quickly and
accurately detect an attack early in its lifecycle and suggest WAF rules to
block the ongoing attack while leaving normal users unaffected.</p>
<figure style="text-align: center">
<a href="/armor/images/caap-detect-protect.svg">
<img alt="Adaptive Protection identifies and mitigates an L7 DDoS attack, allowing legitimate users to access the application." border="0" src="/armor/images/caap-detect-protect.svg" width="700"/></a>
<figcaption>Adaptive Protection identifies and mitigates an L7 DDoS attack, allowing legitimate users to access the application. (click to
   enlarge)</figcaption>
</figure>
<p>Notifications of potential attacks and the identified signature of the suspect
traffic are sent to Logging, where the log message can trigger a
custom Alerting Policy, be analyzed and stored, or be sent to a downstream
security information and event management (SIEM) or log management solution.
Consult the <a href="/logging/docs">Logging documentation</a> for more
information on how to integrate downstream SIEM or log management.</p>
<h3 data-text="Attack signature detection and response" id="signature-detection">Attack signature detection and response</h3>
<p>It is critical to not only detect and alert on potential attacks early but also
be able to act on that alert and respond in time to mitigate the attacks. An
enterprise's incident responders have to spend critical minutes and hours
investigating, frequently analyzing logs and monitoring systems to gather enough
information to develop a response to an ongoing attack. Next, before deploying
the mitigation, that plan has to be validated to make sure it won't have an
unintended or negative impact on production workloads.</p>
<figure style="text-align: center">
<a href="/armor/images/caap-incident-response.svg">
<img alt="A common workflow for an enterprise's incident response process." border="0" src="/armor/images/caap-incident-response.svg" width="700"/></a>
<figcaption>A common workflow for an enterprise's incident response process. (click to
   enlarge)</figcaption>
</figure>
<p>With Adaptive Protection, incident responders have everything they need to
quickly analyze and respond to an ongoing L7 DDoS attack the moment they receive
the alert. The Adaptive Protection alert includes the signature of the
traffic determined to be participating in the potential attack. The contents of
the signature will include metadata about the incoming traffic, including the
set of malicious HTTP request headers, source geographies, etc. The alert also
includes a rule matching the attack signature that can be applied in
Google Cloud Armor to immediately block the malicious traffic.</p>
<p>The Adaptive Protection event provides a confidence score and a projected
impacted baseline rate associated with the suggested rule to aid in
validation. Each component of the signature also has measures for attack
likelihood and proportion of attack to enable incident responders to fine tune
and narrow or widen the scope of the response.</p>
<h3 data-text="Customizing the model and reporting event errors" id="customize-model">Customizing the model and reporting event errors</h3>
<p>The Adaptive Protection attack detection models are trained on a data set,
artificially produced to exhibit the characteristics of both the good and the
malicious traffic. As a result, it is possible that Adaptive Protection will
identify a potential attack that, upon additional investigation, the incident
responder or application owner will determine was not an attack.
Adaptive Protection is able to learn from the unique context and traffic
patterns of each protected application.</p>
<figure style="text-align: center">
<a href="/armor/images/caap-identify-respond.svg">
<img alt="Example signature of a potential attack." border="0" src="/armor/images/caap-identify-respond.svg" width="700"/></a>
<figcaption>Example signature of a potential attack. (click to
   enlarge)</figcaption>
</figure>
<p>You can report individual alerts as a false positive to further help
Adaptive Protection train and customize the detection models. With false
positive reports, Adaptive Protection models will be less likely to alert on
traffic with similar characteristics and attributes in the future. Over time,
the Adaptive Protection detection models will be more attuned to the
specific characteristics of the traffic in each protected security policy. The
steps to report false positive events were described in <a href="/armor/docs/adaptive-protection-overview#monitor-%0Afeedback-report-errors">Monitoring, feedback
and reporting event errors</a>.</p>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/adaptive-protection-overview">Read more about Google Cloud Armor Adaptive Protection</a>.</li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/cscc-findings]</H1></p><div class="devsite-article-body clearfix">
<p><a href="/security-command-center/docs">Security Command Center</a> is the security and risk
database for Google Cloud. Security Command Center includes a risk dashboard
and analytics system for surfacing, understanding, and remediating
Google Cloud security and data risks across an organization.</p>
<p>Google Cloud Armor is integrated automatically with Security Command Center and
exports two findings to the Security Command Center dashboard:
<strong>Allowed Traffic Spike</strong> and <strong>Increasing Deny Ratio</strong>. This guide
describes the findings and how to interpret them.</p>
<p>If you do not already have Google Cloud Armor enabled in
Security Command Center, see
<a href="/security-command-center/docs/how-to-configure-security-command-center">Configuring Security Command Center</a>.
You see findings in Security Command Center only for projects that have
Security Command Center enabled at the organization level.</p>
<h2 data-text="Allowed Traffic Spike finding" id="allowed_traffic_spike_finding">Allowed Traffic Spike finding</h2>
<p>Allowed traffic consists of well-formed HTTP(S) requests that are
destined to reach your backend services after a Google Cloud Armor
security policy is enforced.</p>
<p>The <strong>Allowed Traffic Spike</strong> finding notifies you of a spike in allowed traffic
on a per-backend-service basis. A finding is generated when there is a sudden
increase in the allowed number of requests per second (RPS) compared to the
normal volume observed in recent history. The RPS that constituted the spike and
the RPS of the recent history are provided as part of the finding.</p>
<h3 data-text="Use case: Potential L7 attacks" id="use_case_potential_l7_attacks">Use case: Potential L7 attacks</h3>
<p>Distributed denial-of-service (DDoS) attacks occur when attackers send large
volumes of requests to overload a target service. Layer 7 DDoS attack traffic
typically presents a spike in the number of requests per second.</p>
<p>An <strong>Allowed Traffic Spike</strong> finding identifies the backend service to which
the RPS spike is directed and provides the traffic characteristics that caused
Google Cloud Armor to classify it as an RPS spike. Use this information to
determine the following:</p>
<ul>
<li>Whether a potential layer 7 DDoS attack is underway.</li>
<li>The service that is being targeted.</li>
<li>The actions that you can take to mitigate the potential attack.</li>
</ul>
<p>The following is a screenshot of a sample <strong>Allowed Traffic Spike</strong> finding on
the Security Command Center dashboard.</p>
<figure style="text-align: center">
<a href="/armor/images/ca-cscc-allowed.svg">
<img alt="Allowed Traffic Spike finding." border="0" src="/armor/images/ca-cscc-allowed.svg" width="700"/></a>
<figcaption><b>Allowed Traffic Spike</b> finding (click to
   enlarge)</figcaption>
</figure>
<p>Google Cloud calculates the values <strong>Long_Term_Allowed_RPS</strong> and <strong>Short_Term_Allowed_RPS</strong> based on Google Cloud Armor historical
information.</p>
<h2 data-text="Increasing Deny Ratio finding" id="increasing_deny_ratio_finding">Increasing Deny Ratio finding</h2>
<p>The <strong>Increasing Deny Ratio</strong> finding notifies you that there is an increase in
the ratio of traffic that Google Cloud Armor blocks because of a user-configured
rule in a security policy. Although the denial is expected and does
not affect the backend service, this finding helps alert you to increases in
unwanted and potentially malicious traffic targeting your applications. The RPS
of the denied traffic and the total incoming traffic are provided as part of the
finding.</p>
<h3 data-text="Use case: Mitigating L7 attacks" id="use_case_mitigating_l7_attacks">Use case: Mitigating L7 attacks</h3>
<p>An <strong>Increasing Deny Ratio</strong> finding enables you to see both the impact of
successful mitigations and significant changes in the behavior of malicious
clients. The finding identifies the backend to which the denied traffic was
directed and provides the traffic characteristics that caused
Google Cloud Armor to raise the finding. Use this information to evaluate
whether the denied traffic must be studied in detail to further strengthen your
mitigations.</p>
<p>The following is a screenshot of a sample <strong>Increasing Deny Ratio</strong> finding on
the Security Command Center dashboard.</p>
<figure style="text-align: center">
<a href="/armor/images/ca-cscc-increasing.svg">
<img alt="Increasing Deny Ratio finding." border="0" src="/armor/images/ca-cscc-increasing.svg" width="700"/></a>
<figcaption>Increasing Deny Ratio finding (click to
   enlarge)</figcaption>
</figure>
<p>Google Cloud calculates the values <strong>Long_Term_Denied_RPS</strong> and <strong>Long_Term_Incoming_RPS</strong> based on Google Cloud Armor historical
information.</p>
<h2 data-text="After traffic returns to normal" id="after_traffic_returns_to_normal">After traffic returns to normal</h2>
<p>Security Command Center findings are notifications that a particular behavior was
observed at a point in time. No notification is sent when the behavior clears.</p>
<p>There might be updates to existing findings if the current traffic
characteristics increase substantially in comparison to existing
characteristics. If there is no follow-up finding, then either the behavior
cleared or the traffic volume did not increase (allow or deny) substantially
after the initial finding was generated.</p>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
<li><a href="/armor/docs/rules-language-reference">Use the custom rules language reference</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/monitoring]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor exports monitoring data from security policies to
Cloud Monitoring. You can use monitoring metrics to
check whether your policies are working as intended or to troubleshoot problems.
For example, you can view the traffic that was blocked or allowed for each
backend service. You can monitor the metrics of a single security policy
(which can be applied to multiple backend services) or a single backend service.</p>
<p>In addition to the predefined dashboards in Monitoring, you can
create custom dashboards, set up alert policies, and query the metrics through
the <a href="/monitoring/api">Cloud Monitoring API</a>.</p>
<p>On the Monitoring dashboard, <strong>Open incidents</strong> are
driven by the alerting policies that you configure. Alerts appear as <em>incidents</em>
on the dashboard when the alert is triggered. These are general functions of
Monitoring.</p>
<p>There are no Monitoring logs for Security Command Center.</p>
<p>For complete information about Monitoring, see the
<a href="/monitoring/docs">Cloud Monitoring documentation</a>.</p>
<h2 data-text="Viewing the monitoring dashboard" id="viewing_the_monitoring_dashboard">Viewing the monitoring dashboard</h2>
<p>You can monitor the status and request traffic volumes (allowed, denied, or
previewed) on a per-policy and per-backend-service basis by using the
preconfigured <strong>Network Security Policies</strong> resource dashboard in
Cloud Monitoring.</p>
<p>To view the dashboard, follow these steps:</p>
<ol>
<li><p>In the Google Cloud console, go to <strong>Monitoring</strong>.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/monitoring" target="console" track-metadata-position="body" track-name="stackdriverConsoleLink" track-type="article">Go to Monitoring</a> </p></li>
<li><p>In the navigation pane on the left, select <strong>Dashboards</strong>.</p></li>
<li><p>Under <strong>Name</strong>, select <strong>Network Security Policies</strong>.</p></li>
<li><p>Click the name of your policy.</p></li>
</ol>
<p>When you access the dashboard, you see overall metrics on the right. These
include request volume metrics for requests evaluated by a security policy
broken down by outcome: allowed, denied, previewed allowed, previewed denied.
Metrics can be observed at varying levels of granularity, including
per-project, per-policy, and per-backend-service.</p>
<p>When you click a policy name, you see details about the policy.</p>
<figure style="text-align: center">
<a href="/armor/images/monitoring-dashboard.svg">
<img alt="Google Cloud Armor monitoring dashboard." border="0" height="350" src="/armor/images/monitoring-dashboard.svg" width="700"/></a>
<figcaption>Google Cloud Armor monitoring dashboard (click to
   enlarge)</figcaption>
</figure>
<h2 data-text="Defining custom dashboards" id="defining_custom_dashboards">Defining custom dashboards</h2>
<p>To create custom Monitoring dashboards over Network Security
Policy metrics, follow these steps:</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text="Console" id="console">Console</h3><ol>
<li><p>In the Google Cloud console, go to <strong>Monitoring</strong>.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/monitoring" target="console" track-metadata-position="body" track-name="stackdriverConsoleLink" track-type="article">Go to Monitoring</a> </p></li>
<li><p>Click <strong>Dashboards</strong>, and then click <strong>Create dashboard</strong>.</p></li>
<li><p>Create a name for your dashboard, and then click <strong>Confirm</strong>.</p></li>
<li><p>Click <strong>Add chart</strong>.</p></li>
<li><p>Give the chart a title.</p></li>
<li><p>Select metrics and filters. For metrics, the resource type is <strong>Network
Security Policy</strong>.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol></section>
</div>
<h2 data-text="Defining alerting policies" id="defining_alerting_policies">Defining alerting policies</h2>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text="Console" id="console_1">Console</h3><p>
<p>You can create alerting policies to monitor the values of metrics and to notify you when
  those metrics violate a condition. The following steps are for the preview alerting interface.
</p>
<ol>
<li>In the Google Cloud console, go to the <b>Monitoring</b> page.
  <p><a class="button button-primary" href="https://console.cloud.google.com/monitoring" target="console">Go to Monitoring</a></p>
</li>
<li>In the Monitoring navigation pane, select
    <i aria-hidden="true" class="material-icons" translate="no">notifications</i><b>Alerting</b>.</li>
<li>If you haven't created your notification channels and if you want to be notified, then click
      <b>Edit Notification Channels</b> and add your notification channels. Return to the
      <b>Alerting</b> page after you add your channels.
  <li>From the <b>Alerting</b> page, select <b>Create policy</b>.</li>
<li>To select the metric, expand the <b>Select a metric</b> menu and then do the following:

        

        <ol>
<li>To limit the menu to relevant entries, enter <code dir="ltr" translate="no">Network Security Policy</code>
              into the filter bar. If there are no results after you filter the menu, then disable
              the <b>Show only active resources &amp; metrics</b> toggle.

          </li>
<li>For the <b>Resource type</b>, select <b>Network Security Policy</b>.</li>
<li>Select a <b>Metric category</b> and a <b>Metric</b>, and then select <b>Apply</b>.</li>
</ol>
</li>
<li>Click <b>Next</b>.</li>
<li>The settings in the <b>Configure alert trigger</b> page determine when the alert is triggered.

      
      Select a condition type and, if necessary, specify a threshold. For more
      information, see
      <a href="/monitoring/alerts/using-alerting-ui#configure-trigger">Condition trigger</a>.
      
  </li>
<li>Click <b>Next</b>.</li>
<li>Optional: To add notifications to your alerting policy, click
      <b>Notification channels</b>. In the dialog, select one or more notification
      channels from the menu, and then click <b>OK</b>.</li>
<li>Optional: Update the <b>Incident autoclose duration</b>. This field determines when
      Monitoring closes incidents in the absence of metric data.</li>
<li>Optional: Click <b>Documentation</b>, and then add any information that you
      want included in a notification message.</li>
<li>Click <b>Alert name</b> and enter a name for the alerting policy.</li>
<li>Click <b>Create Policy</b>.</li>
</li></ol>

For more information, see <a href="/monitoring/alerts">Alerting policies</a>.
</p></section>
</div>
<h2 data-text="Metric reporting frequency and retention" id="metric_reporting_frequency_and_retention">Metric reporting frequency and retention</h2>
<p>Metrics for the Google Cloud Armor security policies are exported to
Cloud Monitoring in one-minute granularity batches. Monitoring data is
retained for six weeks. The dashboard provides data analysis in the following
default intervals:</p>
<ul>
<li>1H (one hour)</li>
<li>6H (six hours)</li>
<li>1D (one day)</li>
<li>1W (one week)</li>
<li>6W (six weeks)</li>
</ul>
<p>Using the controls in the upper-right corner of the <strong>Monitoring</strong>
page, you can manually request analysis in any interval from 6W to 1 minute.</p>
<h2 data-text="Monitoring metrics for security policies" id="monitoring_metrics_for_security_policies">Monitoring metrics for security policies</h2>
<p>The following metrics are reported on the <strong>Network Security Policies</strong>
dashboard:</p>
<table>
<thead>
<tr>
<th width="25%">Metric</th>
<th width="75%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><b>Requests</b> count</td>
<td>The number of requests processed by a Google Cloud Armor security
         policy.</td>
</tr>
<tr>
<td><b>Previewed Requests</b> count</td>
<td>
<p>The number of requests that match preview-mode rules. <b>Previewed
           Requests</b> are logged, but the corresponding action is not enforced.</p>
<p>The <b>Previewed Requests</b> counts are included in the preceding
           <b>Requests</b> count metric because all requests are expected to match
           a configured non-preview rule or the default rule.</p></td>
</tr>
</tbody>
</table>
<h2 data-text="Filtering dimensions for security policies" id="filtering_dimensions_for_security_policies">Filtering dimensions for security policies</h2>
<p>Metrics are aggregated for each Google Cloud Armor security policy. You can
filter aggregated metrics by the following dimensions:</p>
<table>
<thead>
<tr>
<th width="25%">Dimension</th>
<th width="75%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>backend_target_name</td>
<td>Track requests based on the backend target (service) that the
         traffic was destined to.</td>
</tr>
<tr>
<td>blocked</td>
<td>Track requests based on whether they were allowed or blocked by the
         security policy rules.</td>
</tr>
</tbody>
</table>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
<li><a href="/armor/docs/rules-language-reference">Use the custom rules language reference</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/audit-logging]</H1></p><div class="devsite-article-body clearfix">
<p>This document describes the audit logs created by Google Cloud Armor as part of
<a href="/logging/docs/audit">Cloud Audit Logs</a>.</p>
<h2 data-text="Overview" id="overview">Overview</h2>
<p>Google Cloud services write audit logs to help you answer the questions, "Who
did what, where, and when?" within your Google Cloud resources.</p>
<p>Your Google Cloud projects contain only the audit logs for resources that are
directly within the Cloud project. Other Google Cloud resources,
such as folders, organizations, and billing accounts, contain the audit logs for
the entity itself.</p>
<p>For a general overview of Cloud Audit Logs, see
<a href="/logging/docs/audit">Cloud Audit Logs overview</a>. For a deeper understanding of
the audit log format, see
<a href="/logging/docs/audit/understanding-audit-logs">Understand audit logs</a>.</p>
<h2 data-text="Available audit logs" id="available-logs">Available audit logs</h2>
<p>The following types of audit logs are available for Google Cloud Armor:</p>
<ul>
<li>
<p>
        Admin Activity audit logs
      </p>
<p>
        Includes "admin write" operations that write metadata or configuration
        information.
      </p>
<p>
        You can't disable Admin Activity audit logs.
      </p>
</li>
<li>
<p>
        Data Access audit logs
      </p>
<p>
        Includes "admin read" operations that read metadata or configuration
        information. Also includes "data read" and "data write" operations that
        read or write user-provided data.
      </p>
<p>
          To receive Data Access audit logs, you must
          <a href="/logging/docs/audit/configure-data-access#config-console-enable">
            explicitly enable</a> them.
        </p>
</li>
</ul>
<p>For fuller descriptions of the audit log types, see
<a href="/logging/docs/audit#types">Types of audit logs</a>.</p>
<h2 data-text="Audited operations" id="audited_operations">Audited operations</h2>
<p>The following summarizes which API operations correspond to each audit log
type in Google Cloud Armor:</p>
<p>
<table>
<thead>
<tr>
<th>Audit logs category</th>
<th>Google Cloud Armor operations</th>
</tr>
</thead>
<tbody>
<tr>
<td>Admin Activity audit logs</td>
<td>backendServices.delete<br/>backendServices.insert<br/>backendServices.patch<br/>backendServices.setSecurityPolicy<br/>backendServices.update<br/>securityPolicies.addRule<br/>securityPolicies.delete<br/>securityPolicies.insert<br/>securityPolicies.patch<br/>securityPolicies.patchRule<br/>securityPolicies.removeRule<br/></td>
</tr>
<tr>
<td>Data Access audit logs</td>
<td>backendServices.aggregatedList<br/>backendServices.get<br/>backendServices.getHealth<br/>backendServices.getbackendServicestatus<br/>backendServices.list<br/>securityPolicies.get<br/>securityPolicies.getRule<br/>securityPolicies.list</td>
</tr>
</tbody>
</table>
</p>
<h2 data-text="Audit log format" id="audit_log_format">Audit log format</h2>
<p>Audit log entries include the following objects:</p>
<ul>
<li><p>The log entry itself, which is an object of type <a href="/logging/docs/reference/v2/rest/v2/LogEntry"><code dir="ltr" translate="no">LogEntry</code></a>.
Useful fields include the following:</p>
<ul>
<li>The <code dir="ltr" translate="no">logName</code> contains the resource ID and audit log type.</li>
<li>The <code dir="ltr" translate="no">resource</code> contains the target of the audited operation.</li>
<li>The <code dir="ltr" translate="no">timeStamp</code> contains the time of the audited operation.</li>
<li>The <code dir="ltr" translate="no">protoPayload</code> contains the audited information.</li>
</ul></li>
<li><p>The audit logging data, which is an <a href="/logging/docs/reference/audit/auditlog/rest/Shared.Types/AuditLog"><code dir="ltr" translate="no">AuditLog</code></a> object held in
the <code dir="ltr" translate="no">protoPayload</code> field of the log entry.</p></li>
<li><p>Optional service-specific audit information, which is a service-specific
object. For earlier integrations, this object is held in the <code dir="ltr" translate="no">serviceData</code>
field of the <code dir="ltr" translate="no">AuditLog</code> object; later integrations use the <code dir="ltr" translate="no">metadata</code> field.</p></li>
</ul>
<p>For other fields in these objects, and how to interpret them, review
<a href="/logging/docs/audit/understanding-audit-logs">Understand audit logs</a>.</p>
<h3 data-text="Log name" id="log_name">Log name</h3>
<p>Cloud Audit Logs log names include resource identifiers indicating the
Cloud project or other Google Cloud entity that owns the audit
logs, and whether the log contains Admin Activity, Data Access, Policy Denied,
or System Event audit logging data.</p>
<p>The following are the audit log names, including variables for the resource
identifiers:</p>
<pre class="devsite-click-to-copy" dir="ltr" lang-sql="" translate="no">
   projects/<var translate="no">PROJECT_ID</var>/logs/cloudaudit.googleapis.com%2Factivity
   projects/<var translate="no">PROJECT_ID</var>/logs/cloudaudit.googleapis.com%2Fdata_access
   projects/<var translate="no">PROJECT_ID</var>/logs/cloudaudit.googleapis.com%2Fsystem_event
   projects/<var translate="no">PROJECT_ID</var>/logs/cloudaudit.googleapis.com%2Fpolicy

   folders/<var translate="no">FOLDER_ID</var>/logs/cloudaudit.googleapis.com%2Factivity
   folders/<var translate="no">FOLDER_ID</var>/logs/cloudaudit.googleapis.com%2Fdata_access
   folders/<var translate="no">FOLDER_ID</var>/logs/cloudaudit.googleapis.com%2Fsystem_event
   folders/<var translate="no">FOLDER_ID</var>/logs/cloudaudit.googleapis.com%2Fpolicy

   billingAccounts/<var translate="no">BILLING_ACCOUNT_ID</var>/logs/cloudaudit.googleapis.com%2Factivity
   billingAccounts/<var translate="no">BILLING_ACCOUNT_ID</var>/logs/cloudaudit.googleapis.com%2Fdata_access
   billingAccounts/<var translate="no">BILLING_ACCOUNT_ID</var>/logs/cloudaudit.googleapis.com%2Fsystem_event
   billingAccounts/<var translate="no">BILLING_ACCOUNT_ID</var>/logs/cloudaudit.googleapis.com%2Fpolicy

   organizations/<var translate="no">ORGANIZATION_ID</var>/logs/cloudaudit.googleapis.com%2Factivity
   organizations/<var translate="no">ORGANIZATION_ID</var>/logs/cloudaudit.googleapis.com%2Fdata_access
   organizations/<var translate="no">ORGANIZATION_ID</var>/logs/cloudaudit.googleapis.com%2Fsystem_event
   organizations/<var translate="no">ORGANIZATION_ID</var>/logs/cloudaudit.googleapis.com%2Fpolicy
</pre>
<aside class="note"><strong>Note:</strong><span> The part of the log name following <code dir="ltr" translate="no">/logs/</code> must be URL-encoded. The
forward-slash character, <code dir="ltr" translate="no">/</code>, must be written as <code dir="ltr" translate="no">%2F</code>.</span></aside>
<h3 data-text="Service name" id="service_name">Service name</h3>
<p>
Google Cloud Armor audit logs use the service name
<code dir="ltr" translate="no">compute.googleapis.com</code>.
</p>
<p>For a list of all the Cloud Logging API service names and their corresponding
monitored resource type, see
<a href="/logging/docs/api/v2/resource-list#service-names">Map services to resources</a>.</p>
<h3 data-text="Resource types" id="resource_types">Resource types</h3>
<p>
Google Cloud Armor audit logs use the resource types
<code dir="ltr" translate="no">backendServices</code> and <code dir="ltr" translate="no">securityPolicies</code>for all audit
logs.
</p>
<p>For a list of all the Cloud Logging monitored resource types and descriptive
information, see
<a href="/logging/docs/api/v2/resource-list#resource-types">Monitored resource types</a>.</p>
<h2 data-text="Enable audit logging" id="enabling_audit_logging">Enable audit logging</h2>
<p>Admin Activity audit logs are always enabled; you can't disable them.</p>
<p>Data Access audit logs are disabled by default and aren't written unless
explicitly enabled (the exception is Data Access audit logs for
BigQuery, which can't be disabled).</p>
<p>For information about enabling some or all of your Data Access audit logs, see
<a href="/logging/docs/audit/configure-data-access">Configure Data Access audit logs</a>.</p>
<h2 data-text="Permissions and roles" id="audit_log_permissions">Permissions and roles</h2>
<p><a href="/iam/docs">IAM</a> permissions and roles determine your ability to
access audit logs data in Google Cloud resources.</p>
<p>When deciding which
<a href="/logging/docs/access-control#permissions_and_roles">Logging-specific permissions and roles</a>
apply to your use case, consider the following:</p>
<ul>
<li><p>The Logs Viewer role (<code dir="ltr" translate="no">roles/logging.viewer</code>) gives you read-only access to
Admin Activity, Policy Denied, and System Event audit logs. If you have just
this role, you cannot view Data Access audit logs that are in the
<code dir="ltr" translate="no">_Required</code> and <code dir="ltr" translate="no">_Default</code> buckets.</p></li>
<li><p>The Private Logs Viewer role<code dir="ltr" translate="no">(roles/logging.privateLogViewer</code>) includes the
permissions contained in <code dir="ltr" translate="no">roles/logging.viewer</code>, plus the ability to read
Data Access audit logs in the <code dir="ltr" translate="no">_Required</code> and <code dir="ltr" translate="no">_Default</code> buckets.</p>
<p>Note that if these private logs are stored in user-defined buckets, then any
user who has permissions to read logs in those buckets can read the private
logs. For more information about log buckets, see
<a href="/logging/docs/routing/overview">Routing and storage overview</a>.</p></li>
</ul>
<p>For more information about the IAM permissions and roles that
apply to audit logs data, see
<a href="/logging/docs/access-control">Access control with IAM</a>.</p>
<h2 data-text="View logs" id="viewing_logs">View logs</h2>
<p>To query for audit logs, you need to know the <a href="#log_name">audit log name</a>, which includes the
<a href="/resource-manager/docs/creating-managing-projects#identifying_projects">resource identifier</a>
of the Cloud project, folder, billing account, or
organization for which you want to view audit logging information. In your
query, you can further specify other indexed <a href="/logging/docs/reference/v2/rest/v2/LogEntry"><code dir="ltr" translate="no">LogEntry</code></a> fields, such
as <code dir="ltr" translate="no">resource.type</code>. For more information on querying, see
<a href="/logging/docs/view/building-queries">Build queries in the Logs Explorer</a>.</p>


You can view audit logs in Cloud Logging by using the
Cloud console, the Google Cloud CLI, or the Logging API.



<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text="Console" id="console">Console</h3><p>In the Cloud console, you can use the Logs Explorer
to retrieve your audit log entries for your Cloud project, folder,
or organization:</p>
<aside class="note"><strong>Note:</strong><span> You can't view audit logs for Cloud Billing accounts in the
Cloud console. You must use the API or the gcloud CLI.</span></aside>
<ol>
<li><p>In the Cloud console, go to the
<strong>Logging<span aria-label="and then">&gt;</span> Logs Explorer</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/logs/query" target="console">Go to Logs Explorer</a> </p></li>
<li><p>Select an existing Cloud project, folder, or organization.</p></li>
<li><p>In the <strong>Query builder</strong> pane, do the following:</p>
<ul>
<li><p>In <strong>Resource type</strong>, select the Google Cloud resource whose
audit logs you want to see.</p></li>
<li><p>In <strong>Log name</strong>, select the audit log type that you want to see:</p>
<ul>
<li>For Admin Activity audit logs, select <strong>activity</strong>.</li>
<li>For Data Access audit logs, select <strong>data_access</strong>.</li>
<li>For System Event audit logs, select <strong>system_event</strong>.</li>
<li>For Policy Denied audit logs, select <strong>policy</strong>.</li>
</ul></li>
</ul>
<p>If you don't see these options, then there aren't any audit logs of
that type available in the Cloud project, folder, or
organization.</p>
<p>If you're experiencing issues when trying to view logs in the
Logs Explorer, see the
<a href="/logging/docs/view/logs-explorer-interface#troubleshooting">troubleshooting</a>
information.</p>
<p>For more information about querying by using the Logs Explorer, see
<a href="/logging/docs/view/building-queries">Build queries in the Logs Explorer</a>.</p></li>
</ol></section>
<section><h3 data-text="gcloud" id="gcloud">gcloud</h3><p>The Google Cloud CLI provides a command-line interface to the
Logging API. Supply a valid resource identifier in each of the log
names. For example, if your query includes a <var translate="no">PROJECT_ID</var>, then the
project identifier you supply must refer to the currently selected
Cloud project.</p>
<p>To read your Cloud project-level audit log entries, run
the following command:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud logging read "logName : projects/<var translate="no">PROJECT_ID</var>/logs/cloudaudit.googleapis.com" \
    --project=<var translate="no">PROJECT_ID</var>
</pre>
<p>To read your folder-level audit log entries, run the following command:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud logging read "logName : folders/<var translate="no">FOLDER_ID</var>/logs/cloudaudit.googleapis.com" \
    --folder=<var translate="no">FOLDER_ID</var>
</pre>
<p>To read your organization-level audit log entries, run the following
command:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud logging read "logName : organizations/<var translate="no">ORGANIZATION_ID</var>/logs/cloudaudit.googleapis.com" \
    --organization=<var translate="no">ORGANIZATION_ID</var>
</pre>
<p>To read your Cloud Billing account-level audit log entries, run the following command:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud logging read "logName : billingAccounts/<var translate="no">BILLING_ACCOUNT_ID</var>/logs/cloudaudit.googleapis.com" \
    --billing-account=<var translate="no">BILLING_ACCOUNT_ID</var>
</pre>
<p>Add the <a href="/sdk/gcloud/reference/logging/read#--freshness"><code dir="ltr" translate="no">--freshness</code> flag</a>
to your command to read logs that are more than 1 day old.</p>
<p>For more information about using the gcloud CLI, see
<a href="/sdk/gcloud/reference/logging/read"><code dir="ltr" translate="no">gcloud logging read</code></a>.</p></section>
<section><h3 data-text="API" id="api">API</h3><p>When building your queries, supply a valid resource identifier in each of
the log names. For example, if your query includes a <var translate="no">PROJECT_ID</var>,
then the project identifier you supply must refer to the currently selected
Cloud project.</p>
<p>For example, to use the Logging API to view your project-level
audit log entries, do the following:</p>
<ol>
<li><p>Go to the <strong>Try this API</strong> section in the documentation for the
<a href="/logging/docs/reference/v2/rest/v2/entries/list"><code dir="ltr" translate="no">entries.list</code></a>
method.</p></li>
<li><p>Put the following into the <strong>Request body</strong> part of the <strong>Try this
API</strong> form. Clicking this <a href="/logging/docs/reference/v2/rest/v2/entries/list?apix_params=%7B%22resource%22%3A%7B%22resourceNames%22%3A%5B%22projects%2F%5BPROJECT_ID%5D%22%5D%2C%22pageSize%22%3A5%2C%22filter%22%3A%22logName%3D(projects%2F%5BPROJECT_ID%5D%2Flogs%2Fcloudaudit.googleapis.com%252Factivity%20OR%20projects%2F%5BPROJECT_ID%5D%2Flogs%2Fcloudaudit.googleapis.com%252Fsystem_events%20OR%20projects%2F%5BPROJECT_ID%5D%2Flogs%2Fcloudaudit.googleapis.com%252Fdata_access)%22%7D%7D">prepopulated form</a>
automatically fills the request body, but you need to supply a valid
<var translate="no">PROJECT_ID</var> in each of the log names.</p>
<pre class="devsite-click-to-copy" dir="ltr" lang-html="" translate="no">
{
  "resourceNames": [
    "projects/<var translate="no">PROJECT_ID</var>"
  ],
  "pageSize": 5,
  "filter": "logName : projects/<var translate="no">PROJECT_ID</var>/logs/cloudaudit.googleapis.com"
}
</pre></li>
<li><p>Click <strong>Execute</strong>.</p></li>
</ol></section>
</div>
<h2 data-text="Route audit logs" id="exporting_audit_logs">Route audit logs</h2>
<p>You can <a href="/logging/docs/routing/overview">route audit logs</a> to supported
destinations in the same way that you can route other kinds of logs. Here are
some reasons you might want to route your audit logs:</p>
<ul>
<li><p>To keep audit logs for a longer period of time or to use more powerful
search capabilities, you can route copies of your audit logs to
Cloud Storage, BigQuery, or Pub/Sub. Using
Pub/Sub, you can route to other applications, other
repositories, and to third parties.</p></li>
<li><p>To manage your audit logs across an entire organization, you can create
<a href="/logging/docs/export/aggregated_sinks">aggregated sinks</a> that can
route logs from any or all Cloud projects in the organization.</p></li>
</ul>
<ul>
<li>If your enabled Data Access audit logs are pushing your
Cloud projects over your log allotments, you can create sinks that
exclude the Data Access audit logs from Logging.</li>
</ul>
<p>For instructions about routing logs, see
<a href="/logging/docs/export/configure_export_v2">Configure and manage sinks </a>.</p>
<h2 data-text="Pricing" id="pricing">Pricing</h2>
<p>For information about Cloud Logging pricing, see
<a href="/stackdriver/pricing#logging-costs">Google Cloud's operations suite pricing: Cloud Logging</a>.</p>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
<li><a href="/armor/docs/rules-language-reference">Use the custom rules language reference</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="mwETRvWii0eU5NUYprb0Y9z5GVbc" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/request-logging]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor per-request logs for security policy name, match rule priority,
associated action, and related information are logged as part of logging for
HTTP(S) Load Balancing, TCP Proxy Load Balancing, and SSL Proxy Load Balancing. Logging for
new backend services is disabled by default, so you must enable logging to
record complete logging information for Google Cloud Armor.</p>
<p>Because Google Cloud Armor logs are part of the Cloud Load Balancing logs,
Google Cloud Armor log generation is subject to the log sampling rate
configured for your load balancer. If you reduce the sampling rate
for your HTTP(S) Load Balancing, TCP Proxy Load Balancing, or SSL Proxy Load Balancing,
your Google Cloud Armor requests logs are sampled at that reduced rate.</p>
<p>Using logging, you can view every request evaluated by a Google Cloud Armor
security policy and the outcome or action taken. For example, to view denied
requests, you can use filters such as
<code dir="ltr" translate="no">jsonPayload.enforcedSecurityPolicy.outcome="DENY"</code> or
<code dir="ltr" translate="no">jsonPayload.statusDetails="denied_by_security_policy"</code>.</p>
<p>To enable logging for HTTP(S) Load Balancing, see
<a href="/load-balancing/docs/https/https-logging-monitoring#logging">HTTP(S) Load Balancing logging and monitoring</a>.
For TCP Proxy Load Balancing and SSL Proxy Load Balancing, you can use the Google Cloud CLI
commands as listed in the previous <em>HTTP(S) Load Balancing logging and monitoring</em>
page. You cannot enable logging for TCP Proxy Load Balancing and SSL Proxy Load Balancing
using the Google Cloud console.</p>
<p>In addition, you can set different logging levels to help you evaluate whether
your security policies and their rules are working as intended. For complete
information, see <a href="#verbose-logging">Verbose logging</a>.</p>
<h2 data-text="Security policy log entries" id="security_policy_log_entries">Security policy log entries</h2>
<p>The following log entries in the <strong>Logs Explorer</strong> are for Google Cloud Armor
security policy and rules logging. The entries include the following structure
in <code dir="ltr" translate="no">jsonPayload</code>. HTTP request details appear in the <code dir="ltr" translate="no">httpRequest</code> message.</p>
<ul>
<li><code dir="ltr" translate="no">statusDetails</code> (string): a textual description of the response code.
<ul>
<li><code dir="ltr" translate="no">redirected_by_security_policy</code>: the request was redirected by a redirect
rule, either <code dir="ltr" translate="no">GOOGLE_RECAPTCHA</code> or <code dir="ltr" translate="no">EXTERNAL_302</code>.</li>
<li><code dir="ltr" translate="no">denied_by_security_policy</code>: a request was denied by the load balancer
because of a Google Cloud Armor security policy.</li>
<li><code dir="ltr" translate="no">body_denied_by_security_policy</code>: a request body was denied by the load
balancer because of a Google Cloud Armor security policy.</li>
</ul></li>
<li><code dir="ltr" translate="no">enforcedSecurityPolicy</code>: the security policy rule that was
enforced.
<ul>
<li><code dir="ltr" translate="no">name</code> (string): the name of the security policy.</li>
<li><code dir="ltr" translate="no">priority</code> (number): the priority of the matching rule in the security
policy.</li>
<li><code dir="ltr" translate="no">configuredAction</code> (string): the name of the configured action in the
matching rule—for example, <code dir="ltr" translate="no">ALLOW</code>, <code dir="ltr" translate="no">DENY</code>, <code dir="ltr" translate="no">GOOGLE_RECAPTCHA</code>, <code dir="ltr" translate="no">EXTERNAL_302</code>,
<code dir="ltr" translate="no">THROTTLE</code> (for a throttle rule), <code dir="ltr" translate="no">RATE_BASED_BAN</code> (for a rate-based ban rule).</li>
<li><code dir="ltr" translate="no">rateLimitAction</code>: information about the rate limit action when a
throttle rule or rate-based ban rule is matched.
<ul>
<li><code dir="ltr" translate="no">key</code> (string): rate limit key value (up to 32 bytes). This field is
omitted if the key type is <code dir="ltr" translate="no">ALL</code>, or if the key type is <code dir="ltr" translate="no">HTTP-HEADER</code> or
<code dir="ltr" translate="no">HTTP-COOKIE</code> and the specified header or cookie is not present in the
request.</li>
<li><code dir="ltr" translate="no">outcome</code> (string): possible values are as follows:
<ul>
<li><code dir="ltr" translate="no">"RATE_LIMIT_THRESHOLD_CONFORM"</code> if under the configured rate limit
threshold.</li>
<li><code dir="ltr" translate="no">"RATE_LIMIT_THRESHOLD_EXCEED"</code> if above the configured rate limit
threshold.</li>
<li><code dir="ltr" translate="no">"BAN_THRESHOLD_EXCEED"</code> if above the configured ban threshold.</li>
</ul></li>
</ul></li>
<li><code dir="ltr" translate="no">outcome</code> (string): the outcome of executing the configured
action—for example, <code dir="ltr" translate="no">ACCEPT</code>, <code dir="ltr" translate="no">DENY</code>, <code dir="ltr" translate="no">REDIRECT</code>, <code dir="ltr" translate="no">EXEMPT</code>.</li>
<li><code dir="ltr" translate="no">preconfiguredExprIds</code> (string): the IDs of all preconfigured WAF rule
expressions that triggered the rule.</li>
</ul></li>
<li><code dir="ltr" translate="no">previewSecurityPolicy</code>: populated if a request matches a rule configured for
preview (present only when a preview rule would have taken priority over the
enforced rule).
<ul>
<li><code dir="ltr" translate="no">name</code> (string): the name of the security policy</li>
<li><code dir="ltr" translate="no">priority</code> (number): the priority of the matching rule in the security
policy.</li>
<li><code dir="ltr" translate="no">configuredAction</code> (string): the name of the configured action in the
matching rule—for example, <code dir="ltr" translate="no">ALLOW</code>, <code dir="ltr" translate="no">DENY</code>, <code dir="ltr" translate="no">GOOGLE_RECAPTCHA</code>, <code dir="ltr" translate="no">EXTERNAL_302</code>,
<code dir="ltr" translate="no">THROTTLE</code> (for a throttle rule), <code dir="ltr" translate="no">RATE_BASED_BAN</code> (for a rate-based ban rule).</li>
<li><code dir="ltr" translate="no">rateLimitAction</code>: information about the rate limit action when a
throttle rule or rate-based ban rule is matched.
<ul>
<li><code dir="ltr" translate="no">key</code> (string): rate limit key value (up to 32 bytes). This field is omitted
if the key type is <code dir="ltr" translate="no">ALL</code>, or if the key type is <code dir="ltr" translate="no">HTTP-HEADER</code> or
<code dir="ltr" translate="no">HTTP-COOKIE</code> and the specified header or cookie is not present in the
request.</li>
<li><code dir="ltr" translate="no">outcome</code> (string): possible values are as follows:
<ul>
<li><code dir="ltr" translate="no">"RATE_LIMIT_THRESHOLD_CONFORM"</code> if under the configured rate limit
threshold.</li>
<li><code dir="ltr" translate="no">"RATE_LIMIT_THRESHOLD_EXCEED"</code> if above the configured rate limit
threshold.</li>
<li><code dir="ltr" translate="no">"BAN_THRESHOLD_EXCEED"</code> if above the configured ban threshold.</li>
</ul></li>
</ul></li>
<li><code dir="ltr" translate="no">outcome</code> (string): the outcome of executing the configured.</li>
<li><code dir="ltr" translate="no">outcome</code> (string): the outcome of executing the configured
action—for example, <code dir="ltr" translate="no">ACCEPT</code>, <code dir="ltr" translate="no">DENY</code>, <code dir="ltr" translate="no">REDIRECT</code>, <code dir="ltr" translate="no">EXEMPT</code>.</li>
<li><code dir="ltr" translate="no">preconfiguredExprIds</code> (string): the IDs of all preconfigured WAF rule
expressions that triggered the rule.</li>
</ul></li>
<li><code dir="ltr" translate="no">enforcedEdgeSecurityPolicy</code> (<a href="/products#product-launch-stages">Preview</a>):
the edge security policy rule that was enforced.
<ul>
<li><code dir="ltr" translate="no">name</code> (string): the name of the security policy.</li>
<li><code dir="ltr" translate="no">priority</code> (number): the priority of the matching rule in the security
policy.</li>
<li><code dir="ltr" translate="no">configuredAction</code> (string): the name of the configured action in the
matching rule—for example, <code dir="ltr" translate="no">ALLOW</code>, <code dir="ltr" translate="no">DENY</code>.</li>
<li><code dir="ltr" translate="no">outcome</code> (string): the outcome of executing the configured
action—for example, <code dir="ltr" translate="no">ACCEPT</code>, <code dir="ltr" translate="no">DENY</code>.</li>
</ul></li>
<li><code dir="ltr" translate="no">previewEdgeSecurityPolicy</code> (<a href="/products#product-launch-stages">Preview</a>):
populated if a request matches an edge security policy rule configured for
preview (present only when a preview rule would have taken priority over the
enforced rule).
<ul>
<li><code dir="ltr" translate="no">name</code> (string): the name of the security policy.</li>
<li><code dir="ltr" translate="no">priority</code> (number): the priority of the matching rule in the security
policy.</li>
<li><code dir="ltr" translate="no">configuredAction</code> (string): the name of the configured action in the
matching rule—for example, <code dir="ltr" translate="no">ALLOW</code>, <code dir="ltr" translate="no">DENY</code>.</li>
<li><code dir="ltr" translate="no">outcome</code> (string): the outcome of executing the configured
action—for example, <code dir="ltr" translate="no">ACCEPT</code>, <code dir="ltr" translate="no">DENY</code>.</li>
</ul></li>
</ul>
<h2 data-text="Verbose logging" id="verbose-logging">Verbose logging</h2>
<p>It can be difficult to tell why a preconfigured WAF rule was triggered by a
particular request. Google Cloud Armor's default event logs contain the rule
that was triggered, as well as the subsignature. However, you might need to identify
the details from the incoming request that triggered the rule for
troubleshooting, rule validation, or rule tuning purposes.</p>
<p>You can change the level of detail logged for a policy by using the <code dir="ltr" translate="no">--log-level</code>
flag. This flag can have the values <code dir="ltr" translate="no">NORMAL</code> or <code dir="ltr" translate="no">VERBOSE</code>:</p>
<p><code dir="ltr" translate="no">--log-level=[NORMAL | VERBOSE]</code></p>
<p>For example:</p>
<div class="example">
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies update ca-policy-1 \
    --log-level=VERBOSE
</pre>
</div>
<p>We recommend that you enable verbose logging when you first create a
policy, make changes to a policy, or troubleshoot a policy.</p>
<h3 data-text="Values logged when verbose logging is enabled" id="verbose-values">Values logged when verbose logging is enabled</h3>
<p>When verbose logging is enabled, additional information is logged to the
load balancing request log that is sent to Cloud Logging. The
following additional fields appear in the request log when verbose logging is
enabled:</p>
<ul>
<li><p><code dir="ltr" translate="no">matchedFieldType</code> (string): This is the type of field causing the match.</p>
<ul>
<li><code dir="ltr" translate="no">ARG_NAMES</code></li>
<li><code dir="ltr" translate="no">ARG_VALUES</code></li>
<li><p><code dir="ltr" translate="no">BODY</code></p>
<ul>
<li>When the <code dir="ltr" translate="no">BODY</code> field is in the log, it means that the entire post body
matches a rule.</li>
</ul></li>
<li><p><code dir="ltr" translate="no">COOKIE_VALUES</code></p></li>
<li><p><code dir="ltr" translate="no">COOKIE_NAMES</code></p></li>
<li><p><code dir="ltr" translate="no">FILENAME</code></p></li>
<li><p><code dir="ltr" translate="no">HEADER_VALUES</code></p></li>
<li><p><code dir="ltr" translate="no">RAW_URI</code></p></li>
<li><p><code dir="ltr" translate="no">REFERER</code></p></li>
<li><p><code dir="ltr" translate="no">REQUEST_LINE</code></p></li>
<li><p><code dir="ltr" translate="no">URI</code></p></li>
<li><p><code dir="ltr" translate="no">USER_AGENT</code></p></li>
<li><p><code dir="ltr" translate="no">HEADER_NAMES</code></p></li>
<li><p><code dir="ltr" translate="no">ARGS_GET</code></p></li>
<li><p><code dir="ltr" translate="no">X_FILENAME</code></p></li>
<li><p><code dir="ltr" translate="no">ARG_NAME_COUNT</code></p></li>
<li><p><code dir="ltr" translate="no">TRANSFER_ENCODING</code></p></li>
<li><p><code dir="ltr" translate="no">REQUEST_METHOD</code></p></li>
</ul></li>
<li><p><code dir="ltr" translate="no">matchedFieldName</code> (string): If this matches the value part of a key-value pair,
the key value is stored in this field. Otherwise, it is empty.</p></li>
<li><p><code dir="ltr" translate="no">matchedFieldValue</code> (string): A prefix of up to 16 bytes for the part of the field
that causes the match.</p></li>
<li><p><code dir="ltr" translate="no">matchedFieldLength</code> (integer): The total length of the field.</p></li>
<li><p><code dir="ltr" translate="no">matchedOffset</code> (integer): The start offset inside the field that causes the match.</p></li>
<li><p><code dir="ltr" translate="no">matchedLength</code> (integer): The length of the match.</p></li>
</ul>
<p>For example, you might send this request to a project where SQL injection WAF
rules are enabled:</p>
<pre dir="ltr" translate="no">
curl http://IP_ADDR/?sql_table=abc%20pg_catalog%20xyz
</pre>
<p>The entry in the <strong>Logs Explorer</strong> would look like the following:</p>
<pre dir="ltr" translate="no">
enforcedSecurityPolicy: {
 name: "user-staging-sec-policy"
 priority: 100
 configuredAction: "DENY"
 outcome: "DENY
 preconfiguredExprIds: [
   0: "owasp-crs-v030001-id942140-sqli"
  ]
matchedFieldType: "ARG_VALUES"
matchedFieldName: "sql_table"
matchedFieldValue: "pg_catalog"
matchedFieldLength: 18
matchedOffset: 4
matchedLength: 10
}
</pre>
<h3 data-text="Maintaining privacy when verbose logging is turned on" id="maintaining_privacy_when_verbose_logging_is_turned_on">Maintaining privacy when verbose logging is turned on</h3>
<p>When you use verbose logging, Google Cloud Armor logs snippets of the elements
from the incoming requests that triggered a particular preconfigured WAF rule.
These snippets might contain pieces of request headers, request parameters, or
elements of the POST body. It is possible that a snippet contains sensitive data
such as an IP address or other sensitive data from the incoming request,
depending on what is in the request headers or body and what triggers the WAF
rule.</p>
<p>By enabling verbose logging, be aware that there is a risk of accumulating
potentially sensitive data in your logs in Logging. We recommend
that you enable verbose logging only during rule creation and validation or for
troubleshooting. During normal operations, we recommend that you leave verbose
logging disabled.</p>
<h2 data-text="Viewing logs" id="view-logs">Viewing logs</h2>
<p>You can view the logs for a Google Cloud Armor security policy only in the
Google Cloud console.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" Console " id="console"> Console </h3><ol>
<li><p>In the Google Cloud console, go to the <strong>Network Security</strong> page.</p>
<p><a class="button button-primary" href="https://console.cloud.google.com/net-security/" target="console">Go to Network Security</a> </p></li>
<li><p>On the <strong>Security policies</strong> page, in the row for a security policy,
click
<span aria-hidden="true" class="material-icons" translate="no">more_vert</span><strong>Menu</strong>
for the policy whose logs you want to view.</p></li>
<li><p>Select <strong>View logs</strong>.</p></li>
</ol></section>
</div>
<h2 data-text="Bot management" id="recaptcha">Bot management</h2>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
<p>To give visibility into how Google Cloud Armor evaluates
reCAPTCHA Enterprise tokens, <code dir="ltr" translate="no">jsonPayload</code> has the following additional field:</p>
<ul>
<li><code dir="ltr" translate="no">securityPolicyRequestData</code>: data pertaining to the request while being
processed by a security policy, regardless of which rule is matched eventually.
<ul>
<li><code dir="ltr" translate="no">recaptchaActionToken</code>: data related to a reCAPTCHA Enterprise action-token.
<ul>
<li><code dir="ltr" translate="no">score (float)</code>: a user legitimacy score embedded in a
reCAPTCHA Enterprise action-token. Only present when a reCAPTCHA Enterprise
action-token is attached with the request and it is decoded successfully
based on a security policy rule. For more information, see
<a href="/armor/docs/configure-security-policies#enforce-assessment">Enforce reCAPTCHA Enterprise assessment</a>.</li>
</ul></li>
<li><code dir="ltr" translate="no">recaptchaSessionToken</code>: data related to a reCAPTCHA Enterprise session-token.
<ul>
<li><code dir="ltr" translate="no">score (float)</code>: a user legitimacy score embedded in a
reCAPTCHA Enterprise session-token. Only present when a reCAPTCHA Enterprise
session-token is attached with the request and it is decoded successfully
based on a security policy rule. For more information, see
<a href="/armor/docs/configure-security-policies#enforce-assessment">Enforce reCAPTCHA Enterprise assessment</a>.</li>
</ul></li>
</ul></li>
</ul>
<h2 data-text="Log examples" id="log_examples">Log examples</h2>
<p>The following is an example of log details for a throttle rule that blocks a
request:</p>
<div class="example">
<pre dir="ltr" translate="no">
jsonPayload: {
 enforcedSecurityPolicy: {
  priority: 100
  name: "sample-prod-policy"
  configuredAction: "THROTTLE"
  outcome: "DENY"
  rateLimitAction: {
    key:"sample-key"
    outcome:"RATE_LIMIT_THRESHOLD_EXCEED"
  }
 }
 @type: "type.googleapis.com/google.cloud.loadbalancing.type.LoadBalancerLogEntry"
 statusDetails: "denied_by_security_policy"
}
httpRequest: {8}
resource: {2}
timestamp: "2021-03-17T19:16:48.185763Z"
</pre>
</div>
<p>The following is an example of log details for a rate-based ban rule that
blocks a request:</p>
<div class="example">
<pre dir="ltr" translate="no">
jsonPayload: {
 @type: "type.googleapis.com/google.cloud.loadbalancing.type.LoadBalancerLogEntry"
 enforcedSecurityPolicy: {
  priority: 150
  name: "sample-prod-policy"
  outcome: "DENY"
  configuredAction: "RATE_BASED_BAN"
  rateLimitAction: {
    key:"sample-key"
    outcome:"BAN_THRESHOLD_EXCEED"
  }
 }
 statusDetails: "denied_by_security_policy"
}
httpRequest: {8}
resource: {2}
timestamp: "2021-03-17T19:27:17.393244Z"
</pre>
</div>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<p>Learn about <a href="/armor/docs/troubleshooting">Troubleshooting Google Cloud Armor issues</a>.</p>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/troubleshooting]</H1></p><div class="devsite-article-body clearfix">
<p>Use these instructions to troubleshoot issues with Google Cloud Armor security
policies.</p>
<h2 data-text="General issues" id="general_issues">General issues</h2>
<h3 data-text="Debugging security policies" id="debug-policies">Debugging security policies</h3>
<p>If you need additional information about what particular event triggers
preconfigured rules, read <a href="/armor/docs/request-logging">Using request logging</a>,
and then enable verbose logging. Cloud Logging records a higher level of
detail in your logs that you can use to analyze and debug your policies and
rules.</p>
<h3 data-text="Traffic is allowed despite a deny rule configured in the Google Cloud Armor security policy" id="traffic-allowed-despite-deny-rule">Traffic is allowed despite a deny rule configured in the Google Cloud Armor security policy</h3>
<p>To fix this, follow these steps:</p>
<ol>
<li><p>Make sure that the Google Cloud Armor security policy is attached to a
target backend service. For example, the following command describes all data
associated with the backend service <code dir="ltr" translate="no"><var translate="no">BACKEND</var></code>. The results
returned should include the name of the Google Cloud Armor security policy
associated with this backend service.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute backend-services describe <var translate="no">BACKEND</var>
</pre></li>
<li><p>Review the HTTP(S) logs to determine which policy and rule were matched for
your traffic along with the associated action. To view the logs, use
<a href="/logging/docs/view/logs-explorer-interface">Cloud Logging</a>.</p>
<p>The following is a sample log of an allowed request with the interesting fields
highlighted. Check for the following fields and make sure that they match the
rule that you configured to deny the traffic:</p>
<ul>
<li><code dir="ltr" translate="no">configuredAction</code> should match the action configured in the rule.</li>
<li><code dir="ltr" translate="no">name</code> should match the name of the Google Cloud Armor security policy
attached to this backend service.</li>
<li><code dir="ltr" translate="no">outcome</code> should match <code dir="ltr" translate="no">configuredAction</code>.</li>
<li><code dir="ltr" translate="no">priority</code> should match the priority number of the rule.</li>
</ul>
<pre dir="ltr" translate="no">
  httpRequest:
   remoteIp: 104.133.0.95
   requestMethod: GET
   requestSize: '801'
   requestUrl: http://74.125.67.38/
   responseSize: '246'
   serverIp: 10.132.0.4
   status: 200
   userAgent: curl/7.35.0
     insertId: ajvis5ev4i60
     internalId:
       projectNumber: '895280006100'
     jsonPayload:
       '@type': type.googleapis.com/google.cloud.loadbalancing.type.LoadBalancerLogEntry
       <mark>enforcedSecurityPolicy:
         configuredAction: ACCEPT
         name: mydev-policy-log-test1
         outcome: ACCEPT
         priority: 2147483647</mark>
       statusDetails: response_sent_by_backend
     logName: projects/mydev-staging/logs/requests
     resource:
       labels:
         backend_service_name: <var translate="no">BACKEND_SERVICE_NAME</var>
         forwarding_rule_name: <var translate="no">FORWARDING_RULE_NAME</var>
         project_id: <var translate="no">PROJECT_ID</var>
         target_proxy_name: <var translate="no">TARGET_HTTP_PROXY_NAME</var>
         url_map_name: <var translate="no">URL_MAP_NAME</var>
         zone: global
       type: http_load_balancer
     severity: INFO
     timestamp: '2017-04-18T18:57:05.845960288Z'
</pre></li>
<li><p>Review the hierarchy of rules to ensure that the correct rule is matched. It
is possible that a higher priority rule with an allow action is matching your
traffic. Use the <code dir="ltr" translate="no">describe</code> command on the <code dir="ltr" translate="no">security-policies</code> in the
Google Cloud CLI to see the contents of the Google Cloud Armor security
policy.</p>
<p>For example, the following example shows how a higher priority allow rule
(at priority 100) matches traffic coming from the 1.2.3.4 IP address, preventing
the lower priority deny rule (at priority 200) from triggering and blocking
the traffic.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies describe <var translate="no">POLICY_NAME</var>
</pre>
<p>Output:
<pre dir="ltr" translate="no">
  creationTimestamp: '2017-04-18T14:47:58.045-07:00
  description: ''
  fingerprint: Yu5spBjdoC0=
  id: '2560355463394441057'
  kind: compute#securityPolicy
  name: <var translate="no">POLICY_NAME</var>
  rules:
  -action: allow
   description: allow high priority rule
   kind: compute#securityPolicyRule
   match:
     srcIpRanges:
     -'1.2.3.4/32'
   preview: false
   priority: 100
  -action: deny
   description: deny lower priority rule
   kind: compute#securityPolicyRule
   match:
     srcIpRanges:
     -'1.2.3.0/24
   preview: false
   priority: 200
  -action: deny
   description: default rule
   kind: compute#securityPolicyRule
   match:
     srcIpRanges:
     -'*'
   preview: false
   priority: 2147483647
   selfLink: http://www.googleapis.com/compute/v1/projects/bigclustertestdev0-devconsole/global/securityPolicies/sp
</pre></p></li>
</ol>
<h3 data-text="Preconfigured rule returns false positives" id="false-positives">Preconfigured rule returns false positives</h3>
<p>XSS and SQLi detection are based on static signature matching on
HTTP request headers and other L7 parameters. These regular expression
patterns are prone to false positives. You can use the preconfigured rule for
XSS and SQLi detection in preview mode and then check the log for any false
positives.</p>
<p>If you find a false positive, you can compare the traffic content with the
<a class="external" href="https://modsecurity.org/crs/" target="github">ModSecurity CRS rules</a>.
If the rule is invalid or not relevant, disable it by using the
<code dir="ltr" translate="no">evaluatePreconfiguredExpr</code> expression, and specify the rule's ID in the
<code dir="ltr" translate="no">exclude ID list</code> argument.</p>
<p>After reviewing the logs and removing all false positives, disable the preview
mode.</p>
<p>To add a preconfigured rule in preview mode:</p>
<ol>
<li><p>Create a security policy with the preconfigured expression set in preview
mode:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 1000
   --security-policy <var translate="no">POLICY_NAME</var>
   --expression "evaluatePreconfiguredExpr('xss-stable')"
   --action deny-403
   --preview
</pre></li>
<li><p>Review the HTTP(S) <a href="/logging/docs/view/logs_viewer">logs</a> for
HTTP request fields such as <code dir="ltr" translate="no">url</code> and <code dir="ltr" translate="no">cookie</code>. For example, the <code dir="ltr" translate="no">requestUrl</code>
compares positively to the ModSecurity CRS rule ID 941180:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
httpRequest:
  remoteIp: 104.133.0.95
  requestMethod: GET
  requestSize: '801'
  requestUrl: http://74.125.67.38/foo?document.cookie=1010"
  responseSize: '246'
  serverIp: 10.132.0.4
  status: 200
  userAgent: curl/7.35.0
insertId: ajvis5ev4i60
internalId:
  projectNumber: '895280006100'
jsonPayload:
  '@type': type.googleapis.com/google.cloud.loadbalancing.type.LoadBalancerLogEntry
  enforcedSecurityPolicy:
    configuredAction: ACCEPT
    name: <var translate="no">POLICY_NAME</var>
    outcome: ACCEPT
    priority: 2147483647
    preconfiguredExprIds: [ 'owasp-crs-v030001-id941180-xss' ]
  statusDetails: response_sent_by_backend
logName: projects/mydev-staging/logs/requests
resource:
  labels:
    backend_service_name: <var translate="no">BACKEND_SERVICE</var>
    forwarding_rule_name: mydev-forwarding-rule
    project_id: mydev-staging
    target_proxy_name: mydev-target-http-proxy
    url_map_name: mydev-url-map
    zone: global
  type: http_load_balancer
severity: INFO
timestamp: '2017-04-18T18:57:05.845960288Z'
</pre></li>
<li><p>Exclude the ModSecurity CRS rule ID 941180 by updating the rule in the
Google Cloud Armor security policy:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules update 1000 \
    --security-policy <var translate="no">POLICY_NAME</var> \
    --expression "evaluatePreconfiguredExpr('xss-stable', ['owasp-crs-v030001-id941180-xss'])" \
    --action deny-403 \
    --preview
</pre></li>
<li><p>Review the logs again and then disable preview mode to implement the rule.</p></li>
</ol>
<h3 data-text="Clients with denied signatures are not blocked or denied" id="clients-not-denied">Clients with denied signatures are not blocked or denied</h3>
<p>If you are using Google Cloud Armor with Cloud CDN, security
policies are enforced only for requests for dynamic content, cache misses, or
other requests that are destined for the CDN origin server. Cache hits are
served even if the downstream Google Cloud Armor security policy would
prevent that request from reaching the CDN origin server.</p>
<h3 data-text="Mitigate risk on POST body that exceeds 8 KB when using preconfigured WAF rules" id="post-body">Mitigate risk on POST body that exceeds 8 KB when using preconfigured WAF rules</h3>
<p>When a preconfigured WAF rule is evaluated in a Google Cloud Armor security
policy, up to 8 KB of the POST body is inspected for signature matches against
the WAF rules. This approach provides you with low latency layer 7 inspection and
protection, while maintaining availability for other Google customers.</p>
<p>You can mitigate the risk from larger POST requests by creating a rule in your
security policies to make sure that no uninspected content reaches your backends.
Create a rule to deny traffic that exceeds 8 KB (8192 bytes) in POST body size.
The following code sample shows how to create this rule:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 10 \
    --security-policy my-policy \
    --expression "int(request.headers['content-length']) &gt; 8192" \
    --action deny-403 \
    --description "Block requests great than 8KB"
</pre>
<h2 data-text="Issues with named IP address lists" id="issues_with_named_ip_address_lists">Issues with named IP address lists</h2>
<p>This section provides information for resolving problems with named IP address
lists.</p>
<h3 data-text="IP addresses within a named IP address list" id="ip-addresses-list">IP addresses within a named IP address list</h3>
<p>The IP addresses in the lists always match the IP addresses in the <a href="/armor/docs/armor-named-ip#ip-list-providers">provider
websites listed</a> in the
Google Cloud Armor named IP address lists guide. If you have questions about
the lists, <a href="/armor/docs/getting-support">contact the Cloud Support team</a>.</p>
<h3 data-text="IP addresses within a named IP address list are stale in Google Cloud Armor" id="stale-ip-addresses-list">IP addresses within a named IP address list are stale in Google Cloud Armor</h3>
<p>Google Cloud Armor synchronizes its lists with IP address list providers
daily. It is possible to have stale data that lags a few hours or a day behind
the data at a provider. However, if you believe that the stale data lags more
than expected, for example, more than a week,
<a href="/armor/docs/getting-support">contact the Cloud Support team</a>.</p>
<h3 data-text="Difficulty creating a security policy that references a named IP address list" id="security-policy">Difficulty creating a security policy that references a named IP address list</h3>
<p>You might try to create a security policy that references a named IP address
list, using a command such as this:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies rules create 750 \
    --security-policy my \
    --expression "evaluatePreconfiguredExpr('sourceiplist-abc')" \
    --action "allow"
</pre>
<p>If the command fails, the error that you see looks something like this:</p>
<pre dir="ltr" translate="no">
ERROR: (gcloud.compute.security-policies.rules.create) Could not fetch resource:
 - Invalid value for field 'resource.match.expr': '{  "expression": "evaluatePreconfiguredExpr(\u0027sourceiplist-abc\u0027)"}'.
Error parsing Google Cloud Armor rule matcher expression: sourceiplist-abc
is not a valid preconfigured expression set.
</pre>
<p>Make sure that the particular provider is supported, and that the name of the IP
address list is given correctly. You can check this by using the following
<code dir="ltr" translate="no">gcloud</code> command to list the current preconfigured expression sets:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies list-preconfigured-expression-sets
</pre>
<h3 data-text="Traffic is blocked despite a preconfigured rule for a named IP address allowlist" id="traffic-blocked">Traffic is blocked despite a preconfigured rule for a named IP address allowlist</h3>
<p>You might find that traffic is blocked from an IP address that is on a named
IP address list:</p>
<ol>
<li><p>Make sure that traffic is coming from an IP address that is on a
<a href="/armor/docs/armor-named-ip#ip-list-providers">named IP address allowlist</a>.</p></li>
<li><p>Check whether there are other security rules with a higher priority
that can block the traffic. If you still see the issue,
<a href="/armor/docs/getting-support">contact the Cloud Support team</a>.</p></li>
<li><p>Make sure that the security policy is attached to the correct backend
service:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute backend-services describe <var translate="no">BACKEND_SERVICE</var>
</pre></li>
<li><p>Check the rules that are in the security policy. For example:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
 gcloud compute security-policies describe <var translate="no">POLICY_NAME</var>
</pre>
<p>The command returns information similar to the following:</p>
<pre dir="ltr" translate="no">
---
…
name: <var translate="no">POLICY_NAME</var>
rules:
-action: allow
 description: allow fastly ip addresses
 kind: compute#securityPolicyRule
 match:
    expr:
      expression: evaluatePreconfiguredExpr('sourceiplist-fastly')
 preview: false
 priority: 100
-action: deny(403)
 description: Default rule, higher priority overrides it
 kind: compute#securityPolicyRule
 match:
    config:
      srcIpRanges:
      -'*'
    versionedExpr: SRC_IPS_V1
 preview: false
 priority: 2147483647
-action: deny(404)
 description: deny xyz referer
 kind: compute#securityPolicyRule
 match:
    expr:
      expression: request.headers['Referer'].contains('xyz')
 preview: false
 priority: 50
…
</pre>
<p>The preceding security policy contains three rules: a default deny rule, an
allow rule for
<a href="https://api.fastly.com/public-ip-list">Fastly's IP addresses</a>, and a deny
rule for a referrer that contains <code dir="ltr" translate="no">xyz</code>. Their respective
priorities are also listed.</p></li>
<li><p>Review the logs to determine which rule is matched to your traffic and
the associated action. For information about logging, see
<a href="/logging/docs/view/logs-explorer-interface">Using the Logs Explorer</a>.</p>
<p>The following is an example of a log:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
 httpRequest: {
    referer: "http://www.xyz.com/"
    remoteIp: "23.230.32.10"
    requestMethod: "HEAD"
    requestSize: "79"
    requestUrl: "http://www.abc.com/"
    responseSize: "258"
    status: 404
    userAgent: "Mozilla/5.0"
  }
  …
  jsonPayload: {
    @type: "type.googleapis.com/google.cloud.loadbalancing.type.LoadBalancerLogEntry"
    enforcedSecurityPolicy: {
      configuredAction: "DENY"
      name: "<var translate="no">POLICY_NAME</var>"
      outcome: "DENY"
      priority: 50
    }
    statusDetails: "denied_by_security_policy"
  }
  …
</pre>
<p>From the preceding log, the request is coming from <code dir="ltr" translate="no">23.230.32.10</code>, which is
covered by <a href="https://api.fastly.com/public-ip-list">Fastly's public IP address list</a>.
However, the request is matched with a deny rule of a higher
priority of 50. Comparing this with what's in the security policy, the rule
corresponds to the deny rule for a referer that contains <code dir="ltr" translate="no">xyz</code>. Because the
request has a referer of <code dir="ltr" translate="no">http://www.xyz.com/</code>, the security rule enforcement
is working correctly.</p></li>
</ol>
<h2 data-text="Issues with Security Command Center findings" id="scc-issues">Issues with Security Command Center findings</h2>
<p>This section contains information about issues with Security Command Center findings.</p>
<h3 data-text="The Google Cloud Armor card does not appear in the Security Command Center" id="armor-card-not-in-scc">The Google Cloud Armor card does not appear in the Security Command Center</h3>
<p>Enable Google Cloud Armor findings in the Security Command Center interface.</p>
<h3 data-text="Findings from Google Cloud Armor do not appear in the Security Command Center" id="armor-not-in-scc">Findings from Google Cloud Armor do not appear in the Security Command Center</h3>
<p>If findings from Google Cloud Armor do not appear in the Security Command Center,
traffic to the backend services might not meet the criteria for raising a
finding.</p>
<p>For questions about traffic volume to your backends, check request statistics in
the Cloud Monitoring dashboards under the <a href="/armor/docs/monitoring">Network Security
Policies</a>.</p>
<h3 data-text="Findings are too noisy" id="armor-noisy">Findings are too noisy</h3>
<p>For assistance with this issue,
<a href="/armor/docs/getting-support">contact the Cloud Support team</a>.</p>
<h2 data-text="Issues with Google Cloud Armor Adaptive Protection" id="issues_with">Issues with Google Cloud Armor Adaptive Protection</h2>
<p>Use these instructions to help you resolve issues with Adaptive Protection.</p>
<h3 data-text="Adaptive Protection is enabled for a security policy but there are no logs in Cloud Logging" id="is_enabled_for_a_security_policy_but_there_are_no_logs_in">Adaptive Protection is enabled for a security policy but there are no logs in Cloud Logging</h3>
<p>Adaptive Protection logs are generated separately from Google Cloud Armor
request logs and appear under a different resource in Cloud Logging.
Adaptive Protection logs and events are under the <strong>Network Security
Policy</strong> resource in Cloud Logging. There is a training period of at least an
hour after Adaptive Protection is enabled in a security policy before
Adaptive Protection starts generating alerts for suspected attacks. During
the training period, Adaptive Protection learns from incoming request
traffic and develops distinct baselines for each backend service that is
protected by that security policy. Adaptive Protection is subsequently able
to identify suspicious activity.</p>
<p>If you enable Adaptive Protection for a security policy and you don't
observe any alerts after a one-hour training period, this suggests that there is
no activity that can be identified as potentially malicious targeting of any of
the backend services associated with that security policy.</p>
<p>If the potential attack or anomalous traffic persists for longer periods of
time, exceeding several hours, then Adaptive Protection starts to deem that
behavior as baseline behavior and does not continue to alert on similar traffic
patterns. After the potential attack subsides and traffic patterns go back to
the original baseline, either because the attack concluded or you blocked it
with the appropriate Google Cloud Armor rules, Adaptive Protection alerts
on future traffic behaviors that are considered departures from the baseline.</p>
<p>Adaptive Protection analyzes traffic that would otherwise be allowed through
a Google Cloud Armor security policy. If you set the default rule to deny
access with a restricted allow list of traffic, then Adaptive Protection
only detects malicious activity on the traffic that passes evaluation with
respect to the allow list.</p>
<h3 data-text="There are too many alerts or too many logs in Cloud Logging from Adaptive Protection" id="there_are_too_many_alerts_or_too_many_logs_in_from">There are too many alerts or too many logs in Cloud Logging from Adaptive Protection</h3>
<p>An Adaptive Protection alert provides a confidence score, indicating how
strongly Adaptive Protection models identify the detected activity as
anomalous and potentially an attack. You can filter on the log's specific entry
through Cloud Logging to only surface (or forward to downstream) the
alerts that have a confidence score above a particular threshold.</p>
<p>Adaptive Protection provides a mechanism for reporting alerts as false
positives, which is described in the section <a href="/armor/docs/adaptive-protection-overview#monitor-feedback-report-%0Aerrors">Monitoring, feedback and reporting
event errors</a>. Note that false positive reporting might not result in immediate
changes to what Adaptive Protection alerts on. Over time,
Adaptive Protection models learn that such traffic patterns are normal and
acceptable, and Adaptive Protection stops alerting on these patterns.</p>
<p>If Adaptive Protection alerts are too frequent on a subset of backend
services in a security policy, it might suggest that these backend services'
normal traffic has significant fluctuations that are constantly identified by
Adaptive Protection as anomalous behaviors. You can create a separate
security policy without Adaptive Protection enabled and associate these
backend services with the new security policy.</p>
<h3 data-text="A particular incident reported by Adaptive Protection is considered a false positive or is not relevant" id="a_particular_incident_reported_by_is_considered_a_false_positive_or_is_not_relevant">A particular incident reported by Adaptive Protection is considered a false positive or is not relevant</h3>
<p>Adaptive Protection provides a mechanism for reporting false positive alerts.
Follow the procedure described in the section
<a href="/armor/docs/adaptive-protection-overview#monitor-feedback-report-errors">Monitoring, feedback and reporting event errors</a>.
Note that false positive reporting might not result in immediate changes to what
Adaptive Protection alerts on. Over time, Adaptive Protection models
learn that such traffic patterns are normal and acceptable, and
Adaptive Protection stops alerting on these patterns.</p>
<h3 data-text="How do I know that my edge security policies are being enforced?" id="how_do_i_know_that_my_edge_security_policies_are_being_enforced">How do I know that my edge security policies are being enforced?</h3>
<p>You can check the actions taken on your edge security policies by checking the
monitoring dashboards, monitoring metrics, or per-request logging.</p>
<h4 data-text="Monitoring dashboards" id="monitoring_dashboards">Monitoring dashboards</h4>
<p>Cloud Monitoring is available on the <strong>Network Security Policies</strong>
page under <strong>Monitoring</strong>. You can use the breakdown by security policy on
the page to measure the number of requests allowed and denied by the
configured edge security policy. You can also examine the breakdown by backend
service to debug a particular backend service. For details about the
Cloud Monitoring dashboard, see
<a href="/armor/docs/monitoring">Monitoring Google Cloud Armor security policies</a>.</p>
<h4 data-text="Monitoring metrics" id="monitoring_metrics">Monitoring metrics</h4>
<p>Raw metrics that measure the requests allowed and denied are available for edge
security policies. For more information, see
<a href="/armor/docs/monitoring#monitoring_metrics_for_security_policies">Monitoring metrics for security policies</a>.</p>
<h4 data-text="Per-request logging" id="per-request_logging">Per-request logging</h4>
<p>The edge security policy decision is logged to the load balancing request logs
under <code dir="ltr" translate="no">enforcedEdgeSecurityPolicy</code>. This is separate from the
<code dir="ltr" translate="no">enforcedSecurityPolicy</code>, which captures the backend security policy decision.</p>
<h2 data-text="Bot management" id="recaptcha">Bot management</h2>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
<p>This section contains information about troubleshooting issues with bot
management.</p>
<h3 data-text="Users are not exempted as expected" id="users_are_not_exempted_as_expected">Users are not exempted as expected</h3>
<p>You might have configured security policy rules with the redirect action for
reCAPTCHA Enterprise assessment, and find that some users that you think are
legitimate were not exempted as expected. Follow the steps below for
troubleshooting.</p>
<p>First, check in the per-request logs to see whether there is a security policy
rule with a higher priority that matches the traffic, in which the action is
different. In particular, look for the <code dir="ltr" translate="no">configured_action</code> and <code dir="ltr" translate="no">outcome</code> fields.
Note that for a user to be exempted, at least two requests are involved. The
initial request comes without an exemption cookie, and the follow-on requests
come with an exemption cookie if the user passes the reCAPTCHA Enterprise
assessment. Therefore, at least two log entries are expected.</p>
<ul>
<li>If you see <code dir="ltr" translate="no">GOOGLE_RECAPTCHA</code> as the configured action, and <code dir="ltr" translate="no">REDIRECT</code> as the
outcome, the request was redirected for reCAPTCHA Enterprise assessment;</li>
<li>If you see <code dir="ltr" translate="no">GOOGLE_RECAPTCHA</code> as the configured action, and <code dir="ltr" translate="no">ACCEPT</code> as the
outcome, the request was exempted from being redirected for
reCAPTCHA Enterprise assessment.</li>
<li>If you see different values in the above fields, a rule with a different
action was matched. In that case, it is expected that the user is not
redirected or exempted.</li>
</ul>
<p>Second, there are several requirements on the user's side for them to be
exempted from being redirected for reCAPTCHA Enterprise assessment.</p>
<ol>
<li>The user must be using a browser.</li>
<li>The browser must enable JavaScript to allow proper loading of the redirect
page with reCAPTCHA Enterprise JavaScript embedded.</li>
<li>The browser must enable cookies to allow the setting and auto-attaching of
the exemption cookie.</li>
<li>The user must pass reCAPTCHA Enterprise assessment; for example, they
must resolve pop-up challenges if there are any.</li>
</ol>
<p>Expect that users who cannot meet any of the above requirements will not
receive exemption, even if a rule with the redirect action for
reCAPTCHA Enterprise assessment is matched.</p>
<p>Third, reCAPTCHA Enterprise assessment is only executed when the redirect
page that embeds the reCAPTCHA Enterprise JavaScript is rendered. For that
reason, redirecting for reCAPTCHA Enterprise assessment is only applicable
for requests that expect a response leading to a full page render. Other
requests, such as assets loading within a page, or requests stemming from an
embedded script that do not expect the response to be rendered, are not expected
to get reCAPTCHA Enterprise assessment. As such, we recommend that you apply
this action with a match condition for URL paths that satisfy this condition.</p>
<p>For example, suppose that you have a webpage that contains embedded elements
like images, links to other webpages, and scripts. You do not want to apply the
redirect action for reCAPTCHA Enterprise assessment for URL paths that host
images, or that are supposed to be accessed by scripts where a full page render
is not expected. Instead, you can apply the redirect action for
reCAPTCHA Enterprise assessment for URL paths that host webpages, like the
main webpage or other linked webpages.</p>
<p>Finally, if the redirect page is rendered successfully, check in the Developer
Tool provided by the browser to see whether an exemption cookie is set and
whether it is attached in the follow-on requests for the same site. For further
assistance, you can contact the <a href="/armor/docs/getting-support">Cloud Support</a>
team.</p>
<h2 data-text="Issues with rate limiting" id="issues_with_rate_limiting">Issues with rate limiting</h2>
<h3 data-text="Traffic is not throttled as expected" id="traffic_is_not_throttled_as_expected">Traffic is not throttled as expected</h3>
<p>You might find that a client IP address is sending high levels of traffic to an
application at a rate that exceeds the threshold you set, but the traffic is
not throttled as you expect. Follow these steps to investigate the issue.</p>
<p>First, confirm whether a higher-priority rule is allowing traffic from that IP
address. Examine the logs to see whether an <code dir="ltr" translate="no">ALLOW</code> rule was triggered for the IP
address. This could be an <code dir="ltr" translate="no">ALLOW</code> rule on its own, or in another <code dir="ltr" translate="no">THROTTLE</code> or
<code dir="ltr" translate="no">RATE_BASED_BAN</code> rule.</p>
<p>If you find a higher-priority rule, do one of the following:</p>
<ol>
<li>Change the priorities to ensure that the rate-limiting rule has a higher
priority, by assigning it a <em>lower</em> numerical value.</li>
<li>Exclude the IP address from the matched expression in the rule that has a
higher priority.</li>
</ol>
<p>The issue might also be that the threshold is set incorrectly. If this is the
case, the requests are matched accurately, but the conform action is triggered.
Examine the logs to confirm that this is the case, then reduce the threshold in
your rule.</p>
<p>Lastly, the IP address might not match the throttle or rate-based ban rule. To
fix this, check for a mistake in the match condition, then change the rule's
match condition to the correct value.</p>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/getting-support">Get support</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="mwETRvWii0eU5NUYprb0Y9z5GVbc" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor]</H1></p><div class="devsite-article-body clearfix devsite-no-page-title">
<cloudx-tags tags="5D0S89"></cloudx-tags>
<style>
  body[layout='full'] {
    background: #fff;
  }
</style>
<article id="cloud-site">
<style>
      .module-section:first-child {
        margin-top: 48px;
      }

      .module-section:empty {
        display: none;
      }

      .module-section:not(:empty) {
        margin-bottom: 48px;
      }

      div.richtext {
        color: #5f6368;
      }

      .richtext p {
        color: inherit;
        font: inherit;
        margin-bottom: 0;
      }

      .cloud-jump-content {
        padding-top: 72px;
      }

      .cloud-module__description p {
        margin: 0;
      }

      .cloud-module__description p+p {
        margin-top: 16px;
      }

      @media(min-width: 1024px) {
        .module-section:first-child {
          margin-top: 60px;
        }

        .module-section:not(:empty) {
          margin-bottom: 60px;
        }
      }

      @media(min-width: 1280px) {
        .cloud-jump-content {
          padding-top: 0;
        }
      }

      .cloud-block__image {
        width: 100%;
      }
    </style>
<style>
      .product-template__benefits:not(:empty) {
        margin-top: 36px;
      }

      .product-v2-template .cloud-chip {
        text-decoration: none;
      }
    </style>
<section class="module-section">
<div class="cws-banner cws-fullbleed" track-metadata-module="banner">
<p class="cws-banner__body-copy"><span>Register for
            the <a class="cws-link cws-link--dark" href="https://cloudonair.withgoogle.com/events/security-talks-march-2022" rel="noopener" target="_blank" track-metadata-eventdetail="cloudonair.withgoogle.com/events/security-talks-march-2022" track-name="first google cloud security talks of 2022" track-type="inline link">first Google Cloud Security Talks of 2022</a>!
            Learn about modern approaches to threat detection, response and
            management.</span></p>
</div> </section>
<style>
      .in-page-navigation-module cloudx-jump-menu[mixed],
      .in-page-navigation-module .cloud-jump-menu {
        padding-top: 0
      }

      .in-page-navigation-module .bricks-jump-menu {
        background-color: #f8f9fa;
      }

      @media(min-width: 1024px) {
        .in-page-navigation-module .bricks-jump-menu {
          margin-top: 60px;
        }

        .in-page-navigation-module .bricks-jump-menu--has-banner {
          margin-top: 0;
        }
      }

      #cloud-site cloudx-jump-menu .in-page-navigation-module__headline {
        margin-top: 0;
      }
    </style>
<div class="in-page-navigation-module">
<cloudx-jump-menu class="bricks-jump-menu--has-banner" label="Jump to" label-hidden-large="" mixed="">
<div class="cloud-menu-content">
<a class="cloud-jump-menu__toggle cloud-jump-menu__toggle--hide-large" href="#">Jump to<i aria-hidden="true" class="material-icons" translate="no"><span></span></i></a>
<div class="cloud-jump-menu__links">
<span class="cloud-subhead in-page-navigation-module__headline">
              Cloud Armor </span>
<div class="cloud-jump-menu__active-page"></div>
</div>
</div>
</cloudx-jump-menu>
</div>
<div class="product-v2-template cloud-jump-content">
<section class="module-section">
<style>
          .hero-module__title {
            color: #4185f4;
          }

          .hero-module--centered.hero-module--no-hero-asset .hero-module__content {
            text-align: center;
          }

          @media(max-width: 1024px) {
            .hero-module--centered .hero-module__content {
              text-align: center;
            }
          }
        </style>
<div class="hero-module hero-module--product" track-metadata-module="hero" track-metadata-module_headline="google cloud armor" track-metadata-position="hero">
<div class="cws-grid">
<div class="cws-grid__col--span-12">
</div>
</div>
<div class="cws-grid">
<div class="cws-grid__col--span-8">
<div class="cws-content-block">
<div class="cws-content-block__content hero-module__content">
<div class="cws-content-block__headline">
<h1 class="cws-headline--headline-3" data-text=" Google Cloud Armor                     " id="google-cloud-armor"> Google Cloud Armor
                    </h1>
</div>
<div class="cws-content-block__text">
<div class="cws-body--large richtext">Help protect your
                      applications and websites against denial of service and
                      web attacks.</div>
</div>
</div>
</div>
<div class="cws-spacer-4--top">
<div class="cws-button__set">
<cloudx-free-trial-eligible-content>
<slot slot="eligible">
<a class="cws-button cws-button--high-emphasis" href="https://console.cloud.google.com/freetrial" referrerpolicy="no-referrer-when-downgrade" rel="noopener" target="_blank" track-metadata-eventdetail="console.cloud.google.com/freetrial" track-metadata-modifier="high-emphasis" track-name="try google cloud free" track-type="button">


      Try Google Cloud free
      
    
      </a>
</slot>
<slot slot="ineligible">
<a class="cws-button cws-button--high-emphasis" href="https://console.cloud.google.com/net-security/securitypolicies/list?_ga=2.10069245.936492860.1607995107-366914458.1596215128" referrerpolicy="no-referrer-when-downgrade" rel="noopener" target="_blank" track-metadata-eventdetail="console.cloud.google.com/net-security/securitypolicies/list" track-metadata-modifier="high-emphasis" track-name="go to console" track-type="button">


      Go to console
      
    
      </a>
</slot>
</cloudx-free-trial-eligible-content>
</div>
</div>
<div class="cws-spacer-4--top cws-spacer-4--bottom">
<ul class="cws-bulleted-list">
<li class="cws-bulleted-list__list-item">
<span aria-hidden="true">
<svg class="cws-icon" height="24px" viewbox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0V0z" fill="none"></path>
<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z">
</path>
</svg>
</span>
<span class="cws-bulleted-list__text cws-body--large">
<p>Benefit from DDoS protection and WAF at Google scale
                      </p>
</span>
</li>
<li class="cws-bulleted-list__list-item">
<span aria-hidden="true">
<svg class="cws-icon" height="24px" viewbox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0V0z" fill="none"></path>
<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z">
</path>
</svg>
</span>
<span class="cws-bulleted-list__text cws-body--large">
<p>Detect and mitigate attacks against
                        your <a class="cws-link" href="https://cloud.google.com/load-balancing" track-metadata-eventdetail="cloud.google.com/load-balancing" track-metadata-module="hero" track-metadata-module_headline="google cloud armor" track-metadata-position="hero" track-name="cloud load balancing" track-type="bulleted list">Cloud Load Balancing</a> workloads
                      </p>
</span>
</li>
<li class="cws-bulleted-list__list-item">
<span aria-hidden="true">
<svg class="cws-icon" height="24px" viewbox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0V0z" fill="none"></path>
<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z">
</path>
</svg>
</span>
<span class="cws-bulleted-list__text cws-body--large">
<p>
<a class="cws-link" href="https://cloud.google.com/armor/docs/adaptive-protection-overview" track-metadata-eventdetail="cloud.google.com/armor/docs/adaptive-protection-overview" track-metadata-module="hero" track-metadata-module_headline="google cloud armor" track-metadata-position="hero" track-name="adaptive protection" track-type="bulleted list">Adaptive Protection</a> 
                        ML-based mechanism to help detect and block Layer 7 DDoS
                        attacks</p>
</span>
</li>
<li class="cws-bulleted-list__list-item">
<span aria-hidden="true">
<svg class="cws-icon" height="24px" viewbox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0V0z" fill="none"></path>
<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z">
</path>
</svg>
</span>
<span class="cws-bulleted-list__text cws-body--large">
<p>Mitigate OWASP Top 10 risks and help protect workloads
                        on-premises or in the cloud</p>
</span>
</li>
<li class="cws-bulleted-list__list-item">
<span aria-hidden="true">
<svg class="cws-icon" height="24px" viewbox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0V0z" fill="none"></path>
<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z">
</path>
</svg>
</span>
<span class="cws-bulleted-list__text cws-body--large">
<p>
<a class="cws-link" href="https://cloud.google.com/armor/docs/bot-management" track-metadata-eventdetail="cloud.google.com/armor/docs/bot-management" track-metadata-module="hero" track-metadata-module_headline="google cloud armor" track-metadata-position="hero" track-name="bot management" track-type="bulleted list">Bot management</a>
                        to stop fraud at the edge through native integration
                        with<a class="cws-link" href="https://cloud.google.com/recaptcha-enterprise" track-metadata-eventdetail="cloud.google.com/recaptcha-enterprise" track-metadata-module="hero" track-metadata-module_headline="google cloud armor" track-metadata-position="hero" track-name="recaptcha enterprise" track-type="bulleted list"> reCAPTCHA Enterprise</a>
</p>
</span>
</li>
</ul>
</div>
</div>
<div class="hero-module__right-rail cws-grid__col--span-4">
<a class="cws-card lb" data-lightbox-height="506" data-lightbox-width="900" href="https://www.youtube.com/watch?v=oXJ68Sa8jfU" rel="noopener" target="_blank" track-metadata-child_eyebrow="video" track-metadata-child_headline="protect your web sites and applications with google cloud armor" track-metadata-eventdetail="www.youtube.com/watch" track-metadata-module="hero" track-metadata-module_headline="google cloud armor" track-metadata-position="hero" track-name="protect your web sites and applications with google cloud armor" track-type="card">
<div class="cws-card__inner">
<div class="cws-card__asset cws-card__asset--video">
<picture>
<source srcset="https://lh3.googleusercontent.com/xdM9BBa8TGIvywNY_wpI-gS7l7GDBjwAr01LTr3XJKxu6JwwB-dI5UJqHHDHtmZfu2a_4rPOeuUN=e14-rw-lo-sc0xffffff-h338-w600 1x,https://lh3.googleusercontent.com/xdM9BBa8TGIvywNY_wpI-gS7l7GDBjwAr01LTr3XJKxu6JwwB-dI5UJqHHDHtmZfu2a_4rPOeuUN=e14-rw-lo-sc0xffffff-h676-w1200 2x" type="image/webp"/>
<source srcset="https://lh3.googleusercontent.com/xdM9BBa8TGIvywNY_wpI-gS7l7GDBjwAr01LTr3XJKxu6JwwB-dI5UJqHHDHtmZfu2a_4rPOeuUN=e14-rj-sc0xffffff-h338-w600 1x,https://lh3.googleusercontent.com/xdM9BBa8TGIvywNY_wpI-gS7l7GDBjwAr01LTr3XJKxu6JwwB-dI5UJqHHDHtmZfu2a_4rPOeuUN=e14-rj-sc0xffffff-h676-w1200 2x" type="image/jpeg"/>
<img alt="Thumbnail screenshot from video with Cloud Armor product icon and 4 bullets with text " class="" loading="lazy" src="https://lh3.googleusercontent.com/xdM9BBa8TGIvywNY_wpI-gS7l7GDBjwAr01LTr3XJKxu6JwwB-dI5UJqHHDHtmZfu2a_4rPOeuUN=e14-rj-sc0xffffff-h338-w600" srcset="https://lh3.googleusercontent.com/xdM9BBa8TGIvywNY_wpI-gS7l7GDBjwAr01LTr3XJKxu6JwwB-dI5UJqHHDHtmZfu2a_4rPOeuUN=e14-rj-sc0xffffff-h676-w1200 2x"/>
</picture>
<span aria-hidden="true">
<svg class="cws-icon" height="18px" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M23.74 7.1s-.23-1.65-.95-2.37c-.91-.96-1.93-.96-2.4-1.02C17.04 3.47 12 3.5 12 3.5s-5.02-.03-8.37.21c-.46.06-1.48.06-2.39 1.02C.52 5.45.28 7.1.28 7.1S.04 9.05 0 10.98V13c.04 1.94.28 3.87.28 3.87s.24 1.65.96 2.38c.91.95 2.1.92 2.64 1.02 1.88.18 7.91.22 8.12.22 0 0 5.05.01 8.4-.23.46-.06 1.48-.06 2.39-1.02.72-.72.96-2.37.96-2.37s.24-1.94.25-3.87v-2.02c-.02-1.93-.26-3.88-.26-3.88zM9.57 15.5V8.49L16 12.13 9.57 15.5z"></path></svg>
</span>
</div>
<div class="cws-card__content">
<p class="cws-label">VIDEO</p>
<p class="cws-headline cws-headline--headline-5">Protect Your Web Sites and Applications with Google Cloud Armor</p>
<p class="cws-small-text">30:00</p>
</div>
</div>
</a>
</div>
</div>
</div> <div class="product-template__benefits">
<div class="cloud-jump-section" data-cloud-main-text="Benefits">
<p class="cws-label" style="margin-bottom: 16px;">Benefits</p>
<style>
              .benefit-module__copy-block {
                border: 1px solid #dbdce0;
                padding: 36px;
              }

              @media(max-width: 767px) {
                .benefit-module__copy-block {
                  padding: 24px;
                }
              }
            </style>
<div class="benefits-module" track-metadata-module="benefits">
<div class="cws-spacer-2--bottom">
<div class="cws-content-block">
</div>
</div>
<div class="benefit-module__copy-block cws-grid">
<div class="cws-grid__col--span-6 cws-grid__col--span-4-lg">
<div class="cws-content-block">
<div class="cws-content-block__content">
<h4 class="cws-headline--headline-5 cws-content-block__headline" data-text="                         Enterprise-grade DDoS defense" id="enterprise-grade-ddos-defense">
                        Enterprise-grade DDoS defense</h4>
<div class="cws-body cws-content-block__text">
<p>Cloud Armor benefits from our experience of
                          protecting key internet properties such as Google
                          Search, Gmail, and YouTube. It provides built-in
                          defenses against L3 and L4 DDoS attacks.</p>
</div>
</div>
</div>
</div>
<div class="cws-grid__col--span-6 cws-grid__col--span-4-lg">
<div class="cws-content-block">
<div class="cws-content-block__content">
<h4 class="cws-headline--headline-5 cws-content-block__headline" data-text="                         Mitigate OWASP Top 10 risks" id="mitigate-owasp-top-10-risks">
                        Mitigate OWASP Top 10 risks</h4>
<div class="cws-body cws-content-block__text">
<p>Cloud Armor provides
                          <a class="cws-link" href="/armor/docs/rule-tuning" track-metadata-eventdetail="cloud.google.com/armor/docs/rule-tuning" track-metadata-module="benefits" track-name="predefined rules" track-type="content block">predefined rules</a>
                          to help defend against attacks such as cross-site
                          scripting (XSS) and SQL injection (SQLi) attacks.</p>
</div>
</div>
</div>
</div>
<div class="cws-grid__col--span-6 cws-grid__col--span-4-lg">
<div class="cws-content-block">
<div class="cws-content-block__content">
<h4 class="cws-headline--headline-5 cws-content-block__headline" data-text="                         Managed protection" id="managed-protection">
                        Managed protection</h4>
<div class="cws-body cws-content-block__text">
<p>With
                          <a class="cws-link" href="https://cloud.google.com/armor/docs/managed-protection-overview" track-metadata-eventdetail="cloud.google.com/armor/docs/managed-protection-overview" track-metadata-module="benefits" track-name="cloud armor managed protection plus" track-type="content block">Cloud Armor Managed Protection Plus</a>
                          tier, you will get access to DDoS and WAF services,
                          curated rule sets, and other services for a
                          predictable monthly price.
                          <a class="cws-link" href="https://cloud.google.com/armor#section-7" track-metadata-eventdetail="cloud.google.com/armor" track-metadata-module="benefits" track-name="learn more" track-type="content block">Learn more</a>.
                        </p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section class="module-section"></section>
<section class="module-section">
<div class="cloud-jump-section" data-cloud-main-text="Key features">
<p class="cws-label" style="margin-bottom: 16px;">Key features</p>
<style>
            .key-features-module__eyebrow {
              margin-bottom: 8px;
            }

            .key-features-module__key-feature img {
              width: auto;
            }
          </style>
<div class="key-features-module" track-metadata-module="key features" track-metadata-module_headline="key features">
<div class="cws-grid">
<div class="key-features-module__headline cws-spacer-4--bottom cws-grid__col--span-8">
<div class="cws-content-block">
<div class="cws-content-block__content">
<h2 class="cws-headline--headline-4 cws-content-block__headline" data-text="                       Key features" id="key-features">
                      Key features</h2>
</div>
</div>
</div>
</div>
<div class="cws-grid">
<div class="cws-grid__col--span-8">
<div class="key-features-module__key-feature cws-spacer-4--bottom">
<div class="cws-content-block">
<div class="cws-content-block__content">
<h3 class="cws-headline--headline-6 cws-content-block__headline" data-text="                         Adaptive protection" id="adaptive-protection">
                        Adaptive protection</h3>
<div class="cws-body cws-content-block__text">
<p>Automatically detect and help mitigate high volume
                          Layer 7 DDoS attacks with an ML system trained locally
                          on your applications.
                          <a class="cws-link" href="https://cloud.google.com/armor/docs/adaptive-protection-overview" track-metadata-eventdetail="cloud.google.com/armor/docs/adaptive-protection-overview" track-metadata-module="key features" track-metadata-module_headline="key features" track-name="learn more" track-type="content block">Learn more</a>.
                        </p>
</div>
</div>
</div>
</div>
<div class="key-features-module__key-feature cws-spacer-4--bottom">
<div class="cws-content-block">
<div class="cws-content-block__content">
<h3 class="cws-headline--headline-6 cws-content-block__headline" data-text="                         Support for hybrid and multicloud deployments" id="support-for-hybrid-and-multicloud-deployments">
                        Support for hybrid and multicloud deployments</h3>
<div class="cws-body cws-content-block__text">
<p>Help defend applications from DDoS or web attacks and
                          enforce Layer 7 security policies whether your
                          application is deployed on Google Cloud or in a hybrid
                          or multicloud architecture.</p>
</div>
</div>
</div>
</div>
<div class="key-features-module__key-feature cws-spacer-4--bottom">
<div class="cws-content-block">
<div class="cws-content-block__content">
<h3 class="cws-headline--headline-6 cws-content-block__headline" data-text="                         Pre-configured WAF rules" id="pre-configured-waf-rules">
                        Pre-configured WAF rules</h3>
<div class="cws-body cws-content-block__text">
<p>Out-of-the-box rules based on industry standards to
                          mitigate against common web-application
                          vulnerabilities and help provide protection from the
                          OWASP Top 10. Learn more in our
                          <a class="cws-link" href="https://cloud.google.com/armor/docs/rule-tuning" track-metadata-eventdetail="cloud.google.com/armor/docs/rule-tuning" track-metadata-module="key features" track-metadata-module_headline="key features" track-name="waf rules guide" track-type="content block">WAF rules guide</a>.
                        </p>
</div>
</div>
</div>
</div>
<div class="key-features-module__key-feature cws-spacer-4--bottom">
<div class="cws-content-block">
<div class="cws-content-block__content">
<h3 class="cws-headline--headline-6 cws-content-block__headline" data-text="                         Bot management" id="bot-management">
                        Bot management</h3>
<div class="cws-body cws-content-block__text">
<p>Provides automated protection for your apps from bots
                          and helps stop fraud in line and at the edge through
                          native integration with reCAPTCHA Enterprise.
                          <a class="cws-link" href="https://cloud.google.com/armor/docs/bot-management" track-metadata-eventdetail="cloud.google.com/armor/docs/bot-management" track-metadata-module="key features" track-metadata-module_headline="key features" track-name="learn more" track-type="content block">Learn more</a>.
                        </p>
</div>
</div>
</div>
</div>
<div class="key-features-module__key-feature cws-spacer-4--bottom">
<div class="cws-content-block">
<div class="cws-content-block__content">
<h3 class="cws-headline--headline-6 cws-content-block__headline" data-text="                         Rate limiting" id="rate-limiting">
                        Rate limiting</h3>
<div class="cws-body cws-content-block__text">
<p>Rate-based rules help you protect your applications
                          from a large volume of requests that flood your
                          instances and block access for legitimate users.
                          <a class="cws-link" href="https://cloud.google.com/armor/docs/rate-limiting-overview" track-metadata-eventdetail="cloud.google.com/armor/docs/rate-limiting-overview" track-metadata-module="key features" track-metadata-module_headline="key features" track-name="learn more" track-type="content block">Learn more</a>.
                        </p>
</div>
</div>
</div>
</div>
<a class="cws-button cws-button--low-emphasis cws-button--align-left cloud-smooth-scroll" href="#all-features" track-metadata-eventdetail="cloud.google.com" track-metadata-modifier="low-emphasis" track-name="view all features" track-type="button">


      View all features
      
    
      </a>
</div>
<div class="key-features-module__right-rail cws-grid__col--span-4">
<a class="cws-card lb" data-lightbox-height="506" data-lightbox-width="900" href="https://www.youtube.com/watch?v=Ti-ln36t__I" rel="noopener" target="_blank" track-metadata-child_eyebrow="video" track-metadata-child_headline="getting started with cloud armor adaptive protection" track-metadata-eventdetail="www.youtube.com/watch" track-metadata-module="key features" track-metadata-module_headline="key features" track-name="getting started with cloud armor adaptive protection" track-type="card">
<div class="cws-card__inner">
<div class="cws-card__asset cws-card__asset--video">
<picture>
<source srcset="https://lh3.googleusercontent.com/rXmjjM2tp2gfyY-SHJOpfF-LhXy6mUbc5LL9yxvXl4KuQcdVG57iWhrMByrkGQU_f8QUPWJk0ZA=e14-rw-lo-sc0xffffff-h338-w600 1x,https://lh3.googleusercontent.com/rXmjjM2tp2gfyY-SHJOpfF-LhXy6mUbc5LL9yxvXl4KuQcdVG57iWhrMByrkGQU_f8QUPWJk0ZA=e14-rw-lo-sc0xffffff-h676-w1200 2x" type="image/webp"/>
<source srcset="https://lh3.googleusercontent.com/rXmjjM2tp2gfyY-SHJOpfF-LhXy6mUbc5LL9yxvXl4KuQcdVG57iWhrMByrkGQU_f8QUPWJk0ZA=e14-rj-sc0xffffff-h338-w600 1x,https://lh3.googleusercontent.com/rXmjjM2tp2gfyY-SHJOpfF-LhXy6mUbc5LL9yxvXl4KuQcdVG57iWhrMByrkGQU_f8QUPWJk0ZA=e14-rj-sc0xffffff-h676-w1200 2x" type="image/jpeg"/>
<img alt="Adaptive Protection Overview" class="" loading="lazy" src="https://lh3.googleusercontent.com/rXmjjM2tp2gfyY-SHJOpfF-LhXy6mUbc5LL9yxvXl4KuQcdVG57iWhrMByrkGQU_f8QUPWJk0ZA=e14-rj-sc0xffffff-h338-w600" srcset="https://lh3.googleusercontent.com/rXmjjM2tp2gfyY-SHJOpfF-LhXy6mUbc5LL9yxvXl4KuQcdVG57iWhrMByrkGQU_f8QUPWJk0ZA=e14-rj-sc0xffffff-h676-w1200 2x"/>
</picture>
<span aria-hidden="true">
<svg class="cws-icon" height="18px" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M23.74 7.1s-.23-1.65-.95-2.37c-.91-.96-1.93-.96-2.4-1.02C17.04 3.47 12 3.5 12 3.5s-5.02-.03-8.37.21c-.46.06-1.48.06-2.39 1.02C.52 5.45.28 7.1.28 7.1S.04 9.05 0 10.98V13c.04 1.94.28 3.87.28 3.87s.24 1.65.96 2.38c.91.95 2.1.92 2.64 1.02 1.88.18 7.91.22 8.12.22 0 0 5.05.01 8.4-.23.46-.06 1.48-.06 2.39-1.02.72-.72.96-2.37.96-2.37s.24-1.94.25-3.87v-2.02c-.02-1.93-.26-3.88-.26-3.88zM9.57 15.5V8.49L16 12.13 9.57 15.5z"></path></svg>
</span>
</div>
<div class="cws-card__content">
<p class="cws-label">VIDEO</p>
<p class="cws-headline cws-headline--headline-5">Getting started with Cloud Armor Adaptive Protection</p>
<p class="cws-small-text">7:00</p>
</div>
</div>
</a>
</div>
</div>
</div>
</div>
</section>
<section class="module-section">
<div class="cloud-jump-section" data-cloud-main-text="Customers">
<style>
            .customer-module__carousel .cloud-carousel {
              padding: 0;
            }
          </style>
<div class="customer-module" track-metadata-module="customers carousel" track-metadata-module_headline="learn from customers using cloud armor">
<p class="cws-label">Customers</p>
<div class="cws-grid">
<div class="cws-grid__col--span-8">
<div class="customer-module__headline cws-spacer-4--bottom">
<div class="cws-content-block">
<div class="cws-content-block__content">
<h2 class="cws-headline--headline-4 cws-content-block__headline" data-text="                         Learn from customers using Cloud Armor" id="learn-from-customers-using-cloud-armor">
                        Learn from customers using Cloud Armor</h2>
</div>
</div>
</div>
</div>
</div>
<div class="customer-module__carousel cws-spacer-4--bottom">
<style>
                @media (max-width: 480px) {
                  .cloud-carousel--bleed-right {
                    margin-right: 0;
                  }

                  .cloud-carousel__slide {
                    margin-right: 16px;
                  }
                }
              </style>
<div class="cloud-carousel cloud-carousel--3up cloud-carousel--margin-tight">
<div class="cloud-carousel__slide-deck-container">
<div class="cloud-carousel__slide-deck" role="group">
<div class="cloud-carousel__slide cws-cards">
<a class="cws-card" href="https://cloud.google.com/blog/products/gcp/getting-to-know-cloud-armor-defense-at-scale-for-internet-facing-services" track-metadata-child_eyebrow="news" track-metadata-child_headline="evernote migrates to google clouds more scalable and secure infrastructure" track-metadata-child_index="1" track-metadata-child_total="1" track-metadata-eventdetail="cloud.google.com/blog/products/gcp/getting-to-know-cloud-armor-defense-at-scale-for-internet-facing-services" track-metadata-module="customers carousel" track-metadata-module_headline="learn from customers using cloud armor" track-name="evernote migrates to google clouds more scalable and secure infrastructure" track-type="card">
<div class="cws-card__inner">
<div class="cws-card__asset cws-card__asset--logo">
<img alt="Evernote logo" class="" src="https://lh3.googleusercontent.com/7jD8QkmOxyvHnN9dfZPmIJi48ZODiZw8i9w91CTrRxNgdwG0_nxk41_1gu8AS5D0c_XStuaZ0-A=e14-rj-sc0xffffff-h36" srcset="https://lh3.googleusercontent.com/7jD8QkmOxyvHnN9dfZPmIJi48ZODiZw8i9w91CTrRxNgdwG0_nxk41_1gu8AS5D0c_XStuaZ0-A=e14-rj-sc0xffffff-h72 2x"/>
</div>
<div class="cws-card__content">
<p class="cws-label">News</p>
<p class="cws-headline cws-headline--headline-5">Evernote migrates to Google Cloud’s more scalable and secure infrastructure.</p>
<p class="cws-small-text">5-min read</p>
</div>
</div>
</a>
</div>
</div>
</div>
<div class="cloud-carousel__controls cloud-carousel__controls--hide-nuggets">
<div class="cloud-carousel__arrow left-arrow">
<i aria-hidden="true" class="material-icons" translate="no">keyboard_arrow_left</i>
</div>
<div class="cloud-carousel__arrow right-arrow">
<i aria-hidden="true" class="material-icons" translate="no">keyboard_arrow_right</i>
</div>
<div class="cloud-carousel__nuggets">
<div class="cloud-carousel__nugget"></div>
</div>
</div>
</div>
</div>
<div>
<a class="cws-button cws-button--low-emphasis cws-button--align-left" href="https://cloud.google.com/customers" track-metadata-eventdetail="cloud.google.com/customers" track-metadata-modifier="low-emphasis" track-name="see all customers" track-type="button">


      See all customers
      
    
      </a>
</div>
</div>
</div> </section>
<section class="module-section"></section>
<section class="module-section">
<div class="cloud-jump-section" data-cloud-main-text="What's new">
<style>
            .whats-new-module .cloud-carousel {
              padding: 0;
            }

            @media (max-width: 767px) {
              .whats-new-module .cloud-carousel--3up .cloud-carousel__slide {
                padding: 0 24px;
                align-items: start;
              }
            }
          </style>
<div class="whats-new-module" track-metadata-module="whats new" track-metadata-module_headline="whats new">
<p class="cws-label">What's new</p>
<div class="cws-grid">
<div class="cws-grid__col--span-8">
<div class="whats-new-module__headline cws-spacer-4--bottom">
<div class="cws-content-block">
<div class="cws-content-block__content">
<h2 class="cws-headline--headline-4 cws-content-block__headline" data-text="                         What's new" id="whats-new">
                        What's new</h2>
<div class="cws-body cws-content-block__text">
<a class="cws-link" href="https://cloud.google.com/newsletter" track-metadata-eventdetail="cloud.google.com/newsletter" track-metadata-module="whats new" track-metadata-module_headline="whats new" track-name="sign up" track-type="content block">Sign up</a>
                        for Google Cloud newsletters to receive product updates,
                        event information, special offers, and more.</div>
</div>
</div>
</div>
</div>
</div>
<style>
              @media (max-width: 480px) {
                .cloud-carousel--bleed-right {
                  margin-right: 0;
                }

                .cloud-carousel__slide {
                  margin-right: 16px;
                }
              }
            </style>
<div class="cloud-carousel cloud-carousel--3up">
<div class="cloud-carousel__slide-deck-container">
<div class="cloud-carousel__slide-deck" role="group">
<div class="cloud-carousel__slide cloud-carousel__slide--story">
<a class="cloud-carousel__slide-link" href="https://cloud.google.com/blog/products/identity-security/cloud-armor-waf-rule-to-help-address-apache-log4j-vulnerability" track-metadata-child_eyebrow="blog post" track-metadata-child_headline="cloud armor waf rule to help mitigate cve-2021-44228 apache log4j vulnerability" track-metadata-child_index="1" track-metadata-child_total="6" track-metadata-eventdetail="cloud.google.com/blog/products/identity-security/cloud-armor-waf-rule-to-help-address-apache-log4j-vulnerability" track-metadata-module="whats new" track-metadata-module_headline="whats new" track-name="learn more" track-type="carousel slide item">
<div class="cloud-carousel__slide-image cloud-carousel__slide-image--rounded">
<picture>
<source srcset="https://lh3.googleusercontent.com/71AsWKIgVCV4z7lNRwXni13AIDKR7kpMlGqIlfHSIVULr_WkVCnAU82pspxGCaWJhrFUCZXOWZhw=e14-rw-lo-sc0xffffff-h130-w102 1x,https://lh3.googleusercontent.com/71AsWKIgVCV4z7lNRwXni13AIDKR7kpMlGqIlfHSIVULr_WkVCnAU82pspxGCaWJhrFUCZXOWZhw=e14-rw-lo-sc0xffffff-h260-w204 2x" type="image/webp"/>
<source srcset="https://lh3.googleusercontent.com/71AsWKIgVCV4z7lNRwXni13AIDKR7kpMlGqIlfHSIVULr_WkVCnAU82pspxGCaWJhrFUCZXOWZhw=e14-rj-sc0xffffff-h130-w102 1x,https://lh3.googleusercontent.com/71AsWKIgVCV4z7lNRwXni13AIDKR7kpMlGqIlfHSIVULr_WkVCnAU82pspxGCaWJhrFUCZXOWZhw=e14-rj-sc0xffffff-h260-w204 2x" type="image/jpeg"/>
<img alt="Blog post about Cloud Armor WAF rule to help mitigate CVE-2021-44228 Apache Log4j vulnerability" class="" src="https://lh3.googleusercontent.com/71AsWKIgVCV4z7lNRwXni13AIDKR7kpMlGqIlfHSIVULr_WkVCnAU82pspxGCaWJhrFUCZXOWZhw=e14-rj-sc0xffffff-h130-w102" srcset="https://lh3.googleusercontent.com/71AsWKIgVCV4z7lNRwXni13AIDKR7kpMlGqIlfHSIVULr_WkVCnAU82pspxGCaWJhrFUCZXOWZhw=e14-rj-sc0xffffff-h260-w204 2x"/>
</picture>
</div>
<div class="cloud-carousel__slide-body">
<p class="cloud-carousel__slide-metadata cws-label">
<span class="cloud-carousel__slide-eyebrow">Blog post</span>
</p>
<p class="cloud-carousel__slide-description cws-headline--headline-6">
<span>Cloud Armor WAF rule to help mitigate CVE-2021-44228 Apache Log4j vulnerability</span>
<span class="cloud-link cloud-carousel__slide-cta">Learn more</span>
</p>
</div>
</a>
</div>
<div class="cloud-carousel__slide cloud-carousel__slide--story">
<a class="cloud-carousel__slide-link" href="https://cloud.google.com/blog/products/identity-security/bot-management-with-google-cloud" track-metadata-child_eyebrow="blog post" track-metadata-child_headline="protect your apps from bots with cloud armor and recaptcha enterprise" track-metadata-child_index="2" track-metadata-child_total="6" track-metadata-eventdetail="cloud.google.com/blog/products/identity-security/bot-management-with-google-cloud" track-metadata-module="whats new" track-metadata-module_headline="whats new" track-name="read the blog" track-type="carousel slide item">
<div class="cloud-carousel__slide-image cloud-carousel__slide-image--rounded">
<picture>
<source srcset="https://lh3.googleusercontent.com/DFKf0YxfwVrtjDCujH9yXLbb4yfk3AnrlgtXIyuLq-e9HqqUIENqDzbg3v0xAEYe-g_fnZIQyzeO=e14-rw-lo-sc0xffffff-h130-w102 1x,https://lh3.googleusercontent.com/DFKf0YxfwVrtjDCujH9yXLbb4yfk3AnrlgtXIyuLq-e9HqqUIENqDzbg3v0xAEYe-g_fnZIQyzeO=e14-rw-lo-sc0xffffff-h260-w204 2x" type="image/webp"/>
<source srcset="https://lh3.googleusercontent.com/DFKf0YxfwVrtjDCujH9yXLbb4yfk3AnrlgtXIyuLq-e9HqqUIENqDzbg3v0xAEYe-g_fnZIQyzeO=e14-rj-sc0xffffff-h130-w102 1x,https://lh3.googleusercontent.com/DFKf0YxfwVrtjDCujH9yXLbb4yfk3AnrlgtXIyuLq-e9HqqUIENqDzbg3v0xAEYe-g_fnZIQyzeO=e14-rj-sc0xffffff-h260-w204 2x" type="image/jpeg"/>
<img alt="Thumbnail of cloud armor logo" class="" src="https://lh3.googleusercontent.com/DFKf0YxfwVrtjDCujH9yXLbb4yfk3AnrlgtXIyuLq-e9HqqUIENqDzbg3v0xAEYe-g_fnZIQyzeO=e14-rj-sc0xffffff-h130-w102" srcset="https://lh3.googleusercontent.com/DFKf0YxfwVrtjDCujH9yXLbb4yfk3AnrlgtXIyuLq-e9HqqUIENqDzbg3v0xAEYe-g_fnZIQyzeO=e14-rj-sc0xffffff-h260-w204 2x"/>
</picture>
</div>
<div class="cloud-carousel__slide-body">
<p class="cloud-carousel__slide-metadata cws-label">
<span class="cloud-carousel__slide-eyebrow">Blog post</span>
</p>
<p class="cloud-carousel__slide-description cws-headline--headline-6">
<span>Protect your apps from bots with Cloud Armor and reCAPTCHA Enterprise</span>
<span class="cloud-link cloud-carousel__slide-cta">Read the blog</span>
</p>
</div>
</a>
</div>
<div class="cloud-carousel__slide cloud-carousel__slide--story">
<a class="cloud-carousel__slide-link" href="https://cloud.google.com/blog/products/identity-security/improve-your-ddos--waf-defense-with-new-cloud-armor-features" track-metadata-child_eyebrow="blog post" track-metadata-child_headline="enhancing security at the edge with adaptive protection" track-metadata-child_index="3" track-metadata-child_total="6" track-metadata-eventdetail="cloud.google.com/blog/products/identity-security/improve-your-ddos--waf-defense-with-new-cloud-armor-features" track-metadata-module="whats new" track-metadata-module_headline="whats new" track-name="read the blog" track-type="carousel slide item">
<div class="cloud-carousel__slide-image cloud-carousel__slide-image--rounded">
<picture>
<source srcset="https://lh3.googleusercontent.com/KoLNVN82S8xZmC-locr07eaZcGRC7jUUUiL3ndcKuQbqOQmfmej-tERZ_RpxFyXKkYEwY9nMzP-x=e14-rw-lo-sc0xffffff-h130-w102 1x,https://lh3.googleusercontent.com/KoLNVN82S8xZmC-locr07eaZcGRC7jUUUiL3ndcKuQbqOQmfmej-tERZ_RpxFyXKkYEwY9nMzP-x=e14-rw-lo-sc0xffffff-h260-w204 2x" type="image/webp"/>
<source srcset="https://lh3.googleusercontent.com/KoLNVN82S8xZmC-locr07eaZcGRC7jUUUiL3ndcKuQbqOQmfmej-tERZ_RpxFyXKkYEwY9nMzP-x=e14-rj-sc0xffffff-h130-w102 1x,https://lh3.googleusercontent.com/KoLNVN82S8xZmC-locr07eaZcGRC7jUUUiL3ndcKuQbqOQmfmej-tERZ_RpxFyXKkYEwY9nMzP-x=e14-rj-sc0xffffff-h260-w204 2x" type="image/jpeg"/>
<img alt="Cloud Armor logo " class="" src="https://lh3.googleusercontent.com/KoLNVN82S8xZmC-locr07eaZcGRC7jUUUiL3ndcKuQbqOQmfmej-tERZ_RpxFyXKkYEwY9nMzP-x=e14-rj-sc0xffffff-h130-w102" srcset="https://lh3.googleusercontent.com/KoLNVN82S8xZmC-locr07eaZcGRC7jUUUiL3ndcKuQbqOQmfmej-tERZ_RpxFyXKkYEwY9nMzP-x=e14-rj-sc0xffffff-h260-w204 2x"/>
</picture>
</div>
<div class="cloud-carousel__slide-body">
<p class="cloud-carousel__slide-metadata cws-label">
<span class="cloud-carousel__slide-eyebrow">Blog post</span>
</p>
<p class="cloud-carousel__slide-description cws-headline--headline-6">
<span>Enhancing security at the edge with Adaptive Protection</span>
<span class="cloud-link cloud-carousel__slide-cta">Read the blog</span>
</p>
</div>
</a>
</div>
<div class="cloud-carousel__slide cloud-carousel__slide--story">
<a class="cloud-carousel__slide-link" href="https://cloud.google.com/blog/products/identity-security/google-cloud-armor-managed-protection-plus-is-now-ga" track-metadata-child_eyebrow="blog post" track-metadata-child_headline="enhance ddos protection get predictable pricing with new cloud armor service" track-metadata-child_index="4" track-metadata-child_total="6" track-metadata-eventdetail="cloud.google.com/blog/products/identity-security/google-cloud-armor-managed-protection-plus-is-now-ga" track-metadata-module="whats new" track-metadata-module_headline="whats new" track-name="learn more" track-type="carousel slide item">
<div class="cloud-carousel__slide-image cloud-carousel__slide-image--rounded">
<picture>
<source srcset="https://lh3.googleusercontent.com/pvT0mB0idpREKiA2cfQPIw-pF6jgjhG9i6bAXKV35cvdXt9g7fsrWod1xjrbhjSgBJWu6zHzigtk=e14-rw-lo-sc0xffffff-h130-w102 1x,https://lh3.googleusercontent.com/pvT0mB0idpREKiA2cfQPIw-pF6jgjhG9i6bAXKV35cvdXt9g7fsrWod1xjrbhjSgBJWu6zHzigtk=e14-rw-lo-sc0xffffff-h260-w204 2x" type="image/webp"/>
<source srcset="https://lh3.googleusercontent.com/pvT0mB0idpREKiA2cfQPIw-pF6jgjhG9i6bAXKV35cvdXt9g7fsrWod1xjrbhjSgBJWu6zHzigtk=e14-rj-sc0xffffff-h130-w102 1x,https://lh3.googleusercontent.com/pvT0mB0idpREKiA2cfQPIw-pF6jgjhG9i6bAXKV35cvdXt9g7fsrWod1xjrbhjSgBJWu6zHzigtk=e14-rj-sc0xffffff-h260-w204 2x" type="image/jpeg"/>
<img alt="DDoS Protection" class="" src="https://lh3.googleusercontent.com/pvT0mB0idpREKiA2cfQPIw-pF6jgjhG9i6bAXKV35cvdXt9g7fsrWod1xjrbhjSgBJWu6zHzigtk=e14-rj-sc0xffffff-h130-w102" srcset="https://lh3.googleusercontent.com/pvT0mB0idpREKiA2cfQPIw-pF6jgjhG9i6bAXKV35cvdXt9g7fsrWod1xjrbhjSgBJWu6zHzigtk=e14-rj-sc0xffffff-h260-w204 2x"/>
</picture>
</div>
<div class="cloud-carousel__slide-body">
<p class="cloud-carousel__slide-metadata cws-label">
<span class="cloud-carousel__slide-eyebrow">Blog post</span>
</p>
<p class="cloud-carousel__slide-description cws-headline--headline-6">
<span>Enhance DDoS protection &amp; get predictable pricing with new Cloud Armor service</span>
<span class="cloud-link cloud-carousel__slide-cta">Learn more</span>
</p>
</div>
</a>
</div>
<div class="cloud-carousel__slide cloud-carousel__slide--story">
<a class="cloud-carousel__slide-link" href="https://cloud.google.com/blog/products/identity-security/google-cloud-armor-features-to-protect-your-websites-and-applications" track-metadata-child_eyebrow="blog post" track-metadata-child_headline="introducing three key features to protect your websites and applications" track-metadata-child_index="5" track-metadata-child_total="6" track-metadata-eventdetail="cloud.google.com/blog/products/identity-security/google-cloud-armor-features-to-protect-your-websites-and-applications" track-metadata-module="whats new" track-metadata-module_headline="whats new" track-name="read the blog" track-type="carousel slide item">
<div class="cloud-carousel__slide-image cloud-carousel__slide-image--rounded">
<picture>
<source srcset="https://lh3.googleusercontent.com/DTyS61jB1hPLVKVlgeVaUMv5x5ZHBaCTdmTtxGoVBUhXMNsk0P6iQrYhqiwcrhnGWLek-5nrZo3U=e14-rw-lo-sc0xffffff-h130-w102 1x,https://lh3.googleusercontent.com/DTyS61jB1hPLVKVlgeVaUMv5x5ZHBaCTdmTtxGoVBUhXMNsk0P6iQrYhqiwcrhnGWLek-5nrZo3U=e14-rw-lo-sc0xffffff-h260-w204 2x" type="image/webp"/>
<source srcset="https://lh3.googleusercontent.com/DTyS61jB1hPLVKVlgeVaUMv5x5ZHBaCTdmTtxGoVBUhXMNsk0P6iQrYhqiwcrhnGWLek-5nrZo3U=e14-rj-sc0xffffff-h130-w102 1x,https://lh3.googleusercontent.com/DTyS61jB1hPLVKVlgeVaUMv5x5ZHBaCTdmTtxGoVBUhXMNsk0P6iQrYhqiwcrhnGWLek-5nrZo3U=e14-rj-sc0xffffff-h260-w204 2x" type="image/jpeg"/>
<img alt="Thumbnail of text from the blog" class="" src="https://lh3.googleusercontent.com/DTyS61jB1hPLVKVlgeVaUMv5x5ZHBaCTdmTtxGoVBUhXMNsk0P6iQrYhqiwcrhnGWLek-5nrZo3U=e14-rj-sc0xffffff-h130-w102" srcset="https://lh3.googleusercontent.com/DTyS61jB1hPLVKVlgeVaUMv5x5ZHBaCTdmTtxGoVBUhXMNsk0P6iQrYhqiwcrhnGWLek-5nrZo3U=e14-rj-sc0xffffff-h260-w204 2x"/>
</picture>
</div>
<div class="cloud-carousel__slide-body">
<p class="cloud-carousel__slide-metadata cws-label">
<span class="cloud-carousel__slide-eyebrow">Blog post</span>
</p>
<p class="cloud-carousel__slide-description cws-headline--headline-6">
<span>Introducing three key features to protect your websites and applications</span>
<span class="cloud-link cloud-carousel__slide-cta">Read the blog</span>
</p>
</div>
</a>
</div>
<div class="cloud-carousel__slide cloud-carousel__slide--story">
<a class="cloud-carousel__slide-link" href="https://cloud.google.com/blog/products/identity-security/new-waf-capabilities-in-cloud-armor" track-metadata-child_eyebrow="blog post" track-metadata-child_headline="new waf capabilities in cloud armor for on-premises and cloud workloads" track-metadata-child_index="6" track-metadata-child_total="6" track-metadata-eventdetail="cloud.google.com/blog/products/identity-security/new-waf-capabilities-in-cloud-armor" track-metadata-module="whats new" track-metadata-module_headline="whats new" track-name="read the blog" track-type="carousel slide item">
<div class="cloud-carousel__slide-image cloud-carousel__slide-image--rounded">
<picture>
<source srcset="https://lh3.googleusercontent.com/aZIRzozOr_nTay96aIcTtKl6olFj2T7aHurB0dowAgGtyhtSstYbf4h1OBX2Q78b58aNcpUmwg_a=e14-rw-lo-sc0xffffff-h130-w102 1x,https://lh3.googleusercontent.com/aZIRzozOr_nTay96aIcTtKl6olFj2T7aHurB0dowAgGtyhtSstYbf4h1OBX2Q78b58aNcpUmwg_a=e14-rw-lo-sc0xffffff-h260-w204 2x" type="image/webp"/>
<source srcset="https://lh3.googleusercontent.com/aZIRzozOr_nTay96aIcTtKl6olFj2T7aHurB0dowAgGtyhtSstYbf4h1OBX2Q78b58aNcpUmwg_a=e14-rj-sc0xffffff-h130-w102 1x,https://lh3.googleusercontent.com/aZIRzozOr_nTay96aIcTtKl6olFj2T7aHurB0dowAgGtyhtSstYbf4h1OBX2Q78b58aNcpUmwg_a=e14-rj-sc0xffffff-h260-w204 2x" type="image/jpeg"/>
<img alt="Thumbnail illustration of open laptop with locked padlock, a magnifying glass in front, and file folders on each side" class="" src="https://lh3.googleusercontent.com/aZIRzozOr_nTay96aIcTtKl6olFj2T7aHurB0dowAgGtyhtSstYbf4h1OBX2Q78b58aNcpUmwg_a=e14-rj-sc0xffffff-h130-w102" srcset="https://lh3.googleusercontent.com/aZIRzozOr_nTay96aIcTtKl6olFj2T7aHurB0dowAgGtyhtSstYbf4h1OBX2Q78b58aNcpUmwg_a=e14-rj-sc0xffffff-h260-w204 2x"/>
</picture>
</div>
<div class="cloud-carousel__slide-body">
<p class="cloud-carousel__slide-metadata cws-label">
<span class="cloud-carousel__slide-eyebrow">Blog post</span>
</p>
<p class="cloud-carousel__slide-description cws-headline--headline-6">
<span>New WAF capabilities in Cloud Armor for on-premises and cloud workloads</span>
<span class="cloud-link cloud-carousel__slide-cta">Read the blog</span>
</p>
</div>
</a>
</div>
</div>
</div>
<div class="cloud-carousel__controls cloud-carousel__controls--hide-nuggets">
<div class="cloud-carousel__arrow left-arrow">
<i aria-hidden="true" class="material-icons" translate="no">keyboard_arrow_left</i>
</div>
<div class="cloud-carousel__arrow right-arrow">
<i aria-hidden="true" class="material-icons" translate="no">keyboard_arrow_right</i>
</div>
<div class="cloud-carousel__nuggets">
<div class="cloud-carousel__nugget"></div>
</div>
</div>
</div>
</div>
</div> </section>
<section class="module-section" id="documentation">
<div class="cloud-jump-section" data-cloud-is-subtitle-linked="true" data-cloud-main-text="Documentation">
<p class="cws-label" style="margin-bottom: 16px;">Documentation</p>
<style>
            .documentation-module__more-docs {
              margin-bottom: 24px;
            }
          </style>
<div class="documentation-module" track-metadata-module="documentation" track-metadata-module_headline="documentation">
<div class="cws-grid">
<div class="documentation-module__copy cws-grid__col--span-8">
<div class="documentation-module__headline cws-spacer-4--bottom">
<div class="cws-content-block">
<div class="cws-content-block__content">
<h2 class="cws-headline--headline-4 cws-content-block__headline" data-text="                         Documentation" id="documentation">
                        Documentation</h2>
</div>
</div>
</div>
</div>
</div>
<div class="cws-grid">
<div class="cws-grid__col--span-8">
<div class="cloud-list">
<div class="cloud-list-item">
<div class="cloud-list-item__content">
<div class="cloud-list-item__header">
<span class="cloud-chip cloud-chip--green-bg"> Tutorial </span>
</div>
<h5 class="cws-headline--headline-6 cloud-list-item__headline" data-text="                         Cloud Armor overview" id="cloud-armor-overview">
                        Cloud Armor overview</h5>
<p class="cws-body cloud-list-item__blurb"><span class="cws-body richtext">Learn how Cloud Armor works
                          and see an overview of Cloud Armor features and
                          capabilities.</span></p>
</div>
<div class="cloud-list-item__footer">
<div class="cws-button__set cws-button__set--with-margin">
<a class="cws-button cws-button--low-emphasis cws-button--align-left" href="https://cloud.google.com/armor/docs/cloud-armor-overview" track-metadata-child_index="1" track-metadata-child_total="9" track-metadata-eventdetail="cloud.google.com/armor/docs/cloud-armor-overview" track-metadata-modifier="low-emphasis" track-metadata-module="documentation" track-metadata-module_headline="documentation" track-metadata-parent_type="list item" track-name="learn more" track-type="button">


      Learn more
      
    
      </a>
</div>
</div>
</div>
<div class="cloud-list-item">
<div class="cloud-list-item__content">
<div class="cloud-list-item__header">
<span class="cloud-chip cloud-chip--green-bg"> Tutorial </span>
</div>
<h5 class="cws-headline--headline-6 cloud-list-item__headline" data-text="                         Hands-on lab: HTTP load balancer with Cloud Armor" id="hands-on-lab:-http-load-balancer-with-cloud-armor">
                        Hands-on lab: HTTP load balancer with Cloud Armor</h5>
<p class="cws-body cloud-list-item__blurb"><span class="cws-body richtext">Learn how to configure an
                          HTTP load balancer with global back ends, stress test
                          the load balancer, and denylist the stress test
                          IP.</span></p>
</div>
<div class="cloud-list-item__footer">
<div class="cws-button__set cws-button__set--with-margin">
<a class="cws-button cws-button--low-emphasis cws-button--align-left" href="https://www.cloudskillsboost.google/focuses/1232?catalog_rank=%7B%22rank%22%3A1%2C%22num_filters%22%3A0%2C%22has_search%22%3Atrue%7D&amp;parent=catalog&amp;search_id=5489793" rel="noopener" target="_blank" track-metadata-child_index="2" track-metadata-child_total="9" track-metadata-eventdetail="www.cloudskillsboost.google/focuses/1232" track-metadata-modifier="low-emphasis" track-metadata-module="documentation" track-metadata-module_headline="documentation" track-metadata-parent_type="list item" track-name="learn more" track-type="button">


      Learn more
      
    
      </a>
</div>
</div>
</div>
<div class="cloud-list-item">
<div class="cloud-list-item__content">
<div class="cloud-list-item__header">
<span class="cloud-chip cloud-chip--green-bg"> Google Cloud Basics </span>
</div>
<h5 class="cws-headline--headline-6 cloud-list-item__headline" data-text="                         Cloud Armor security policy overview" id="cloud-armor-security-policy-overview">
                        Cloud Armor security policy overview</h5>
<p class="cws-body cloud-list-item__blurb"><span class="cws-body richtext">Use Google Cloud Armor
                          security policies to help protect your load-balanced
                          applications from distributed denial of service (DDoS)
                          and other web-based attacks.</span></p>
</div>
<div class="cloud-list-item__footer">
<div class="cws-button__set cws-button__set--with-margin">
<a class="cws-button cws-button--low-emphasis cws-button--align-left" href="/armor/docs/security-policy-concepts" track-metadata-child_index="3" track-metadata-child_total="9" track-metadata-eventdetail="cloud.google.com/armor/docs/security-policy-concepts" track-metadata-modifier="low-emphasis" track-metadata-module="documentation" track-metadata-module_headline="documentation" track-metadata-parent_type="list item" track-name="learn more" track-type="button">


      Learn more
      
    
      </a>
</div>
</div>
</div>
<div class="cloud-list-item">
<div class="cloud-list-item__content">
<div class="cloud-list-item__header">
<span class="cloud-chip cloud-chip--green-bg"> Tutorial </span>
</div>
<h5 class="cws-headline--headline-6 cloud-list-item__headline" data-text="                         Managed protection" id="managed-protection_1">
                        Managed protection</h5>
<p class="cws-body cloud-list-item__blurb"><span class="cws-body richtext">Managed protection is an
                          application protection service that helps protect your
                          web applications and services from DDoS attacks and
                          other threats from the internet.</span></p>
</div>
<div class="cloud-list-item__footer">
<div class="cws-button__set cws-button__set--with-margin">
<a class="cws-button cws-button--low-emphasis cws-button--align-left" href="https://cloud.google.com/armor/docs/managed-protection-overview" track-metadata-child_index="4" track-metadata-child_total="9" track-metadata-eventdetail="cloud.google.com/armor/docs/managed-protection-overview" track-metadata-modifier="low-emphasis" track-metadata-module="documentation" track-metadata-module_headline="documentation" track-metadata-parent_type="list item" track-name="learn more" track-type="button">


      Learn more
      
    
      </a>
</div>
</div>
</div>
<div class="cloud-list-item">
<div class="cloud-list-item__content">
<div class="cloud-list-item__header">
<span class="cloud-chip cloud-chip--green-bg"> Tutorial </span>
</div>
<h5 class="cws-headline--headline-6 cloud-list-item__headline" data-text="                         Bot management" id="bot-management_1">
                        Bot management</h5>
<p class="cws-body cloud-list-item__blurb"><span class="cws-body richtext">Provides effective
                          management of automated clients' requests towards your
                          back ends through native integration with reCAPTCHA
                          Enterprise.</span></p>
</div>
<div class="cloud-list-item__footer">
<div class="cws-button__set cws-button__set--with-margin">
<a class="cws-button cws-button--low-emphasis cws-button--align-left" href="https://cloud.google.com/armor/docs/bot-management" track-metadata-child_index="5" track-metadata-child_total="9" track-metadata-eventdetail="cloud.google.com/armor/docs/bot-management" track-metadata-modifier="low-emphasis" track-metadata-module="documentation" track-metadata-module_headline="documentation" track-metadata-parent_type="list item" track-name="learn more" track-type="button">


      Learn more
      
    
      </a>
</div>
</div>
</div>
<div class="cloud-list-item">
<div class="cloud-list-item__content">
<div class="cloud-list-item__header">
<span class="cloud-chip cloud-chip--green-bg"> Tutorial </span>
</div>
<h5 class="cws-headline--headline-6 cloud-list-item__headline" data-text="                         Rate limiting" id="rate-limiting_1">
                        Rate limiting</h5>
<p class="cws-body cloud-list-item__blurb"><span class="cws-body richtext">Rate-based rules help you
                          protect your applications from a large volume of
                          requests that flood your instances and block access
                          for legitimate users.</span></p>
</div>
<div class="cloud-list-item__footer">
<div class="cws-button__set cws-button__set--with-margin">
<a class="cws-button cws-button--low-emphasis cws-button--align-left" href="https://cloud.google.com/armor/docs/rate-limiting-overview" track-metadata-child_index="6" track-metadata-child_total="9" track-metadata-eventdetail="cloud.google.com/armor/docs/rate-limiting-overview" track-metadata-modifier="low-emphasis" track-metadata-module="documentation" track-metadata-module_headline="documentation" track-metadata-parent_type="list item" track-name="learn more" track-type="button">


      Learn more
      
    
      </a>
</div>
</div>
</div>
<div class="cloud-list-item">
<div class="cloud-list-item__content">
<div class="cloud-list-item__header">
<span class="cloud-chip cloud-chip--green-bg"> Tutorial </span>
</div>
<h5 class="cws-headline--headline-6 cloud-list-item__headline" data-text="                         Configuring Google Cloud Armor security policies" id="configuring-google-cloud-armor-security-policies">
                        Configuring Google Cloud Armor security policies</h5>
<p class="cws-body cloud-list-item__blurb"><span class="cws-body richtext">Use these instructions to
                          filter incoming traffic to HTTP(S) load balancing by
                          creating Google Cloud Armor security policies.</span>
</p>
</div>
<div class="cloud-list-item__footer">
<div class="cws-button__set cws-button__set--with-margin">
<a class="cws-button cws-button--low-emphasis cws-button--align-left" href="/armor/docs/configure-security-policies" track-metadata-child_index="7" track-metadata-child_total="9" track-metadata-eventdetail="cloud.google.com/armor/docs/configure-security-policies" track-metadata-modifier="low-emphasis" track-metadata-module="documentation" track-metadata-module_headline="documentation" track-metadata-parent_type="list item" track-name="learn more" track-type="button">


      Learn more
      
    
      </a>
</div>
</div>
</div>
<div class="cloud-list-item">
<div class="cloud-list-item__content">
<div class="cloud-list-item__header">
<span class="cloud-chip cloud-chip--green-bg"> Google Cloud Basics </span>
</div>
<h5 class="cws-headline--headline-6 cloud-list-item__headline" data-text="                         Configuring Google Cloud Armor through GKE Ingress" id="configuring-google-cloud-armor-through-gke-ingress">
                        Configuring Google Cloud Armor through GKE Ingress</h5>
<p class="cws-body cloud-list-item__blurb"><span class="cws-body richtext">Learn how to use a
                          BackendConfig custom resource to configure Google
                          Cloud Armor in Google Kubernetes Engine (GKE).</span>
</p>
</div>
<div class="cloud-list-item__footer">
<div class="cws-button__set cws-button__set--with-margin">
<a class="cws-button cws-button--low-emphasis cws-button--align-left" href="/kubernetes-engine/docs/how-to/cloud-armor-backendconfig" track-metadata-child_index="8" track-metadata-child_total="9" track-metadata-eventdetail="cloud.google.com/kubernetes-engine/docs/how-to/cloud-armor-backendconfig" track-metadata-modifier="low-emphasis" track-metadata-module="documentation" track-metadata-module_headline="documentation" track-metadata-parent_type="list item" track-name="learn more" track-type="button">


      Learn more
      
    
      </a>
</div>
</div>
</div>
<div class="cloud-list-item">
<div class="cloud-list-item__content">
<div class="cloud-list-item__header">
<span class="cloud-chip cloud-chip--green-bg"> Tutorial </span>
</div>
<h5 class="cws-headline--headline-6 cloud-list-item__headline" data-text="                         Tuning Google Cloud Armor WAF rules" id="tuning-google-cloud-armor-waf-rules">
                        Tuning Google Cloud Armor WAF rules</h5>
<p class="cws-body cloud-list-item__blurb"><span class="cws-body richtext">Preconfigured web
                          application firewall (WAF) rules with dozens of
                          signatures that are compiled from open source industry
                          standards.</span></p>
</div>
<div class="cloud-list-item__footer">
<div class="cws-button__set cws-button__set--with-margin">
<a class="cws-button cws-button--low-emphasis cws-button--align-left" href="https://cloud.google.com/armor/docs/rule-tuning" track-metadata-child_index="9" track-metadata-child_total="9" track-metadata-eventdetail="cloud.google.com/armor/docs/rule-tuning" track-metadata-modifier="low-emphasis" track-metadata-module="documentation" track-metadata-module_headline="documentation" track-metadata-parent_type="list item" track-name="learn more" track-type="button">


      Learn more
      
    
      </a>
</div>
</div>
</div>
<div class="cloud-list__footer">
<h5 class="cws-headline--headline-6 cloud-list__footer-heading" data-text="                       Not seeing what you’re looking for? " id="not-seeing-what-you’re-looking-for">
                      Not seeing what you’re looking for? </h5>
<div class="cloud-list__footer--buttons">
<div class="cws-button__set">
<a class="cws-button cws-button--low-emphasis cws-button--align-left" href="/armor/docs" track-metadata-eventdetail="cloud.google.com/armor/docs" track-metadata-modifier="low-emphasis" track-metadata-module="documentation" track-metadata-module_headline="documentation" track-name="view all product documentation" track-type="button">


      View all product documentation
      
    
      </a>
</div>
</div>
</div>
</div>
</div>
<div class="cws-grid__col--span-4 documentation-module__sidebar">
<div class="documentation-module__more-docs">
<div aria-label="Explore more docs 1" class="cws-link-aside" role="complementary">
<div class="cws-link-aside__header">
<h2 class="cws-link-aside__headline cws-headline--headline-6" data-text="                         Explore more docs " id="explore-more-docs">
                        Explore more docs </h2>
</div>
<ul class="cws-link-aside__items">
<li class="cws-link-aside__item">
<a class="cws-link-aside__link" href="/armor/docs" track-metadata-eventdetail="cloud.google.com/armor/docs" track-name="get a quick intro to using this product" track-type="link aside">
<div class="cws-link-aside__link-content">
<p class="cws-link-aside__link-text cws-headline--headline-6">Get a quick intro to using this product.</p>
</div>
</a>
</li>
<li class="cws-link-aside__item">
<a class="cws-link-aside__link" href="/armor/docs/how-to" track-metadata-eventdetail="cloud.google.com/armor/docs/how-to" track-name="learn to complete specific tasks with this product" track-type="link aside">
<div class="cws-link-aside__link-content">
<p class="cws-link-aside__link-text cws-headline--headline-6">Learn to complete specific tasks with this product.</p>
</div>
</a>
</li>
<li class="cws-link-aside__item">
<a class="cws-link-aside__link" href="/armor/docs" track-metadata-eventdetail="cloud.google.com/armor/docs" track-name="browse walkthroughs of common uses and scenarios for this product" track-type="link aside">
<div class="cws-link-aside__link-content">
<p class="cws-link-aside__link-text cws-headline--headline-6">Browse walkthroughs of common uses and scenarios for                this product.</p>
</div>
</a>
</li>
<li class="cws-link-aside__item">
<a class="cws-link-aside__link" href="/armor/docs/apis" track-metadata-eventdetail="cloud.google.com/armor/docs/apis" track-name="view apis references and other resources for this product" track-type="link aside">
<div class="cws-link-aside__link-content">
<p class="cws-link-aside__link-text cws-headline--headline-6">View APIs, references, and other resources for this product.</p>
</div>
</a>
</li>
</ul>
</div>
</div>
<a class="cws-card cws-card--list" href="/armor/docs/release-notes" track-metadata-child_headline="release notes" track-metadata-eventdetail="cloud.google.com/armor/docs/release-notes" track-metadata-module="documentation" track-metadata-module_headline="documentation" track-name="release notes" track-type="card">
<div class="cws-card__inner">
<div class="cws-card__content">
<p class="cws-headline cws-headline--headline-6">Release notes</p>
<div class="cws-body">Read about the latest releases for Cloud Armor</div>
</div>
</div>
</a>
</div>
</div>
</div>
</div>
</section>
<section class="module-section"></section>
<section class="module-section" id="all-features"></section>
<section class="module-section" id="all-features">
<div class="cloud-jump-section" data-cloud-is-subtitle-linked="true" data-cloud-main-text="All features">
<p class="cws-label" style="margin-bottom: 16px;">All features</p>
<style>
            .feature-module__body-text__large {
              font-family: Google Sans, sans-serif;
            }

            .feature-module__table-header {
              color: #202124;
            }

            .feature-module__table-cell p {
              font: inherit;
              margin-top: 0;
            }

            .feature-module__table-cell {
              line-height: 30px;
            }

            .feature-module__headline {
              margin-bottom: 36px;
            }
          </style>
<div class="feature-module" track-metadata-module="all features" track-metadata-module_headline="all features">
<div>
<div class="feature-module__headline">
<h3 class="cws-headline--headline-4" data-text=" All features " id="all-features"> All features </h3>
</div>
<div class="feature-module__feature-table">
<div class="cloud-table-wrapper devsite-table-wrapper">
<table class="cloud-table">
<tbody>
<tr>
<td>
<span class="cws-headline--headline-6 feature-module__table-header">
                            Pre-defined WAF rules to mitigate OWASP Top 10 risks
                          </span>
</td>
<td class="feature-module__table-cell">
<span class="cws-body richtext">Out-of-the-box rules
                            based on industry standards to mitigate against
                            common web-application vulnerabilities and help
                            provide protection from the OWASP Top 10.</span>
</td>
</tr>
<tr>
<td>
<span class="cws-headline--headline-6 feature-module__table-header">
                            Rich rules language for web application firewall
                          </span>
</td>
<td class="feature-module__table-cell">
<span class="cws-body richtext">Create custom rules
                            using any combination of L3–L7 parameters and
                            geolocation to help protect your deployment with a
                            flexible rules language.</span>
</td>
</tr>
<tr>
<td>
<span class="cws-headline--headline-6 feature-module__table-header">
                            Visibility and monitoring </span>
</td>
<td class="feature-module__table-cell">
<span class="cws-body richtext">Easily monitor all of
                            the metrics associated with your security policies
                            in the Cloud Monitoring dashboard. You can also view
                            suspicious application traffic patterns from Cloud
                            Armor directly in the
                            <a class="cws-link" href="/security-command-center" track-metadata-eventdetail="cloud.google.com/security-command-center" track-metadata-module="all features" track-metadata-module_headline="all features" track-name="security command center" track-type="inline link">Security Command Center</a>
                            dashboard.</span>
</td>
</tr>
<tr>
<td>
<span class="cws-headline--headline-6 feature-module__table-header">
                            Logging </span>
</td>
<td class="feature-module__table-cell">
<span class="cws-body richtext">Get visibility into
                            Cloud Armor decisions as well as the implicated
                            policies and rules on a per-request basis via
                            <a class="cws-link" href="/logging" track-metadata-eventdetail="cloud.google.com/logging" track-metadata-module="all features" track-metadata-module_headline="all features" track-name="cloud logging" track-type="inline link">Cloud Logging</a>.</span>
</td>
</tr>
<tr>
<td>
<span class="cws-headline--headline-6 feature-module__table-header">
                            Preview mode </span>
</td>
<td class="feature-module__table-cell">
<span class="cws-body richtext">Deploy Cloud Armor
                            rules in preview mode to understand rule efficacy
                            and impact on production traffic before enabling
                            active enforcement.</span>
</td>
</tr>
<tr>
<td>
<span class="cws-headline--headline-6 feature-module__table-header">
                            Policy framework with rules </span>
</td>
<td class="feature-module__table-cell">
<span class="cws-body richtext">Configure one or more
                            security policies with a hierarchy of rules. Apply a
                            policy at varying levels of granularity to one or
                            many workloads.</span>
</td>
</tr>
<tr>
<td>
<span class="cws-headline--headline-6 feature-module__table-header">
                            IP-based and geo-based access control </span>
</td>
<td class="feature-module__table-cell">
<span class="cws-body richtext">Filter your incoming
                            traffic based on IPv4 and IPv6 addresses or CIDRs.
                            Identify and enforce access control based on
                            geographic location of incoming traffic.</span>
</td>
</tr>
<tr>
<td>
<span class="cws-headline--headline-6 feature-module__table-header">
                            Support for hybrid and multicloud deployments
                          </span>
</td>
<td class="feature-module__table-cell">
<span class="cws-body richtext">Help defend
                            applications from DDoS or web attacks and enforce
                            Layer 7 security policies whether your application
                            is deployed on Google Cloud or in a hybrid or
                            multicloud architecture.</span>
</td>
</tr>
<tr>
<td>
<span class="cws-headline--headline-6 feature-module__table-header">
                            Named IP Lists </span>
</td>
<td class="feature-module__table-cell">
<span class="cws-body richtext">Allow or deny traffic
                            through a Cloud Armor security policy based on a
                            curated Named IP List.</span>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section class="module-section">
<div class="cloud-jump-section" data-cloud-is-subtitle-linked="true" data-cloud-main-text="Pricing">
<p class="cws-label" style="margin-bottom: 16px;">Pricing</p>
<style>
            .pricing-module__table-header span {
              color: #202124;
            }

            .pricing-module__table-cell {
              line-height: 30px;
            }

            .pricing-module__headline {
              margin-bottom: 36px;
            }

            .pricing-module__pricing-table,
            .pricing-module__pricing-cta {
              margin-top: 24px;
            }
          </style>
<div class="pricing-module" track-metadata-module="pricing" track-metadata-module_headline="pricing">
<div>
<div class="pricing-module__headline">
<h3 class="cws-headline--headline-4" data-text=" Pricing " id="pricing"> Pricing </h3>
</div>
<p class="cws-spacer-0--bottom">
<span class="cws-body--large richtext">
<p>
<a class="cws-link" href="https://cloud.google.com/armor/docs/managed-protection-overview" track-metadata-eventdetail="cloud.google.com/armor/docs/managed-protection-overview" track-metadata-module="pricing" track-metadata-module_headline="pricing" track-name="google cloud armor tiers" track-type="inline link">Google Cloud Armor tiers</a>:
                  </p>
<p>Cloud Armor Standard provides a pay-as-you-go model,
                    measuring and charging for security policies and rules
                    within that policy, as well as for well-formed L7 requests
                    that are evaluated by a security policy.</p>
<p>Managed Protection Plus, now Generally Available, offers
                    a  subscription-based pricing model starting at
                    US$3,000 per month for the first 100 protected resources and
                    then $30 per additional protected resource per month.</p>
</span>
</p>
</div>
<div class="pricing-module__pricing-table">
<div class="cloud-table-wrapper devsite-table-wrapper">
<table class="cloud-table">
<thead>
<tr>
<th>
<span class="cws-headline--headline-6 pricing-module__table-header"><span class="cws-body richtext">Cloud Armor</span></span>
</th>
<th>
<span class="cws-headline--headline-6 pricing-module__table-header"><span class="cws-body richtext">Standard</span></span>
</th>
<th>
<span class="cws-headline--headline-6 pricing-module__table-header"><span class="cws-body richtext">Managed Protection
                            Plus</span></span>
</th>
<th>
<span class="cws-headline--headline-6 pricing-module__table-header"><span class="cws-body richtext"> Notes</span></span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td class="pricing-module__table-cell">
<span class="cws-body richtext">Billing</span>
</td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">Pay as you go</span></td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">Starting at
                          $3,000/month</span></td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">-</span></td>
</tr>
<tr>
<td class="pricing-module__table-cell">
<span class="cws-body richtext">Protected
                          resources</span>
</td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">None</span></td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">Includes first 100
                          ($30/month for additional protected resources)</span>
</td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">Protected resources include
                          backend services and backend buckets</span></td>
</tr>
<tr>
<td class="pricing-module__table-cell">
<span class="cws-body richtext">Rules</span>
</td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">$1 / month</span></td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">Included in
                          subscription</span></td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">-</span></td>
</tr>
<tr>
<td class="pricing-module__table-cell">
<span class="cws-body richtext">Policy</span>
</td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">$5 / month</span></td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">Included in
                          subscription</span></td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">-</span></td>
</tr>
<tr>
<td class="pricing-module__table-cell">
<span class="cws-body richtext">Requests</span>
</td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">$0.75 / million
                          queries</span></td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">Included in
                          subscription</span></td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">-</span></td>
</tr>
<tr>
<td class="pricing-module__table-cell">
<span class="cws-body richtext">Data processing
                          fee</span>
</td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">None</span></td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">Additional
                          (<a class="cws-link" href="https://cloud.google.com/armor/pricing" track-metadata-eventdetail="cloud.google.com/armor/pricing" track-metadata-module="pricing" track-metadata-module_headline="pricing" track-name="details" track-type="inline link">details</a>)</span>
</td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">-</span></td>
</tr>
<tr>
<td class="pricing-module__table-cell">
<span class="cws-body richtext">Term</span>
</td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">None</span></td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">1 year</span></td>
<td class="pricing-module__table-cell"><span class="cws-body richtext">-</span></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cws-small-text cws-spacer-2--top cws-spacer-2--bottom richtext">
<p>If a backend service has a Cloud Armor policy, you can use the
                <a class="cws-link" href="/load-balancing/docs/backend-service#user-defined-request-headers" track-metadata-eventdetail="cloud.google.com/load-balancing/docs/backend-service" track-metadata-module="pricing" track-metadata-module_headline="pricing" track-name="user-defined request headers feature" track-type="inline link">user-defined request headers feature</a>
                with that service without any additional charge for the
                user-defined request headers feature.</p>
<p>If you pay in a currency other than USD, the prices listed in
                your currency on
                <a class="cws-link" href="/skus" track-metadata-eventdetail="cloud.google.com/skus/" track-metadata-module="pricing" track-metadata-module_headline="pricing" track-name="google cloud skus" track-type="inline link">Google Cloud SKUs</a>
                apply.</p>
</div>
<div class="pricing-module__pricing-cta">
<a class="cws-button cws-button--low-emphasis cws-button--align-left" href="https://cloud.google.com/armor/pricing" track-metadata-eventdetail="cloud.google.com/armor/pricing" track-metadata-modifier="low-emphasis" track-name="view pricing details" track-type="button">


      View pricing details
      
    
      </a>
</div>
</div>
</div>
</section>
<section class="module-section">
</section>
<section class="module-section">
<style>
          .legal-module__disclaimer {
            border-top: 1px solid #dadce0;
          }

          .legal-module__disclaimer-footnote {
            margin-top: 24px;
          }
        </style>
<div class="legal-module cws-grid" track-metadata-module="legal">
<div class="legal-module__disclaimer cws-grid__col--span-8">
<div class="legal-module__disclaimer-footnote">
<span class="cws-small-text richtext">
<p>A product or feature listed on this page is in preview. Learn
                  more about
                  <a class="cws-link" href="https://cloud.google.com/products#product-launch-stages" track-metadata-eventdetail="cloud.google.com/products" track-metadata-module="legal" track-name="product launch stages" track-type="inline link">product launch stages</a>.
                </p>
</span>
</div>
</div>
</div>
</section>
</div>
<section class="cloud-content-footer">
<div class="cloud-jump-section" data-cloud-is-subtitle-linked="true" data-cloud-main-text="Take the next step">
<style>
          .ankle-module__headline {
            margin-bottom: 28px;
          }

          .ankle-module__description {
            margin-bottom: 48px;
          }

          .ankle-module__buttons-wrap {
            display: flex;
            flex-wrap: wrap;
            gap: 32px;
          }

          .ankle-module__buttons {
            display: inline-block;
          }

          .ankle-module__richtext-cta {
            align-self: center;
            display: inline-block;
          }

          .ankle-module__richtext-cta p {
            margin-top: 0;
          }

          .ankle-module__content {
            padding: 60px 0;
          }

          .ankle-module__link-list {
            list-style: none;
            padding: 0;
          }

          .ankle-module__link-list-item:first-child {
            margin: 0;
          }

          .ankle-module__link-list-item {
            margin: 24px 0 0;
          }

          .ankle-module__link-list-item-label {
            margin-bottom: 8px;
          }

          @media (min-width: 767px) {
            .ankle-module__links {
              border-left: 1px solid #dadce0;
            }

            .ankle-module__link-list {
              padding: 4px 24px;
            }
          }

          @media (min-width: 1280px) {
            .ankle-module__link-list-item {
              margin: 36px 0 0;
            }
          }

          @media (max-width: 600px) {
            .ankle-module__links {
              margin-top: 24px;
            }
          }
        </style>
<div class="ankle-module cws-fullbleed cws-background--grey" track-metadata-module="take the next step">
<div class="cws-page">
<div class="ankle-module__content cloud-jump-content cws-grid">
<div class="cws-grid__col--span-6">
<cloudx-free-trial-eligible-content>
<slot slot="eligible">
<h3 class="cws-headline--headline-4 ankle-module__headline" data-text="                       Take the next step " id="take-the-next-step">
                      Take the next step </h3>
<p class="cws-body--large ankle-module__description"> Start
                      building on Google Cloud with $300 in free credits and 20+
                      always free products. </p>
<div class="ankle-module__buttons-wrap">
<div class="ankle-module__buttons">
<a class="cws-button cws-button--high-emphasis" href="https://console.cloud.google.com/freetrial" referrerpolicy="no-referrer-when-downgrade" rel="noopener" target="_blank" track-metadata-eventdetail="console.cloud.google.com/freetrial" track-metadata-modifier="high-emphasis" track-name="try product free" track-type="button">


      Try (Product) free
      
    
      </a>
</div>
</div>
</slot>
<slot slot="ineligible">
<h3 class="cws-headline--headline-4 ankle-module__headline" data-text="                       Take the next step " id="take-the-next-step_1">
                      Take the next step </h3>
<p class="cws-body--large ankle-module__description"> Start
                      your next project, explore interactive tutorials, and
                      manage your account. </p>
<div class="ankle-module__buttons-wrap">
<div class="ankle-module__buttons">
<a class="cws-button cws-button--high-emphasis" href="https://console.cloud.google.com/" referrerpolicy="no-referrer-when-downgrade" rel="noopener" target="_blank" track-metadata-eventdetail="console.cloud.google.com/" track-metadata-modifier="high-emphasis" track-name="go to console" track-type="button">


      Go to console
      
    
      </a>
</div>
</div>
</slot>
</cloudx-free-trial-eligible-content>
</div>
<div class="cws-grid__col--span-4 cws-grid__col--offset-7 ankle-module__links">
<cloudx-free-trial-eligible-content>
<slot slot="eligible">
<ul class="ankle-module__link-list">
<li class="ankle-module__link-list-item">
<div class="cws-headline--headline-6 ankle-module__link-list-item-label">
                          Need help getting started? </div>
<a class="cws-link-independent cws-link-independent" href="https://cloud.google.com/contact/" track-metadata-child_index="1" track-metadata-child_total="3" track-metadata-eventdetail="cloud.google.com/contact/" track-metadata-module="take the next step" track-name="contact sales" track-type="ankle link">
        Contact sales
    </a>
</li>
<li class="ankle-module__link-list-item">
<div class="cws-headline--headline-6 ankle-module__link-list-item-label">
                          Work with a trusted partner </div>
<a class="cws-link-independent cws-link-independent" href="https://cloud.withgoogle.com/partners/" rel="noopener" target="_blank" track-metadata-child_index="2" track-metadata-child_total="3" track-metadata-eventdetail="cloud.withgoogle.com/partners/" track-metadata-module="take the next step" track-name="find a partner" track-type="ankle link">
        Find a partner
    </a>
</li>
<li class="ankle-module__link-list-item">
<div class="cws-headline--headline-6 ankle-module__link-list-item-label">
                          Continue browsing </div>
<a class="cws-link-independent cws-link-independent" href="https://cloud.google.com/products/" track-metadata-child_index="3" track-metadata-child_total="3" track-metadata-eventdetail="cloud.google.com/products/" track-metadata-module="take the next step" track-name="see all products" track-type="ankle link">
        See all products
    </a>
</li>
</ul>
</slot>
<slot slot="ineligible">
<ul class="ankle-module__link-list">
<li class="ankle-module__link-list-item">
<div class="cws-headline--headline-6 ankle-module__link-list-item-label">
                          Need help getting started? </div>
<a class="cws-link-independent cws-link-independent" href="https://cloud.google.com/contact/" track-metadata-child_index="1" track-metadata-child_total="3" track-metadata-eventdetail="cloud.google.com/contact/" track-metadata-module="take the next step" track-name="contact sales" track-type="ankle link">
        Contact sales
    </a>
</li>
<li class="ankle-module__link-list-item">
<div class="cws-headline--headline-6 ankle-module__link-list-item-label">
                          Work with a trusted partner </div>
<a class="cws-link-independent cws-link-independent" href="https://cloud.withgoogle.com/partners/" rel="noopener" target="_blank" track-metadata-child_index="2" track-metadata-child_total="3" track-metadata-eventdetail="cloud.withgoogle.com/partners/" track-metadata-module="take the next step" track-name="find a partner" track-type="ankle link">
        Find a partner
    </a>
</li>
<li class="ankle-module__link-list-item">
<div class="cws-headline--headline-6 ankle-module__link-list-item-label">
                          Get tips &amp; best practices </div>
<a class="cws-link-independent cws-link-independent" href="https://cloud.google.com/docs/tutorials" track-metadata-child_index="3" track-metadata-child_total="3" track-metadata-eventdetail="cloud.google.com/docs/tutorials" track-metadata-module="take the next step" track-name="see tutorials" track-type="ankle link">
        See tutorials
    </a>
</li>
</ul>
</slot>
</cloudx-free-trial-eligible-content>
</div>
</div>
</div>
</div>
</div>
</section>
</article>
<!--&#123;# Page published by Bricks, request id 2bd353c5-84c3-4c5f-8873-d20fcb3b094c} #}-->
<devsite-hats-survey class="nocontent" hats-id="mwETRvWii0eU5NUYprb0Y9z5GVbc" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/security-policy-overview]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor security policies protect your application by providing Layer 7
filtering and by scrubbing incoming requests for common web attacks or other Layer 7
attributes to potentially block traffic before it reaches your load balanced
backend services or backend buckets. Each security policy is made up of a set of
rules that filter traffic based on conditions such as an incoming request's IP
address, IP range, region code, or request headers.</p>
<p>Google Cloud Armor security policies are available only for backend services
behind an external HTTP(S) load balancer, TCP proxy load balancer, or an SSL proxy load balancer. The load
balancer can be in
<a href="/network-tiers/docs/overview">Premium Tier or Standard Tier</a>.</p>
<p>The backends to the backend service can be any of the following:</p>
<ul>
<li><a href="/compute/docs/instance-groups">Instance groups</a></li>
<li><a href="/load-balancing/docs/negs/zonal-neg-concepts">Zonal network endpoint groups
(NEGs)</a></li>
<li><a href="/load-balancing/docs/negs/serverless-neg-concepts">Serverless NEGs</a>: One or
more <a href="/appengine/docs">App Engine</a>, <a href="/run/docs">Cloud Run</a>,
or <a href="/functions/docs">Cloud Functions</a> services</li>
<li><a href="/load-balancing/docs/negs/internet-neg-concepts">Internet NEGs</a> for
external backends</li>
<li>Buckets in <a href="/storage/docs">Cloud Storage</a></li>
</ul>
<p>When you use Google Cloud Armor to protect a hybrid deployment or a multi-cloud
architecture, the backends must be internet NEGs. Google Cloud Armor also
protects serverless NEGs when traffic is routed through a load balancer. To
ensure that only traffic that has been routed through your load balancer reaches
your serverless NEG, see
<a href="/appengine/docs/standard/python3/application-security#ingress_controls">Ingress controls</a>.</p>
<h2 data-text="Protect your Google Cloud deployments with Google Cloud Armor security policies" id="edge-security">Protect your Google Cloud deployments with Google Cloud Armor security policies</h2>
<p>External load balancing is implemented at the edge of Google's network in
<a href="/about/locations#network-tab">Google's points of presence (PoPs)</a> around the
world. In Premium Tier, user traffic directed to an
<a href="/load-balancing/docs/choosing-load-balancer#external-internal">external load balancer</a>
enters the PoP closest to the user. It is then load balanced over Google's
global network to the closest backend that has sufficient capacity available. In
Standard Tier, user traffic enters Google's network through peering, ISP, or
transit networks in the region where you have deployed your Google Cloud
resources.</p>
<p>Google Cloud Armor security policies enable you to rate-limit or redirect
requests to your HTTP(S) Load Balancing, TCP Proxy Load Balancing, or
SSL Proxy Load Balancing at the Google Cloud edge, as close as
possible to the source of incoming traffic. This prevents unwelcome traffic from
consuming resources or entering your Virtual Private Cloud (VPC) networks.</p>
<p>The following diagram illustrates the location of external HTTP(S) load balancers,
the Google network, and Google data centers.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-1.svg">
<img alt="Google Cloud Armor policy at network edge." border="0" src="/armor/images/ip-bl-wl-1.svg" width="700"/></a>
<figcaption>Google Cloud Armor policy at network edge (click to
   enlarge)</figcaption>
</figure>
<h2 data-text="Requirements" id="requirements">Requirements</h2>
<p>These are the requirements for using Google Cloud Armor security policies:</p>
<ul>
<li>The load balancer must be an external HTTP(S) load balancer, TCP proxy load balancer, or SSL proxy load balancer.</li>
<li>The backend service's load balancing scheme must be <code dir="ltr" translate="no">EXTERNAL</code>.</li>
<li>The backend service's protocol must be one of <code dir="ltr" translate="no">HTTP</code>, <code dir="ltr" translate="no">HTTPS</code>, <code dir="ltr" translate="no">HTTP/2</code>,
<code dir="ltr" translate="no">TCP</code>, or <code dir="ltr" translate="no">SSL</code>.</li>
</ul>
<h2 data-text="About Google Cloud Armor security policies" id="about">About Google Cloud Armor security policies</h2>
<p>Google Cloud Armor security policies are sets of rules that match on
attributes from Layer 3 to Layer 7 to protect externally facing applications or
services. Each rule is evaluated with respect to incoming traffic.</p>
<p>A Google Cloud Armor security policy <em>rule</em> consists of a match condition and
an action to take when that condition is met. Conditions can be as simple as
whether the incoming traffic's source IP address matches a specific IP address
or CIDR range (also known as IP address allowlist and denylist rules).
Alternatively, by using the
<a href="/armor/docs/rules-language-reference">Google Cloud Armor custom rules language reference</a>,
you can create custom conditions that match on various attributes of the
incoming traffic, such as the URL path, request method, or request header values.</p>
<p>When an incoming request matches a condition in a security policy rule,
Google Cloud Armor allows, denies, or redirects the request, based on whether
the rule is an allow rule, a deny rule, or a redirect rule. There can be
additional action parameters to apply, like inserting request headers; this
feature is part of Google Cloud Armor bot management. For more information
about bot management, see the
<a href="/armor/docs/bot-management">bot management overview</a>.</p>
<p>You can associate a Google Cloud Armor security policy with one or more
backend services. A backend service can have only one security policy associated
with it, but your backend services do not all need to be associated with the
same security policy.</p>
<p>If a Google Cloud Armor security policy is associated with any backend
service, it can't be deleted. A backend service can be deleted regardless of
whether it has an associated security policy.</p>
<p>If multiple forwarding rules point to a backend service that has an associated
security policy, the policy rules are enforced for all traffic coming in to each
of the forwarding rule IP addresses.</p>
<p>In the following illustration, the Google Cloud Armor security policy
<code dir="ltr" translate="no">internal-users-policy</code> is associated with the backend service <code dir="ltr" translate="no">test-network</code>.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-8.svg">
<img alt="Google Cloud Armor security policy at network edge." border="0" src="/armor/images/ip-bl-wl-8.svg" width="700"/></a>
<figcaption>Google Cloud Armor security policy at network edge
      (click to enlarge)</figcaption>
</figure>
<p>Google Cloud Armor security policies have the following core features:</p>
<ul>
<li><p>You can optionally use the <code dir="ltr" translate="no">QUIC</code> protocol with load balancers that use
Google Cloud Armor.</p></li>
<li><p>You can use Google Cloud Armor with load balancers that are in
either of the following Network Service Tiers:</p>
<ul>
<li>Premium Tier</li>
<li>Standard Tier</li>
</ul></li>
<li><p>You can use security policies with GKE and the default Ingress
controller.</p></li>
</ul>
<h3 data-text="Types of security policies" id="policy-types">Types of security policies</h3>
<p>The following table shows the types of security policies and what you can do
with them. A check mark (✔) indicates that the type of security policy supports
the feature.</p>
<table class="vertical-rules">
<colgroup>
<col span="2"/>
</colgroup>
<thead>
<tr>
<th width="20%"></th>
<th colspan="2" scope="colgroup" width="50%"><center>Backend security policy</center></th>
<th width="30%"><center>Edge security policy</center></th>
</tr>
</thead>
<tbody>
<tr>
<td>Frontend Type</td>
<td>HTTP(S) Load Balancing</td>
<td>TCP proxy load balancer/SSL proxy load balancer<break></break>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</td>
<td>HTTP(S) Load Balancing</td>
</tr>
<tr>
<td>Attachment point (protected resource)</td>
<td>Backend service</td>
<td>Backend service</td>
<td><ul><li>Backend service</li><li>Backend bucket</li></ul></td>
</tr>
<tr>
<td>Rule actions</td>
<td><ul>
<li>Allow</li>
<li>Deny</li>
<li>Redirect (GOOGLE_RECAPTCHA and EXTERNAL_302)</li>
<li>Throttle</li>
<li>Rate-based ban</li>
</ul></td>
<td><ul>
<li>Allow</li>
<li>Deny</li>
<li>Throttle</li>
<li>Rate-based ban</li>
</ul></td>
<td><ul>
<li>Allow</li>
<li>Deny</li>
</ul></td>
</tr>
<tr>
<td>Source IP address</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td>Source geography</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td>Source ASN</td>
<td>✔</td>
<td>✔</td>
<td></td>
</tr>
<tr>
<td>Rate limiting</td>
<td>✔</td>
<td>✔</td>
<td></td>
</tr>
<tr>
<td>Bot management</td>
<td>✔ (preview)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Layer 7 filtering</td>
<td>✔</td>
<td></td>
<td></td>
</tr>
<tr>
<td>WAF</td>
<td>✔</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Adaptive protection</td>
<td>✔</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Named IP address lists</td>
<td>✔</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 data-text="Backend security policies" id="backend-policies">Backend security policies</h4>
<p>Backend security policies are used to protect backend services exposed by an
HTTP(S) Load Balancing, TCP Proxy Load Balancing, or SSL Proxy Load Balancing. They can be
used to filter requests and protect backend services containing instance groups
or network endpoint groups (NEGs) including internet, zonal, and serverless NEGs.</p>
<p>When using an TCP proxy load balancer, Google Cloud Armor enforces the security policy
rule action <code dir="ltr" translate="no">deny</code> only on new connection requests. The <code dir="ltr" translate="no">deny</code> action
terminates the TCP connection. In addition, if you provide a status code with
your <code dir="ltr" translate="no">deny</code> action, the status code is ignored.</p>
<h4 data-text="Edge security policies" id="edge-policies">Edge security policies</h4>
<p>Edge security policies enable users to configure filtering and access control
policies for content that is stored in cache; this includes endpoints like
Cloud CDN-enabled backend services and Cloud Storage buckets. Edge
security policies support filtering based on a subset of parameters compared to
backend security policies. You cannot set an edge security policy as a backend
policy. Edge security policies are not supported for TCP proxy load balancers or
SSL proxy load balancers.</p>
<p>Edge security policies can be configured to filter requests before the request
is served from Google's cache. Edge security policies are deployed and enforced
at the outermost perimeter of Google's network, upstream of where the
Cloud CDN cache resides. Edge security policies can coexist with backend
security policies to provide two layers of protection. They can be
simultaneously applied to a backend service regardless of the resources that the
backend service points to (for example, instance groups or network endpoint
groups). Only edge security policies can be applied to backend buckets.</p>
<aside class="note"><strong>Note:</strong><span> Edge security policies are evaluated and enforced upstream of the
Identity-Aware Proxy (IAP). A request blocked by an edge security policy is
denied before IAP evaluates the identity of the requestor.
Blocking a request with a rule at the edge security policy prevents the
IAP from serving a sign-in page or otherwise attempting to
authenticate the user.</span></aside>
<h3 data-text="Rule evaluation order" id="eval-order">Rule evaluation order</h3>
<p>Rule evaluation order is determined by <em>rule priority</em>, from the lowest number
to the highest number. The rule with the lowest numeric value assigned has the
highest logical priority and is evaluated prior to rules with lower logical
priorities. The minimum numeric priority is 0. The priority of a rule decreases
as its number increases (1, 2, 3, <em>N</em>+1). You cannot configure two or more rules
with the same priority. The priority for each rule must be set to a number from
0 to 2147483646 inclusive. The priority value 2147483647, also known as
<code dir="ltr" translate="no">INT-MAX</code>, is reserved for the <a href="#default-rule">default rule</a>.</p>
<p>Priority numbers can have gaps, which enable you to add or remove rules in the
future without affecting the rest of the rules. For example, 1, 2, 3, 4, 5, 9,
12, 16 is a valid series of priority numbers to which you could add rules
numbered from 6 to 8, 10 to 11, and 13 to 15 in the future. You don't need to
change the existing rules except for the order of execution.</p>
<p>Typically, the highest priority rule that matches the request is applied.
However, there is an exception when <code dir="ltr" translate="no">HTTP POST</code> requests are evaluated against
preconfigured rules that use <code dir="ltr" translate="no">evaluatePreconfiguredExpr()</code>. The exception is as
follows.</p>
<p>For <code dir="ltr" translate="no">HTTP POST</code> requests, Google Cloud Armor receives the request's header
before the body (payload). Because Google Cloud Armor receives the
header information first, it evaluates rules that match against the header, but
it does not match any preconfigured rules on the body. If there are multiple
header-based rules, Google Cloud Armor evaluates them based on their
priority as expected. Note that <code dir="ltr" translate="no">redirect</code> actions and inserting custom header
actions work only during the header processing phase. The <code dir="ltr" translate="no">redirect</code> action, if
matched during the following body processing phase, is translated to a <code dir="ltr" translate="no">deny</code>
action. The custom request header action, if matched during the body
processing phase, will not take effect.</p>
<p>After Google Cloud Armor receives the <code dir="ltr" translate="no">HTTP POST</code> body, it evaluates rules
that apply to both the request headers and body. As a result, it's possible that
lower priority rules that allow a request's header are matched before higher
priority rules that block the request's body. In such cases, it is possible that
the HTTP header portion of the request is sent to the target backend
service, but the <code dir="ltr" translate="no">POST</code> body containing potentially malicious content is
blocked. Google Cloud Armor inspects the first 8KB of the <code dir="ltr" translate="no">POST</code> body.
For more information about this limitation, see
<a href="#post-body">POST body inspection limitation</a>.</p>
<p>The <code dir="ltr" translate="no">evaluatePreconfiguredExpr()</code> expression for preconfigured rules is
the only expression that is evaluated against the request body. All other
expressions are evaluated against the request header only. Among the <code dir="ltr" translate="no">HTTP</code>
request types with a request body, Google Cloud Armor processes only <code dir="ltr" translate="no">POST</code>
requests. The inspection is limited to the first 8 KB of the <code dir="ltr" translate="no">POST</code> body and
gets decoded like URL query parameters. Google Cloud Armor can parse and apply
preconfigured WAF rules for JSON-formatted POST bodies (Content-
Type='application/json'). However, Google Cloud Armor does not support other
HTTP Content-Type/Content-Encoding-based decoders such as XML and Gzip.</p>
<h4 data-text="Examples" id="examples">Examples</h4>
<p>In the following example, rules 1, 2, and 3 are evaluated in that order for the
<code dir="ltr" translate="no">IP</code> and <code dir="ltr" translate="no">HTTP</code> header fields. However, if an <code dir="ltr" translate="no">IP 9.9.9.1</code> launches an XSS
attack in the <code dir="ltr" translate="no">HTTP POST</code> body, only the body is blocked (by rule 2); the <code dir="ltr" translate="no">HTTP</code>
header passes through to the backend (by rule 3).</p>
<pre dir="ltr" translate="no">
Rule1
expr: inIPRange(origin.ip, '10.10.10.0/24')
action: deny(403)
priority: 1
Rule2
expr: evaluatePreconfiguredExpr('xss-stable')
action: deny(403)
priority: 2
Rule3
expr: inIPRange(origin.ip, '9.9.9.0/24')
action: allow
priority: 3
Rule-default
action: deny(403)
priority: INT-MAX
</pre>
<p>In the following example, the policy allows <code dir="ltr" translate="no">IP 9.9.9.1</code> without scanning against
XSS attacks:</p>
<pre dir="ltr" translate="no">
Rule1
expr: inIPRange(origin.ip, '10.10.10.0/24')
action: deny(403)
priority: 1
Rule2
expr: inIPRange(origin.ip, '9.9.9.0/24')
action: allow
priority: 2
Rule3
expr: evaluatePreconfiguredExpr('xss-stable')
action: deny(403)
priority: 3
Rule-default
action: allow
priority: INT-MAX
</pre>
<h3 data-text="Default rule" id="default-rule">Default rule</h3>
<p>Each Google Cloud Armor security policy contains a <em>default</em> rule that is
matched if none of the higher priority rules are matched or if there are no
other rules in the policy. The default rule is automatically assigned a priority
of 2147483647 (<code dir="ltr" translate="no">INT-MAX</code>), and it is always present in the security policy.</p>
<p>You cannot delete the default rule, but you can modify it. The default action
for the default rule is allow, but you can change the action to deny.</p>
<h3 data-text="Fingerprint" id="fingerprint">Fingerprint</h3>
<p>Each Google Cloud Armor security policy has a field <code dir="ltr" translate="no">fingerprint</code>. The
fingerprint is a hash of the contents stored in the policy. When you create a
new policy, do not provide the value of this field. If you provide a value, it
is ignored. However, when you update a security policy, you must specify the
current fingerprint, which you get when you export or describe the policy (using
<code dir="ltr" translate="no">EXPORT</code> or <code dir="ltr" translate="no">DESCRIBE</code>, respectively).</p>
<p>The fingerprint protects you from overriding another user's update. If the
fingerprint that you provide is out of date, it means that the security policy
was updated since you last retrieved the fingerprint. To check for any
differences and to retrieve the latest fingerprint, run the <code dir="ltr" translate="no">DESCRIBE</code>
command.</p>
<h3 data-text="Rules language and enforcement engine" id="rules_language_and_enforcement_engine">Rules language and enforcement engine</h3>
<p>The rules language and enforcement engine provide the following:</p>
<ul>
<li><p>The ability to write custom rule expressions that can match on various Layer 3
through Layer 7 attributes of incoming requests. Google Cloud Armor provides a
<a href="/armor/docs/rules-language-reference">flexible language</a> for writing custom
match conditions.</p></li>
<li><p>The ability to combine multiple subexpressions in a single rule.</p></li>
<li><p>The ability to deny or allow requests based on the incoming request's region
code. The region codes are based on the
<a class="external" href="https://www.wikipedia.org/wiki/ISO_3166-1_alpha-2" target="wiki">ISO 3166-1 alpha 2</a> 
codes. The region codes sometimes correspond to specific countries, but some
encompass a country plus its associated areas. For example, the <code dir="ltr" translate="no">US</code> code
includes all states of the United States, one district, and six outlying areas.</p></li>
</ul>
<h3 data-text="Types of rules" id="types_of_rules">Types of rules</h3>
<p>Google Cloud Armor has the following types of rules.</p>
<aside class="note"><strong>Note:</strong><span> Edge security policies only support filtering based on source IP address
and geography attributes, which are <code dir="ltr" translate="no">origin.ip</code> and <code dir="ltr" translate="no">origin.region_code</code>.</span></aside>
<h4 data-text="IP address allowlist and denylist rules" id="ip-address-rules">IP address allowlist and denylist rules</h4>
<p>You can create IP address allowlist and denylist rules within a security
policy. Some examples include the following:</p>
<ul>
<li><p>Denylisting for IP address/<a class="external" href="https://wikipedia.org/wiki/Classless_Inter-Domain_Routing" target="wiki">CIDR</a> 
enables you to block a source IP address or CIDR range from
accessing supported load balancers.</p></li>
<li><p>Allowlisting for IP address/CIDR enables you to allow a source
IP address or CIDR range to access supported load balancers.</p></li>
<li><p>IPv4 and IPv6 addresses are supported in allowlist and denylist rules.</p></li>
<li><p>IP address rules can block or allow individual source IP
addresses or CIDRs. Both IPv4 and IPv6 source addresses are supported, but
IPv6 addresses must have subnet masks no larger than /64.</p></li>
<li><p>Deny rules can return an HTTP <code dir="ltr" translate="no">403</code> (Unauthorized), <code dir="ltr" translate="no">404</code> (Access Denied),
or <code dir="ltr" translate="no">502</code> (Bad Gateway) response.</p></li>
<li><p>Exceed action rules can return an HTTP <code dir="ltr" translate="no">429</code> (Too Many Requests).</p></li>
</ul>
<h4 data-text="Preconfigured rules for XSS, SQLi, LFI, RFI, and RCE" id="preconfigured-rules">Preconfigured rules for XSS, SQLi, LFI, RFI, and RCE</h4>
<p>You can use preconfigured rules to mitigate the following attacks:</p>
<ul>
<li>Cross-site scripting (XSS)</li>
<li>SQL injection (SQLi) attacks</li>
<li>Local file inclusion (LFI) attacks</li>
<li>Remote file inclusion (RFI) attacks</li>
<li>Remote code execution (RCE) attacks</li>
</ul>
<p>These rules are based on the
<a class="external" href="https://modsecurity.org/crs/" target="github">OWASP Modsecurity</a> 
core rule set version 3.0.2.</p>
<h4 data-text="Bot management rules" id="recaptcha">Bot management rules</h4>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
<p>You can use bot management rules to do the following:</p>
<ol>
<li>Redirect requests for reCAPTCHA Enterprise assessment with optional
manual challenges.</li>
<li>Evaluate reCAPTCHA Enterprise tokens attached with a request and apply
the configured action based on token attributes.</li>
<li>Redirect requests to your configured alternative URL with a 302 response.</li>
<li>Insert custom headers to requests before proxying them to your backends.</li>
</ol>
<p>For more information about bot management, see the
<a href="/armor/docs/bot-management">bot management overview</a>.</p>
<h4 data-text="Preconfigured rules for named IP address lists" id="preconfigured-rules-named-ip-address-lists">Preconfigured rules for named IP address lists</h4>
<p>Preconfigured rules for named IP address lists provide the following:</p>
<ul>
<li><p>Integrate third-party providers' named IP address lists with
Google Cloud Armor.</p></li>
<li><p>Simplify maintenance of allowed or denied IP address ranges.</p></li>
<li><p>Synchronize third-party providers' lists daily.</p></li>
<li><p>Increase your capacity for configuring IP addresses and ranges in security
policies because named IP address lists are not subject to limits on the number
of IP addresses per rule.</p></li>
</ul>
<h4 data-text="Rate limiting rules" id="rate-limiting-rules">Rate limiting rules</h4>
<p>You can use rate limiting rules to do the following:</p>
<ul>
<li>Throttle requests per client based on a threshold you configure.</li>
<li>Temporarily ban clients that exceed a request threshold that you set for a
configured duration.</li>
</ul>
<p>When you use rate limiting with TCP proxy load balancers or SSL proxy load balancers, the
following restrictions apply:</p>
<ul>
<li>Google Cloud Armor only enforces rate limiting actions like throttling or
banning on new connection requests from clients.</li>
<li>Only the key types <code dir="ltr" translate="no">ALL</code> and <code dir="ltr" translate="no">IP</code> are supported for TCP Proxy Load Balancing and
SSL Proxy Load Balancing.</li>
<li>If you attempt to use the key type <code dir="ltr" translate="no">HTTP-HEADER</code> or <code dir="ltr" translate="no">HTTP-COOKIE</code> with TCP/SSL
load balancers, the key type is interpreted as <code dir="ltr" translate="no">ALL</code>, and likewise
<code dir="ltr" translate="no">XFF-IP</code> is interpreted as <code dir="ltr" translate="no">IP</code>.</li>
</ul>
<p>For more information about rate limiting and how it works, see the
<a href="/armor/docs/rate-limiting-overview">Rate limiting overview</a>.</p>
<h3 data-text="Preview mode" id="preview_mode">Preview mode</h3>
<p>You can preview the effects of a rule without enforcing it. In preview mode,
actions are noted in <a href="/monitoring/docs">Cloud Monitoring</a>. You can choose to
preview individual rules in a security policy, or you can preview every rule in
the policy.</p>
<p>You can enable preview mode for a rule by using the Google Cloud CLI and the
<code dir="ltr" translate="no">--preview</code> flag of
<a href="/sdk/gcloud/reference/compute/security-policies/rules/update"><code dir="ltr" translate="no">gcloud compute security-policies rules update</code></a>.</p>
<p>To disable preview mode, use the <code dir="ltr" translate="no">--no-preview</code> flag, which is not currently
documented. You can also use the Cloud console.</p>
<p>If a request triggers a preview, Google Cloud Armor will continue to evaluate
other rules until finding a match. Both the matched and preview rule will be
available in the logs.</p>
<h3 data-text="Logging" id="logging">Logging</h3>
<p>Google Cloud Armor has extensive logging and lets you define how verbose
your logging is. For complete information about logging, see
<a href="/armor/docs/request-logging">Using request logging</a>.</p>
<h3 data-text="JSON parsing and verbose logging" id="json-parsing">JSON parsing and verbose logging</h3>
<p>By default, Google Cloud Armor does not parse the JSON content of POST bodies
when preconfigured WAF (web application firewall) rules are evaluated. This can
cause the WAF rules to be noisy and potentially generate false positive matches
on incoming requests if the protected workloads serve REST APIs or otherwise
receive requests with JSON in the POST Body
(<code dir="ltr" translate="no">Content-Type = "application/json"</code>).</p>
<p>A noisy rule is triggered by requests that you would most likely consider to be
false positives. For example, a JSON request body such as <code dir="ltr" translate="no">'{"test": "123"}'</code>
triggers the SQL injection rule <code dir="ltr" translate="no">owasp-crs-v030001-id942431-sqli</code> if JSON
parsing is not enabled.</p>
<p>We recommend that you enable JSON parsing if you expect your workload to receive
requests with <code dir="ltr" translate="no">Content-Type = "application/json"</code>—for example, if you are
serving REST APIs. By default, this option is disabled. The syntax for the flag
is as follows:</p>
<p><code dir="ltr" translate="no">--json-parsing=[STANDARD | DISABLED]</code></p>
<p>The flag is available only with <code dir="ltr" translate="no">gcloud compute security-policies update</code>. You
cannot create a new security policy with this option unless you create a
security policy in a file and then import that file.</p>
<p>To reduce the noise and false positives, you can configure Google Cloud Armor
to parse the JSON content of POST bodies. This means that Google Cloud Armor
ignores structural characters of the JSON message in the POST body and looks
only at the end-user-provided values in the JSON message. For more information
about preconfigured WAF rules, see
<a href="/armor/docs/rule-tuning">Tuning Google Cloud Armor WAF rules</a>.</p>
<p>Additionally, you might not be able to tell why a preconfigured WAF rule was
triggered by a particular request. Google Cloud Armor's default event logs
contain the rule that was triggered, as well as the subsignature. However, you might
need to identify the details from the incoming request that triggered the rule
for troubleshooting, rule validation, or rule tuning purposes.</p>
<p>You can adjust the level of detail recorded in your logs. We recommend that you
enable verbose logging only when you first create a policy, make
changes to a policy, or troubleshoot a policy. If you enable verbose
logging, it is in effect for rules in preview mode as well as active
(non-previewed) rules during standard operations.</p>
<p>For more information about verbose logging, see <a href="/armor/docs/request-logging#verbose-logging">Using request
logging</a>.</p>
<h4 data-text="HTTP(S) Load Balancing request logging" id="https-request-logging">HTTP(S) Load Balancing request logging</h4>
<p>Each HTTP(S) request that is evaluated against a Google Cloud Armor security
policy is logged through Cloud Logging. The logs provide details such as the
name of the applied security policy, the matching rule, and whether the rule was
enforced. Request logging for new backend service resources is disabled by
default. To ensure that Google Cloud Armor requests are logged, you must
enable HTTP(S) logging for each backend service protected by a security policy.</p>
<p>For more information, see
<a href="/load-balancing/docs/https/https-logging-monitoring">HTTP(S) Load Balancing logging and monitoring</a>
and <a href="/armor/docs/request-logging">Using request logging</a>.</p>
<p>To view Google Cloud Armor logs, see <a href="/armor/docs/request-logging#view-logs">Viewing logs</a>.</p>
<h4 data-text="TCP Proxy Load Balancing and SSL Proxy Load Balancing request logging" id="and_request_logging">TCP Proxy Load Balancing and SSL Proxy Load Balancing request logging</h4>
<p>You can configure TCP Proxy Load Balancing and SSL Proxy Load Balancing
logging using the Google Cloud CLI commands as listed in
<a href="/load-balancing/docs/https/https-logging-monitoring#logging">HTTP(S) Load Balancing logging and monitoring</a>.
You cannot enable logging for TCP Proxy Load Balancing and SSL Proxy Load Balancing
using the Google Cloud console.</p>
<h2 data-text="Limitations" id="limitations">Limitations</h2>
<ul>
<li>Backend security policies are enforced only for cache miss requests that
have passed edge security policies.</li>
</ul>
<h3 data-text="POST body inspection limitation" id="post-body">POST body inspection limitation</h3>
<p>The <code dir="ltr" translate="no">evaluatePreconfiguredExpr()</code> expression for preconfigured rules is the only
expression that Google Cloud Armor evaluates against the request body. Among
the HTTP request types with a request body, Google Cloud Armor processes only
POST requests.</p>
<p>The inspection is limited to the first 8 KB of the POST body, which gets decoded
like URL query parameters. The remainder of the POST body might contain
malicious code, which your application might accept. To mitigate the risk of
POST bodies whose size exceeds 8 KB, see the
<a href="/armor/docs/troubleshooting#post-body">troubleshooting guide</a>.</p>
<p>Google Cloud Armor can parse and apply preconfigured WAF rules for default
URL-encoded and JSON-formatted POST bodies (Content-Type='application/json'),
in which case rules are independently applied on the decoded names and values in
the data. For other HTTP content types, Google Cloud Armor does not decode the
data, but applies the preconfigured rules on raw data.</p>
<h3 data-text="How WebSocket connections are handled" id="websocket">How WebSocket connections are handled</h3>
<p>External HTTP(S) Load Balancing has built-in support for the WebSocket protocol.
WebSocket channels are initiated from HTTP(S) requests. Google Cloud Armor
can block a WebSocket channel from being established, for example, if an IP
address denylist blocks the originating IP address. However, subsequent
transactions in the channel do not conform to the HTTP protocol, and
Google Cloud Armor does not evaluate any messages after the first request.</p>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/configure-security-policies">Configure security policies, rules, and expressions</a></li>
<li><a href="/armor/docs/managed-protection-overview">Learn about the features in Managed Protection tiers</a></li>
<li><a href="/armor/docs/armor-named-ip">Learn about named IP address lists</a></li>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/rules-language-reference]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor enables you to define prioritized rules with configurable
match conditions and actions in a security policy. A rule takes effect, meaning
that the configured action is applied, if the rule is the highest priority rule
whose conditions match the attributes of the incoming request.</p>
<p>There are two kinds of match conditions:</p>
<ul>
<li>A <em>basic match condition</em> contains lists of IP addresses or lists of IP
address ranges.</li>
<li>An <em>advanced match condition</em> contains an expression with multiple
subexpressions to match on a variety of attributes of an incoming request.</li>
</ul>
<p>The custom rules language is used to write the expressions in advanced match
conditions for security policy rules. The Google Cloud Armor
custom rules language is an extension of the
<a href="https://github.com/google/cel-spec">Common Expression Language (CEL)</a>.</p>
<p>An expression requires two components:</p>
<ul>
<li><em>Attributes</em> that can be inspected in rule expressions.</li>
<li><em>Operations</em> that can be performed on the attributes as part of an
expression.</li>
</ul>
<p>For example, the following expression uses the attributes <code dir="ltr" translate="no">origin.ip</code> and
<code dir="ltr" translate="no">9.9.9.0/24</code> in the operation <code dir="ltr" translate="no">inIpRange()</code>. In this case, the expression
returns true if <code dir="ltr" translate="no">origin.ip</code> is within the <code dir="ltr" translate="no">9.9.9.0/24</code> IP address range.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '9.9.9.0/24')
</pre>
<h2 data-text="Attributes" id="attributes">Attributes</h2>
<p>Attributes represent information from an incoming request, such as the
origin IP address or the requested URL path.</p>
<table>
<thead>
<tr>
<th width="20%">Field</th>
<th width="10%">Type</th>
<th width="70%">Field description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">origin.ip</code></td>
<td>string</td>
<td>The source IP address of the request.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">request.headers</code></td>
<td>map</td>
<td>A string-to-string map of the HTTP request headers. If a header
      contains multiple values, the value in this map would be a comma-separated
      string of all of the values of the header. The keys in this map are all
      <em>lowercase</em>. Only the first 16 KB of each header value is available for
      inspection. Any header value over 16 KB is truncated per
      Google Cloud load balancer specifications.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">request.method</code></td>
<td>string</td>
<td>The HTTP request method, such as <code dir="ltr" translate="no">GET</code> or <code dir="ltr" translate="no">POST</code>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">request.path</code></td>
<td>string</td>
<td>The requested HTTP URL path.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">request.scheme</code></td>
<td>string</td>
<td>The HTTP URL scheme such as <code dir="ltr" translate="no">http</code> or <code dir="ltr" translate="no">https</code>.
      Values for this attribute are all <em>lowercase</em>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">request.query</code></td>
<td>string</td>
<td>The HTTP URL query in the format of
      <code dir="ltr" translate="no">name1=value&amp;name2=value2</code>, as it appears in the first line of
      the HTTP request. No decoding is performed.
      </td>
</tr>
<tr>
<td><code dir="ltr" translate="no">origin.region_code</code></td>
<td>string</td>
<td>The Unicode country code that is associated with the origin IP, such
      as <code dir="ltr" translate="no">US</code>. If you are creating a rule or expression that uses
      <a class="external" href="https://www.wikipedia.org/wiki/ISO_3166-1_alpha-2" target="wiki">ISO 3166-1 alpha 2</a>
      country or region codes, Google Cloud Armor treats each code
      independently. Google Cloud Armor rules and expressions explicitly
      use those region codes to allow or deny requests.
      <p>For more information, see <a class="external" href="http://www.unicode.org/reports/tr35/#unicode_region_subtag" target="unicode">unicode_region_subtag</a>
      in the Unicode Technical Standard.</p>
</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">origin.asn</code></td>
<td>integer</td>
<td>The autonomous system number (ASN) that is associated with the origin
      IP address. The globally unique ASN is determined based on the network
      operator supporting the IP address prefixes that contain the origin IP address.
      </td>
</tr>
</tbody>
</table>
<aside class="note"><strong>Note:</strong><span> Edge security policies only support filtering based on source IP address
and geography attributes, which are <code dir="ltr" translate="no">origin.ip</code> and <code dir="ltr" translate="no">origin.region_code</code>.</span></aside>
<h3 data-text="reCAPTCHA Enterprise attributes" id="recaptcha-attributes">reCAPTCHA Enterprise attributes</h3>
<p>This section lists attributes that are only applicable to
reCAPTCHA Enterprise tokens or exemption cookies. A subexpression
based on these attributes returns <code dir="ltr" translate="no">false</code> if the reCAPTCHA token or exemption
cookie to be evaluated is not available or is invalid (malformed, mismatched,
or expired).</p>
<h4 data-text="Exemption cookie attributes" id="exemption_cookie_attributes">Exemption cookie attributes</h4>
<table>
<thead>
<tr>
<th width="30%">Field</th>
<th width="10%">Type</th>
<th width="60%">Field description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">token.recaptcha_exemption.valid</code></td>
<td><code dir="ltr" translate="no">bool</code></td>
<td>The presence of a valid reCAPTCHA exemption cookie.</td>
</tr>
</tbody>
</table>
<h4 data-text="Action-token attributes" id="action-token_attributes">Action-token attributes</h4>
<table>
<thead>
<tr>
<th width="30%">Field</th>
<th width="10%">Type</th>
<th width="60%">Field description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">token.recaptcha_action.score</code></td>
<td><code dir="ltr" translate="no">float</code></td>
<td>The score from a reCAPTCHA action-token. A valid score ranges from
        <code dir="ltr" translate="no">0.0</code> to <code dir="ltr" translate="no">1.0</code>, with <code dir="ltr" translate="no">0.0</code> being very
        likely an illegitimate user, and <code dir="ltr" translate="no">1.0</code> being very likely a
        legitimate user.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">token.recaptcha_action.captcha_status</code></td>
<td><code dir="ltr" translate="no">string</code></td>
<td>The captcha status from a reCAPTCHA action-token. A valid status is
        <code dir="ltr" translate="no">NONE</code>, <code dir="ltr" translate="no">PASS</code>, or <code dir="ltr" translate="no">FAIL</code>, where
        <code dir="ltr" translate="no">NONE</code> refers to when there are no challenges involved during
        reCAPTCHA assessment, such that the captcha field is missing in the
        action-token.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">token.recaptcha_action.action</code></td>
<td><code dir="ltr" translate="no">string</code></td>
<td>The action name (up to 100 characters) from a reCAPTCHA action-token.
        See <a href="/recaptcha-enterprise/docs/actions">Action names</a>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">token.recaptcha_action.valid</code></td>
<td><code dir="ltr" translate="no">bool</code></td>
<td>The presence of a valid reCAPTCHA action-token.</td>
</tr>
</tbody>
</table>
<h4 data-text="Session-token attributes" id="session-token_attributes">Session-token attributes</h4>
<table>
<thead>
<tr>
<th width="30%">Field</th>
<th width="10%">Type</th>
<th width="60%">Field description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">token.recaptcha_session.score</code></td>
<td><code dir="ltr" translate="no">float</code></td>
<td>The score from a reCAPTCHA session-token. A valid score ranges from
        <code dir="ltr" translate="no">0.0</code> to <code dir="ltr" translate="no">1.0</code>, with <code dir="ltr" translate="no">0.0</code> being very
        likely an illegitimate user, and <code dir="ltr" translate="no">1.0</code> being very likely a
        legitimate user.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">token.recaptcha_session.valid</code></td>
<td><code dir="ltr" translate="no">bool</code></td>
<td>The presence of a valid reCAPTCHA session-token.</td>
</tr>
</tbody>
</table>
<h2 data-text="Operations" id="operations">Operations</h2>
<p>The following reference describes the operators that you can use with attributes
(represented by <code dir="ltr" translate="no">x</code>, <code dir="ltr" translate="no">y</code>, and <code dir="ltr" translate="no">k</code>) to define rule expressions.</p>
<table>
<thead>
<tr>
<th width="20%">Expressions</th>
<th width="80%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">x == "foo"</code></td>
<td>Returns true if <i>x</i> is equal to the given constant string literal.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x == R"fo'o"</code></td>
<td>Returns true if <i>x</i> is equal to the given raw string literal that does
      not interpret escape sequences. Raw string literals are convenient for
      expressing strings that themselves must use escape sequence characters.
    </td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x == y</code></td>
<td>Returns true if <i>x</i> is equal to <i>y</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x != y</code></td>
<td>Returns true if <i>x</i> is not equal to <i>y</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x + y</code></td>
<td>Returns the concatenated string <i>xy</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x &amp;&amp; y</code></td>
<td>Returns true if both <i>x</i> and <i>y</i> are true.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x || y</code></td>
<td>Returns true if <i>x</i>, <i>y</i>, or both are true.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">!x</code></td>
<td>Returns true if the Boolean value <i>x</i> is false, or returns false if
    the Boolean value <i>x</i> is true.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x.contains(y)</code></td>
<td>Returns true if the string <i>x</i> contains the substring <i>y</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x.startsWith(y)</code></td>
<td>Returns true if the string <i>x</i> begins with the substring <i>y</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x.endsWith(y)</code></td>
<td>Returns true if the string <i>x</i> ends with the substring <i>y</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x.matches(y)</code></td>
<td>Returns true if the string <i>x</i> matches the specified
    <a class="external" href="https://www.wikipedia.org/wiki/RE2_(software)" target="wiki">RE2</a>
    pattern <i>y</i>. The RE2 pattern is compiled by using the RE2::Latin1
    option that disables Unicode features.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">inIpRange(x, y)</code></td>
<td>Returns true if the IP address <i>x</i> is contained within the IP range
    <i>y</i>. Subnet masks for IPv6 addresses cannot be larger than /64.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x.lower()</code></td>
<td>Returns the lowercase value of the string <i>x</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x.upper()</code></td>
<td>Returns the uppercase value of the string <i>x</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">x.base64Decode()</code></td>
<td>Returns the base64 decoded value of <i>x</i>; the characters
    <code dir="ltr" translate="no">_ -</code> are first replaced with <code dir="ltr" translate="no">/ +</code> respectively.
    Returns <code dir="ltr" translate="no">""</code> (empty string) if <i>x</i> is not a valid base64
    value.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">has(m['k'])</code></td>
<td>Returns true if key <i>k</i> is available in the map <i>m</i>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">m['k']</code></td>
<td>Returns the value at key <i>k</i> in the string-to-string map <i>m</i> if
    <i>k</i> is available; otherwise, returns an error. Recommended approach is
    to first check for availability by using <code dir="ltr" translate="no">"has(m['k'])==true"</code>.</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">int(x)</code></td>
<td>Converts the string result of <i>x</i> to an <code dir="ltr" translate="no">int</code> type. It can
    then be used to do an integer comparison by using standard arithmetic
    operators such as &gt; and &lt;=. This works only for values that are
    supposed to be integers.</td>
</tr>
</tbody>
</table>
<h2 data-text="Example expressions" id="expression-examples">Example expressions</h2>
<p>For each of these expressions, the action taken depends on whether the
expression is included in a deny rule or an allow rule.</p>
<h3 data-text="Allow or deny access based on an IP address range in IPv4 or IPv6" id="allow_or_deny_access_based_on_an_ip_address_range_in_ipv4_or_ipv6">Allow or deny access based on an IP address range in IPv4 or IPv6</h3>
<ul>
<li><p>The following expression matches with requests from the <code dir="ltr" translate="no">9.9.9.0/24</code>
IP address range:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '9.9.9.0/24')
</pre></li>
<li><p>The following expression matches with requests from the <code dir="ltr" translate="no">2001:db8::/32</code>
IP address range:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '2001:db8::/32')
</pre></li>
</ul>
<h3 data-text="Allow or deny traffic with a specific cookie" id="allow_or_deny_traffic_with_a_specific_cookie">Allow or deny traffic with a specific cookie</h3>
<ul>
<li><p>The following expression matches with requests that have a cookie containing
<code dir="ltr" translate="no">80=BLAH</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
has(request.headers['cookie']) &amp;&amp; request.headers['cookie'].contains('80=BLAH')
</pre></li>
</ul>
<h3 data-text="Allow or deny traffic with a non-empty referer header" id="allow_or_deny_traffic_with_a_non-empty_referer_header">Allow or deny traffic with a non-empty <code dir="ltr" translate="no">referer</code> header</h3>
<ul>
<li><p>The following expression matches with requests that have a non-empty
<code dir="ltr" translate="no">referer</code> header:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
has(request.headers['referer']) &amp;&amp; request.headers['referer'] != ""
</pre></li>
</ul>
<h3 data-text="Allow or deny traffic based on host URL in header" id="allow_or_deny_traffic_based_on_host_url_in_header">Allow or deny traffic based on host URL in header</h3>
<ul>
<li><p>The following expression matches with requests to a specific URL:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
request.headers['host'].lower().contains('test.example.com')
</pre></li>
</ul>
<h3 data-text="Allow or deny traffic from a specific region" id="allow_or_deny_traffic_from_a_specific_region">Allow or deny traffic from a specific region</h3>
<p>If your web application isn't available in the <code dir="ltr" translate="no">AU</code> region, then all
requests from that region must be blocked.</p>
<ul>
<li><p>In a deny rule, use the following expression, which matches requests from the
<code dir="ltr" translate="no">AU</code> region:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.region_code == 'AU'
</pre></li>
</ul>
<p>Alternatively, if your web application is <em>only</em> available in the <code dir="ltr" translate="no">AU</code> region,
 then requests from all other regions must be blocked.</p>
<ul>
<li><p>In a deny rule, use the following expression, which matches requests from all
regions other than the <code dir="ltr" translate="no">AU</code> region:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.region_code != 'AU'
</pre></li>
</ul>
<p>The region codes are based on the
<a class="external" href="https://www.wikipedia.org/wiki/ISO_3166-1_alpha-2" target="wiki">ISO 3166-1 alpha 2</a> 
codes. In some cases, a region corresponds to a country, but this is not always
the case. For example, the <code dir="ltr" translate="no">US</code> code includes all states of the United States,
one district, and six outlying areas.</p>
<h3 data-text="Allow or deny traffic from a specific ASN" id="allow_or_deny_traffic_from_a_specific_asn">Allow or deny traffic from a specific ASN</h3>
<p>If your web application needs to be blocked to customers serviced by a specific
network operator, you can use the ASN number of the network operator to block.</p>
<ul>
<li><p>In a deny rule, use the following expression, which matches requests from a specific ASN:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.asn == 123
</pre></li>
</ul>
<p>Alternatively, if your web application is to be <em>only</em> available to customers
behind a specific network operator, then requests from all other network
operators must be blocked.</p>
<ul>
<li><p>In a deny rule, use the following expression, which matches all other network
operators other than the one that you are interested in allowing.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.asn != 123
</pre></li>
</ul>
<h3 data-text="Multiple expressions" id="multiple_expressions">Multiple expressions</h3>
<p>To include multiple conditions in a single rule, combine multiple
subexpressions.</p>
<ul>
<li><p>In the following example, requests from <code dir="ltr" translate="no">1.2.3.0/24</code> (such as
your alpha testers) in the <code dir="ltr" translate="no">AU</code> region match the following expression:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.region_code == "AU" &amp;&amp; inIpRange(origin.ip, '1.2.3.0/24')
</pre></li>
<li><p>The following expression matches requests from <code dir="ltr" translate="no">1.2.3.4</code> where a user
agent contains the string <code dir="ltr" translate="no">WordPress</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '1.2.3.4/32') &amp;&amp;
has(request.headers['user-agent']) &amp;&amp; request.headers['user-agent'].contains('WordPress')
</pre></li>
</ul>
<h3 data-text="Allow or deny traffic for a request URI that matches a regular expression" id="allow_or_deny_traffic_for_a_request_uri_that_matches_a_regular_expression">Allow or deny traffic for a request URI that matches a regular expression</h3>
<ul>
<li><p>The following expression matches with requests that contain the string
<code dir="ltr" translate="no">bad_path</code> in the URI:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
request.path.matches('/bad_path/')
</pre></li>
<li><p>The following expression matches with requests that have <code dir="ltr" translate="no">Chrome</code> in the
<code dir="ltr" translate="no">User-Agent</code> header field:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
request.headers['user-agent'].matches('Chrome')
</pre></li>
<li><p>The following expression shows case-insensitive matching for the
<code dir="ltr" translate="no">User-Agent</code> header containing <code dir="ltr" translate="no">wordpress</code>; it matches with
<code dir="ltr" translate="no">User-Agent:WordPress/605.1.15</code>, <code dir="ltr" translate="no">User-Agent:wordPress</code>, and other variations
of <code dir="ltr" translate="no">wordpress</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
request.headers['user-agent'].matches('(?i:wordpress)')
</pre></li>
</ul>
<h3 data-text="Allow or deny traffic that contains a specific Base64 decoded value" id="allow_or_deny_traffic_that_contains_a_specific_base64_decoded_value">Allow or deny traffic that contains a specific Base64 decoded value</h3>
<ul>
<li><p>The following expression matches with requests that have a Base64 decoded
value of <code dir="ltr" translate="no">myValue</code> for the <code dir="ltr" translate="no">user-id</code> header:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
has(request.headers['user-id']) &amp;&amp; request.headers['user-id'].base64Decode().contains('myValue')
</pre></li>
</ul>
<h3 data-text="Allow or deny traffic that has zero content-length in the HTTP body" id="allow_or_deny_traffic_that_has_zero_content-length_in_the_http_body">Allow or deny traffic that has zero <code dir="ltr" translate="no">content-length</code> in the HTTP body</h3>
<ul>
<li><p>The following expression matches requests that have a zero <code dir="ltr" translate="no">content-length</code>
in the HTTP body:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
int(request.headers["content-length"]) == 0
</pre></li>
</ul>
<h2 data-text="Preconfigured rules" id="preconfigured-rules">Preconfigured rules</h2>
<p>Preconfigured rules use preconfigured static signatures, regular expressions, or
both to match on HTTP request headers and query parameters. The available
preconfigured rules are based on the
<a class="external" href="https://modsecurity.org/crs/" target="mod">OWASP Modsecurity core rule set</a> 
version 3.0.2. Google Cloud Armor provides these predefined expression sets:</p>
<ul>
<li><code dir="ltr" translate="no">xss-&lt;version&gt;</code>: defends against cross-site scripting attacks</li>
<li><code dir="ltr" translate="no">sqli-&lt;version&gt;</code>: defends against SQL injection attacks</li>
<li><code dir="ltr" translate="no">lfi-&lt;version&gt;</code>: defends against local file inclusion attacks</li>
<li><code dir="ltr" translate="no">rfi-&lt;version&gt;</code>: defends against remote file inclusion attacks</li>
<li><code dir="ltr" translate="no">rce-&lt;version&gt;</code>: defends against remote code execution attacks</li>
</ul>
<p>To list all of the available preconfigured rules, see
<a href="/armor/docs/configure-security-policies#list-preconfig-rules">Listing the available preconfigured rules</a>.</p>
<p>For more information about preconfigured rules, see the use case
<a href="/armor/docs/security-policy-overview#preconfig-use-case">Mitigate application layer attacks by using preconfigured rules</a>.</p>
<h3 data-text="Expression set names" id="expression_set_names">Expression set names</h3>
<p>Expression set names have the format <code dir="ltr" translate="no">&lt;attack category&gt;-&lt;version field&gt;</code>. The
attack category specifies the type of attacks that you want to protect against,
such as <code dir="ltr" translate="no">xss</code> (cross-site scripting) or <code dir="ltr" translate="no">sqli</code> (SQL injection).</p>
<p>The supported version fields are <code dir="ltr" translate="no">stable</code> and <code dir="ltr" translate="no">canary</code>. Additions and
modifications to the rules are released in the <code dir="ltr" translate="no">canary</code> version first. When
additions and modifications are considered safe and stable, they are promoted
to the <code dir="ltr" translate="no">stable</code> version.</p>
<h3 data-text="Expression set member IDs" id="expression_set_member_ids">Expression set member IDs</h3>
<p>An expression set contains several expressions, each with its own core rule set
(CRS) ID.  For example, the expression set <code dir="ltr" translate="no">xss-stable</code> includes an expression
called <code dir="ltr" translate="no">owasp-crs-v020901-id981136-xss</code>, which corresponds to rule ID <code dir="ltr" translate="no">981136</code>
for <code dir="ltr" translate="no">version 2.9.1</code>. You can use the CRS IDs to exclude specific expressions from
being used, which is useful if a particular expression consistently triggers a
false positive. For more information, see the <a href="/armor/docs/troubleshooting#false-positives">false
positives</a>
troubleshooting information.</p>
<p>For information about the core rule set and tuning at different
sensitivity levels, see <a href="/armor/docs/rule-tuning">Tuning Google Cloud Armor WAF rules</a>.</p>
<h3 data-text="Operator for preconfigured rules" id="operator_for_preconfigured_rules">Operator for preconfigured rules</h3>
<table>
<thead>
<tr>
<th width="45%">Expressions</th>
<th width="55%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">evaluatePreconfiguredExpr(string, LIST)</code></td>
<td><p>Returns true if any one of the expressions inside the specified
      expression set returns true.</p>
<p>The first argument is the name of the expression set, such as
          <code dir="ltr" translate="no">xss-stable</code>. The second argument (optional) is a
          comma-separated string list of IDs that should be excluded from
          evaluation. The exclusion list is useful when a given member of the
          expression set triggers a false positive.</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Preconfigured rule examples" id="preconfigured_rule_examples">Preconfigured rule examples</h3>
<ul>
<li><p>The following expression uses the <code dir="ltr" translate="no">xss-stable</code> preconfigured rule to
mitigate XSS attacks:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
evaluatePreconfiguredExpr('xss-stable')
</pre></li>
<li><p>The following expression uses all the expressions from the <code dir="ltr" translate="no">xss-stable</code>
preconfigured rule except for member IDs <code dir="ltr" translate="no">981136</code> and <code dir="ltr" translate="no">981138</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
evaluatePreconfiguredExpr('xss-stable', ['owasp-crs-v020901-id981136-xss',
'owasp-crs-v020901-id981138-xss'])
</pre></li>
<li><p>The following expression uses a preconfigured rule to mitigate SQLi attacks
from the <code dir="ltr" translate="no">198.51.100.0/24</code> IP address range:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '198.51.100.0/24') &amp;&amp; evaluatePreconfiguredExpr('sqli-stable')
</pre></li>
</ul>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/configure-security-policies">Configure security policies, rules, and expressions</a></li>
<li><a href="/armor/docs/rule-tuning">Tune web application firewall (WAF) rules</a></li>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/rule-tuning]</H1></p><div class="devsite-article-body clearfix">
<h2 data-text="Preconfigured rules" id="preconfigured_rules">Preconfigured rules</h2>
<p>Google Cloud Armor preconfigured rules are complex web application firewall (WAF)
rules with dozens of <em>signatures</em> that are compiled from open source industry
standards. Google offers these rules as-is. The rules allow
Google Cloud Armor to evaluate dozens of distinct traffic signatures by
referring to conveniently-named rules, rather than requiring you to define
each signature manually.</p>
<p>The following table contains a comprehensive list of preconfigured WAF rules
that are available for use in a Google Cloud Armor security policy. The
rule source is
<a class="external" href="https://github.com/SpiderLabs/owasp-modsecurity-crs/releases/tag/v3.0.2" target="github">ModSecurity Core Rule Set (CRS) 3.0</a> 
and <a class="external" href="https://github.com/coreruleset/coreruleset/releases/tag/v3.3.2" target="github">CRS 3.3</a>.
We recommend that you use version 3.3 for increased sensitivity, and for an
increased breadth of protected attack types.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="33%">Google Cloud Armor rule name</th>
<th width="33%">ModSecurity rule name</th>
<th width="34%">Current status</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="2">SQL injection (public preview)</td>
<td><code dir="ltr" translate="no">sqli-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">sqli-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">sqli-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Cross-site scripting (public preview)</td>
<td><code dir="ltr" translate="no">xss-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">xss-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">xss-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Local file inclusion (public preview)</td>
<td><code dir="ltr" translate="no">lfi-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">lfi-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">lfi-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Remote file inclusion (public preview)</td>
<td><code dir="ltr" translate="no">rfi-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">rfi-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">rfi-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Remote code execution (public preview)</td>
<td><code dir="ltr" translate="no">rce-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">rce-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">rce-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Method enforcement (public preview)</td>
<td><code dir="ltr" translate="no">methodenforcement-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">methodenforcement-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">methodenforcement-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Scanner detection (public preview)</td>
<td><code dir="ltr" translate="no">scannerdetection-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">scannerdetection-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">scannerdetection-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Protocol attack (public preview)</td>
<td><code dir="ltr" translate="no">protocolattack-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">protocolattack-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">protocolattack-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">PHP injection attack (public preview)</td>
<td><code dir="ltr" translate="no">php-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">php-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">php-v33-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Session fixation attack (public preview)</td>
<td><code dir="ltr" translate="no">sessionfixation-v33-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">sessionfixation-v33-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">sessionfixation-v33-canary</code></td>
<td>Latest</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="33%">Google Cloud Armor rule name</th>
<th width="33%">ModSecurity rule name</th>
<th width="34%">Current status</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="2">SQL injection</td>
<td><code dir="ltr" translate="no">sqli-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">sqli-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">sqli-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Cross-site scripting</td>
<td><code dir="ltr" translate="no">xss-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">xss-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">xss-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Local file inclusion</td>
<td><code dir="ltr" translate="no">lfi-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">lfi-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">lfi-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Remote file inclusion</td>
<td><code dir="ltr" translate="no">rfi-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">rfi-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">rfi-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Remote code execution</td>
<td><code dir="ltr" translate="no">rce-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">rce-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">rce-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Method enforcement (public preview)</td>
<td><code dir="ltr" translate="no">methodenforcement-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">methodenforcement-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">methodenforcement-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Scanner detection</td>
<td><code dir="ltr" translate="no">scannerdetection-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">scannerdetection-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">scannerdetection-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Protocol attack</td>
<td><code dir="ltr" translate="no">protocolattack-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">protocolattack-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">protocolattack-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">PHP injection attack</td>
<td><code dir="ltr" translate="no">php-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">php-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">php-canary</code></td>
<td>Latest</td>
</tr>
<tr>
<td rowspan="2">Session fixation attack</td>
<td><code dir="ltr" translate="no">sessionfixation-stable</code></td>
<td>In sync with <code dir="ltr" translate="no">sessionfixation-canary</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">sessionfixation-canary</code></td>
<td>Latest</td>
</tr>
</tbody>
</table></section>
</div>
<p>In addition, the following <code dir="ltr" translate="no">cve-canary</code> rule is available to all
Google Cloud Armor customers to help detect and optionally block exploit
attempts of the <code dir="ltr" translate="no">CVE-2021-44228</code> and <code dir="ltr" translate="no">CVE-2021-45046</code> vulnerabilities.</p>
<table>
<thead>
<tr>
<th width="33%">Google Cloud Armor rule name</th>
<th width="33%">Rule content</th>
<th width="34%">Covered vulnerability types</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">cve-canary</code></td>
<td>Newly discovered vulnerabilities</td>
<td>Log4j vulnerability</td>
</tr>
</tbody>
</table>
<p>Each preconfigured rule consists of multiple signatures. Incoming requests are
evaluated against the preconfigured rules. A request matches a preconfigured
rule if the request matches any of the signatures that are associated with the
preconfigured rule. A match is made when the <code dir="ltr" translate="no">evaluatePreconfiguredExpr()</code>
command returns the value <code dir="ltr" translate="no">true</code>.</p>
<p>If you decide that a preconfigured rule matches more traffic than is necessary,
or if the rule is blocking traffic that needs to be allowed, the rule can be
tuned to disable noisy or otherwise unnecessary signatures. To disable signatures
in a particular preconfigured rule, you provide a list of IDs of the unwanted
signatures to the <code dir="ltr" translate="no">evaluatePreconfiguredExpr()</code> command.</p>
<p>The following example excludes two CRS rule IDs from the preconfigured
<code dir="ltr" translate="no">xss-v33-stable</code> (CRS 3.3) WAF rule:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
evaluatePreconfiguredExpr('xss-v33-stable', ['owasp-crs-v030301-id941330-xss', 'owasp-crs-v030301-id941340-xss'])
</pre>
<p>When you exclude signature IDs from preconfigured CRS rule sets, you must match
the signature ID version with the rule set version (CRS 3.0 or 3.3) to avoid
configuration errors.</p>
<p>The preceding example is an expression in the <a href="/armor/docs/rules-language-reference">custom rules language</a>.
The general syntax is:</p>
<pre dir="ltr" translate="no">
evaluatePreconfiguredExpr(RULE, ['SIGNATURE1', 'SIGNATURE2', 'SIGNATURE3'])
</pre>
<h2 data-text="Preconfigured ModSecurity rules" id="preconfigured_modsecurity_rules">Preconfigured ModSecurity rules</h2>
<p>Each preconfigured rule has a sensitivity level that corresponds to a
ModSecurity
<a class="external" href="https://coreruleset.org/faq/#paranoialevel">paranoia level</a>.
A lower sensitivity level indicates a higher confidence signature, which is less
likely to generate a false positive. A higher sensitivity level increases
security, but also increases the risk of generating a false positive.</p>
<h3 data-text="SQL injection (SQLi)" id="sql_injection_sqli">SQL injection (SQLi)</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the SQLi preconfigured rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_1"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942140-sqli</code></td>
<td>1</td>
<td>SQL injection attack: Common DB Names Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942160-sqli</code></td>
<td>1</td>
<td>Detects blind SQLi tests using sleep() or benchmark()</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942170-sqli</code></td>
<td>1</td>
<td>Detects SQL benchmark and sleep injection attempts including
      conditional queries</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942190-sqli</code></td>
<td>1</td>
<td>Detects MSSQL code execution and information gathering attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942220-sqli</code></td>
<td>1</td>
<td>Looks for integer overflow attacks</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942230-sqli</code></td>
<td>1</td>
<td>Detects conditional SQL injection attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942240-sqli</code></td>
<td>1</td>
<td>Detects MySQL charset switch and MSSQL DoS attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942250-sqli</code></td>
<td>1</td>
<td>Detects MATCH AGAINST</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942270-sqli</code></td>
<td>1</td>
<td>Looks for basic SQL injection; common attack string for MySql</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942280-sqli</code></td>
<td>1</td>
<td>Detects Postgres pg_sleep injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942290-sqli</code></td>
<td>1</td>
<td>Finds basic MongoDB SQL injection attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942320-sqli</code></td>
<td>1</td>
<td>Detects MySQL and PostgreSQL stored procedure/function injections</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942350-sqli</code></td>
<td>1</td>
<td>Detects MySQL UDF injection and other data/structure manipulation
      attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942360-sqli</code></td>
<td>1</td>
<td>Detects concatenated basic SQL injection and SQLLFI attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942500-sqli</code></td>
<td>1</td>
<td>MySQL in-line comment detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942110-sqli</code></td>
<td>2</td>
<td>SQL injection attack: Common Injection Testing Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942120-sqli</code></td>
<td>2</td>
<td>SQL injection attack: SQL Operator Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942130-sqli</code></td>
<td>2</td>
<td>SQL Injection Attack: SQL Tautology Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942150-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942180-sqli</code></td>
<td>2</td>
<td>Detects basic SQL authentication bypass attempts 1/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942200-sqli</code></td>
<td>2</td>
<td>Detects MySQL comment-/space-obfuscated injections and backtick
      termination</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942210-sqli</code></td>
<td>2</td>
<td>Detects chained SQL injection attempts 1/2</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942260-sqli</code></td>
<td>2</td>
<td>Detects basic SQL authentication bypass attempts 2/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942300-sqli</code></td>
<td>2</td>
<td>Detects MySQL comments</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942310-sqli</code></td>
<td>2</td>
<td>Detects chained SQL injection attempts 2/2</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942330-sqli</code></td>
<td>2</td>
<td>Detects classic SQL injection probings 1/2</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942340-sqli</code></td>
<td>2</td>
<td>Detects basic SQL authentication bypass attempts 3/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942361-sqli</code></td>
<td>2</td>
<td>Detects basic SQL injection based on keyword alter or union</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942370-sqli</code></td>
<td>2</td>
<td>Detects classic SQL injection probings 2/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942380-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942390-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942400-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942410-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942470-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942480-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942430-sqli</code></td>
<td>2</td>
<td>Restricted SQL Character Anomaly Detection (args): # of special
      characters exceeded (12)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942440-sqli</code></td>
<td>2</td>
<td>SQL Comment Sequence Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942450-sqli</code></td>
<td>2</td>
<td>SQL Hex Encoding Identified</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942510-sqli</code></td>
<td>2</td>
<td>SQLi bypass attempt by ticks or backticks detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942251-sqli</code></td>
<td>3</td>
<td>Detects HAVING injections</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942490-sqli</code></td>
<td>3</td>
<td>Detects classic SQL injection probings 3/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942420-sqli</code></td>
<td>3</td>
<td>Restricted SQL Character Anomaly Detection (cookies): # of special
      characters exceeded (8)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942431-sqli</code></td>
<td>3</td>
<td>Restricted SQL Character Anomaly Detection (args): # of special
      characters exceeded (6)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942460-sqli</code></td>
<td>3</td>
<td>Meta-Character Anomaly Detection Alert - Repetitive Non-Word
      Characters</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942511-sqli</code></td>
<td>3</td>
<td>SQLi bypass attempt by ticks detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942421-sqli</code></td>
<td>4</td>
<td>Restricted SQL Character Anomaly Detection (cookies): # of special
      characters exceeded (3)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id942432-sqli</code></td>
<td>4</td>
<td>Restricted SQL Character Anomaly Detection (args): # of special
      characters exceeded (2)</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_1"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942140-sqli</code></td>
<td>1</td>
<td>SQL injection attack: Common DB Names Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942160-sqli</code></td>
<td>1</td>
<td>Detects blind SQLi tests using sleep() or benchmark()</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942170-sqli</code></td>
<td>1</td>
<td>Detects SQL benchmark and sleep injection attempts including
      conditional queries</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942190-sqli</code></td>
<td>1</td>
<td>Detects MSSQL code execution and information gathering attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942220-sqli</code></td>
<td>1</td>
<td>Looks for integer overflow attacks</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942230-sqli</code></td>
<td>1</td>
<td>Detects conditional SQL injection attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942240-sqli</code></td>
<td>1</td>
<td>Detects MySQL charset switch and MSSQL DoS attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942250-sqli</code></td>
<td>1</td>
<td>Detects MATCH AGAINST</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942270-sqli</code></td>
<td>1</td>
<td>Looks for basic SQL injection; common attack string for MySql</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942280-sqli</code></td>
<td>1</td>
<td>Detects Postgres pg_sleep injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942290-sqli</code></td>
<td>1</td>
<td>Finds basic MongoDB SQL injection attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942320-sqli</code></td>
<td>1</td>
<td>Detects MySQL and PostgreSQL stored procedure/function injections</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942350-sqli</code></td>
<td>1</td>
<td>Detects MySQL UDF injection and other data/structure manipulation
      attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942360-sqli</code></td>
<td>1</td>
<td>Detects concatenated basic SQL injection and SQLLFI attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>MySQL in-line comment detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942110-sqli</code></td>
<td>2</td>
<td>SQL injection attack: Common Injection Testing Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942120-sqli</code></td>
<td>2</td>
<td>SQL injection attack: SQL Operator Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>SQL Injection Attack: SQL Tautology Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942150-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942180-sqli</code></td>
<td>2</td>
<td>Detects basic SQL authentication bypass attempts 1/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942200-sqli</code></td>
<td>2</td>
<td>Detects MySQL comment-/space-obfuscated injections and backtick
      termination</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942210-sqli</code></td>
<td>2</td>
<td>Detects chained SQL injection attempts 1/2</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942260-sqli</code></td>
<td>2</td>
<td>Detects basic SQL authentication bypass attempts 2/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942300-sqli</code></td>
<td>2</td>
<td>Detects MySQL comments</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942310-sqli</code></td>
<td>2</td>
<td>Detects chained SQL injection attempts 2/2</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942330-sqli</code></td>
<td>2</td>
<td>Detects classic SQL injection probings 1/2</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942340-sqli</code></td>
<td>2</td>
<td>Detects basic SQL authentication bypass attempts 3/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>Detects basic SQL injection based on keyword alter or union</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>Detects classic SQL injection probings 2/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942380-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942390-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942400-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942410-sqli</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>SQL injection attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942430-sqli</code></td>
<td>2</td>
<td>Restricted SQL Character Anomaly Detection (args): # of special
      characters exceeded (12)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942440-sqli</code></td>
<td>2</td>
<td>SQL Comment Sequence Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942450-sqli</code></td>
<td>2</td>
<td>SQL Hex Encoding Identified</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>SQLi bypass attempt by ticks or backticks detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942251-sqli</code></td>
<td>3</td>
<td>Detects HAVING injections</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>Detects classic SQL injection probings 3/3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942420-sqli</code></td>
<td>3</td>
<td>Restricted SQL Character Anomaly Detection (cookies): # of special
      characters exceeded (8)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942431-sqli</code></td>
<td>3</td>
<td>Restricted SQL Character Anomaly Detection (args): # of special
      characters exceeded (6)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942460-sqli</code></td>
<td>3</td>
<td>Meta-Character Anomaly Detection Alert - Repetitive Non-Word
      Characters</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>3</td>
<td>SQLi bypass attempt by ticks detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942421-sqli</code></td>
<td>4</td>
<td>Restricted SQL Character Anomaly Detection (cookies): # of special
      characters exceeded (3)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id942432-sqli</code></td>
<td>4</td>
<td>Restricted SQL Character Anomaly Detection (args): # of special
      characters exceeded (2)</td>
</tr>
</tbody>
</table></section>
</div>
<p>To configure a rule at a particular sensitivity level, disable the signatures
at greater sensitivity levels.</p>
<table>
<thead>
<tr>
<th>SQLi sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('sqli-v33-stable',
['owasp-crs-v030301-id942110-sqli',
  'owasp-crs-v030301-id942120-sqli',
  'owasp-crs-v030301-id942130-sqli',
  'owasp-crs-v030301-id942150-sqli',
  'owasp-crs-v030301-id942180-sqli',
  'owasp-crs-v030301-id942200-sqli',
  'owasp-crs-v030301-id942210-sqli',
  'owasp-crs-v030301-id942260-sqli',
  'owasp-crs-v030301-id942300-sqli',
  'owasp-crs-v030301-id942310-sqli',
  'owasp-crs-v030301-id942330-sqli',
  'owasp-crs-v030301-id942340-sqli',
  'owasp-crs-v030301-id942361-sqli',
  'owasp-crs-v030301-id942370-sqli',
  'owasp-crs-v030301-id942380-sqli',
  'owasp-crs-v030301-id942390-sqli',
  'owasp-crs-v030301-id942400-sqli',
  'owasp-crs-v030301-id942410-sqli',
  'owasp-crs-v030301-id942470-sqli',
  'owasp-crs-v030301-id942480-sqli',
  'owasp-crs-v030301-id942430-sqli',
  'owasp-crs-v030301-id942440-sqli',
  'owasp-crs-v030301-id942450-sqli',
  'owasp-crs-v030301-id942510-sqli',
  'owasp-crs-v030301-id942251-sqli',
  'owasp-crs-v030301-id942490-sqli',
  'owasp-crs-v030301-id942420-sqli',
  'owasp-crs-v030301-id942431-sqli',
  'owasp-crs-v030301-id942460-sqli',
  'owasp-crs-v030301-id942511-sqli',
  'owasp-crs-v030301-id942421-sqli',
  'owasp-crs-v030301-id942432-sqli']
)
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>SQLi sensitivity level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('sqli-v33-stable',
 ['owasp-crs-v030301-id942251-sqli',
  'owasp-crs-v030301-id942490-sqli',
  'owasp-crs-v030301-id942420-sqli',
  'owasp-crs-v030301-id942431-sqli',
  'owasp-crs-v030301-id942460-sqli',
  'owasp-crs-v030301-id942511-sqli',
  'owasp-crs-v030301-id942421-sqli',
  'owasp-crs-v030301-id942432-sqli']
)</pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>SQLi sensitivity level 3</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('sqli-v33-stable',
        ['owasp-crs-v030301-id942421-sqli',
         'owasp-crs-v030301-id942432-sqli']
         )</pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>SQLi sensitivity level 4</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('sqli-v33-stable')</pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Cross-site scripting (XSS)" id="cross-site_scripting_xss">Cross-site scripting (XSS)</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the XSS preconfigured rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_2"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941110-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 1: Script Tag Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941120-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 2: Event Handler Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941130-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 3: Attribute Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941140-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 4: JavaScript URI Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941160-xss</code></td>
<td>1</td>
<td>NoScript XSS InjectionChecker: HTML Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941170-xss</code></td>
<td>1</td>
<td>NoScript XSS InjectionChecker: Attribute Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941180-xss</code></td>
<td>1</td>
<td>Node-Validator Blacklist Keywords</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941190-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941200-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941210-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941220-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941230-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941240-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941250-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941260-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941270-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941280-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941290-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941300-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941310-xss</code></td>
<td>1</td>
<td>US-ASCII Malformed Encoding XSS Filter - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941350-xss</code></td>
<td>1</td>
<td>UTF-7 Encoding IE XSS - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941360-xss</code></td>
<td>1</td>
<td>Hieroglyphy obfuscation detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941370-xss</code></td>
<td>1</td>
<td>JavaScript global variable found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941150-xss</code></td>
<td>2</td>
<td>XSS Filter - Category 5: Disallowed HTML Attributes</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941320-xss</code></td>
<td>2</td>
<td>Possible XSS Attack Detected - HTML Tag Handler</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941330-xss</code></td>
<td>2</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941340-xss</code></td>
<td>2</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id941380-xss</code></td>
<td>2</td>
<td>AngularJS client side template injection detected</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_2"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941110-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 1: Script Tag Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941120-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 2: Event Handler Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941130-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 3: Attribute Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941140-xss</code></td>
<td>1</td>
<td>XSS Filter - Category 4: JavaScript URI Vector</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941160-xss</code></td>
<td>1</td>
<td>NoScript XSS InjectionChecker: HTML Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941170-xss</code></td>
<td>1</td>
<td>NoScript XSS InjectionChecker: Attribute Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941180-xss</code></td>
<td>1</td>
<td>Node-Validator Blacklist Keywords</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941190-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941200-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941210-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941220-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941230-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941240-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941250-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941260-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941270-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941280-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941290-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941300-xss</code></td>
<td>1</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941310-xss</code></td>
<td>1</td>
<td>US-ASCII Malformed Encoding XSS Filter - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941350-xss</code></td>
<td>1</td>
<td>UTF-7 Encoding IE XSS - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>JSFuck / Hieroglyphy obfuscation detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>JavaScript global variable found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941150-xss</code></td>
<td>2</td>
<td>XSS Filter - Category 5: Disallowed HTML Attributes</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941320-xss</code></td>
<td>2</td>
<td>Possible XSS Attack Detected - HTML Tag Handler</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941330-xss</code></td>
<td>2</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id941340-xss</code></td>
<td>2</td>
<td>IE XSS Filters - Attack Detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>AngularJS client side template injection detected</td>
</tr>
</tbody>
</table></section>
</div>
<p>To configure a rule at a particular sensitivity level, disable the signatures
at greater sensitivity levels.</p>
<table>
<thead>
<tr>
<th>XSS sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('xss-v33-stable',
['owasp-crs-v030301-id941150-xss',
  'owasp-crs-v030301-id941320-xss',
  'owasp-crs-v030301-id941330-xss',
  'owasp-crs-v030301-id941340-xss',
  'owasp-crs-v030301-id941380-xss'
])
          </pre>
</p></td>
</tr>
</tbody>
</table>
<p><br/>
All signatures for XSS are below sensitivity level 2. The following
configuration works for other sensitivity levels:</p>
<table>
<thead>
<tr>
<th>XSS sensitivity level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('xss-v33-stable')</pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Local file inclusion (LFI)" id="local_file_inclusion_lfi">Local file inclusion (LFI)</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the LFI preconfigured rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_3"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id930100-lfi</code></td>
<td>1</td>
<td>Path Traversal Attack (/../)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id930110-lfi</code></td>
<td>1</td>
<td>Path Traversal Attack (/../)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id930120-lfi</code></td>
<td>1</td>
<td>OS File Access Attempt</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id930130-lfi</code></td>
<td>1</td>
<td>Restricted File Access Attempt</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_3"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id930100-lfi</code></td>
<td>1</td>
<td>Path Traversal Attack (/../)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id930110-lfi</code></td>
<td>1</td>
<td>Path Traversal Attack (/../)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id930120-lfi</code></td>
<td>1</td>
<td>OS File Access Attempt</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id930130-lfi</code></td>
<td>1</td>
<td>Restricted File Access Attempt</td>
</tr>
</tbody>
</table></section>
</div>
<p>All signatures for LFI are at sensitivity level 1. The following configuration
works for all sensitivity levels:</p>
<table>
<thead>
<tr>
<th>LFI sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('lfi-v33-canary')</pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Remote code execution (RCE)" id="remote_code_execution_rce">Remote code execution (RCE)</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the RCE preconfigured rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_4"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932100-rce</code></td>
<td>1</td>
<td>UNIX Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932105-rce</code></td>
<td>1</td>
<td>UNIX Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932110-rce</code></td>
<td>1</td>
<td>Windows Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932115-rce</code></td>
<td>1</td>
<td>Windows Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932120-rce</code></td>
<td>1</td>
<td>Windows PowerShell Command Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932130-rce</code></td>
<td>1</td>
<td>Unix Shell Expression Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932140-rce</code></td>
<td>1</td>
<td>Windows FOR/IF Command Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932150-rce</code></td>
<td>1</td>
<td>Direct UNIX Command Execution</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932160-rce</code></td>
<td>1</td>
<td>UNIX Shell Code Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932170-rce</code></td>
<td>1</td>
<td>Shellshock (CVE-2014-6271)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932171-rce</code></td>
<td>1</td>
<td>Shellshock (CVE-2014-6271)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932180-rce</code></td>
<td>1</td>
<td>Restricted File Upload Attempt</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932200-rce</code></td>
<td>2</td>
<td>RCE Bypass Technique</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932106-rce</code></td>
<td>3</td>
<td>Remote Command Execution: Unix Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id932190-rce</code></td>
<td>3</td>
<td>Remote Command Execution: Wildcard bypass technique attempt</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_4"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932100-rce</code></td>
<td>1</td>
<td>UNIX Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932105-rce</code></td>
<td>1</td>
<td>UNIX Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932110-rce</code></td>
<td>1</td>
<td>Windows Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932115-rce</code></td>
<td>1</td>
<td>Windows Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932120-rce</code></td>
<td>1</td>
<td>Windows PowerShell Command Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932130-rce</code></td>
<td>1</td>
<td>Unix Shell Expression Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932140-rce</code></td>
<td>1</td>
<td>Windows FOR/IF Command Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932150-rce</code></td>
<td>1</td>
<td>Direct UNIX Command Execution</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932160-rce</code></td>
<td>1</td>
<td>UNIX Shell Code Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932170-rce</code></td>
<td>1</td>
<td>Shellshock (CVE-2014-6271)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id932171-rce</code></td>
<td>1</td>
<td>Shellshock (CVE-2014-6271)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>Restricted File Upload Attempt</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>2</td>
<td>RCE Bypass Technique</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>3</td>
<td>Remote Command Execution: Unix Command Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>3</td>
<td>Remote Command Execution: Wildcard bypass technique attempt</td>
</tr>
</tbody>
</table></section>
</div>
<p>All signatures for RCE are at sensitivity level 1. The following configuration
works for all sensitivity levels:</p>
<table>
<thead>
<tr>
<th>RCE sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('rce-v33-stable',
          ['owasp-crs-v030301-id932200-rce',
           'owasp-crs-v030301-id932106-rce',
           'owasp-crs-v030301-id932190-rce'])
          )</pre>
</p></td>
</tr>
</tbody>
</table>
<p>The following configuration works for other sensitivity levels:</p>
<table>
<thead>
<tr>
<th>RCE sensitivity level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('rce-v33-stable',
          ['owasp-crs-v030301-id932106-rce',
           'owasp-crs-v030301-id932190-rce'])
          )
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>RCE sensitivity level 3</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('rce-v33-stable')
          </pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Remote file inclusion (RFI)" id="remote_file_inclusion_rfi">Remote file inclusion (RFI)</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the RFI preconfigured rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_5"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="22.5%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id931100-rfi</code></td>
<td>1</td>
<td>URL Parameter using IP Address</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id931110-rfi</code></td>
<td>1</td>
<td>Common RFI Vulnerable Parameter Name used w/URL Payload</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id931120-rfi</code></td>
<td>1</td>
<td>URL Payload Used w/Trailing Question Mark Character (?)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id931130-rfi</code></td>
<td>2</td>
<td>Off-Domain Reference/Link</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_5"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="22.5%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id931100-rfi</code></td>
<td>1</td>
<td>URL Parameter using IP Address</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id931110-rfi</code></td>
<td>1</td>
<td>Common RFI Vulnerable Parameter Name used w/URL Payload</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id931120-rfi</code></td>
<td>1</td>
<td>URL Payload Used w/Trailing Question Mark Character (?)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id931130-rfi</code></td>
<td>2</td>
<td>Off-Domain Reference/Link</td>
</tr>
</tbody>
</table></section>
</div>
<p>To configure a rule at a particular sensitivity level, disable the signatures
at greater sensitivity levels.</p>
<table>
<thead>
<tr>
<th>RFI sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('rfi-v33-canary', ['owasp-crs-v030301-id931130-rfi'])</pre>
</p></td>
</tr>
</tbody>
</table>
<p>All signatures for RFI are below sensitivity level 2. The following
configuration works for other sensitivity levels:</p>
<table>
<thead>
<tr>
<th>RFI sensitivity level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('rfi-v33-stable')</pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Method enforcement" id="method_enforcement">Method enforcement</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the method enforcement preconfigured
rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_6"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id911100-methodenforcement</code></td>
<td>1</td>
<td>Method is not allowed by policy</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_6"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id911100-methodenforcement</code></td>
<td>1</td>
<td>Method is not allowed by policy</td>
</tr>
</tbody>
</table></section>
</div>
<p>All signatures for Method Enforcement are below sensitivity level 2. The following
configuration works for other sensitivity levels:</p>
<table>
<thead>
<tr>
<th>Method Enforcement sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('methodenforcement-v33-stable')</pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Scanner detection" id="scanner_detection">Scanner detection</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the scanner detection preconfigured
rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_7"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id913100-scannerdetection</code></td>
<td>1</td>
<td>Found User-Agent associated with security scanner</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id913110-scannerdetection</code></td>
<td>1</td>
<td>Found request header associated with security scanner</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id913120-scannerdetection</code></td>
<td>1</td>
<td>Found request filename/argument associated with security scanner</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id913101-scannerdetection</code></td>
<td>2</td>
<td>Found User-Agent associated with scripting/generic HTTP client</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id913102-scannerdetection</code></td>
<td>2</td>
<td>Found User-Agent associated with web crawler/bot</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_7"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id913100-scannerdetection</code></td>
<td>1</td>
<td>Found User-Agent associated with security scanner</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id913110-scannerdetection</code></td>
<td>1</td>
<td>Found request header associated with security scanner</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id913120-scannerdetection</code></td>
<td>1</td>
<td>Found request filename/argument associated with security scanner</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id913101-scannerdetection</code></td>
<td>2</td>
<td>Found User-Agent associated with scripting/generic HTTP client</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id913102-scannerdetection</code></td>
<td>2</td>
<td>Found User-Agent associated with web crawler/bot</td>
</tr>
</tbody>
</table></section>
</div>
<p>To configure a rule at a particular sensitivity level, disable the signatures
at greater sensitivity levels.</p>
<table>
<thead>
<tr>
<th>Scanner Detection sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('scannerdetection-v33-stable',
  ['owasp-crs-v030301-id913101-scannerdetection',
  'owasp-crs-v030301-id913102-scannerdetection']
)
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Scanner Detection sensitivity level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('scannerdetection-v33-stable')
          </pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Protocol attack" id="protocol_attack">Protocol attack</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the protocol attack preconfigured
rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_8"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>HTTP Request Smuggling Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921110-protocolattack</code></td>
<td>1</td>
<td>HTTP Request Smuggling Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921120-protocolattack</code></td>
<td>1</td>
<td>HTTP Response Splitting Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921130-protocolattack</code></td>
<td>1</td>
<td>HTTP Response Splitting Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921140-protocolattack</code></td>
<td>1</td>
<td>HTTP Header Injection Attack via headers</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921150-protocolattack</code></td>
<td>1</td>
<td>HTTP Header Injection Attack via payload (CR/LF detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921160-protocolattack</code></td>
<td>1</td>
<td>HTTP Header Injection Attack via payload (CR/LF and header-name detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921190-protocolattack</code></td>
<td>1</td>
<td>HTTP Splitting (CR/LF in request filename detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921200-protocolattack</code></td>
<td>1</td>
<td>LDAP Injection Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921151-protocolattack</code></td>
<td>2</td>
<td>HTTP Header Injection Attack via payload (CR/LF detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id921170-protocolattack</code></td>
<td>3</td>
<td>HTTP Parameter Pollution</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_8"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921100-protocolattack</code></td>
<td>1</td>
<td>HTTP Request Smuggling Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921110-protocolattack</code></td>
<td>1</td>
<td>HTTP Request Smuggling Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921120-protocolattack</code></td>
<td>1</td>
<td>HTTP Response Splitting Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921130-protocolattack</code></td>
<td>1</td>
<td>HTTP Response Splitting Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921140-protocolattack</code></td>
<td>1</td>
<td>HTTP Header Injection Attack via headers</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921150-protocolattack</code></td>
<td>1</td>
<td>HTTP Header Injection Attack via payload (CR/LF detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921160-protocolattack</code></td>
<td>1</td>
<td>HTTP Header Injection Attack via payload (CR/LF and header-name detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>HTTP Splitting (CR/LF in request filename detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>LDAP Injection Attack</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921151-protocolattack</code></td>
<td>2</td>
<td>HTTP Header Injection Attack via payload (CR/LF detected)</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id921170-protocolattack</code></td>
<td>3</td>
<td>HTTP Parameter Pollution</td>
</tr>
</tbody>
</table></section>
</div>
<p>To configure a rule at a particular sensitivity level, disable the signatures
at greater sensitivity levels.</p>
<table>
<thead>
<tr>
<th>Protocol Attack sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('protocolattack-v33-stable',
  ['owasp-crs-v030301-id921151-protocolattack',
  'owasp-crs-v030301-id921170-protocolattack']
)
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Protocol Attack sensitivity level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('protocolattack-v33-stable',
  ['owasp-crs-v030301-id921170-protocolattack']
)
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Protocol Attack sensitivity level 3</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('protocolattack-v33-stable')
          </pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="PHP" id="php">PHP</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the PHP preconfigured rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_9"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933100-php</code></td>
<td>1</td>
<td>PHP Injection Attack: PHP Open Tag Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933110-php</code></td>
<td>1</td>
<td>PHP Injection Attack: PHP Script File Upload Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933120-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Configuration Directive Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933130-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Variables Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933140-php</code></td>
<td>1</td>
<td>PHP Injection Attack: I/O Stream Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933200-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Wrapper scheme detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933150-php</code></td>
<td>1</td>
<td>PHP Injection Attack: High-Risk PHP Function Name Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933160-php</code></td>
<td>1</td>
<td>PHP Injection Attack: High-Risk PHP Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933170-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Serialized Object Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933180-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Variable Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933210-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Variable Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933151-php</code></td>
<td>2</td>
<td>PHP Injection Attack: Medium-Risk PHP Function Name Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933131-php</code></td>
<td>3</td>
<td>PHP Injection Attack: Variables Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933161-php</code></td>
<td>3</td>
<td>PHP Injection Attack: Low-Value PHP Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933111-php</code></td>
<td>3</td>
<td>PHP Injection Attack: PHP Script File Upload Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id933190-php</code></td>
<td>3</td>
<td>PHP Injection Attack: PHP Closing Tag Found</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_9"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933100-php</code></td>
<td>1</td>
<td>PHP Injection Attack: PHP Open Tag Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933110-php</code></td>
<td>1</td>
<td>PHP Injection Attack: PHP Script File Upload Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933120-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Configuration Directive Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933130-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Variables Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933140-php</code></td>
<td>1</td>
<td>PHP Injection Attack: I/O Stream Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>PHP Injection Attack: Wrapper scheme detected</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933150-php</code></td>
<td>1</td>
<td>PHP Injection Attack: High-Risk PHP Function Name Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933160-php</code></td>
<td>1</td>
<td>PHP Injection Attack: High-Risk PHP Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933170-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Serialized Object Injection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933180-php</code></td>
<td>1</td>
<td>PHP Injection Attack: Variable Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>1</td>
<td>PHP Injection Attack: Variable Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933151-php</code></td>
<td>2</td>
<td>PHP Injection Attack: Medium-Risk PHP Function Name Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933131-php</code></td>
<td>3</td>
<td>PHP Injection Attack: Variables Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933161-php</code></td>
<td>3</td>
<td>PHP Injection Attack: Low-Value PHP Function Call Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id933111-php</code></td>
<td>3</td>
<td>PHP Injection Attack: PHP Script File Upload Found</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">Not included</code></td>
<td>3</td>
<td>PHP Injection Attack: PHP Closing Tag Found</td>
</tr>
</tbody>
</table></section>
</div>
<p>To configure a rule at a particular sensitivity level, disable the signatures
at greater sensitivity levels.</p>
<table>
<thead>
<tr>
<th>PHP Injection Attack sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('php-v33-stable',
['owasp-crs-v030301-id933151-php',
  'owasp-crs-v030301-id933131-php',
  'owasp-crs-v030301-id933161-php',
  'owasp-crs-v030301-id933111-php',
  'owasp-crs-v030301-id933190-php']
)
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>PHP Injection Attack sensitivity level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('php-v33-stable',
  ['owasp-crs-v0303001-id933131-php',
  'owasp-crs-v0303001-id933161-php',
  'owasp-crs-v0303001-id933111-php'
  'owasp-crs-v030301-id933190-php'])
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>PHP Injection Attack sensitivity level 3</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('php-v33-stable')
          </pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="Session fixation" id="session_fixation">Session fixation</h3>
<p>The following table provides the signature ID, sensitivity level, and
description of each supported signature in the session fixation preconfigured
rule.</p>
<div class="ds-selector-tabs" data-ds-scope="code-sample">
<section><h3 data-text=" CRS 3.3 " id="crs-3.3_10"> CRS 3.3 </h3><p>
<aside class="beta">
<p>
<strong>
      
        Preview
      
        
    </strong>
</p>
<p>
      
      
        This product or feature is covered by the
        <a href="/terms/service-terms#1">Pre-GA Offerings Terms</a> of the Google Cloud
        Terms of Service. Pre-GA products and features might have limited support, and changes to
        pre-GA products and features might not be compatible with other pre-GA versions.
      
      For more information, see the
      <a href="/products#product-launch-stages">launch stage descriptions</a>.
  </p>
</aside>
</p>
<table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id943100-sessionfixation</code></td>
<td>1</td>
<td>Possible Session Fixation Attack: Setting Cookie Values in HTML</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id943110-sessionfixation</code></td>
<td>1</td>
<td>Possible Session Fixation Attack: SessionID Parameter Name with Off-Domain Referer</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030301-id943120-sessionfixation</code></td>
<td>1</td>
<td>Possible Session Fixation Attack: SessionID Parameter Name with No Referer</td>
</tr>
</tbody>
</table></section>
<section><h3 data-text=" CRS 3.0 " id="crs-3.0_10"> CRS 3.0 </h3><table>
<thead>
<tr>
<th width="45%">Signature ID (Rule ID)</th>
<th width="5%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id943100-sessionfixation</code></td>
<td>1</td>
<td>Possible Session Fixation Attack: Setting Cookie Values in HTML</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id943110-sessionfixation</code></td>
<td>1</td>
<td>Possible Session Fixation Attack: SessionID Parameter Name with Off-Domain Referer</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id943120-sessionfixation</code></td>
<td>1</td>
<td>Possible Session Fixation Attack: SessionID Parameter Name with No Referer</td>
</tr>
</tbody>
</table></section>
</div>
<p>All signatures for Session Fixation are below sensitivity level 2. The following
configuration works for other sensitivity levels:</p>
<table>
<thead>
<tr>
<th>Session Fixation sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('sessionfixation-v33-canary')</pre>
</p></td>
</tr>
</tbody>
</table>
<h3 data-text="CVEs and other vulnerabilities" id="cves_and_other_vulnerabilities">CVEs and other vulnerabilities</h3>
<p>The following signatures cover the <code dir="ltr" translate="no">CVE-2021-44228</code> and <code dir="ltr" translate="no">CVE-2021-45046</code> Log4j
RCE Vulnerabilities.</p>
<table>
<thead>
<tr>
<th width="30%">Signature ID (Rule ID)</th>
<th width="20%">Sensitivity level</th>
<th width="50%">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id044228-cve</code></td>
<td>1</td>
<td>Base rule to help detect exploit attempts of <code dir="ltr" translate="no">CVE-2021-44228</code>
          &amp; <code dir="ltr" translate="no">CVE-2021-45046</code></td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id144228-cve</code></td>
<td>1</td>
<td>Google-provided enhancements to cover more bypass and obfuscation attempts</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id244228-cve</code></td>
<td>3</td>
<td>Increased sensitivity of detection to target even more bypass and
           obfuscation attempts, with nominal increase in risk of false positive detection</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">owasp-crs-v030001-id344228-cve</code></td>
<td>3</td>
<td>Increased sensitivity of detection to target even more bypass and
           obfuscation attempts using base64 encoding, with nominal increase in risk of false positive detection</td>
</tr>
</tbody>
</table>
<p>To configure a rule at a particular sensitivity level, disable the signatures at greater sensitivity levels.</p>
<table>
<thead>
<tr>
<th>CVE sensitivity level 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><pre dir="ltr" translate="no">
evaluatePreconfiguredExpr('cve-canary', ['owasp-crs-v030001-id244228-cve',
  'owasp-crs-v030001-id344228-cve'])
          </pre>
</p></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>CVE sensitivity level 3</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><pre dir="ltr" translate="no">evaluatePreconfiguredExpr('cve-canary')</pre>
</p></td>
</tr>
</tbody>
</table>
<h2 data-text="Limitations" id="limitations">Limitations</h2>
<p>Google Cloud Armor preconfigured rules have the following limitations:</p>
<ul>
<li>Among the HTTP request types with a request body, Google Cloud Armor
processes only <code dir="ltr" translate="no">POST</code> requests. Google Cloud Armor evaluates preconfigured
rules against the first 8 KB of <code dir="ltr" translate="no">POST</code> body content. For more information, see
<a href="/armor/docs/security-policy-overview#post-body"><code dir="ltr" translate="no">POST</code> body inspection limitation</a>.</li>
<li>Google Cloud Armor can parse and apply preconfigured WAF rules for default
URL-encoded and JSON-formatted <code dir="ltr" translate="no">POST</code> bodies (Content-Type='application/json').
However, Google Cloud Armor does not parse or decode other HTTP Content-Type
and Content-Encoding formats.</li>
<li>Google Cloud Armor security policies are available only for backend services
behind a load balancer. Therefore, load balancing quotas and limits apply to
your deployment. See the load balancing
<a href="/load-balancing/docs/quotas">quotas</a> page for more information.</li>
<li>The following ModSecurity CRS rule IDs are not supported by
Google Cloud Armor.
<ul>
<li>sqli-942100</li>
<li>sqli-942101</li>
<li>xss-941100</li>
<li>xss-941101</li>
</ul></li>
</ul>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/configure-security-policies">Configure security policies, rules, and expressions</a></li>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
<li><a href="/armor/docs/rules-language-reference">Use the custom rules language reference</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/armor-named-ip]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor named IP address lists let you reference lists of IP
addresses and IP ranges that are maintained by third-party providers. You
can configure named IP address lists within a security policy. You do not have to
manually specify each IP address or IP range individually.</p>
<p>In this document, the terms <em>IP address</em> and <em>IP address list</em> include <em>IP
address ranges</em>.</p>
<p>Named IP address lists are lists of IP addresses grouped under
different names. The name typically refers to the provider. Named IP address
lists are not subject to the quota limit on the number of IP addresses per rule.</p>
<p>Named IP address lists are not security policies. You incorporate them
into a security policy by referencing them as expressions the same way that you
reference a preconfigured rule.</p>
<p>For example, if a third-party provider has an IP address list of <code dir="ltr" translate="no">{ip1, ip2,
ip3....ip_N_}</code> under the name <code dir="ltr" translate="no">provider-a</code>, you can create a security rule that
allows all IP addresses that are in the <code dir="ltr" translate="no">provider-a</code> list and excludes IP
addresses that are not in that list:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud beta compute security-policies rules create 1000 \
    --security-policy <var translate="no">POLICY_NAME</var> \
    --expression "evaluatePreconfiguredExpr('provider-a')" \
    --action "allow"
</pre>
<p>You cannot create your own custom named IP address lists. This feature is
available only with respect to named IP address lists that are maintained by
third-party providers that partner with Google. If such named IP address lists
do not meet your needs, you can create a security policy where the rules allow
or deny access to your resources based on the IP address from which requests
originate. For more information, see <a href="/armor/docs/configure-security-policies">Configuring security
policies</a>.</p>
<p>To use named IP address lists, you must subscribe to
<a href="/armor/docs/managed-protection-overview">Google Cloud Armor Managed Protection</a> Plus and
enroll projects in Managed Protection. For more information, see
<a href="#named-ip-list-availability">Availability of named IP address lists</a>.</p>
<h2 data-text="Allowing traffic only from permitted third-party providers" id="ip-list-allow">Allowing traffic only from permitted third-party providers</h2>
<p>A typical use case is to create an allowlist containing the IP addresses of
a permitted third-party partner to ensure that only traffic coming from this
partner can access the load balancer and the backends.</p>
<p>For example, CDN providers need to pull content from origin servers at regular
intervals to distribute them to their own caches. A partnership with
Google provides a direct connection between CDN providers and the Google
network edge. CDN users on Google Cloud can use this direct connection
during origin pulls. In this case, the CDN user might want to build a security
policy that only allows traffic coming from that particular CDN provider.</p>
<p>In this example, a CDN provider publishes its IP address list
<code dir="ltr" translate="no">23.235.32.0/20, 43.249.72.0/22, ⋯,</code>. A CDN user configures a security rule
that only allows traffic coming from these IP addresses. As a result, two
CDN provider access points are allowed (<code dir="ltr" translate="no">23.235.32.10</code> and <code dir="ltr" translate="no">43.249.72.10</code>) and
their traffic is therefore permitted. Traffic from the unauthorized access point
<code dir="ltr" translate="no">198.51.100.1</code> is blocked.</p>
<figure style="text-align: center">
<a href="/armor/images/ca-named-ip.svg">
<img alt="Google Cloud Armor named IP address." border="0" src="/armor/images/ca-named-ip.svg"/></a>
<figcaption>Google Cloud Armor named IP address (click to
   enlarge)</figcaption>
</figure>
<h2 data-text="Simplifying configuration and management by using preconfigured rules" id="ip-list-simplify">Simplifying configuration and management by using preconfigured rules</h2>
<p>CDN providers often use IP addresses that are well-known and that many CDN
users need to use. These lists change over time, as providers add, remove, and
update the IP addresses.</p>
<p>Using a named IP address list in a security policy rule simplifies the process
of configuring and managing IP addresses because Google Cloud Armor
automatically synchronizes information from CDN providers on a daily basis.
This eliminates the time-consuming and error-prone process of maintaining a
large IP address list manually.</p>
<p>The following is an example of a preconfigured rule that allows all traffic
from a provider:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
evaluatePreconfiguredExpr('provider-a') =&gt; allow traffic
</pre>
<h2 data-text="IP address list providers" id="ip-list-providers">IP address list providers</h2>
<p>The IP address list providers in the following table are supported for
Google Cloud Armor. These are CDN providers that have partnered with
Google. Their IP address lists are published through individual public URLs.</p>
<p>These partners provide separate lists of IPv4 addresses and IPv6 addresses.
Google Cloud Armor uses the provided URLs to fetch lists, and then converts the
lists into named IP address lists. You refer to the lists by the names in the
table.</p>
<p>For example, the following code creates a rule in the security policy
<code dir="ltr" translate="no"><var translate="no">POLICY_NAME</var></code> with priority 750, incorporating the named IP
address list from Cloudflare and allowing access from those IP addresses:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud beta compute security-policies rules create 750 \
    --security-policy <var translate="no">POLICY_NAME</var> \
    --expression "evaluatePreconfiguredExpr('sourceiplist-cloudflare')" \
    --action "allow"
</pre>
<table>
<thead>
<tr>
<th width="15%">Provider</th>
<th width="55%">URL(s)</th>
<th width="30%">IP address list name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fastly</td>
<td><code dir="ltr" translate="no">https://api.fastly.com/public-ip-list</code></td>
<td><code dir="ltr" translate="no">sourceiplist-fastly</code></td>
</tr>
<tr>
<td>Cloudflare</td>
<td>
<p><code dir="ltr" translate="no">https://www.cloudflare.com/ips-v4</code></p>
<p><code dir="ltr" translate="no">https://www.cloudflare.com/ips-v6</code></p>
</td>
<td><code dir="ltr" translate="no">sourceiplist-cloudflare</code></td>
</tr>
<tr>
<td>Imperva</td>
<td>
<p><code dir="ltr" translate="no">https://my.imperva.com/api/integration/v1/ips</code></p>
<p>Access to Imperva's list requires a <code dir="ltr" translate="no">POST</code> request. You
          can use the following command as well:</p>
<p><code dir="ltr" translate="no">curl -d "" https://my.imperva.com/api/integration/v1/ips</code></p>
</td>
<td><code dir="ltr" translate="no">sourceiplist-imperva</code></td>
</tr>
</tbody>
</table>
<p>To list the preconfigured named IP address lists , use this <code dir="ltr" translate="no">gcloud</code> command:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
gcloud compute security-policies list-preconfigured-expression-sets \
    --filter="id:sourceiplist"
</pre>
<p>This returns:</p>
<pre dir="ltr" translate="no">
EXPRESSION_SET
sourceiplist-fastly
sourceiplist-cloudflare
sourceiplist-imperva
</pre>
<h2 data-text="Synchronizing IP address lists" id="ip-list-sync">Synchronizing IP address lists</h2>
<p>Google Cloud Armor synchronizes IP address lists with each provider only
when it detects changes that are in a valid format. Google Cloud Armor
performs basic syntax validation on the IP addresses in all lists.</p>
<h2 data-text="Availability of named IP address lists" id="named-ip-list-availability">Availability of named IP address lists</h2>
<p><a href="/armor/docs/managed-protection-using">Google Cloud Armor Managed Protection Plus</a> is in general
availability. Third-party named IP address lists availability is as follows:</p>
<ol>
<li>If you are subscribed to Google Cloud Armor Managed Protection Plus tier, you are licensed to
use named IP address lists in enrolled projects. You can create, update,
and delete rules with named IP address lists.</li>
<li>If your Google Cloud Armor Managed Protection Plus tier subscription expires or you otherwise
return to Standard tier, you cannot add or modify rules with named IP address
lists, but you can delete existing rules and update rules to remove a named
IP list.</li>
<li>In projects that already include rules with named IP address lists, but which
you did not enroll in Google Cloud Armor Managed Protection Plus, you can continue to use,
update, and delete existing rules with named IP address lists. In such
projects, you can create new rules that incorporate named IP address lists.</li>
</ol>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/configure-security-policies">Configure Google Cloud Armor security policies</a></li>
<li><a href="/armor/docs/managed-protection-overview">View pricing for Managed Protection tiers</a></li>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/managed-protection-overview]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor Managed Protection is the managed application protection
service that helps protect your web applications and services from distributed
denial-of-service (DDoS) attacks and other threats from the internet.
Managed Protection helps protect applications deployed on Google Cloud,
on-premises, or on other infrastructure providers.</p>
<h2 data-text="Google Cloud Armor Standard versus Managed Protection Plus" id="standard_versus_plus">Google Cloud Armor Standard versus Managed Protection Plus</h2>
<p>Google Cloud Armor is offered in two service tiers, Standard and
Managed Protection Plus:</p>
<ul>
<li><p><strong>Google Cloud Armor Standard</strong> includes a pay-as-you go pricing model, always-on protection
from volumetric and protocol-based DDoS attacks across your globally
load-balanced infrastructure, and access to Google Cloud Armor web
application firewall (WAF) rule capabilities, including preconfigured WAF rules
for OWASP Top 10 protection.</p></li>
<li><p><strong>Managed Protection Plus</strong> includes a monthly subscription that includes all the features
of Google Cloud Armor Standard, as well as bundled Google Cloud Armor WAF usage (including
rules, policy, and HTTP(S) requests),
<a href="/armor/docs/armor-named-ip">third-party named IP address lists</a>, and
<a href="/armor/docs/adaptive-protection-overview">Adaptive Protection</a>.
Managed Protection Plus subscribers also get access to DDoS bill
protection and DDoS response team services.</p></li>
</ul>
<p>All projects that include HTTP(S) Load Balancing, TCP Proxy Load Balancing, or
SSL Proxy Load Balancing are automatically enrolled in Google Cloud Armor
Standard. After subscribing to Managed Protection Plus at the
billing account level, users can choose to enroll individual projects attached
to the billing account in Managed Protection Plus.</p>
<p>The following table summarizes the two service tiers.</p>
<table>
<thead>
<tr>
<th></th>
<th>Google Cloud Armor Standard</th>
<th>Managed Protection Plus</th>
</tr>
</thead>
<tbody>
<tr>
<td>Billing method</td>
<td>Pay-as-you-go</td>
<td>Monthly subscription + Data Processing Fee (see
         <a href="/armor/pricing">Pricing</a>)</td>
</tr>
<tr>
<td>DDoS attack protection</td>
<td><ul>
<li>HTTP(S) Load Balancing</li>
<li>TCP Proxy Load Balancing</li>
<li>SSL Proxy Load Balancing</li>
</ul></td>
<td><ul>
<li>HTTP(S) Load Balancing</li>
<li>TCP Proxy Load Balancing</li>
<li>SSL Proxy Load Balancing</li>
</ul></td>
</tr>
<td>Google Cloud Armor WAF</td>
<td>Per policy, per rule, per request (see
         <a href="/armor/pricing">Pricing</a>)</td>
<td>Included with Plus subscription</td>

<tr>
<td>Resource limits</td>
<td>Up to quota limit</td>
<td>Up to quota limit</td>
</tr>
<tr>
<td>Preconfigured WAF rules</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Time commitment</td>
<td>N/A</td>
<td>One year</td>
</tr>
<tr>
<td>Named IP address lists</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Adaptive Protection</td>
<td>Alerting only</td>
<td>Yes</td>
</tr>
<tr>
<td>DDoS response support</td>
<td>N/A</td>
<td>Yes (w/ Premium Support)</td>
</tr>
<tr>
<td>DDoS bill protection</td>
<td>N/A</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h2 data-text="Subscribing to Managed Protection Plus" id="subscribing_to_plus">Subscribing to Managed Protection Plus</h2>
<p>To use the additional services and capabilities in Managed Protection Plus,
you must first subscribe to Managed Protection Plus. After your Managed Protection Plus
subscription is activated for the billing account, you must then enroll
individual projects in Managed Protection Plus.</p>
<p>After a project is enrolled in Managed Protection Plus, the forwarding rules
for HTTP(S) Load Balancing, SSL Proxy Load Balancing, and
TCP Proxy Load Balancing within the project are added to the subscription. In
addition, all backend services and backend buckets are counted as protected
resources and are metered for the Managed Protection Plus monthly
subscription cost. The backend services and backend buckets in
Managed Protection Plus are aggregated across all enrolled projects in a
billing account.</p>
<aside class="note"><strong>Note:</strong><span> Subscribing to Managed Protection Plus requires a one-year (12-month)
commitment. Only users with the billing account role and permissions can
subscribe the billing account to Managed Protection Plus.</span></aside>
<h2 data-text="DDoS response support" id="ddos_response_support">DDoS response support</h2>
<p>Google Cloud Armor Managed Protection distributed denial-of-service (DDoS) response support lets
you receive 24/7 help and potential custom mitigations from DDoS attacks from
the same team that protects all Google services. You can engage DDoS support
during an attack to help mitigate the attack, or you can reach out proactively
to plan for an upcoming high volume or potentially viral event (one which might
attract an unusually high amount of visitors).</p>
<p>To engage DDoS response support, see
<a href="/armor/docs/managed-protection-using#ddos-response-support">Engaging DDoS response support</a>.</p>
<h2 data-text="DDoS bill protection" id="ddos_bill_protection">DDoS bill protection</h2>
<p>Google Cloud Armor DDoS bill protection provides credits for future
Google Cloud usage for some increases in the bills from Cloud Load
Balancing, Google Cloud Armor, and network internet, inter-region, and
inter-zone egress as a result of a verified DDoS attack. If a claim is
recognized and a credit is provided, the credit cannot be used to offset
existing usage; the credit can only apply to future usage. The following table
demonstrates what resources are covered by DDos bill protection:</p>
<table>
<tr>
<th width="30%">Endpoint Type</th>
<th width="70%">Covered Usage Increase</th>
</tr>
<tr>
<td>External HTTP(S) Load Balancing, external TCP Proxy Load Balancing, external SSL Proxy Load Balancing</td>
<td>Cloud Load Balancing
       <ul>
<li>Ingress Data Processing Fee</li>
<li>HTTP(S) Load Balancing Request Logging</li>
</ul>
</td>
</tr>
<tr>
<td></td>
<td>Google Cloud Armor
         <ul>
<li>Managed Protection data processing fee</li>
</ul>
</td>
</tr>
<tr>
<td></td>
<td>Network egress
        <ul>
<li>Inter-region, inter-zone egress</li>
<li>Internet egress</li>
<li>Carrier peering egress</li>
</ul>
</td>
</tr>
</table>
<p>To engage DDoS bill protection, see
<a href="/armor/docs/managed-protection-using#ddos-bill-protection">Engaging DDoS bill protection</a>.</p>
<h2 data-text="Terms and limitations" id="terms_and_limitations">Terms and limitations</h2>
<p>To learn more about the terms and limitations of Managed Protection Plus,
see the <a href="/terms/service-terms#networking">Service Specific Terms</a> page and
follow these steps:</p>
<ol>
<li>Click <strong>Service Terms</strong>. </li>
<li>Scroll to <strong>9. Google Cloud Armor – Managed Protection Plus</strong>.</li>
</ol>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/managed-protection-using">Subscribe and enroll projects in Managed Protection Plus</a></li>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
<li><a href="/armor/docs/rules-language-reference">Use the custom rules language reference</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="mwETRvWii0eU5NUYprb0Y9z5GVbc" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/adaptive-protection-overview]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor Adaptive Protection helps you protect your Google Cloud applications, websites,
and services against L7 distributed denial-of-service (DDoS) attacks such as
HTTP floods and other high-frequency layer 7 (application-level) malicious
activity. Adaptive Protection builds machine-learning models that do the
following:</p>
<ol>
<li>Detect and alert on anomalous activity</li>
<li>Generate a signature describing the potential attack</li>
<li>Generate a custom Google Cloud Armor WAF rule to block the signature</li>
</ol>
<p>You enable or disable Adaptive Protection on a per-security-policy
basis.</p>
<p>Alerts about anomalous traffic (potential attacks), which include the signatures
of the attacks, appear in the Adaptive Protection event dashboard with event
logs sent to Cloud Logging, where they can be directly analyzed or forwarded
to a downstream log or security event monitoring workflow. Alerts of potential
attacks are also generated as findings in the
<a href="https://console.cloud.google.com/projectselector2/security/command-center/welcome">Security Command Center</a>.</p>
<h2 data-text="Availability of Adaptive Protection" id="availability_of">Availability of Adaptive Protection</h2>
<p>Full Adaptive Protection alerts are available only if you
subscribe to Google Cloud Armor Managed Protection Plus. Otherwise, you receive only a
<em>basic alert</em>, without an <em>attack signature</em> or the ability to deploy a
suggested rule.</p>
<p>If your projects are not already enrolled in Managed Protection Plus, read
<a href="/armor/docs/managed-protection-using">Using Managed Protection</a> for
information about how to enroll.</p>
<h2 data-text="Cloud Logging and Cloud Monitoring" id="and">Cloud Logging and Cloud Monitoring</h2>
<p>Because using Adaptive Protection effectively requires you to understand
how logging and alerting work in Google Cloud, we recommend that you
familiarize yourself with Cloud Logging, alerting, and alerting policies.</p>
<ul>
<li>For general logging information, see the <a href="/logging/docs/basic-concepts">Cloud Logging documentation</a>.</li>
<li>For information about alerting, see the <a href="/monitoring/alerts">Cloud Monitoring documentation</a>.</li>
<li>For Google Cloud Armor-specific logging information, see <a href="/armor/docs/request-logging">Using request logging</a>.</li>
</ul>
<h2 data-text="Configuring and tuning alerts" id="configure-alert-tuning">Configuring and tuning alerts</h2>
<p>You can enable Adaptive Protection in projects where Google Cloud Armor
security policies already protect your applications. When you enable
Adaptive Protection for a particular security policy,
Adaptive Protection is in effect for all backend services with which the
security policy is associated.</p>
<p>After Adaptive Protection is enabled, there's a training period of at least
one hour before Adaptive Protection develops a reliable baseline and
begins monitoring traffic and generating alerts. During the training period,
Adaptive Protection models incoming traffic and usage patterns that are
specific to each backend service, so that it develops the baseline for each
backend service. When the training period is over, you receive real-time alerts
when Adaptive Protection identifies high frequency or high volume anomalies
in the traffic directed to any of the backend services associated with that
security policy.</p>
<p>You can tune Adaptive Protection alerts based on several metrics. The
alerts, which are sent to Cloud Logging, include a <em>confidence level</em>, an
<em>attack signature</em>, a suggested rule, and an estimated <em>impacted baseline rate</em>
associated with the suggested rule.</p>
<ul>
<li>The confidence level indicates the confidence with which Adaptive Protection
models predict that the observed change in traffic pattern is anomalous.</li>
<li>The impacted baseline rates associated with the suggested rule represent the
percentage of existing baseline traffic that is caught by the rule. Two
rates are provided. The first is the percentage relative to the traffic into
the specific backend service under attack. The second is the percentage
relative to all the traffic going through the security policy including all
configured backend service targets (not just the one being attacked).</li>
</ul>
<p>You can filter alerts in Cloud Logging based on the
confidence level or the impacted baseline rates, or both. For more information
about tuning alerts, see <a href="/monitoring/alerts/using-alerting-ui">Managing alerting policies</a>.</p>
<h2 data-text="Consuming and interpreting alerts" id="consume-interpret-alerts">Consuming and interpreting alerts</h2>
<p>As soon as Adaptive Protection detects a suspected attack, it generates an
event in the Adaptive Protection event dashboard and generates a log item in
Cloud Logging. The alert is in the JSON payload of the log item. The
log item is generated under the <strong>Network Security Policy</strong> resource in
Cloud Logging. The log message identifies the backend service under
attack and includes a confidence score indicating how strongly
Adaptive Protection rates the identified traffic pattern change as anomalous.
The log message also includes an <em>attack signature</em> that illustrates the
characteristics of the attack traffic, along with suggested
Google Cloud Armor rules that you might apply to mitigate the attack.</p>
<h3 data-text="Understanding attack signatures" id="understand-attack-signature">Understanding attack signatures</h3>
<p>An Adaptive Protection alert includes an <em>attack signature</em>, which is a
description of the traffic attributes of the potential attack. You use the
signature to identify and potentially block the attack. The signature takes two
forms: as a user-readable table and as a preconstructed Google Cloud Armor WAF
rule that you can deploy in the relevant security policy. If you are
not subscribed to Google Cloud Armor Managed Protection Plus, an <em>attack signature</em> is not included
in the basic alert.</p>
<p>The signature consists of a set of attributes, such as source IP address,
geographical regions, cookies, user agents, referers and other HTTP request
headers, and the set of values for those attributes thought to be associated
with the potential attack traffic. The set of attributes is not user-
configurable. The attribute values depend on the values in the incoming traffic
to your backend service.</p>
<p>For each attribute value that Adaptive Protection believes indicates the
potential attack, Adaptive Protection lists the following:</p>
<ul>
<li>The attack likelihood</li>
<li>The proportion of the attribute in the attack, which is the percentage of
potential attack traffic that had this value at the time that the attack
was detected</li>
<li>The proportion of the attribute in baseline, which is the percentage of
baseline traffic that possessed this attribute value at time that the
attack was detected</li>
</ul>
<p><a href="/armor/docs/adaptive-protection-overview#logging-entry">Cloud Logging entry specification</a>
contains details about the information in each alert.</p>
<p>The following is an example of a user-readable table that contains the signature
of a potential attack:</p>
<table>
<thead>
<tr>
<th width="16%">Attribute name</th>
<th width="16%">Value</th>
<th width="17%">Match type</th>
<th width="17%">Attack likelihood</th>
<th width="17%">Proportion in attack</th>
<th width="17%">Proportion in baseline</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">UserAgent</code></td>
<td>"foo"</td>
<td>Exact match</td>
<td>0.7</td>
<td>0.85</td>
<td>0.12</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">UserAgent</code></td>
<td>"bar"</td>
<td>Exact match</td>
<td>0.6</td>
<td>0.7</td>
<td>0.4</td>
</tr>
<tr>
<td>Source IP</td>
<td>"a.b.c.d"</td>
<td>Exact match</td>
<td>0.95</td>
<td>0.1</td>
<td>0.01</td>
</tr>
<tr>
<td>Source IP</td>
<td>a.b.c.e</td>
<td>Exact match</td>
<td>0.95</td>
<td>0.1</td>
<td>0.01</td>
</tr>
<tr>
<td>Source IP</td>
<td>a.b.c.f</td>
<td>Exact match</td>
<td>0.05</td>
<td>0.1</td>
<td>0.1</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">RegionCode</code></td>
<td>UK</td>
<td>Exact match</td>
<td>0.64</td>
<td>0.3</td>
<td>0.1</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">RegionCode</code></td>
<td>IN</td>
<td>Exact match</td>
<td>0.25</td>
<td>0.2</td>
<td>0.3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">RequestUri</code></td>
<td>/urlpart</td>
<td>Substring</td>
<td>0.7</td>
<td>0.85</td>
<td>0.12</td>
</tr>
</tbody>
</table>
<p>An Adaptive Protection alert and the relevant Cloud Logging event
log contain the following:</p>
<ul>
<li>A unique alert ID, or <code dir="ltr" translate="no">alertID</code>, which is used to refer to a specific alert
when it reports user feedback (more below)</li>
<li>The backend service under attack, or <code dir="ltr" translate="no">backendService</code></li>
<li>The confidence score, or <code dir="ltr" translate="no">confidence</code>, which is a number between 0 and 1 that
indicates how strongly the Adaptive Protection system rates the detected
event as a malicious attack</li>
</ul>
<p>You also receive a set of signatures and rules characterizing the
detected attack. Specifically, the set provides a list of <code dir="ltr" translate="no">headerSignatures</code>,
each corresponding to one HTTP header and containing a list of <code dir="ltr" translate="no">significantValues</code>
for the specific header. Each significant value is either an observed header
value or a substring of it.</p>
<p>The following is an example signature:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
...
headerSignatures: [
  0: {
   name: "Referer"
   significantValues: [
    0: {
     attackLikelihood: 0.95
     matchType: "MATCH_TYPE_EQUALS"
     proportionInAttack: 0.6
     proportionInBaseline: 0.01
     value: "foo.attacker.com"
    }
   ]
  }
...
</pre>
<p>The alert suggests that the value <code dir="ltr" translate="no">foo.attacker.com</code> in the header <code dir="ltr" translate="no">Referer</code> is
important in characterizing the attack. More specifically, 60% of the attack
traffic (<code dir="ltr" translate="no">proportionInAttack</code>) has this <code dir="ltr" translate="no">Referer</code> value and only 1% of baseline
traffic among all traffic (<code dir="ltr" translate="no">proportionInBaseline</code>) has the same <code dir="ltr" translate="no">Referer</code>
value. Moreover, among all traffic matching this <code dir="ltr" translate="no">Referer</code> value, 95% is attack
traffic (<code dir="ltr" translate="no">attackLikelihood</code>).</p>
<p>These values suggest that if you were to block all requests with <code dir="ltr" translate="no">foo.attacker.com</code>
in the <code dir="ltr" translate="no">Referer</code> header field, you would successfully block 60% of the attack
and also 1% of the baseline traffic.</p>
<p>The property <code dir="ltr" translate="no">matchType</code> specifies the relationship between the
attribute in the attack traffic and the significant value. It can be either
<code dir="ltr" translate="no">MATCH_TYPE_CONTAINS</code> or <code dir="ltr" translate="no">MATCH_TYPE_EQUALS</code>.</p>
<p>The next signature matches traffic with a substring <code dir="ltr" translate="no">/api?</code> in the request URI:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
...
headerSignatures: [
  0: {
   name: "RequestUri"
   significantValues: [
    0: {
     attackLikelihood: 0.95
     matchType: "MATCH_TYPE_CONTAINS"
     proportionInAttack: 0.9
     proportionInBaseline: 0.01
     value: "/api?"
    }
   ]
  }
...
</pre>
<h3 data-text="Deploying suggested rules" id="deploy-tune-rules">Deploying suggested rules</h3>
<p>Adaptive Protection alerts also provide a suggested Google Cloud Armor
rule expressed in the <a href="/armor/docs/rules-language-reference">custom rules language</a>.
This rule can be used to create a rule in a Google Cloud Armor security
policy to mitigate the attack. In addition to the signature, the alert
includes a rate of impacted baseline traffic to help you evaluate the impact of
deploying the rule. The rate of impacted baseline traffic is a projected
proportion of baseline traffic that matches the attack signature identified by
Adaptive Protection. If you are not subscribed to Google Cloud Armor Managed Protection Plus,
 <em>basic alerts</em> sent by Adaptive Protection do not include a suggested
Google Cloud Armor rule that you can apply.</p>
<p>You can find some of the alert signature as well as the impacted baseline rate
in the log message sent to Cloud Logging. The following example is the JSON
payload of a sample alert along with the resource labels on which you can filter
the logs.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
...
 jsonPayload: {
   alertId: "11275630857957031521"
   backendService: "test-service"
   confidence: 0.71828485
   headerSignatures: [

    0: {
     name: "RequestUri"
     significantValues: [
      0: {
       attackLikelihood: 0.88
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.85
       proportionInBaseline: 0.01
       value: "/"
      }
     ]
    }
    1: {
     name: "RegionCode"
     significantValues: [
      0: {
       attackLikelihood: 0.08
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.17
       proportionInBaseline: 0.28
       value: "US"
      }
      1: {
       attackLikelihood: 0.68
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.09
       proportionInBaseline: 0.01
       value: "DE"
      }
      2: {
       attackLikelihood: 0.74
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.05
       proportionInBaseline: 0
       value: "MD"
      }
     ]
    }
     2: {
     name: "UserAgent"
     significantValues: [
      0: {
       attackLikelihood: 0.92
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.85
       proportionInBaseline: 0
       value: "Unusual browser"
      }
      1: {
       attackLikelihood: 0.87
       proportionInAttack: 0.7
       proportionInBaseline: 0.1
       missing: true
      }
     ]
    }
   ]
   suggestedRule: [
    0: {
     action: "DENY"
     evaluation: {
       impactedAttackProportion: 0.95
       impactedBaselineProportion: 0.001
       impactedBaselinePolicyProportion: 0.001
     }
     expression: "evaluateAdaptiveProtection('11275630857957031521')"
    }
   ]
   ruleStatus: RULE_GENERATED
   attackSize: 5000
 }
 resource: {
    type: "network_security_policy",
    labels: {
      project_id: "your-project",
      policy_name: "your-security-policy-name"
    }
 },
}
}
...
</pre>
<p>You can deploy suggested rules by copying the CEL expression from the rule
signature and pasting the expression into the match condition of a newly created
rule, or by clicking the <strong>Apply</strong> button on the Adaptive Protection
dashboard in the Google Cloud Armor UI.</p>
<p>To deploy the rule, you create a new rule in the Google Cloud Armor security
policy that protects the targeted backend services identified by the alert.
Next, during rule configuration, copy and paste the CEL expression from the
alert into the <strong>Match condition</strong> field of the rule and set the rule action to
<code dir="ltr" translate="no">deny</code>. In the above example, you copy the expression
<code dir="ltr" translate="no">evaluateAdaptiveProtection('11275630857957031521')</code> from the <code dir="ltr" translate="no">suggestedRule</code>
section of the alert.</p>
<p>We strongly recommend that you initially deploy the rule in preview mode
so you can evaluate the impact of the rule on production traffic. When you do
this, Google Cloud Armor logs the action and the associated traffic whenever
the rule is triggered, but no action is taken on the matched traffic.</p>
<p>In addition, if your security policy is attached to multiple backend services,
note whether the effects of the new rule have unwanted effects in any of
the backend services. If this happens, configure new security policies to
mitigate the unwanted effects, and attach them to the correct backend services.</p>
<figure style="text-align: center">
<a href="/armor/images/caap-add-rule.svg">
<img alt="Deploying a suggested Adaptive Protection rule" border="0" src="/armor/images/caap-add-rule.svg" width="700"/></a>
<figcaption>Deploying a suggested Adaptive Protection rule (click to
   enlarge)</figcaption>
</figure>
<p>We recommend that you set the priority for the new rule higher than any rules
with the action set to allow. This is because, to have the projected impact and
have maximal effect in mitigating the attack, the rule should be deployed in the
highest logical priority position to ensure that all matching traffic is blocked
by the rule. Rules in a Google Cloud Armor security policy are evaluated in
priority order with evaluation terminating after the first matching rule is
triggered and the associated rule action is taken. If you need to grant an
exception for some traffic or specific clients from this rule, an "allow" rule
can be created with higher priority, that is, with a lower numerical value.
For more information about rule priority, see
<a href="/armor/docs/security-policy-overview#eval-order">Rule evaluation order</a>.</p>
<h3 data-text="Rule status" id="rule-status">Rule status</h3>
<p>If no rule is presented when you attempt to deploy a suggested rule, you can
use the <code dir="ltr" translate="no">ruleStatus</code> field to determine the cause.</p>
<pre dir="ltr" translate="no">
 ]
ruleStatus: RULE_GENERATED
attackSize: 5000
}
</pre>
<p>The following table describes the possible values of the field and what they
mean.</p>
<table>
<tr>
<th>Rule status</th>
<th>Description</th>
</tr>
<tr>
<td>RULE_GENERATED</td>
<td>A usable rule was generated normally.</td>
</tr>
<tr>
<td>BASELINE_TOO_RECENT</td>
<td>Not enough time to accumulate reliable baseline traffic. Up to one hour is necessary to generate rules.</td>
</tr>
<tr>
<td>NO_SIGNIFICANT_VALUE_DETECTED</td>
<td>No headers have significant values associated with attack traffic, so no rule could be generated.</td>
</tr>
<tr>
<td>NO_USABLE_RULE_FOUND</td>
<td>No usable rule could be created.</td>
</tr>
<tr>
<td>ERROR</td>
<td>An unspecified error occurred when creating the rule.</td>
</tr>
</table>
<h3 data-text="Monitoring, feedback, and reporting event errors" id="monitor-feedback-report-errors">Monitoring, feedback, and reporting event errors</h3>
<p>You need the following permissions to view or interact with the
Adaptive Protection dashboard.</p>
<ul>
<li><code dir="ltr" translate="no">compute.securityPolicies.list</code></li>
<li><code dir="ltr" translate="no">compute.backendServices.list</code></li>
<li><code dir="ltr" translate="no">logging.logEntries.list</code></li>
</ul>
<p>After you enable Adaptive Protection on any Google Cloud Armor security
policy, you can see the following page under <strong>Network Security &gt;
Google Cloud Armor</strong> panel. It displays the traffic volume over time for the
selected security policy and backend service, and the selected duration. Any
instances of potential attacks alerted by Adaptive Protection are annotated
on the graph and listed below the graph. When you click a specific attack event,
a side window is displayed with the attack signature and suggested rule shown in
tabular format. This is same information that's in the Cloud Logging log
entries that are described in <a href="#logging-entry">Cloud Logging entry specification</a>.
Click the <strong>Apply</strong> button to add the suggested rule to the same security policy.</p>
<figure style="text-align: center">
<a href="/armor/images/caap-dashboard.svg">
<img alt="Adaptive Protection dashboard" border="0" src="/armor/images/caap-dashboard.svg" width="700"/></a>
<figcaption>Adaptive Protection dashboard (click to
   enlarge)</figcaption>
</figure>
<figure style="text-align: center">
<a href="/armor/images/alert-details.svg">
<img alt="Adaptive Protection alert details" border="0" src="/armor/images/alert-details.svg" width="700"/></a>
<figcaption>Adaptive Protection dashboard (click to
   enlarge)</figcaption>
</figure>
<p>Not every Adaptive Protection finding is deemed an attack, given the
protected backend service's unique context and environmental factors. If you
determine that the potential attack described by the alert is normal or accepted
behavior, then you can report an event error to help train the
Adaptive Protection models. Next to each attack event listed under the graph
is a button that pops up an interactive window to allow you to report an event
error with some optional context. Reporting an event error helps reduce the
likelihood of similar errors in the future. Over time, this increases
Adaptive Protection's accuracy.</p>
<h3 data-text="Monitoring, alerting, and logging" id="monitor-alert-log">Monitoring, alerting, and logging</h3>
<p>Adaptive Protection telemetry is sent to Cloud Logging as well as
the Security Command Center. The Adaptive Protection log message sent to
Cloud Logging is described in the previous sections of this document. A
log entry is generated every time Adaptive Protection detects a potential
attack and each entry contains a confidence score describing how confident the
models are that the observed traffic is anomalous. To fine-tune alerting, an
alerting policy can be configured in Cloud Logging to trigger an alert
only when an Adaptive Protection log message has a confidence score above a
user-specified threshold. We recommend that you start with a low threshold, with
confidence &gt; 0.5, to avoid missing warnings of potential attacks. The confidence
threshold in the alerting policy can be increased over time if the alerts have
an unacceptable impacted baseline rate.</p>
<p>The Security Command Center dashboard also contains findings from
Adaptive Protection. They are located in the Google Cloud Armor card under
the <strong>Application DDoS Attacks</strong> category. Each finding includes the details of
the service, the attack confidence, the signature associated with the attack,
and a link to the specific alert on the Adaptive Protection dashboard.</p>
<h3 data-text="Cloud Logging entry specification" id="logging-entry">Cloud Logging entry specification</h3>
<p>The Adaptive Protection alert sent to Cloud Logging consists of a
log entry containing the following elements:</p>
<ul>
<li>Alert confidence: Adaptive Protection confidence that the event observed
is an attack.</li>
<li>Attack signature
<ul>
<li>Attribute name: The name of the attribute which matches to the <code dir="ltr" translate="no">Value</code>
below, such as a particular request header name or a geographic origin.</li>
<li>Value: The value to which the attribute in malicious traffic matches.</li>
<li>Match type: The relationship between <code dir="ltr" translate="no">Value</code> and the attribute in attack
traffic. The value is either equal to or a substring of an attribute in
attack traffic.</li>
<li>Attack likelihood: The likelihood that a given request is malicious, given
that the relevant attribute of this request matches <code dir="ltr" translate="no">Value</code>.</li>
<li>Proportion in attack: The percent of potential attack traffic that matches
<code dir="ltr" translate="no">Value</code>.</li>
<li>Proportion in baseline: The percent of normal, baseline traffic that matches
<code dir="ltr" translate="no">Value</code>.</li>
</ul></li>
<li>Suggested rule
<ul>
<li>Match condition: The expression to be used in the rules match condition to
identify malicious traffic.</li>
<li>Impacted baseline rate: The projected percentage of good traffic to the
specific backend service under attack that is captured by the suggested rule.</li>
<li>Impacted baseline rate across policy: The projected percentage of good
traffic to all the backend services in the same security policy that is
captured by the suggested rule.</li>
<li>Impacted attack rate: The projected percentage of attack traffic that is
captured by the suggested rule.</li>
</ul></li>
<li>Rule status: Additional details about rule generation.</li>
</ul>
<h2 data-text="Machine learning overview and privacy" id="ml-privacy">Machine learning overview and privacy</h2>
<ul>
<li>Training data and detection data
<ul>
<li>Adaptive Protection builds several models to
detect potential attacks and identify their signatures. The signals used by
these models to determine if an attack is ongoing are derived from the
observed metadata of incoming request traffic from your projects. Such
metadata includes: source IP address, source geography, and the values of
some HTTP request headers.</li>
<li>The actual features used by the models are derived statistical properties
of the above-mentioned signals. That is, the
training data for the models do not include the actual values of any
metadata, such as IP addresses and/or request header values.</li>
<li>A common set of detection models, trained with only artificial data are
shared across all customers, to determine whether an attack is taking place,
when Adaptive Protection is first enabled. Once you report any false
attack event and the models are updated using traffic signals specific from
your projects, these models are local to your projects and are not
used for any other customers.</li>
</ul></li>
<li>Signature generation data
<ul>
<li>After Adaptive Protection determines that a potential attack is
taking place, it generates an attack signature that's effective to help the
target mitigate the attack quickly. To achieve the above, after
you enable Adaptive Protection on a security policy, traffic metrics and
request metadata to a backend service (associated with the security policy)
are continually recorded to learn baseline traffic characteristics.</li>
<li>Because Adaptive Protection needs to learn about the baseline traffic,
Adaptive Protection might require up to one hour before generating rules
to mitigate potential attacks.</li>
</ul></li>
</ul>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/adaptive-protection-use-cases">Learn about common use cases for Adaptive Protection</a></li>
<li><a href="/armor/docs/managed-protection-overview">Learn about the features in Managed Protection tiers</a></li>
<li><a href="/armor/docs/managed-protection-using">Learn how to enable Managed Protection</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/images/ip-bl-wl-1.svg]</H1></p>None<hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/common-use-cases]</H1></p><div class="devsite-article-body clearfix">
<p>This page features common use cases for Google Cloud Armor security policies.
Google Cloud Armor security policies can protect your application with
features like IP address allowlists and denylists, and preconfigured
rules to deter common web attacks.</p>
<h2 data-text="Controlling access to your web applications and services" id="controlling_access_to_your_web_applications_and_services">Controlling access to your web applications and services</h2>
<p>This section presents several ways to use Google Cloud Armor security policies
to control access to your applications or services.</p>
<h3 data-text="Enable access for users at specific IP addresses with allowlists" id="limit-access-to-https">Enable access for users at specific IP addresses with allowlists</h3>
<p>A typical use case for placing user IP addresses on an allowlist is when your
external HTTP(S) load balancer is accessed only by a specific set of users. In the following
example, only users from your organization are allowed access to services behind
your load balancer. These users have IP addresses or address blocks assigned by
your organization. You can place these IP addresses or CIDR ranges on an
allowlist so that only these users have access to the load balancer.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-2.svg">
<img alt="Restricting load balancer access with an allowlist." border="0" src="/armor/images/ip-bl-wl-2.svg" width="700"/></a>
<figcaption>Restricting load balancer access with an allowlist
      (click to enlarge)</figcaption>
</figure>
<p>You control access to the external HTTP(S) load balancer by configuring an allowlist with
source IP addresses or source CIDR ranges from which access to your load
balancer is permitted. The following section further describes this
configuration.</p>
<p>In this configuration, you only want to allow users from your organization with
IP addresses from an IP range to access the external HTTP(S) load balancer. You want
all other traffic to be denied.</p>
<p>To create this configuration, follow these steps:</p>
<ol>
<li>Create a Google Cloud Armor security policy.</li>
<li>In the security policy, add a rule that adds the range to the allowlist
as the first rule. This rule has the description <code dir="ltr" translate="no">allow <var translate="no">[RANGE]</var></code>,
where <code dir="ltr" translate="no"><var translate="no">[RANGE]</var></code> is the desired IP range.</li>
<li>Modify the default rule in the policy from an allow rule to a
deny rule. The default rule governs traffic that does not match any of
the preceding rules. It is the last rule in the policy. Changing the rule
from <code dir="ltr" translate="no">allow</code> to <code dir="ltr" translate="no">deny</code> blocks all traffic that does not originate in the
range on the allowlist.</li>
<li>Associate this policy with the external HTTP(S) load balancer's backend service.</li>
</ol>
<p>If your organization uses a third-party security provider to scrub traffic, you
can add the security provider's IP address to an allowlist to ensure that only
scrubbed traffic can access the external HTTP(S) load balancer and backends.</p>
<p>In the following illustration, the third-party provider is identified by the
CIDR range 192.0.2.0/24, and this range is on an allowlist.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-4.svg">
<img alt="Restricting load balancer access by allowlisting traffic from a
       third-party security provider." border="0" src="/armor/images/ip-bl-wl-4.svg" width="700"/></a>
<figcaption>Restricting load balancer access by allowlisting traffic from a
       third-party security provider (click to enlarge)</figcaption>
</figure>
<h3 data-text="Block access for users at specific IP addresses with denylists" id="block-traffic">Block access for users at specific IP addresses with denylists</h3>
<p>Use denylists to create Google Cloud Armor security policies that reject
traffic from an IP address or CIDR range. In the following illustration, the
Google Cloud Armor security policy has a <code dir="ltr" translate="no">deny</code> rule that blocks traffic
from the IP address 198.51.100.1, where a malicious user has been identified.</p>
<figure style="text-align: center">
<a href="/armor/images/ip-bl-wl-3.svg">
<img alt="Restricting load balancer access with a denylist." border="0" src="/armor/images/ip-bl-wl-3.svg" width="700"/></a>
<figcaption>Restricting load balancer access with a denylist
      (click to enlarge)</figcaption>
</figure>
<h3 data-text="Custom rules to filter based on Layer 3 through Layer 7 parameters" id="customize-defenses">Custom rules to filter based on Layer 3 through Layer 7 parameters</h3>
<p>Use the Google Cloud Armor custom rules language to define one or more
expressions in a rule's match condition. When Google Cloud Armor receives a
request, it evaluates the request against these expressions. If there is a
match, the rule's action takes effect, either denying or allowing the incoming
traffic.</p>
<p>The following examples are expressions that are written in the
Google Cloud Armor extension of the <a class="external" href="https://github.com/google/cel-spec" target="github">Common Expression Language
(CEL)</a>.
For more information, see the
<a href="/armor/docs/rules-language-reference">Custom rules language reference</a>.</p>
<p>To define expressions in a rule, use the gcloud <code dir="ltr" translate="no">--expression</code> flag or the
Google Cloud console. For more information, see
<a href="/armor/docs/configure-security-policies#creating-policy-rules">Creating Google Cloud Armor security policies, rules, and expressions</a>.</p>
<p>In the following example, requests from <code dir="ltr" translate="no">2001:db8::/32</code> (such as your alpha
testers) in the <code dir="ltr" translate="no">AU</code> region match the following expression:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
origin.region_code == "AU" &amp;&amp; inIpRange(origin.ip, '2001:db8::/32')
</pre>
<p>The following example matches with requests from <code dir="ltr" translate="no">192.0.2.0/24</code> and with a user
agent that contains the string <code dir="ltr" translate="no">WordPress</code>:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '192.0.2.0/24') &amp;&amp; has(request.headers['user-agent']) &amp;&amp; request.headers['user-agent'].contains('WordPress')
</pre>
<p>For additional examples, see <a href="/armor/docs/rules-language-reference#expression-examples">Example
expressions</a> in the
custom rules language reference.</p>
<h2 data-text="Protect your deployment against application layer attacks and help mitigate OWASP Top 10 risks" id="protect_your_deployment_against_application_layer_attacks_and_help_mitigate_owasp_top_10_risks">Protect your deployment against application layer attacks and help mitigate OWASP Top 10 risks</h2>
<p>You can use Google Cloud Armor to protect a Cloud CDN origin server
from application layer (L7) attacks such as SQL injection (SQLi) and
cross-site scripting (XSS). Content in a cache is static and presumably does not
pose a risk of a targeted attack from the web. However, the underlying content
origin server might be a dynamic application with known or potential web-app
vulnerabilities. Your security or compliance requirements might require you to
mitigate these risks to prevent vulnerability exploits from the internet from
successfully attacking the origin server.</p>
<p>To mitigate the risks, follow these steps:</p>
<ol>
<li>Create or identify a  backend service with CDN enabled.</li>
<li>Create a Google Cloud Armor security policy.</li>
<li>Create one or more rules in the security policy to deny L7 attacks.</li>
<li>Configure one of the targets of the security policy to be the backend
service that you created or identified in step 1.</li>
</ol>
<p>You can also use preconfigured rules to detect and block common application layer
attacks. Preconfigured rules are predefined expression sets that you can add to
a Google Cloud Armor security policy. To add these expression sets to a rule,
use the gcloud <code dir="ltr" translate="no">--expression</code> flag or Cloud console.
For more information, see
<a href="/armor/docs/configure-security-policies#creating-policy-rules">Creating security policies, rules, and expressions</a>.</p>
<p>For more information about preconfigured rules, see <a href="/armor/docs/rules-language-reference#preconfigured-rules">Preconfigured
rules</a> in the custom
rules language reference.</p>
<p>The following example uses a preconfigured rule to mitigate cross-site
scripting (XSS) attacks:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
evaluatePreconfiguredExpr('xss-stable')
</pre>
<p>The following example uses a preconfigured rule to mitigate SQL injection
(SQLi) attacks:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
evaluatePreconfiguredExpr('sqli-stable')
</pre>
<p>You can also combine preconfigured rules with other expressions. The following
example uses a preconfigured rule to mitigate SQLi attacks from the
<code dir="ltr" translate="no">192.0.2.1/24</code> IP address range:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
inIpRange(origin.ip, '192.0.2.1/24') &amp;&amp; evaluatePreconfiguredExpr('sqli-stable')
</pre>
<h3 data-text="OWASP Top 10 mitigation for hybrid workloads" id="owasp-top-10">OWASP Top 10 mitigation for hybrid workloads</h3>
<p>Google Cloud Armor offers mitigations for the following attacks, whether they
are deployed in Google Cloud,on-premises, or in a third-party provider:</p>
<ul>
<li>SQL injection (SQLi)</li>
<li>Cross-site scripting (XSS)</li>
<li>Local File Inclusion (LFI)</li>
<li>Remote File Inclusion (RFI)</li>
<li>Remote Code Execution (RCE)</li>
</ul>
<p>You can use these capabilities to address some of the most common web
application security risks, including those risks identified in the
<a class="external" href="https://owasp.org/www-project-top-ten/" target="owasp">OWASP Top 10</a> 
list.</p>
<p>Google Cloud Armor's preconfigured <a href="/armor/docs/rule-tuning">WAF rules</a> can be
added to a security policy to detect and deny unwelcome layer 7 requests
containing SQLi or XSS attempts. Google Cloud Armor detects malicious requests
and drops them at the edge of Google's infrastructure. The requests are not
proxied to the backend service, regardless of where the backend service is
deployed.</p>
<p>To defend a non-Google Cloud-hosted workload from these attacks
at the edge of Google's network, follow these steps:</p>
<ol>
<li>Configure an external HTTP(S) load balancer with a backend service that has an internet
NEG as a backend.</li>
<li>Create a Google Cloud Armor security policy.</li>
<li>Add preconfigured SQLi and XSS rules to the policy.</li>
<li>Attach the security policy to the backend service that you created in step 1.</li>
<li>Monitor Google Cloud Armor activity by using Cloud Logging,
Cloud Monitoring, and the findings sent to Security Command Center.</li>
</ol>
<h3 data-text="Cloud CDN external origin server DDoS defense and layer 7 monitoring" id="cdn-ddos-defense">Cloud CDN external origin server DDoS defense and layer 7 monitoring</h3>
<p>Cloud CDN deployments with an external origin server can have
Google's edge infrastructure as the frontend for proxying, caching, and
Google Cloud Armor layer 7 filtering. Using internet NEGs, the origin
server can be located on-premises or with a third-party infrastructure
provider.</p>
<p>Google Cloud Armor and the rest of Google's edge infrastructure mitigates
and drops L3/L4 attacks, alerts on suspicious Layer 7 activity, and stands
ready to deny unwelcome layer 7 requests with custom rules. Google Cloud Armor
logging and telemetry across Cloud Logging, Cloud Monitoring, and
Security Command Center provide actionable insight for protected
applications regardless of where they are deployed.</p>
<p>To enable Google Cloud Armor protection for CDN external origins servers,
follow these steps:</p>
<ol>
<li>Configure an external HTTP(S) load balancer with a backend service that has an internet
NEG as a backend.</li>
<li>Enable Cloud CDN for this backend service.</li>
<li>Create a Google Cloud Armor security policy.</li>
<li>Attach the security policy to the backend service that you created in step 1.</li>
<li>Access Google Cloud Armor alerts, logging and telemetry in
Security Command Center, Cloud Logging, and Cloud Monitoring.</li>
</ol>
<p>In addition, you can use edge security policies to protect content stored in
cache. For more information on edge security policies, see the
<a href="/armor/docs/security-policy-overview#edge-policies">Security policy overview</a>.</p>
<h3 data-text="Layer 7 access controls and cache-busting attacks" id="layer-7-access-controls">Layer 7 access controls and cache-busting attacks</h3>
<p>Depending on the application architecture, you can configure one backend service
to serve requests for various URLs, including cacheable and non-cacheable
content. In such deployment scenarios, create Google Cloud Armor security
policies that deny unwelcome traffic on certain request paths, but allow all
clients to access static content on a different request path.</p>
<p>In other situations, even though the content is being efficiently served from
cache, a malicious or faulty client might generate a high volume of requests
that result in a cache miss and require the underlying origin server to fetch or
generate the requested content. This can strain limited resources and have a
negative impact on the availability of the application for all users. You can
create a Google Cloud Armor security policy to match the signature of
any clients that are causing the issue and deny the requests before they reach
the origin server and affect performance.</p>
<p>To accomplish this, follow these steps:</p>
<ol>
<li>Create a Google Cloud Armor security policy.</li>
<li><p>Configure a rule; for example, the following rule denies access to <code dir="ltr" translate="no">"/admin"</code>:</p>
<pre class="prettyprint lang-sh" dir="ltr" translate="no"><code dir="ltr" translate="no">request.path.contains("/admin") &amp;&amp; !inIpRange(origin.ip, '&lt;allowed_ip_range&gt;'
</code></pre></li>
<li><p>Attach the security policy from step 1 to the backend service that has
Cloud CDN enabled.</p></li>
</ol>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/configure-security-policies">Configure security policies</a></li>
<li><a href="/armor/docs/rules-language-reference">Learn about the custom rules language</a></li>
<li><a href="/armor/docs/rule-tuning">Tune WAF rules</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/managed-protection-overview]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor Managed Protection is the managed application protection
service that helps protect your web applications and services from distributed
denial-of-service (DDoS) attacks and other threats from the internet.
Managed Protection helps protect applications deployed on Google Cloud,
on-premises, or on other infrastructure providers.</p>
<h2 data-text="Google Cloud Armor Standard versus Managed Protection Plus" id="standard_versus_plus">Google Cloud Armor Standard versus Managed Protection Plus</h2>
<p>Google Cloud Armor is offered in two service tiers, Standard and
Managed Protection Plus:</p>
<ul>
<li><p><strong>Google Cloud Armor Standard</strong> includes a pay-as-you go pricing model, always-on protection
from volumetric and protocol-based DDoS attacks across your globally
load-balanced infrastructure, and access to Google Cloud Armor web
application firewall (WAF) rule capabilities, including preconfigured WAF rules
for OWASP Top 10 protection.</p></li>
<li><p><strong>Managed Protection Plus</strong> includes a monthly subscription that includes all the features
of Google Cloud Armor Standard, as well as bundled Google Cloud Armor WAF usage (including
rules, policy, and HTTP(S) requests),
<a href="/armor/docs/armor-named-ip">third-party named IP address lists</a>, and
<a href="/armor/docs/adaptive-protection-overview">Adaptive Protection</a>.
Managed Protection Plus subscribers also get access to DDoS bill
protection and DDoS response team services.</p></li>
</ul>
<p>All projects that include HTTP(S) Load Balancing, TCP Proxy Load Balancing, or
SSL Proxy Load Balancing are automatically enrolled in Google Cloud Armor
Standard. After subscribing to Managed Protection Plus at the
billing account level, users can choose to enroll individual projects attached
to the billing account in Managed Protection Plus.</p>
<p>The following table summarizes the two service tiers.</p>
<table>
<thead>
<tr>
<th></th>
<th>Google Cloud Armor Standard</th>
<th>Managed Protection Plus</th>
</tr>
</thead>
<tbody>
<tr>
<td>Billing method</td>
<td>Pay-as-you-go</td>
<td>Monthly subscription + Data Processing Fee (see
         <a href="/armor/pricing">Pricing</a>)</td>
</tr>
<tr>
<td>DDoS attack protection</td>
<td><ul>
<li>HTTP(S) Load Balancing</li>
<li>TCP Proxy Load Balancing</li>
<li>SSL Proxy Load Balancing</li>
</ul></td>
<td><ul>
<li>HTTP(S) Load Balancing</li>
<li>TCP Proxy Load Balancing</li>
<li>SSL Proxy Load Balancing</li>
</ul></td>
</tr>
<td>Google Cloud Armor WAF</td>
<td>Per policy, per rule, per request (see
         <a href="/armor/pricing">Pricing</a>)</td>
<td>Included with Plus subscription</td>

<tr>
<td>Resource limits</td>
<td>Up to quota limit</td>
<td>Up to quota limit</td>
</tr>
<tr>
<td>Preconfigured WAF rules</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Time commitment</td>
<td>N/A</td>
<td>One year</td>
</tr>
<tr>
<td>Named IP address lists</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Adaptive Protection</td>
<td>Alerting only</td>
<td>Yes</td>
</tr>
<tr>
<td>DDoS response support</td>
<td>N/A</td>
<td>Yes (w/ Premium Support)</td>
</tr>
<tr>
<td>DDoS bill protection</td>
<td>N/A</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h2 data-text="Subscribing to Managed Protection Plus" id="subscribing_to_plus">Subscribing to Managed Protection Plus</h2>
<p>To use the additional services and capabilities in Managed Protection Plus,
you must first subscribe to Managed Protection Plus. After your Managed Protection Plus
subscription is activated for the billing account, you must then enroll
individual projects in Managed Protection Plus.</p>
<p>After a project is enrolled in Managed Protection Plus, the forwarding rules
for HTTP(S) Load Balancing, SSL Proxy Load Balancing, and
TCP Proxy Load Balancing within the project are added to the subscription. In
addition, all backend services and backend buckets are counted as protected
resources and are metered for the Managed Protection Plus monthly
subscription cost. The backend services and backend buckets in
Managed Protection Plus are aggregated across all enrolled projects in a
billing account.</p>
<aside class="note"><strong>Note:</strong><span> Subscribing to Managed Protection Plus requires a one-year (12-month)
commitment. Only users with the billing account role and permissions can
subscribe the billing account to Managed Protection Plus.</span></aside>
<h2 data-text="DDoS response support" id="ddos_response_support">DDoS response support</h2>
<p>Google Cloud Armor Managed Protection distributed denial-of-service (DDoS) response support lets
you receive 24/7 help and potential custom mitigations from DDoS attacks from
the same team that protects all Google services. You can engage DDoS support
during an attack to help mitigate the attack, or you can reach out proactively
to plan for an upcoming high volume or potentially viral event (one which might
attract an unusually high amount of visitors).</p>
<p>To engage DDoS response support, see
<a href="/armor/docs/managed-protection-using#ddos-response-support">Engaging DDoS response support</a>.</p>
<h2 data-text="DDoS bill protection" id="ddos_bill_protection">DDoS bill protection</h2>
<p>Google Cloud Armor DDoS bill protection provides credits for future
Google Cloud usage for some increases in the bills from Cloud Load
Balancing, Google Cloud Armor, and network internet, inter-region, and
inter-zone egress as a result of a verified DDoS attack. If a claim is
recognized and a credit is provided, the credit cannot be used to offset
existing usage; the credit can only apply to future usage. The following table
demonstrates what resources are covered by DDos bill protection:</p>
<table>
<tr>
<th width="30%">Endpoint Type</th>
<th width="70%">Covered Usage Increase</th>
</tr>
<tr>
<td>External HTTP(S) Load Balancing, external TCP Proxy Load Balancing, external SSL Proxy Load Balancing</td>
<td>Cloud Load Balancing
       <ul>
<li>Ingress Data Processing Fee</li>
<li>HTTP(S) Load Balancing Request Logging</li>
</ul>
</td>
</tr>
<tr>
<td></td>
<td>Google Cloud Armor
         <ul>
<li>Managed Protection data processing fee</li>
</ul>
</td>
</tr>
<tr>
<td></td>
<td>Network egress
        <ul>
<li>Inter-region, inter-zone egress</li>
<li>Internet egress</li>
<li>Carrier peering egress</li>
</ul>
</td>
</tr>
</table>
<p>To engage DDoS bill protection, see
<a href="/armor/docs/managed-protection-using#ddos-bill-protection">Engaging DDoS bill protection</a>.</p>
<h2 data-text="Terms and limitations" id="terms_and_limitations">Terms and limitations</h2>
<p>To learn more about the terms and limitations of Managed Protection Plus,
see the <a href="/terms/service-terms#networking">Service Specific Terms</a> page and
follow these steps:</p>
<ol>
<li>Click <strong>Service Terms</strong>. </li>
<li>Scroll to <strong>9. Google Cloud Armor – Managed Protection Plus</strong>.</li>
</ol>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/managed-protection-using">Subscribe and enroll projects in Managed Protection Plus</a></li>
<li><a href="/armor/docs/troubleshooting">Troubleshoot issues</a></li>
<li><a href="/armor/docs/rules-language-reference">Use the custom rules language reference</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr><p style="background-color:lightgray;"<H1>[ Page URL:https://cloud.google.com//armor/docs/adaptive-protection-overview]</H1></p><div class="devsite-article-body clearfix">
<p>Google Cloud Armor Adaptive Protection helps you protect your Google Cloud applications, websites,
and services against L7 distributed denial-of-service (DDoS) attacks such as
HTTP floods and other high-frequency layer 7 (application-level) malicious
activity. Adaptive Protection builds machine-learning models that do the
following:</p>
<ol>
<li>Detect and alert on anomalous activity</li>
<li>Generate a signature describing the potential attack</li>
<li>Generate a custom Google Cloud Armor WAF rule to block the signature</li>
</ol>
<p>You enable or disable Adaptive Protection on a per-security-policy
basis.</p>
<p>Alerts about anomalous traffic (potential attacks), which include the signatures
of the attacks, appear in the Adaptive Protection event dashboard with event
logs sent to Cloud Logging, where they can be directly analyzed or forwarded
to a downstream log or security event monitoring workflow. Alerts of potential
attacks are also generated as findings in the
<a href="https://console.cloud.google.com/projectselector2/security/command-center/welcome">Security Command Center</a>.</p>
<h2 data-text="Availability of Adaptive Protection" id="availability_of">Availability of Adaptive Protection</h2>
<p>Full Adaptive Protection alerts are available only if you
subscribe to Google Cloud Armor Managed Protection Plus. Otherwise, you receive only a
<em>basic alert</em>, without an <em>attack signature</em> or the ability to deploy a
suggested rule.</p>
<p>If your projects are not already enrolled in Managed Protection Plus, read
<a href="/armor/docs/managed-protection-using">Using Managed Protection</a> for
information about how to enroll.</p>
<h2 data-text="Cloud Logging and Cloud Monitoring" id="and">Cloud Logging and Cloud Monitoring</h2>
<p>Because using Adaptive Protection effectively requires you to understand
how logging and alerting work in Google Cloud, we recommend that you
familiarize yourself with Cloud Logging, alerting, and alerting policies.</p>
<ul>
<li>For general logging information, see the <a href="/logging/docs/basic-concepts">Cloud Logging documentation</a>.</li>
<li>For information about alerting, see the <a href="/monitoring/alerts">Cloud Monitoring documentation</a>.</li>
<li>For Google Cloud Armor-specific logging information, see <a href="/armor/docs/request-logging">Using request logging</a>.</li>
</ul>
<h2 data-text="Configuring and tuning alerts" id="configure-alert-tuning">Configuring and tuning alerts</h2>
<p>You can enable Adaptive Protection in projects where Google Cloud Armor
security policies already protect your applications. When you enable
Adaptive Protection for a particular security policy,
Adaptive Protection is in effect for all backend services with which the
security policy is associated.</p>
<p>After Adaptive Protection is enabled, there's a training period of at least
one hour before Adaptive Protection develops a reliable baseline and
begins monitoring traffic and generating alerts. During the training period,
Adaptive Protection models incoming traffic and usage patterns that are
specific to each backend service, so that it develops the baseline for each
backend service. When the training period is over, you receive real-time alerts
when Adaptive Protection identifies high frequency or high volume anomalies
in the traffic directed to any of the backend services associated with that
security policy.</p>
<p>You can tune Adaptive Protection alerts based on several metrics. The
alerts, which are sent to Cloud Logging, include a <em>confidence level</em>, an
<em>attack signature</em>, a suggested rule, and an estimated <em>impacted baseline rate</em>
associated with the suggested rule.</p>
<ul>
<li>The confidence level indicates the confidence with which Adaptive Protection
models predict that the observed change in traffic pattern is anomalous.</li>
<li>The impacted baseline rates associated with the suggested rule represent the
percentage of existing baseline traffic that is caught by the rule. Two
rates are provided. The first is the percentage relative to the traffic into
the specific backend service under attack. The second is the percentage
relative to all the traffic going through the security policy including all
configured backend service targets (not just the one being attacked).</li>
</ul>
<p>You can filter alerts in Cloud Logging based on the
confidence level or the impacted baseline rates, or both. For more information
about tuning alerts, see <a href="/monitoring/alerts/using-alerting-ui">Managing alerting policies</a>.</p>
<h2 data-text="Consuming and interpreting alerts" id="consume-interpret-alerts">Consuming and interpreting alerts</h2>
<p>As soon as Adaptive Protection detects a suspected attack, it generates an
event in the Adaptive Protection event dashboard and generates a log item in
Cloud Logging. The alert is in the JSON payload of the log item. The
log item is generated under the <strong>Network Security Policy</strong> resource in
Cloud Logging. The log message identifies the backend service under
attack and includes a confidence score indicating how strongly
Adaptive Protection rates the identified traffic pattern change as anomalous.
The log message also includes an <em>attack signature</em> that illustrates the
characteristics of the attack traffic, along with suggested
Google Cloud Armor rules that you might apply to mitigate the attack.</p>
<h3 data-text="Understanding attack signatures" id="understand-attack-signature">Understanding attack signatures</h3>
<p>An Adaptive Protection alert includes an <em>attack signature</em>, which is a
description of the traffic attributes of the potential attack. You use the
signature to identify and potentially block the attack. The signature takes two
forms: as a user-readable table and as a preconstructed Google Cloud Armor WAF
rule that you can deploy in the relevant security policy. If you are
not subscribed to Google Cloud Armor Managed Protection Plus, an <em>attack signature</em> is not included
in the basic alert.</p>
<p>The signature consists of a set of attributes, such as source IP address,
geographical regions, cookies, user agents, referers and other HTTP request
headers, and the set of values for those attributes thought to be associated
with the potential attack traffic. The set of attributes is not user-
configurable. The attribute values depend on the values in the incoming traffic
to your backend service.</p>
<p>For each attribute value that Adaptive Protection believes indicates the
potential attack, Adaptive Protection lists the following:</p>
<ul>
<li>The attack likelihood</li>
<li>The proportion of the attribute in the attack, which is the percentage of
potential attack traffic that had this value at the time that the attack
was detected</li>
<li>The proportion of the attribute in baseline, which is the percentage of
baseline traffic that possessed this attribute value at time that the
attack was detected</li>
</ul>
<p><a href="/armor/docs/adaptive-protection-overview#logging-entry">Cloud Logging entry specification</a>
contains details about the information in each alert.</p>
<p>The following is an example of a user-readable table that contains the signature
of a potential attack:</p>
<table>
<thead>
<tr>
<th width="16%">Attribute name</th>
<th width="16%">Value</th>
<th width="17%">Match type</th>
<th width="17%">Attack likelihood</th>
<th width="17%">Proportion in attack</th>
<th width="17%">Proportion in baseline</th>
</tr>
</thead>
<tbody>
<tr>
<td><code dir="ltr" translate="no">UserAgent</code></td>
<td>"foo"</td>
<td>Exact match</td>
<td>0.7</td>
<td>0.85</td>
<td>0.12</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">UserAgent</code></td>
<td>"bar"</td>
<td>Exact match</td>
<td>0.6</td>
<td>0.7</td>
<td>0.4</td>
</tr>
<tr>
<td>Source IP</td>
<td>"a.b.c.d"</td>
<td>Exact match</td>
<td>0.95</td>
<td>0.1</td>
<td>0.01</td>
</tr>
<tr>
<td>Source IP</td>
<td>a.b.c.e</td>
<td>Exact match</td>
<td>0.95</td>
<td>0.1</td>
<td>0.01</td>
</tr>
<tr>
<td>Source IP</td>
<td>a.b.c.f</td>
<td>Exact match</td>
<td>0.05</td>
<td>0.1</td>
<td>0.1</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">RegionCode</code></td>
<td>UK</td>
<td>Exact match</td>
<td>0.64</td>
<td>0.3</td>
<td>0.1</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">RegionCode</code></td>
<td>IN</td>
<td>Exact match</td>
<td>0.25</td>
<td>0.2</td>
<td>0.3</td>
</tr>
<tr>
<td><code dir="ltr" translate="no">RequestUri</code></td>
<td>/urlpart</td>
<td>Substring</td>
<td>0.7</td>
<td>0.85</td>
<td>0.12</td>
</tr>
</tbody>
</table>
<p>An Adaptive Protection alert and the relevant Cloud Logging event
log contain the following:</p>
<ul>
<li>A unique alert ID, or <code dir="ltr" translate="no">alertID</code>, which is used to refer to a specific alert
when it reports user feedback (more below)</li>
<li>The backend service under attack, or <code dir="ltr" translate="no">backendService</code></li>
<li>The confidence score, or <code dir="ltr" translate="no">confidence</code>, which is a number between 0 and 1 that
indicates how strongly the Adaptive Protection system rates the detected
event as a malicious attack</li>
</ul>
<p>You also receive a set of signatures and rules characterizing the
detected attack. Specifically, the set provides a list of <code dir="ltr" translate="no">headerSignatures</code>,
each corresponding to one HTTP header and containing a list of <code dir="ltr" translate="no">significantValues</code>
for the specific header. Each significant value is either an observed header
value or a substring of it.</p>
<p>The following is an example signature:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
...
headerSignatures: [
  0: {
   name: "Referer"
   significantValues: [
    0: {
     attackLikelihood: 0.95
     matchType: "MATCH_TYPE_EQUALS"
     proportionInAttack: 0.6
     proportionInBaseline: 0.01
     value: "foo.attacker.com"
    }
   ]
  }
...
</pre>
<p>The alert suggests that the value <code dir="ltr" translate="no">foo.attacker.com</code> in the header <code dir="ltr" translate="no">Referer</code> is
important in characterizing the attack. More specifically, 60% of the attack
traffic (<code dir="ltr" translate="no">proportionInAttack</code>) has this <code dir="ltr" translate="no">Referer</code> value and only 1% of baseline
traffic among all traffic (<code dir="ltr" translate="no">proportionInBaseline</code>) has the same <code dir="ltr" translate="no">Referer</code>
value. Moreover, among all traffic matching this <code dir="ltr" translate="no">Referer</code> value, 95% is attack
traffic (<code dir="ltr" translate="no">attackLikelihood</code>).</p>
<p>These values suggest that if you were to block all requests with <code dir="ltr" translate="no">foo.attacker.com</code>
in the <code dir="ltr" translate="no">Referer</code> header field, you would successfully block 60% of the attack
and also 1% of the baseline traffic.</p>
<p>The property <code dir="ltr" translate="no">matchType</code> specifies the relationship between the
attribute in the attack traffic and the significant value. It can be either
<code dir="ltr" translate="no">MATCH_TYPE_CONTAINS</code> or <code dir="ltr" translate="no">MATCH_TYPE_EQUALS</code>.</p>
<p>The next signature matches traffic with a substring <code dir="ltr" translate="no">/api?</code> in the request URI:</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
...
headerSignatures: [
  0: {
   name: "RequestUri"
   significantValues: [
    0: {
     attackLikelihood: 0.95
     matchType: "MATCH_TYPE_CONTAINS"
     proportionInAttack: 0.9
     proportionInBaseline: 0.01
     value: "/api?"
    }
   ]
  }
...
</pre>
<h3 data-text="Deploying suggested rules" id="deploy-tune-rules">Deploying suggested rules</h3>
<p>Adaptive Protection alerts also provide a suggested Google Cloud Armor
rule expressed in the <a href="/armor/docs/rules-language-reference">custom rules language</a>.
This rule can be used to create a rule in a Google Cloud Armor security
policy to mitigate the attack. In addition to the signature, the alert
includes a rate of impacted baseline traffic to help you evaluate the impact of
deploying the rule. The rate of impacted baseline traffic is a projected
proportion of baseline traffic that matches the attack signature identified by
Adaptive Protection. If you are not subscribed to Google Cloud Armor Managed Protection Plus,
 <em>basic alerts</em> sent by Adaptive Protection do not include a suggested
Google Cloud Armor rule that you can apply.</p>
<p>You can find some of the alert signature as well as the impacted baseline rate
in the log message sent to Cloud Logging. The following example is the JSON
payload of a sample alert along with the resource labels on which you can filter
the logs.</p>
<pre class="devsite-click-to-copy" dir="ltr" translate="no">
...
 jsonPayload: {
   alertId: "11275630857957031521"
   backendService: "test-service"
   confidence: 0.71828485
   headerSignatures: [

    0: {
     name: "RequestUri"
     significantValues: [
      0: {
       attackLikelihood: 0.88
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.85
       proportionInBaseline: 0.01
       value: "/"
      }
     ]
    }
    1: {
     name: "RegionCode"
     significantValues: [
      0: {
       attackLikelihood: 0.08
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.17
       proportionInBaseline: 0.28
       value: "US"
      }
      1: {
       attackLikelihood: 0.68
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.09
       proportionInBaseline: 0.01
       value: "DE"
      }
      2: {
       attackLikelihood: 0.74
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.05
       proportionInBaseline: 0
       value: "MD"
      }
     ]
    }
     2: {
     name: "UserAgent"
     significantValues: [
      0: {
       attackLikelihood: 0.92
       matchType: "MATCH_TYPE_EQUALS"
       proportionInAttack: 0.85
       proportionInBaseline: 0
       value: "Unusual browser"
      }
      1: {
       attackLikelihood: 0.87
       proportionInAttack: 0.7
       proportionInBaseline: 0.1
       missing: true
      }
     ]
    }
   ]
   suggestedRule: [
    0: {
     action: "DENY"
     evaluation: {
       impactedAttackProportion: 0.95
       impactedBaselineProportion: 0.001
       impactedBaselinePolicyProportion: 0.001
     }
     expression: "evaluateAdaptiveProtection('11275630857957031521')"
    }
   ]
   ruleStatus: RULE_GENERATED
   attackSize: 5000
 }
 resource: {
    type: "network_security_policy",
    labels: {
      project_id: "your-project",
      policy_name: "your-security-policy-name"
    }
 },
}
}
...
</pre>
<p>You can deploy suggested rules by copying the CEL expression from the rule
signature and pasting the expression into the match condition of a newly created
rule, or by clicking the <strong>Apply</strong> button on the Adaptive Protection
dashboard in the Google Cloud Armor UI.</p>
<p>To deploy the rule, you create a new rule in the Google Cloud Armor security
policy that protects the targeted backend services identified by the alert.
Next, during rule configuration, copy and paste the CEL expression from the
alert into the <strong>Match condition</strong> field of the rule and set the rule action to
<code dir="ltr" translate="no">deny</code>. In the above example, you copy the expression
<code dir="ltr" translate="no">evaluateAdaptiveProtection('11275630857957031521')</code> from the <code dir="ltr" translate="no">suggestedRule</code>
section of the alert.</p>
<p>We strongly recommend that you initially deploy the rule in preview mode
so you can evaluate the impact of the rule on production traffic. When you do
this, Google Cloud Armor logs the action and the associated traffic whenever
the rule is triggered, but no action is taken on the matched traffic.</p>
<p>In addition, if your security policy is attached to multiple backend services,
note whether the effects of the new rule have unwanted effects in any of
the backend services. If this happens, configure new security policies to
mitigate the unwanted effects, and attach them to the correct backend services.</p>
<figure style="text-align: center">
<a href="/armor/images/caap-add-rule.svg">
<img alt="Deploying a suggested Adaptive Protection rule" border="0" src="/armor/images/caap-add-rule.svg" width="700"/></a>
<figcaption>Deploying a suggested Adaptive Protection rule (click to
   enlarge)</figcaption>
</figure>
<p>We recommend that you set the priority for the new rule higher than any rules
with the action set to allow. This is because, to have the projected impact and
have maximal effect in mitigating the attack, the rule should be deployed in the
highest logical priority position to ensure that all matching traffic is blocked
by the rule. Rules in a Google Cloud Armor security policy are evaluated in
priority order with evaluation terminating after the first matching rule is
triggered and the associated rule action is taken. If you need to grant an
exception for some traffic or specific clients from this rule, an "allow" rule
can be created with higher priority, that is, with a lower numerical value.
For more information about rule priority, see
<a href="/armor/docs/security-policy-overview#eval-order">Rule evaluation order</a>.</p>
<h3 data-text="Rule status" id="rule-status">Rule status</h3>
<p>If no rule is presented when you attempt to deploy a suggested rule, you can
use the <code dir="ltr" translate="no">ruleStatus</code> field to determine the cause.</p>
<pre dir="ltr" translate="no">
 ]
ruleStatus: RULE_GENERATED
attackSize: 5000
}
</pre>
<p>The following table describes the possible values of the field and what they
mean.</p>
<table>
<tr>
<th>Rule status</th>
<th>Description</th>
</tr>
<tr>
<td>RULE_GENERATED</td>
<td>A usable rule was generated normally.</td>
</tr>
<tr>
<td>BASELINE_TOO_RECENT</td>
<td>Not enough time to accumulate reliable baseline traffic. Up to one hour is necessary to generate rules.</td>
</tr>
<tr>
<td>NO_SIGNIFICANT_VALUE_DETECTED</td>
<td>No headers have significant values associated with attack traffic, so no rule could be generated.</td>
</tr>
<tr>
<td>NO_USABLE_RULE_FOUND</td>
<td>No usable rule could be created.</td>
</tr>
<tr>
<td>ERROR</td>
<td>An unspecified error occurred when creating the rule.</td>
</tr>
</table>
<h3 data-text="Monitoring, feedback, and reporting event errors" id="monitor-feedback-report-errors">Monitoring, feedback, and reporting event errors</h3>
<p>You need the following permissions to view or interact with the
Adaptive Protection dashboard.</p>
<ul>
<li><code dir="ltr" translate="no">compute.securityPolicies.list</code></li>
<li><code dir="ltr" translate="no">compute.backendServices.list</code></li>
<li><code dir="ltr" translate="no">logging.logEntries.list</code></li>
</ul>
<p>After you enable Adaptive Protection on any Google Cloud Armor security
policy, you can see the following page under <strong>Network Security &gt;
Google Cloud Armor</strong> panel. It displays the traffic volume over time for the
selected security policy and backend service, and the selected duration. Any
instances of potential attacks alerted by Adaptive Protection are annotated
on the graph and listed below the graph. When you click a specific attack event,
a side window is displayed with the attack signature and suggested rule shown in
tabular format. This is same information that's in the Cloud Logging log
entries that are described in <a href="#logging-entry">Cloud Logging entry specification</a>.
Click the <strong>Apply</strong> button to add the suggested rule to the same security policy.</p>
<figure style="text-align: center">
<a href="/armor/images/caap-dashboard.svg">
<img alt="Adaptive Protection dashboard" border="0" src="/armor/images/caap-dashboard.svg" width="700"/></a>
<figcaption>Adaptive Protection dashboard (click to
   enlarge)</figcaption>
</figure>
<figure style="text-align: center">
<a href="/armor/images/alert-details.svg">
<img alt="Adaptive Protection alert details" border="0" src="/armor/images/alert-details.svg" width="700"/></a>
<figcaption>Adaptive Protection dashboard (click to
   enlarge)</figcaption>
</figure>
<p>Not every Adaptive Protection finding is deemed an attack, given the
protected backend service's unique context and environmental factors. If you
determine that the potential attack described by the alert is normal or accepted
behavior, then you can report an event error to help train the
Adaptive Protection models. Next to each attack event listed under the graph
is a button that pops up an interactive window to allow you to report an event
error with some optional context. Reporting an event error helps reduce the
likelihood of similar errors in the future. Over time, this increases
Adaptive Protection's accuracy.</p>
<h3 data-text="Monitoring, alerting, and logging" id="monitor-alert-log">Monitoring, alerting, and logging</h3>
<p>Adaptive Protection telemetry is sent to Cloud Logging as well as
the Security Command Center. The Adaptive Protection log message sent to
Cloud Logging is described in the previous sections of this document. A
log entry is generated every time Adaptive Protection detects a potential
attack and each entry contains a confidence score describing how confident the
models are that the observed traffic is anomalous. To fine-tune alerting, an
alerting policy can be configured in Cloud Logging to trigger an alert
only when an Adaptive Protection log message has a confidence score above a
user-specified threshold. We recommend that you start with a low threshold, with
confidence &gt; 0.5, to avoid missing warnings of potential attacks. The confidence
threshold in the alerting policy can be increased over time if the alerts have
an unacceptable impacted baseline rate.</p>
<p>The Security Command Center dashboard also contains findings from
Adaptive Protection. They are located in the Google Cloud Armor card under
the <strong>Application DDoS Attacks</strong> category. Each finding includes the details of
the service, the attack confidence, the signature associated with the attack,
and a link to the specific alert on the Adaptive Protection dashboard.</p>
<h3 data-text="Cloud Logging entry specification" id="logging-entry">Cloud Logging entry specification</h3>
<p>The Adaptive Protection alert sent to Cloud Logging consists of a
log entry containing the following elements:</p>
<ul>
<li>Alert confidence: Adaptive Protection confidence that the event observed
is an attack.</li>
<li>Attack signature
<ul>
<li>Attribute name: The name of the attribute which matches to the <code dir="ltr" translate="no">Value</code>
below, such as a particular request header name or a geographic origin.</li>
<li>Value: The value to which the attribute in malicious traffic matches.</li>
<li>Match type: The relationship between <code dir="ltr" translate="no">Value</code> and the attribute in attack
traffic. The value is either equal to or a substring of an attribute in
attack traffic.</li>
<li>Attack likelihood: The likelihood that a given request is malicious, given
that the relevant attribute of this request matches <code dir="ltr" translate="no">Value</code>.</li>
<li>Proportion in attack: The percent of potential attack traffic that matches
<code dir="ltr" translate="no">Value</code>.</li>
<li>Proportion in baseline: The percent of normal, baseline traffic that matches
<code dir="ltr" translate="no">Value</code>.</li>
</ul></li>
<li>Suggested rule
<ul>
<li>Match condition: The expression to be used in the rules match condition to
identify malicious traffic.</li>
<li>Impacted baseline rate: The projected percentage of good traffic to the
specific backend service under attack that is captured by the suggested rule.</li>
<li>Impacted baseline rate across policy: The projected percentage of good
traffic to all the backend services in the same security policy that is
captured by the suggested rule.</li>
<li>Impacted attack rate: The projected percentage of attack traffic that is
captured by the suggested rule.</li>
</ul></li>
<li>Rule status: Additional details about rule generation.</li>
</ul>
<h2 data-text="Machine learning overview and privacy" id="ml-privacy">Machine learning overview and privacy</h2>
<ul>
<li>Training data and detection data
<ul>
<li>Adaptive Protection builds several models to
detect potential attacks and identify their signatures. The signals used by
these models to determine if an attack is ongoing are derived from the
observed metadata of incoming request traffic from your projects. Such
metadata includes: source IP address, source geography, and the values of
some HTTP request headers.</li>
<li>The actual features used by the models are derived statistical properties
of the above-mentioned signals. That is, the
training data for the models do not include the actual values of any
metadata, such as IP addresses and/or request header values.</li>
<li>A common set of detection models, trained with only artificial data are
shared across all customers, to determine whether an attack is taking place,
when Adaptive Protection is first enabled. Once you report any false
attack event and the models are updated using traffic signals specific from
your projects, these models are local to your projects and are not
used for any other customers.</li>
</ul></li>
<li>Signature generation data
<ul>
<li>After Adaptive Protection determines that a potential attack is
taking place, it generates an attack signature that's effective to help the
target mitigate the attack quickly. To achieve the above, after
you enable Adaptive Protection on a security policy, traffic metrics and
request metadata to a backend service (associated with the security policy)
are continually recorded to learn baseline traffic characteristics.</li>
<li>Because Adaptive Protection needs to learn about the baseline traffic,
Adaptive Protection might require up to one hour before generating rules
to mitigate potential attacks.</li>
</ul></li>
</ul>
<h2 data-text="What's next" id="whats_next">What's next</h2>
<ul>
<li><a href="/armor/docs/adaptive-protection-use-cases">Learn about common use cases for Adaptive Protection</a></li>
<li><a href="/armor/docs/managed-protection-overview">Learn about the features in Managed Protection tiers</a></li>
<li><a href="/armor/docs/managed-protection-using">Learn how to enable Managed Protection</a></li>
</ul>
<devsite-hats-survey class="nocontent" hats-id="Nd7nTix2o0eU5NUYprb0ThtUc5jf" listnr-id="83405"></devsite-hats-survey>
</div><hr>